       algorithm</a>.</ol>

     <dt id=fatal-decode-error>If the <a href=#media-data id=loading-the-media-resource:media-data-12>media data</a> is corrupted<dd>

      <p>Fatal errors in decoding the <a href=#media-data id=loading-the-media-resource:media-data-13>media data</a> that occur after the user agent has
      established whether the <var>current media resource</var> is usable (i.e. once the <a href=#media-element id=loading-the-media-resource:media-element-44>media element</a>'s
      <code id=loading-the-media-resource:dom-media-readystate-6><a href=#dom-media-readystate>readyState</a></code> attribute is no longer <code id=loading-the-media-resource:dom-media-have_nothing-3><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>) must cause the
      user agent to execute the following steps:</p>

      <ol><li><p>The user agent should cancel the fetching process.<li><p>Set the <code id=loading-the-media-resource:dom-media-error-4><a href=#dom-media-error>error</a></code> attribute to the result of
       <a href=#creating-a-mediaerror id=loading-the-media-resource:creating-a-mediaerror-3>creating a <code>MediaError</code></a> with <code id=loading-the-media-resource:dom-mediaerror-media_err_decode><a href=#dom-mediaerror-media_err_decode>MEDIA_ERR_DECODE</a></code>.<li><p>Set the element's <code id=loading-the-media-resource:dom-media-networkstate-17><a href=#dom-media-networkstate>networkState</a></code> attribute
       to the <code id=loading-the-media-resource:dom-media-network_idle-7><a href=#dom-media-network_idle>NETWORK_IDLE</a></code> value.<li><p>Set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-11>delaying-the-load-event flag</a> to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-11>delaying the load event</a>.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-18 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-error-3><a href=#event-media-error>error</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-45>media element</a>.<li><p>Abort the overall <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm-5>resource selection
       algorithm</a>.</ol>

     <dt>If the <a href=#media-data id=loading-the-media-resource:media-data-14>media data</a> fetching process is aborted by the user<dd>

      <p>The fetching process is aborted by the user, e.g. because the user
      pressed a "stop" button, the user agent must execute the following steps. These steps are not
      followed if the <code id=loading-the-media-resource:dom-media-load-2><a href=#dom-media-load>load()</a></code> method itself is invoked while
      these steps are running, as the steps above handle that particular kind of abort.</p>

      <ol><li><p>The user agent should cancel the fetching process.<li><p>Set the <code id=loading-the-media-resource:dom-media-error-5><a href=#dom-media-error>error</a></code> attribute to the result of
       <a href=#creating-a-mediaerror id=loading-the-media-resource:creating-a-mediaerror-4>creating a <code>MediaError</code></a> with <code id=loading-the-media-resource:dom-mediaerror-media_err_aborted><a href=#dom-mediaerror-media_err_aborted>MEDIA_ERR_ABORTED</a></code>.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-19 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-abort-2><a href=#event-media-abort>abort</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-46>media element</a>.<li>

        <p>If the <a href=#media-element id=loading-the-media-resource:media-element-47>media element</a>'s <code id=loading-the-media-resource:dom-media-readystate-7><a href=#dom-media-readystate>readyState</a></code>
        attribute has a value equal to <code id=loading-the-media-resource:dom-media-have_nothing-4><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>, set
        the element's <code id=loading-the-media-resource:dom-media-networkstate-18><a href=#dom-media-networkstate>networkState</a></code> attribute to the
        <code id=loading-the-media-resource:dom-media-network_empty-3><a href=#dom-media-network_empty>NETWORK_EMPTY</a></code> value, set the element's
        <a href=#show-poster-flag id=loading-the-media-resource:show-poster-flag-4>show poster flag</a> to true, and <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-20 data-x-internal=concept-event-fire>fire an
        event</a> named <code id=loading-the-media-resource:event-media-emptied-2><a href=#event-media-emptied>emptied</a></code> at the element.</p>

        <p>Otherwise, set the element's <code id=loading-the-media-resource:dom-media-networkstate-19><a href=#dom-media-networkstate>networkState</a></code>
        attribute to the <code id=loading-the-media-resource:dom-media-network_idle-8><a href=#dom-media-network_idle>NETWORK_IDLE</a></code> value.</p>

       <li><p>Set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-12>delaying-the-load-event flag</a> to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-12>delaying the load event</a>.<li><p>Abort the overall <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm-6>resource selection
       algorithm</a>.</ol>

     <dt id=non-fatal-media-error>If the <a href=#media-data id=loading-the-media-resource:media-data-15>media data</a> can be fetched but has non-fatal
     errors or uses, in part, codecs that are unsupported, preventing the user agent from rendering
     the content completely correctly but not preventing playback altogether<dd>

      <p>The server returning data that is partially usable but cannot be optimally rendered must
      cause the user agent to render just the bits it can handle, and ignore the rest.</p>

      

     <dt id=found-a-media-resource-specific-timed-track>If the <a href=#media-resource id=loading-the-media-resource:media-resource-19>media resource</a> is
     found to declare a <a href=#media-resource-specific-text-track id=loading-the-media-resource:media-resource-specific-text-track-2>media-resource-specific text track</a> that the user agent
     supports<dd>

      <p>If the <a href=#media-data id=loading-the-media-resource:media-data-16>media data</a> is <a href=#cors-same-origin id=loading-the-media-resource:cors-same-origin-3>CORS-same-origin</a>, run the <a href=#steps-to-expose-a-media-resource-specific-text-track id=loading-the-media-resource:steps-to-expose-a-media-resource-specific-text-track>steps to
      expose a media-resource-specific text track</a> with the relevant data.</p>

      <p class=note>Cross-origin videos do not expose their subtitles, since that would allow
      attacks such as hostile sites reading subtitles from confidential videos on a user's
      intranet.</p>

     </dl>

   <li><p><i>Final step:</i> If the user agent ever reaches this step (which can only happen if the entire resource
   gets loaded and kept available): abort the overall <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm-7>resource selection algorithm</a>.</ol>

  <p>When a <a href=#media-element id=loading-the-media-resource:media-element-48>media element</a> is to <dfn id="forget-the-media-element's-media-resource-specific-tracks">forget the media element's media-resource-specific
  tracks</dfn>, the user agent must remove from the <a href=#media-element id=loading-the-media-resource:media-element-49>media element</a>'s <a href=#list-of-text-tracks id=loading-the-media-resource:list-of-text-tracks>list of text
  tracks</a> all the <a href=#media-resource-specific-text-track id=loading-the-media-resource:media-resource-specific-text-track-3>media-resource-specific
  text tracks</a>, then empty the <a href=#media-element id=loading-the-media-resource:media-element-50>media element</a>'s <code id=loading-the-media-resource:dom-media-audiotracks-2><a href=#dom-media-audiotracks>audioTracks</a></code> attribute's <code id=loading-the-media-resource:audiotracklist-3><a href=#audiotracklist>AudioTrackList</a></code> object,
  then empty the <a href=#media-element id=loading-the-media-resource:media-element-51>media element</a>'s <code id=loading-the-media-resource:dom-media-videotracks-2><a href=#dom-media-videotracks>videoTracks</a></code>
  attribute's <code id=loading-the-media-resource:videotracklist-3><a href=#videotracklist>VideoTrackList</a></code> object. No events (in particular, no <code id=loading-the-media-resource:event-media-removetrack><a href=#event-media-removetrack>removetrack</a></code> events) are fired as part of this; the <code id=loading-the-media-resource:event-media-error-4><a href=#event-media-error>error</a></code> and <code id=loading-the-media-resource:event-media-emptied-3><a href=#event-media-emptied>emptied</a></code>
  events, fired by the algorithms that invoke this one, can be used instead.</p>

  

  <hr>

  <p>The <dfn id=attr-media-preload><code>preload</code></dfn> attribute is an <a href=#enumerated-attribute id=loading-the-media-resource:enumerated-attribute>enumerated
  attribute</a>. The following table lists the keywords and states for the attribute â€” the
  keywords in the left column map to the states in the cell in the second column on the same row as
  the keyword. The attribute can be changed even once the <a href=#media-resource id=loading-the-media-resource:media-resource-20>media resource</a> is being
  buffered or played; the descriptions in the table below are to be interpreted with that in
  mind.</p>

  <table><thead><tr><th> Keyword
     <th> State
     <th> Brief description
   <tbody><tr><td><dfn id=attr-media-preload-none><code>none</code></dfn>
     <td><dfn id=attr-media-preload-none-state>None</dfn>
     <td>Hints to the user agent that either the author does not expect the user to need the media resource, or that the server wants to minimize unnecessary traffic.
         This state does not provide a hint regarding how aggressively to actually download the media resource if buffering starts anyway (e.g. once the user hits "play").
    <tr><td><dfn id=attr-media-preload-metadata><code>metadata</code></dfn>
     <td><dfn id=attr-media-preload-metadata-state>Metadata</dfn>
     <td>Hints to the user agent that the author does not expect the user to need the media resource, but that fetching the resource metadata (dimensions, track list, duration, etc), and maybe even the first few frames, is reasonable. If the user agent precisely fetches no more than the metadata, then the <a href=#media-element id=loading-the-media-resource:media-element-52>media element</a> will end up with its <code id=loading-the-media-resource:dom-media-readystate-8><a href=#dom-media-readystate>readyState</a></code> attribute set to <code id=loading-the-media-resource:dom-media-have_metadata-2><a href=#dom-media-have_metadata>HAVE_METADATA</a></code>; typically though, some frames will be obtained as well and it will probably be <code id=loading-the-media-resource:dom-media-have_current_data-2><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> or <code id=loading-the-media-resource:dom-media-have_future_data><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code>.
         When the media resource is playing, hints to the user agent that bandwidth is to be considered scarce, e.g. suggesting throttling the download so that the media data is obtained at the slowest possible rate that still maintains consistent playback.
    <tr><td><dfn id=attr-media-preload-auto><code>auto</code></dfn>
     <td><dfn id=attr-media-preload-auto-state>Automatic</dfn>
     <td>Hints to the user agent that the user agent can put the user's needs first without risk to the server, up to and including optimistically downloading the entire resource.
  </table>

  <p>The empty string is also a valid keyword, and maps to the <a href=#attr-media-preload-auto-state id=loading-the-media-resource:attr-media-preload-auto-state>Automatic</a> state. The attribute's <i id=loading-the-media-resource:missing-value-default><a href=#missing-value-default>missing value default</a></i> is user-agent defined, though the <a href=#attr-media-preload-metadata-state id=loading-the-media-resource:attr-media-preload-metadata-state>Metadata</a> state is suggested as a compromise
  between reducing server load and providing an optimal user experience.</p>

  <p class=note>Authors might switch the attribute from "<code id=loading-the-media-resource:attr-media-preload-none-2><a href=#attr-media-preload-none>none</a></code>" or "<code id=loading-the-media-resource:attr-media-preload-metadata><a href=#attr-media-preload-metadata>metadata</a></code>" to "<code id=loading-the-media-resource:attr-media-preload-auto><a href=#attr-media-preload-auto>auto</a></code>" dynamically once the user begins playback. For
  example, on a page with many videos this might be used to indicate that the many videos are not to
  be downloaded unless requested, but that once one <em>is</em> requested it is to be downloaded
  aggressively.</p>

  

  <p>The <code id=loading-the-media-resource:attr-media-preload-3><a href=#attr-media-preload>preload</a></code> attribute is intended to provide a hint to
  the user agent about what the author thinks will lead to the best user experience. The attribute
  may be ignored altogether, for example based on explicit user preferences or based on the
  available connectivity.</p>

  <p>The <dfn id=dom-media-preload><code>preload</code></dfn> IDL attribute must
  <a href=#reflect id=loading-the-media-resource:reflect>reflect</a> the content attribute of the same name, <a href=#limited-to-only-known-values id=loading-the-media-resource:limited-to-only-known-values>limited to only known
  values</a>.</p>

  

  <p class=note>The <code id=loading-the-media-resource:attr-media-autoplay-2><a href=#attr-media-autoplay>autoplay</a></code> attribute can override the
  <code id=loading-the-media-resource:attr-media-preload-4><a href=#attr-media-preload>preload</a></code> attribute (since if the media plays, it naturally
  has to buffer first, regardless of the hint given by the <code id=loading-the-media-resource:attr-media-preload-5><a href=#attr-media-preload>preload</a></code> attribute). Including both is not an error, however.</p>

  <hr>



  <dl class=domintro><dt><var>media</var> . <code id=loading-the-media-resource:dom-media-buffered><a href=#dom-media-buffered>buffered</a></code><dd>

    <p>Returns a <code id=loading-the-media-resource:timeranges><a href=#timeranges>TimeRanges</a></code> object that represents the ranges of the <a href=#media-resource id=loading-the-media-resource:media-resource-21>media
    resource</a> that the user agent has buffered.</p>

   </dl>

  

  <p>The <dfn id=dom-media-buffered><code>buffered</code></dfn> attribute must return a new
  static <a href=#normalised-timeranges-object id=loading-the-media-resource:normalised-timeranges-object>normalized <code>TimeRanges</code> object</a> that represents the ranges of the
  <a href=#media-resource id=loading-the-media-resource:media-resource-22>media resource</a>, if any, that the user agent has buffered, at the time the attribute
  is evaluated. Users agents must accurately determine the ranges available, even for media streams
  where this can only be determined by tedious inspection.</p>

  <p class=note>Typically this will be a single range anchored at the zero point, but if, e.g. the
  user agent uses HTTP range requests in response to seeking, then there could be multiple
  ranges.</p>

  <p>User agents may discard previously buffered data.</p>

  <p class=note>Thus, a time position included within a range of the objects return by the <code id=loading-the-media-resource:dom-media-buffered-2><a href=#dom-media-buffered>buffered</a></code> attribute at one time can end up being not included in
  the range(s) of objects returned by the same attribute at later times.</p>

  



  <h5 id=offsets-into-the-media-resource>4.8.12.6 Offsets into the media resource<a href=#offsets-into-the-media-resource class=self-link></a></h5>

  <dl class=domintro><dt><var>media</var> . <code id=offsets-into-the-media-resource:dom-media-duration><a href=#dom-media-duration>duration</a></code><dd>

    <p>Returns the length of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource>media resource</a>, in seconds, assuming that the start of
    the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-2>media resource</a> is at time zero.</p>

    <p>Returns NaN if the duration isn't available.</p>

    <p>Returns Infinity for unbounded streams.</p>

   <dt><var>media</var> . <code id=offsets-into-the-media-resource:dom-media-currenttime><a href=#dom-media-currenttime>currentTime</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the <a href=#official-playback-position id=offsets-into-the-media-resource:official-playback-position>official playback position</a>, in seconds.</p>

    <p>Can be set, to seek to the given time.</p>

   </dl>

  

  <p>A <a href=#media-resource id=offsets-into-the-media-resource:media-resource-3>media resource</a> has a <dfn id=media-timeline>media timeline</dfn> that maps times (in seconds) to
  positions in the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-4>media resource</a>. The origin of a timeline is its earliest defined
  position. The duration of a timeline is its last defined position.</p>

  <p><dfn id=defineTimeline>Establishing the media
  timeline</dfn>: If the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-5>media resource</a> somehow specifies an explicit timeline whose
  origin is not negative (i.e. gives each frame a specific time offset and gives the first frame a
  zero or positive offset), then the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline>media timeline</a> should be that timeline. (Whether
  the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-6>media resource</a> can specify a timeline or not depends on the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-7>media resource's</a> format.) If the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-8>media resource</a> specifies an
  explicit start time <em>and date</em>, then that time and date should be considered the zero point
  in the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-2>media timeline</a>; the <a href=#timeline-offset id=offsets-into-the-media-resource:timeline-offset>timeline offset</a> will be the time and date,
  exposed using the <code id=offsets-into-the-media-resource:dom-media-getstartdate><a href=#dom-media-getstartdate>getStartDate()</a></code> method.</p>

  <p>If the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-9>media resource</a> has a discontinuous timeline, the user agent must extend the
  timeline used at the start of the resource across the entire resource, so that the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-3>media
  timeline</a> of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-10>media resource</a> increases linearly starting from the
  <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position>earliest possible position</a> (as defined below), even if the underlying <a href=#media-data id=offsets-into-the-media-resource:media-data>media
  data</a> has out-of-order or even overlapping time codes.</p>

  <p class=example>For example, if two clips have been concatenated into one video file, but the
  video format exposes the original times for the two clips, the video data might expose a timeline
  that goes, say, 00:15..00:29 and then 00:05..00:38. However, the user agent would not expose those
  times; it would instead expose the times as 00:15..00:29 and 00:29..01:02, as a single video.</p>

  <p>In the rare case of a <a href=#media-resource id=offsets-into-the-media-resource:media-resource-11>media resource</a> that does not have an explicit timeline, the
  zero time on the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-4>media timeline</a> should correspond to the first frame of the
  <a href=#media-resource id=offsets-into-the-media-resource:media-resource-12>media resource</a>. In the even rarer case of a <a href=#media-resource id=offsets-into-the-media-resource:media-resource-13>media resource</a> with no
  explicit timings of any kind, not even frame durations, the user agent must itself determine the
  time for each frame in a user-agent-defined manner.
  <a href=#fingerprinting-vector id=offsets-into-the-media-resource:fingerprinting-vector class=fingerprint title="There is a potential fingerprinting vector here."><img alt="(This is a fingerprinting vector.)" src=/images/fingerprint.png width=46 height=64></a>
  </p>

  <p class=note>An example of a file format with no explicit timeline but with explicit frame
  durations is the Animated GIF format. An example of a file format with no explicit timings at all
  is the JPEG-push format (<code id=offsets-into-the-media-resource:multipart/x-mixed-replace><a href=#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code> with JPEG frames, often
  used as the format for MJPEG streams).</p>

  <p>If, in the case of a resource with no timing information, the user agent will nonetheless be
  able to seek to an earlier point than the first frame originally provided by the server, then the
  zero time should correspond to the earliest seekable time of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-14>media resource</a>;
  otherwise, it should correspond to the first frame received from the server (the point in the
  <a href=#media-resource id=offsets-into-the-media-resource:media-resource-15>media resource</a> at which the user agent began receiving the stream).</p>

  <p class=note>At the time of writing, there is no known format that lacks explicit frame time
  offsets yet still supports seeking to a frame before the first frame sent by the server.</p>

  <div class=example>

   <p>Consider a stream from a TV broadcaster, which begins streaming on a sunny Friday afternoon in
   October, and always sends connecting user agents the media data on the same media timeline, with
   its zero time set to the start of this stream. Months later, user agents connecting to this
   stream will find that the first frame they receive has a time with millions of seconds. The <code id=offsets-into-the-media-resource:dom-media-getstartdate-2><a href=#dom-media-getstartdate>getStartDate()</a></code> method would always return the date that the
   broadcast started; this would allow controllers to display real times in their scrubber (e.g.
   "2:30pm") rather than a time relative to when the broadcast began ("8 months, 4 hours, 12
   minutes, and 23 seconds").</p>

   <p>Consider a stream that carries a video with several concatenated fragments, broadcast by a
   server that does not allow user agents to request specific times but instead just streams the
   video data in a predetermined order, with the first frame delivered always being identified as
   the frame with time zero. If a user agent connects to this stream and receives fragments defined
   as covering timestamps 2010-03-20 23:15:00 UTC to 2010-03-21 00:05:00 UTC and 2010-02-12 14:25:00
   UTC to 2010-02-12 14:35:00 UTC, it would expose this with a <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-5>media timeline</a> starting
   at 0s and extending to 3,600s (one hour). Assuming the streaming server disconnected at the end
   of the second clip, the <code id=offsets-into-the-media-resource:dom-media-duration-2><a href=#dom-media-duration>duration</a></code> attribute would then
   return 3,600. The <code id=offsets-into-the-media-resource:dom-media-getstartdate-3><a href=#dom-media-getstartdate>getStartDate()</a></code> method would return a
   <code id=offsets-into-the-media-resource:date><a data-x-internal=date href=https://tc39.github.io/ecma262/#sec-date-objects>Date</a></code> object with a time corresponding to 2010-03-20 23:15:00 UTC. However, if a
   different user agent connected five minutes later, <em>it</em> would (presumably) receive
   fragments covering timestamps 2010-03-20 23:20:00 UTC to 2010-03-21 00:05:00 UTC and 2010-02-12
   14:25:00 UTC to 2010-02-12 14:35:00 UTC, and would expose this with a <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-6>media timeline</a>
   starting at 0s and extending to 3,300s (fifty five minutes). In this case, the <code id=offsets-into-the-media-resource:dom-media-getstartdate-4><a href=#dom-media-getstartdate>getStartDate()</a></code> method would return a <code id=offsets-into-the-media-resource:date-2><a data-x-internal=date href=https://tc39.github.io/ecma262/#sec-date-objects>Date</a></code> object
   with a time corresponding to 2010-03-20 23:20:00 UTC.</p>

   <p>In both of these examples, the <code id=offsets-into-the-media-resource:dom-media-seekable><a href=#dom-media-seekable>seekable</a></code> attribute
   would give the ranges that the controller would want to actually display in its UI; typically, if
   the servers don't support seeking to arbitrary times, this would be the range of time from the
   moment the user agent connected to the stream up to the latest frame that the user agent has
   obtained; however, if the user agent starts discarding earlier information, the actual range
   might be shorter.</p>

  </div>

  <p>In any case, the user agent must ensure that the <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-2>earliest possible position</a> (as
  defined below) using the established <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-7>media timeline</a>, is greater than or equal to
  zero.</p>

  <p>The <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-8>media timeline</a> also has an associated clock. Which clock is used is user-agent
  defined, and may be <a href=#media-resource id=offsets-into-the-media-resource:media-resource-16>media resource</a>-dependent, but it should approximate the user's
  wall clock.</p>

  <p><a href=#media-element id=offsets-into-the-media-resource:media-element>Media elements</a> have a <dfn id=current-playback-position>current playback position</dfn>,
  which must initially (i.e. in the absence of <a href=#media-data id=offsets-into-the-media-resource:media-data-2>media data</a>) be zero seconds. The
  <a href=#current-playback-position id=offsets-into-the-media-resource:current-playback-position>current playback position</a> is a time on the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-9>media timeline</a>.</p>

  <p><a href=#media-element id=offsets-into-the-media-resource:media-element-2>Media elements</a> also have an <dfn id=official-playback-position>official playback
  position</dfn>, which must initially be set to zero seconds. The <a href=#official-playback-position id=offsets-into-the-media-resource:official-playback-position-2>official playback
  position</a> is an approximation of the <a href=#current-playback-position id=offsets-into-the-media-resource:current-playback-position-2>current playback position</a> that is kept
  stable while scripts are running.</p>

  <p><a href=#media-element id=offsets-into-the-media-resource:media-element-3>Media elements</a> also have a <dfn id=default-playback-start-position>default playback start
  position</dfn>, which must initially be set to zero seconds. This time is used to allow the
  element to be seeked even before the media is loaded.</p>

  <p>Each <a href=#media-element id=offsets-into-the-media-resource:media-element-4>media element</a> has a <dfn id=show-poster-flag>show poster flag</dfn>. When a <a href=#media-element id=offsets-into-the-media-resource:media-element-5>media
  element</a> is created, this flag must be set to true. This flag is used to control when the
  user agent is to show a poster frame for a <code id=offsets-into-the-media-resource:the-video-element><a href=#the-video-element>video</a></code> element instead of showing the video
  contents.</p>

  <p>The <dfn id=dom-media-currenttime><code>currentTime</code></dfn> attribute must, on
  getting, return the <a href=#media-element id=offsets-into-the-media-resource:media-element-6>media element</a>'s <a href=#default-playback-start-position id=offsets-into-the-media-resource:default-playback-start-position>default playback start position</a>,
  unless that is zero, in which case it must return the element's <a href=#official-playback-position id=offsets-into-the-media-resource:official-playback-position-3>official playback
  position</a>. The returned value must be expressed in seconds. On setting, if the <a href=#media-element id=offsets-into-the-media-resource:media-element-7>media
  element</a>'s <code id=offsets-into-the-media-resource:dom-media-readystate><a href=#dom-media-readystate>readyState</a></code> is <code id=offsets-into-the-media-resource:dom-media-have_nothing><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>, then it must set the <a href=#media-element id=offsets-into-the-media-resource:media-element-8>media
  element</a>'s <a href=#default-playback-start-position id=offsets-into-the-media-resource:default-playback-start-position-2>default playback start position</a> to the new value; otherwise, it must
  set the <a href=#official-playback-position id=offsets-into-the-media-resource:official-playback-position-4>official playback position</a> to the new value and then <a href=#dom-media-seek id=offsets-into-the-media-resource:dom-media-seek>seek</a> to the new value. The new value must be interpreted as being in
  seconds.</p>

  <p>If the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-17>media resource</a> is a streaming resource, then the user agent might be unable
  to obtain certain parts of the resource after it has expired from its buffer. Similarly, some
  <a href=#media-resource id=offsets-into-the-media-resource:media-resource-18>media resources</a> might have a <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-10>media timeline</a> that
  doesn't start at zero. The <dfn id=earliest-possible-position>earliest possible position</dfn> is the earliest position in the
  stream or resource that the user agent can ever obtain again. It is also a time on the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-11>media
  timeline</a>.</p>

  <p class=note>The <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-3>earliest possible position</a> is not explicitly exposed in the API;
  it corresponds to the start time of the first range in the <code id=offsets-into-the-media-resource:dom-media-seekable-2><a href=#dom-media-seekable>seekable</a></code> attribute's <code id=offsets-into-the-media-resource:timeranges><a href=#timeranges>TimeRanges</a></code> object, if any, or
  the <a href=#current-playback-position id=offsets-into-the-media-resource:current-playback-position-3>current playback position</a> otherwise.</p>

  <p>When the <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-4>earliest possible position</a> changes, then: if the <a href=#current-playback-position id=offsets-into-the-media-resource:current-playback-position-4>current playback
  position</a> is before the <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-5>earliest possible position</a>, the user agent must <a href=#dom-media-seek id=offsets-into-the-media-resource:dom-media-seek-2>seek</a> to the <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-6>earliest possible position</a>; otherwise, if
  the user agent has not fired a <code id=offsets-into-the-media-resource:event-media-timeupdate><a href=#event-media-timeupdate>timeupdate</a></code> event at
  the element in the past 15 to 250ms and is not still running event handlers for such an event,
  then the user agent must <a href=#queue-a-task id=offsets-into-the-media-resource:queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=offsets-into-the-media-resource:concept-event-fire data-x-internal=concept-event-fire>fire an
  event</a> named <code id=offsets-into-the-media-resource:event-media-timeupdate-2><a href=#event-media-timeupdate>timeupdate</a></code> at the element.</p>

  <p class=note>Because of the above requirement and the requirement in the <a href=#concept-media-load-resource id=offsets-into-the-media-resource:concept-media-load-resource>resource fetch algorithm</a> that kicks in <a href=#getting-media-metadata>when the metadata of the clip becomes known</a>, the <a href=#current-playback-position id=offsets-into-the-media-resource:current-playback-position-5>current
  playback position</a> can never be less than the <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-7>earliest possible position</a>.</p>

  
  

  <p>If at any time the user agent learns that an audio or video track has ended and all <a href=#media-data id=offsets-into-the-media-resource:media-data-3>media
  data</a> relating to that track corresponds to parts of the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-12>media timeline</a> that
  are <em>before</em> the <a href=#earliest-possible-position id=offsets-into-the-media-resource:earliest-possible-position-8>earliest possible position</a>, the user agent may <a href=#queue-a-task id=offsets-into-the-media-resource:queue-a-task-2>queue a
  task</a> to run these steps:</p>

  <ol><li><p>Remove the track from the <code id=offsets-into-the-media-resource:dom-media-audiotracks><a href=#dom-media-audiotracks>audioTracks</a></code>
   attribute's <code id=offsets-into-the-media-resource:audiotracklist><a href=#audiotracklist>AudioTrackList</a></code> object or the <code id=offsets-into-the-media-resource:dom-media-videotracks><a href=#dom-media-videotracks>videoTracks</a></code> attribute's <code id=offsets-into-the-media-resource:videotracklist><a href=#videotracklist>VideoTrackList</a></code> object
   as appropriate.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=offsets-into-the-media-resource:concept-event-fire-2 data-x-internal=concept-event-fire>Fire an event</a> named <code id=offsets-into-the-media-resource:event-media-removetrack><a href=#event-media-removetrack>removetrack</a></code> at the <a href=#media-element id=offsets-into-the-media-resource:media-element-9>media element</a>'s
   aforementioned <code id=offsets-into-the-media-resource:audiotracklist-2><a href=#audiotracklist>AudioTrackList</a></code> or <code id=offsets-into-the-media-resource:videotracklist-2><a href=#videotracklist>VideoTrackList</a></code> object, using
   <code id=offsets-into-the-media-resource:trackevent><a href=#trackevent>TrackEvent</a></code>, with the <code id=offsets-into-the-media-resource:dom-trackevent-track><a href=#dom-trackevent-track>track</a></code> attribute
   initialized to the <code id=offsets-into-the-media-resource:audiotrack><a href=#audiotrack>AudioTrack</a></code> or <code id=offsets-into-the-media-resource:videotrack><a href=#videotrack>VideoTrack</a></code> object representing the
   track.</ol>

  <p>The <dfn id=dom-media-duration><code>duration</code></dfn> attribute must return the time
  of the end of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-19>media resource</a>, in seconds, on the <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-13>media timeline</a>. If
  no <a href=#media-data id=offsets-into-the-media-resource:media-data-4>media data</a> is available, then the attributes must return the Not-a-Number (NaN)
  value. If the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-20>media resource</a> is not known to be bounded (e.g. streaming radio, or a
  live event with no announced end time), then the attribute must return the positive Infinity
  value.</p>

  <p>The user agent must determine the duration of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-21>media resource</a> before playing
  any part of the <a href=#media-data id=offsets-into-the-media-resource:media-data-5>media data</a> and before setting <code id=offsets-into-the-media-resource:dom-media-readystate-2><a href=#dom-media-readystate>readyState</a></code> to a value equal to or greater than <code id=offsets-into-the-media-resource:dom-media-have_metadata><a href=#dom-media-have_metadata>HAVE_METADATA</a></code>, even if doing so requires fetching multiple
  parts of the resource.</p>

  <p id=durationChange>When the length of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-22>media resource</a> changes to a known value
  (e.g. from being unknown to known, or from a previously established length to a new length) the
  user agent must <a href=#queue-a-task id=offsets-into-the-media-resource:queue-a-task-3>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=offsets-into-the-media-resource:concept-event-fire-3 data-x-internal=concept-event-fire>fire an
  event</a> named <code id=offsets-into-the-media-resource:event-media-durationchange><a href=#event-media-durationchange>durationchange</a></code> at the
  <a href=#media-element id=offsets-into-the-media-resource:media-element-10>media element</a>. (The event is not fired when the duration is reset as part of loading
  a new media resource.) If the duration is changed such that the <a href=#current-playback-position id=offsets-into-the-media-resource:current-playback-position-6>current playback
  position</a> ends up being greater than the time of the end of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-23>media resource</a>,
  then the user agent must also <a href=#dom-media-seek id=offsets-into-the-media-resource:dom-media-seek-3>seek</a> to the time of the end of
  the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-24>media resource</a>.</p>

  <p class=example>If an "infinite" stream ends for some reason, then the duration would change
  from positive Infinity to the time of the last frame or sample in the stream, and the <code id=offsets-into-the-media-resource:event-media-durationchange-2><a href=#event-media-durationchange>durationchange</a></code> event would be fired. Similarly, if the
  user agent initially estimated the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-25>media resource</a>'s duration instead of determining
  it precisely, and later revises the estimate based on new information, then the duration would
  change and the <code id=offsets-into-the-media-resource:event-media-durationchange-3><a href=#event-media-durationchange>durationchange</a></code> event would be
  fired.</p>

  <p>Some video files also have an explicit date and time corresponding to the zero time in the
  <a href=#media-timeline id=offsets-into-the-media-resource:media-timeline-14>media timeline</a>, known as the <dfn id=timeline-offset>timeline offset</dfn>. Initially, the
  <a href=#timeline-offset id=offsets-into-the-media-resource:timeline-offset-2>timeline offset</a> must be set to Not-a-Number (NaN).</p>

  <p>The <dfn id=dom-media-getstartdate><code>getStartDate()</code></dfn> method must return <a href=#create-a-date-object id=offsets-into-the-media-resource:create-a-date-object>a new <code>Date</code> object</a> representing the current
  <a href=#timeline-offset id=offsets-into-the-media-resource:timeline-offset-3>timeline offset</a>.</p>

  

  <hr>

  <p>The <dfn id=attr-media-loop><code>loop</code></dfn> attribute is a <a href=#boolean-attribute id=offsets-into-the-media-resource:boolean-attribute>boolean
  attribute</a> that, if specified, indicates that the <a href=#media-element id=offsets-into-the-media-resource:media-element-11>media element</a> is to seek back
  to the start of the <a href=#media-resource id=offsets-into-the-media-resource:media-resource-26>media resource</a> upon reaching the end.</p>

  

  <p>The <dfn id=dom-media-loop><code>loop</code></dfn> IDL attribute must <a href=#reflect id=offsets-into-the-media-resource:reflect>reflect</a>
  the content attribute of the same name.</p>

  



  <h5 id=ready-states>4.8.12.7 Ready states<a href=#ready-states class=self-link></a></h5>

  <dl class=domintro><dt><var>media</var> . <code id=ready-states:dom-media-readystate><a href=#dom-media-readystate>readyState</a></code><dd>

    <p>Returns a value that expresses the current state of the element with respect to rendering the
    <a href=#current-playback-position id=ready-states:current-playback-position>current playback position</a>, from the codes in the list below.</p>

   </dl>

  

  <p><a href=#media-element id=ready-states:media-element>Media elements</a> have a <i>ready state</i>, which describes to
  what degree they are ready to be rendered at the <a href=#current-playback-position id=ready-states:current-playback-position-2>current playback position</a>. The
  possible values are as follows; the ready state of a media element at any particular time is the
  greatest value describing the state of the element:</p>

  

  <dl><dt><dfn id=dom-media-have_nothing><code>HAVE_NOTHING</code></dfn> (numeric value 0)<dd><p>No information regarding the <a href=#media-resource id=ready-states:media-resource>media resource</a> is available. No data for the
   <a href=#current-playback-position id=ready-states:current-playback-position-3>current playback position</a> is available. <a href=#media-element id=ready-states:media-element-2>Media
   elements</a> whose <code id=ready-states:dom-media-networkstate><a href=#dom-media-networkstate>networkState</a></code> attribute are set
   to <code id=ready-states:dom-media-network_empty><a href=#dom-media-network_empty>NETWORK_EMPTY</a></code> are always in the <code id=ready-states:dom-media-have_nothing><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code> state.<dt><dfn id=dom-media-have_metadata><code>HAVE_METADATA</code></dfn> (numeric value 1)<dd><p>Enough of the resource has been obtained that the duration of the resource is available.
   In the case of a <code id=ready-states:the-video-element><a href=#the-video-element>video</a></code> element, the dimensions of the video are also available. No
   <a href=#media-data id=ready-states:media-data>media data</a> is available for the immediate <a href=#current-playback-position id=ready-states:current-playback-position-4>current playback
   position</a>.<dt><dfn id=dom-media-have_current_data><code>HAVE_CURRENT_DATA</code></dfn> (numeric value 2)<dd><p>Data for the immediate <a href=#current-playback-position id=ready-states:current-playback-position-5>current playback position</a> is available, but either not
   enough data is available that the user agent could successfully advance the <a href=#current-playback-position id=ready-states:current-playback-position-6>current
   playback position</a> in the <a href=#direction-of-playback id=ready-states:direction-of-playback>direction of playback</a> at all without immediately
   reverting to the <code id=ready-states:dom-media-have_metadata><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> state, or there is no
   more data to obtain in the <a href=#direction-of-playback id=ready-states:direction-of-playback-2>direction of playback</a>. For example, in video this
   corresponds to the user agent having data from the current frame, but not the next frame, when
   the <a href=#current-playback-position id=ready-states:current-playback-position-7>current playback position</a> is at the end of the current frame; and to when <a href=#ended-playback id=ready-states:ended-playback>playback has ended</a>.<dt><dfn id=dom-media-have_future_data><code>HAVE_FUTURE_DATA</code></dfn> (numeric value 3)<dd><p>Data for the immediate <a href=#current-playback-position id=ready-states:current-playback-position-8>current playback position</a> is available, as well as
   enough data for the user agent to advance the <a href=#current-playback-position id=ready-states:current-playback-position-9>current playback position</a> in the
   <a href=#direction-of-playback id=ready-states:direction-of-playback-3>direction of playback</a> at least a little without immediately reverting to the <code id=ready-states:dom-media-have_metadata-2><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> state, and <a href=#the-text-tracks-are-ready id=ready-states:the-text-tracks-are-ready>the text tracks are
   ready</a>. For example, in video this corresponds to the user agent having data for at least
   the current frame and the next frame when the <a href=#current-playback-position id=ready-states:current-playback-position-10>current playback position</a> is at the
   instant in time between the two frames, or to the user agent having the video data for the
   current frame and audio data to keep playing at least a little when the <a href=#current-playback-position id=ready-states:current-playback-position-11>current playback
   position</a> is in the middle of a frame. The user agent cannot be in this state if <a href=#ended-playback id=ready-states:ended-playback-2>playback has ended</a>, as the <a href=#current-playback-position id=ready-states:current-playback-position-12>current playback position</a>
   can never advance in this case.<dt><dfn id=dom-media-have_enough_data><code>HAVE_ENOUGH_DATA</code></dfn> (numeric value 4)<dd>

   <p>All the conditions described for the <code id=ready-states:dom-media-have_future_data><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> state are met, and, in addition,
    either of the following conditions is also true:</p>

    <ul><li>The user agent estimates that data is being fetched at a rate where the <a href=#current-playback-position id=ready-states:current-playback-position-13>current
     playback position</a>, if it were to advance at the element's <code id=ready-states:dom-media-playbackrate><a href=#dom-media-playbackrate>playbackRate</a></code>, would not overtake the available data
     before playback reaches the end of the <a href=#media-resource id=ready-states:media-resource-2>media resource</a>.<li>The user agent has entered a state where waiting longer will not result in further data
     being obtained, and therefore nothing would be gained by delaying playback any further. (For
     example, the buffer might be full.)</ul>

   </dl>

  <p class=note>In practice, the difference between <code id=ready-states:dom-media-have_metadata-3><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> and <code id=ready-states:dom-media-have_current_data><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> is negligible. Really the only time
  the difference is relevant is when painting a <code id=ready-states:the-video-element-2><a href=#the-video-element>video</a></code> element onto a
  <code id=ready-states:the-canvas-element><a href=#the-canvas-element>canvas</a></code>, where it distinguishes the case where something will be drawn (<code id=ready-states:dom-media-have_current_data-2><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> or greater) from the case where
  nothing is drawn (<code id=ready-states:dom-media-have_metadata-4><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> or less). Similarly,
  the difference between <code id=ready-states:dom-media-have_current_data-3><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> (only
  the current frame) and <code id=ready-states:dom-media-have_future_data-2><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> (at least
  this frame and the next) can be negligible (in the extreme, only one frame). The only time that
  distinction really matters is when a page provides an interface for "frame-by-frame"
  navigation.</p>

  

  <p>When the ready state of a <a href=#media-element id=ready-states:media-element-3>media element</a> whose <code id=ready-states:dom-media-networkstate-2><a href=#dom-media-networkstate>networkState</a></code> is not <code id=ready-states:dom-media-network_empty-2><a href=#dom-media-network_empty>NETWORK_EMPTY</a></code> changes, the user agent must follow the steps
  given below:</p>

  <ol><li>

    <p>Apply the first applicable set of substeps from the following list:</p>


    <dl class=switch><dt>If the previous ready state was <code id=ready-states:dom-media-have_nothing-2><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>,
     and the new ready state is <code id=ready-states:dom-media-have_metadata-5><a href=#dom-media-have_metadata>HAVE_METADATA</a></code><dd id=fire-loadedmetadata>

      <p><a href=#queue-a-task id=ready-states:queue-a-task>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named
      <code id=ready-states:event-media-loadedmetadata><a href=#event-media-loadedmetadata>loadedmetadata</a></code> at the element.</p>

      <p class=note>Before this task is run, as part of the <a href=#event-loop id=ready-states:event-loop>event loop</a> mechanism, the
      rendering will have been updated to resize the <code id=ready-states:the-video-element-3><a href=#the-video-element>video</a></code> element if appropriate.</p>

     <dt id=handling-first-frame-available>If the previous ready state was <code id=ready-states:dom-media-have_metadata-6><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> and the new ready state is <code id=ready-states:dom-media-have_current_data-4><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> or greater<dd>

      <p id=fire-loadeddata>If this is the first time this occurs for this <a href=#media-element id=ready-states:media-element-4>media
      element</a> since the <code id=ready-states:dom-media-load><a href=#dom-media-load>load()</a></code> algorithm was last
      invoked, the user agent must <a href=#queue-a-task id=ready-states:queue-a-task-2>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=ready-states:event-media-loadeddata><a href=#event-media-loadeddata>loadeddata</a></code> at the element.</p>

      <p>If the new ready state is <code id=ready-states:dom-media-have_future_data-3><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code>
      or <code id=ready-states:dom-media-have_enough_data><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code>, then the relevant steps
      below must then be run also.</p>

     <dt>If the previous ready state was <code id=ready-states:dom-media-have_future_data-4><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> or more, and the new ready state is
     <code id=ready-states:dom-media-have_current_data-5><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> or less<dd>

      <p id=fire-waiting-when-waiting>If the <a href=#media-element id=ready-states:media-element-5>media element</a> was <a href=#potentially-playing id=ready-states:potentially-playing>potentially
      playing</a> before its <code id=ready-states:dom-media-readystate-2><a href=#dom-media-readystate>readyState</a></code> attribute
      changed to a value lower than <code id=ready-states:dom-media-have_future_data-5><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code>, and the element has not
      <a href=#ended-playback id=ready-states:ended-playback-3>ended playback</a>, and playback has not <a href=#stopped-due-to-errors id=ready-states:stopped-due-to-errors>stopped due to errors</a>,
      <a href=#paused-for-user-interaction id=ready-states:paused-for-user-interaction>paused for user interaction</a>, or <a href=#paused-for-in-band-content id=ready-states:paused-for-in-band-content>paused for in-band content</a>, the user
      agent must <a href=#queue-a-task id=ready-states:queue-a-task-3>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-3 data-x-internal=concept-event-fire>fire an event</a>
      named <code id=ready-states:event-media-timeupdate><a href=#event-media-timeupdate>timeupdate</a></code> at the element, and <a href=#queue-a-task id=ready-states:queue-a-task-4>queue
      a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-4 data-x-internal=concept-event-fire>fire an event</a> named <code id=ready-states:event-media-waiting><a href=#event-media-waiting>waiting</a></code> at the element.</p>

     <dt>If the previous ready state was <code id=ready-states:dom-media-have_current_data-6><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> or less, and the new ready state
     is <code id=ready-states:dom-media-have_future_data-6><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code><dd>

      <p>The user agent must <a href=#queue-a-task id=ready-states:queue-a-task-5>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-5 data-x-internal=concept-event-fire>fire an
      event</a> named <code id=ready-states:event-media-canplay><a href=#event-media-canplay>canplay</a></code> at the element.</p>

      <p>If the element's <code id=ready-states:dom-media-paused><a href=#dom-media-paused>paused</a></code> attribute is false, the user
      agent must <a href=#notify-about-playing id=ready-states:notify-about-playing>notify about playing</a> for the element.</p>

     <dt>If the new ready state is <code id=ready-states:dom-media-have_enough_data-2><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code><dd>

      <p>If the previous ready state was <code id=ready-states:dom-media-have_current_data-7><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> or less, the user agent must
      <a href=#queue-a-task id=ready-states:queue-a-task-6>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-6 data-x-internal=concept-event-fire>fire an event</a> named
      <code id=ready-states:event-media-canplay-2><a href=#event-media-canplay>canplay</a></code> at the element, and, if the element's <code id=ready-states:dom-media-paused-2><a href=#dom-media-paused>paused</a></code> attribute is false, <a href=#notify-about-playing id=ready-states:notify-about-playing-2>notify about playing</a>
      for the element.</p>

      <p>The user agent must <a href=#queue-a-task id=ready-states:queue-a-task-7>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-7 data-x-internal=concept-event-fire>fire an
      event</a> named <code id=ready-states:event-media-canplaythrough><a href=#event-media-canplaythrough>canplaythrough</a></code> at the
      element.</p>

      <p>If the element is not <a href=#eligible-for-autoplay id=ready-states:eligible-for-autoplay>eligible for autoplay</a>, then the user agent must abort
      these substeps.</p>

      <p>The user agent may run the following substeps immediately. Alternatively, if the element is
      a <code id=ready-states:the-video-element-4><a href=#the-video-element>video</a></code> element, the user agent may wait until the element <a href=#intersect-the-viewport id=ready-states:intersect-the-viewport>intersects the viewport</a> and, if the element is still
      <a href=#eligible-for-autoplay id=ready-states:eligible-for-autoplay-2>eligible for autoplay</a>, run the following substeps:</p>

      <p class=note>This specification doesn't define the precise timing for when the intersection
      is tested, but it is recommended that the timing match that of the Intersection Observer
      API. <a href=#refsINTERSECTIONOBSERVER>[INTERSECTIONOBSERVER]</a></p>

      <ol><li>Set the <code id=ready-states:dom-media-paused-3><a href=#dom-media-paused>paused</a></code> attribute to false.<li>If the element's <a href=#show-poster-flag id=ready-states:show-poster-flag>show poster flag</a> is true, set it to false and run the
       <i id=ready-states:time-marches-on><a href=#time-marches-on>time marches on</a></i> steps.<li><a href=#queue-a-task id=ready-states:queue-a-task-8>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=ready-states:concept-event-fire-8 data-x-internal=concept-event-fire>fire an event</a> named
       <code id=ready-states:event-media-play><a href=#event-media-play>play</a></code> at the element.<li><a href=#notify-about-playing id=ready-states:notify-about-playing-3>Notify about playing</a> for the element.<li>Set the <a href=#autoplaying-flag id=ready-states:autoplaying-flag>autoplaying flag</a> to false.</ol>

      <p class=note>User agents do not need to support autoplay, and it is suggested that user
      agents honor user preferences on the matter. Authors are urged to use the <code id=ready-states:attr-media-autoplay><a href=#attr-media-autoplay>autoplay</a></code> attribute rather than using script to force the
      video to play, so as to allow the user to override the behavior if so desired.</p>

     </dl>

   </ol>

  

  <p class=note>It is possible for the ready state of a media element to jump between these states
  discontinuously. For example, the state of a media element can jump straight from <code id=ready-states:dom-media-have_metadata-7><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> to <code id=ready-states:dom-media-have_enough_data-3><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code> without passing through the <code id=ready-states:dom-media-have_current_data-8><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> and <code id=ready-states:dom-media-have_future_data-7><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> states.</p>

  

  <p>The <dfn id=dom-media-readystate><code>readyState</code></dfn> IDL attribute must, on
  getting, return the value described above that describes the current ready state of the
  <a href=#media-element id=ready-states:media-element-6>media element</a>.</p>

  

  <p>The <dfn id=attr-media-autoplay><code>autoplay</code></dfn> attribute is a <a href=#boolean-attribute id=ready-states:boolean-attribute>boolean
  attribute</a>. When present, the user agent (as described in the algorithm
  described herein) will automatically begin playback of the <a href=#media-resource id=ready-states:media-resource-3>media resource</a> as
  soon as it can do so without stopping.</p>

  <p class=note>Authors are urged to use the <code id=ready-states:attr-media-autoplay-2><a href=#attr-media-autoplay>autoplay</a></code>
  attribute rather than using script to trigger automatic playback, as this allows the user to
  override the automatic playback when it is not desired, e.g. when using a screen reader. Authors
  are also encouraged to consider not using the automatic playback behavior at all, and instead to
  let the user agent wait for the user to start playback explicitly.</p>

  

  <p>The <dfn id=dom-media-autoplay><code>autoplay</code></dfn> IDL attribute must
  <a href=#reflect id=ready-states:reflect>reflect</a> the content attribute of the same name.</p>

  



  <h5 id=playing-the-media-resource>4.8.12.8 Playing the media resource<a href=#playing-the-media-resource class=self-link></a></h5><div class=status><input onclick=toggleStatus(this) value=â‹° type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=28032" title="Definition of &quot;ended playback&quot; prevents looping when loop attribute is added after playback has ended">28032</a></div>

  <dl class=domintro><dt><var>media</var> . <code id=playing-the-media-resource:dom-media-paused><a href=#dom-media-paused>paused</a></code><dd>

    <p>Returns true if playback is paused; false otherwise.</p>

   <dt><var>media</var> . <code id=playing-the-media-resource:dom-media-ended><a href=#dom-media-ended>ended</a></code><dd>

    <p>Returns true if playback has reached the end of the <a href=#media-resource id=playing-the-media-resource:media-resource>media resource</a>.</p>

   <dt><var>media</var> . <code id=playing-the-media-resource:dom-media-defaultplaybackrate><a href=#dom-media-defaultplaybackrate>defaultPlaybackRate</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the default rate of playback, for when the user is not fast-forwarding or reversing
    through the <a href=#media-resource id=playing-the-media-resource:media-resource-2>media resource</a>.</p>

    <p>Can be set, to change the default rate of playback.</p>

    <p>The default rate has no direct effect on playback, but if the user switches to a fast-forward
    mode, when they return to the normal playback mode, it is expected that the rate of playback
    will be returned to the default rate of playback.</p>

   <dt><var>media</var> . <code id=playing-the-media-resource:dom-media-playbackrate><a href=#dom-media-playbackrate>playbackRate</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the current rate playback, where 1.0 is normal speed.</p>

    <p>Can be set, to change the rate of playback.</p>

   <dt><var>media</var> . <code id=playing-the-media-resource:dom-media-played><a href=#dom-media-played>played</a></code><dd>

    <p>Returns a <code id=playing-the-media-resource:timeranges><a href=#timeranges>TimeRanges</a></code> object that represents the ranges of the <a href=#media-resource id=playing-the-media-resource:media-resource-3>media
    resource</a> that the user agent has played.</p>

   <dt><var>media</var> . <code id=playing-the-media-resource:dom-media-play><a href=#dom-media-play>play</a></code>()<dd>

    <p>Sets the <code id=playing-the-media-resource:dom-media-paused-2><a href=#dom-media-paused>paused</a></code> attribute to false, loading the
    <a href=#media-resource id=playing-the-media-resource:media-resource-4>media resource</a> and beginning playback if necessary. If the playback had ended, will
    restart it from the start.</p>

   <dt><var>media</var> . <code id=playing-the-media-resource:dom-media-pause><a href=#dom-media-pause>pause</a></code>()<dd>

    <p>Sets the <code id=playing-the-media-resource:dom-media-paused-3><a href=#dom-media-paused>paused</a></code> attribute to true, loading the
    <a href=#media-resource id=playing-the-media-resource:media-resource-5>media resource</a> if necessary.</p>

   </dl>

  

  <p>The <dfn id=dom-media-paused><code>paused</code></dfn> attribute represents whether the
  <a href=#media-element id=playing-the-media-resource:media-element>media element</a> is paused or not. The attribute must initially be true.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-2>media element</a> is a <dfn id=blocked-media-element>blocked media element</dfn> if its <code id=playing-the-media-resource:dom-media-readystate><a href=#dom-media-readystate>readyState</a></code> attribute is in the <code id=playing-the-media-resource:dom-media-have_nothing><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code> state, the <code id=playing-the-media-resource:dom-media-have_metadata><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> state, or the <code id=playing-the-media-resource:dom-media-have_current_data><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code> state, or if the element has
  <a href=#paused-for-user-interaction id=playing-the-media-resource:paused-for-user-interaction>paused for user interaction</a> or <a href=#paused-for-in-band-content id=playing-the-media-resource:paused-for-in-band-content>paused for in-band content</a>.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-3>media element</a> is said to be <dfn id=potentially-playing>potentially playing</dfn> when its <code id=playing-the-media-resource:dom-media-paused-4><a href=#dom-media-paused>paused</a></code> attribute is false, the element has not <a href=#ended-playback id=playing-the-media-resource:ended-playback>ended
  playback</a>, playback has not <a href=#stopped-due-to-errors id=playing-the-media-resource:stopped-due-to-errors>stopped due to errors</a>, and the element is not a
  <a href=#blocked-media-element id=playing-the-media-resource:blocked-media-element>blocked media element</a>.</p>

  <p class=note>A <code id=playing-the-media-resource:event-media-waiting><a href=#event-media-waiting>waiting</a></code> DOM event <a href=#fire-waiting-when-waiting>can be fired</a> as a result of an element that is
  <a href=#potentially-playing id=playing-the-media-resource:potentially-playing>potentially playing</a> stopping playback due to its <code id=playing-the-media-resource:dom-media-readystate-2><a href=#dom-media-readystate>readyState</a></code> attribute changing to a value lower than <code id=playing-the-media-resource:dom-media-have_future_data><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code>.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-4>media element</a> is said to be <dfn id=eligible-for-autoplay>eligible for autoplay</dfn> when its
  <a href=#autoplaying-flag id=playing-the-media-resource:autoplaying-flag>autoplaying flag</a> is true, its <code id=playing-the-media-resource:dom-media-paused-5><a href=#dom-media-paused>paused</a></code> attribute
  is true, the element has an <code id=playing-the-media-resource:attr-media-autoplay><a href=#attr-media-autoplay>autoplay</a></code> attribute
  specified, and the element's <a id=playing-the-media-resource:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#active-sandboxing-flag-set id=playing-the-media-resource:active-sandboxing-flag-set>active sandboxing flag set</a>
  does not have the <a href=#sandboxed-automatic-features-browsing-context-flag id=playing-the-media-resource:sandboxed-automatic-features-browsing-context-flag>sandboxed automatic features browsing context flag</a> set.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-5>media element</a> is said to be <dfn id=allowed-to-play>allowed to play</dfn> if the user agent and the
  system allow media playback in the current context.</p>

  <p class=note>For example, a user agent could require that playback is <a href=#triggered-by-user-activation id=playing-the-media-resource:triggered-by-user-activation>triggered by user
  activation</a>, but an exception could be made to allow playback while <a href=#concept-media-muted id=playing-the-media-resource:concept-media-muted>muted</a>.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-6>media element</a> is said to have <dfn id=ended-playback>ended playback</dfn> when:</p>

  <ul><li>The element's <code id=playing-the-media-resource:dom-media-readystate-3><a href=#dom-media-readystate>readyState</a></code> attribute is <code id=playing-the-media-resource:dom-media-have_metadata-2><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> or greater, and

   <li>

    <p>Either:

    <ul><li>The <a href=#current-playback-position id=playing-the-media-resource:current-playback-position>current playback position</a> is the end of the <a href=#media-resource id=playing-the-media-resource:media-resource-6>media resource</a>,
     and

     <li>The <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback>direction of playback</a> is forwards, and

     <li>The <a href=#media-element id=playing-the-media-resource:media-element-7>media element</a> does not have a <code id=playing-the-media-resource:attr-media-loop><a href=#attr-media-loop>loop</a></code>
     attribute specified.

    </ul>

    <p>Or:

    <ul><li>The <a href=#current-playback-position id=playing-the-media-resource:current-playback-position-2>current playback position</a> is the <a href=#earliest-possible-position id=playing-the-media-resource:earliest-possible-position>earliest possible position</a>,
     and

     <li>The <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback-2>direction of playback</a> is backwards.

    </ul>

   </ul>

  <p>The <dfn id=dom-media-ended><code>ended</code></dfn> attribute must return true if, the
  last time the <a href=#event-loop id=playing-the-media-resource:event-loop>event loop</a> reached <a href=#step1>step 1</a>, the <a href=#media-element id=playing-the-media-resource:media-element-8>media element</a> had
  <a href=#ended-playback id=playing-the-media-resource:ended-playback-2>ended playback</a> and the <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback-3>direction of playback</a> was forwards, and false
  otherwise.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-9>media element</a> is said to have <dfn id=stopped-due-to-errors>stopped due to errors</dfn> when the
  element's <code id=playing-the-media-resource:dom-media-readystate-4><a href=#dom-media-readystate>readyState</a></code> attribute is <code id=playing-the-media-resource:dom-media-have_metadata-3><a href=#dom-media-have_metadata>HAVE_METADATA</a></code> or greater, and the user agent <a href=#non-fatal-media-error>encounters a non-fatal error</a> during the processing of the
  <a href=#media-data id=playing-the-media-resource:media-data>media data</a>, and due to that error, is not able to play the content at the
  <a href=#current-playback-position id=playing-the-media-resource:current-playback-position-3>current playback position</a>.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-10>media element</a> is said to have <dfn id=paused-for-user-interaction>paused for user interaction</dfn> when its
  <code id=playing-the-media-resource:dom-media-paused-6><a href=#dom-media-paused>paused</a></code> attribute is false, the <code id=playing-the-media-resource:dom-media-readystate-5><a href=#dom-media-readystate>readyState</a></code> attribute is either <code id=playing-the-media-resource:dom-media-have_future_data-2><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> or <code id=playing-the-media-resource:dom-media-have_enough_data><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code> and the user agent has reached a point
  in the <a href=#media-resource id=playing-the-media-resource:media-resource-7>media resource</a> where the user has to make a selection for the resource to
  continue.</p>

  <p>It is possible for a <a href=#media-element id=playing-the-media-resource:media-element-11>media element</a> to have both <a href=#ended-playback id=playing-the-media-resource:ended-playback-3>ended playback</a> and
  <a href=#paused-for-user-interaction id=playing-the-media-resource:paused-for-user-interaction-2>paused for user interaction</a> at the same time.</p>

  <p>When a <a href=#media-element id=playing-the-media-resource:media-element-12>media element</a> that is <a href=#potentially-playing id=playing-the-media-resource:potentially-playing-2>potentially playing</a> stops playing
  because it has <a href=#paused-for-user-interaction id=playing-the-media-resource:paused-for-user-interaction-3>paused for user interaction</a>, the user agent must <a href=#queue-a-task id=playing-the-media-resource:queue-a-task>queue a
  task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=playing-the-media-resource:event-media-timeupdate><a href=#event-media-timeupdate>timeupdate</a></code> at the element.</p>

  <p>A <a href=#media-element id=playing-the-media-resource:media-element-13>media element</a> is said to have <dfn id=paused-for-in-band-content>paused for in-band content</dfn> when its
  <code id=playing-the-media-resource:dom-media-paused-7><a href=#dom-media-paused>paused</a></code> attribute is false, the <code id=playing-the-media-resource:dom-media-readystate-6><a href=#dom-media-readystate>readyState</a></code> attribute is either <code id=playing-the-media-resource:dom-media-have_future_data-3><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> or <code id=playing-the-media-resource:dom-media-have_enough_data-2><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code> and the user agent has suspended
  playback of the <a href=#media-resource id=playing-the-media-resource:media-resource-8>media resource</a> in order to play content that is temporally anchored
  to the <a href=#media-resource id=playing-the-media-resource:media-resource-9>media resource</a> and has a non-zero length, or to play content that is
  temporally anchored to a segment of the <a href=#media-resource id=playing-the-media-resource:media-resource-10>media resource</a> but has a length longer than
  that segment.</p>

  <p class=example>One example of when a <a href=#media-element id=playing-the-media-resource:media-element-14>media element</a> would be <a href=#paused-for-in-band-content id=playing-the-media-resource:paused-for-in-band-content-2>paused for
  in-band content</a> is when the user agent is playing <a href=#attr-track-kind-descriptions id=playing-the-media-resource:attr-track-kind-descriptions>audio descriptions</a> from an external WebVTT file, and
  the synthesized speech generated for a cue is longer than the time between the <a href=#text-track-cue-start-time id=playing-the-media-resource:text-track-cue-start-time>text track
  cue start time</a> and the <a href=#text-track-cue-end-time id=playing-the-media-resource:text-track-cue-end-time>text track cue end time</a>.</p>

  <hr>

  <p id=reaches-the-end>When the <a href=#current-playback-position id=playing-the-media-resource:current-playback-position-4>current playback position</a> reaches the end of the
  <a href=#media-resource id=playing-the-media-resource:media-resource-11>media resource</a> when the <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback-4>direction of playback</a> is forwards, then the user
  agent must follow these steps:</p>

  <ol><li><p>If the <a href=#media-element id=playing-the-media-resource:media-element-15>media element</a> has a <code id=playing-the-media-resource:attr-media-loop-2><a href=#attr-media-loop>loop</a></code>
   attribute specified, then <a href=#dom-media-seek id=playing-the-media-resource:dom-media-seek>seek</a> to the <a href=#earliest-possible-position id=playing-the-media-resource:earliest-possible-position-2>earliest
   possible position</a> of the <a href=#media-resource id=playing-the-media-resource:media-resource-12>media resource</a> and abort these steps.<li><p>As defined above, the <code id=playing-the-media-resource:dom-media-ended-2><a href=#dom-media-ended>ended</a></code> IDL attribute starts
   returning true once the <a href=#event-loop id=playing-the-media-resource:event-loop-2>event loop</a> returns to <a href=#step1>step 1</a>.<li>

    <p><a href=#queue-a-task id=playing-the-media-resource:queue-a-task-2>Queue a task</a> to run the following substeps:</p>

    <ol><li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-2 data-x-internal=concept-event-fire>Fire an event</a> named <code id=playing-the-media-resource:event-media-timeupdate-2><a href=#event-media-timeupdate>timeupdate</a></code> at the <a href=#media-element id=playing-the-media-resource:media-element-16>media element</a>.<li>

      <p>If the <a href=#media-element id=playing-the-media-resource:media-element-17>media element</a> has <a href=#ended-playback id=playing-the-media-resource:ended-playback-4>ended playback</a>, and the <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback-5>direction
      of playback</a> is forwards, and <a href=#dom-media-paused id=playing-the-media-resource:dom-media-paused-8>paused</a> is false,
      run the following subsubsteps:</p>

      <ol><li><p>Set the <code id=playing-the-media-resource:dom-media-paused-9><a href=#dom-media-paused>paused</a></code> attribute to true.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-3 data-x-internal=concept-event-fire>Fire an event</a> named <code id=playing-the-media-resource:event-media-pause><a href=#event-media-pause>pause</a></code> at the <a href=#media-element id=playing-the-media-resource:media-element-18>media element</a>.<li><p><a href=#take-pending-play-promises id=playing-the-media-resource:take-pending-play-promises>Take pending play promises</a> and <a href=#reject-pending-play-promises id=playing-the-media-resource:reject-pending-play-promises>reject pending play promises</a>
       with the result and an <a id=playing-the-media-resource:aborterror href=https://heycam.github.io/webidl/#aborterror data-x-internal=aborterror>"<code>AbortError</code>"</a>
       <code id=playing-the-media-resource:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

     <li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-4 data-x-internal=concept-event-fire>Fire an event</a> named <code id=playing-the-media-resource:event-media-ended><a href=#event-media-ended>ended</a></code> at the <a href=#media-element id=playing-the-media-resource:media-element-19>media element</a>.</ol>

   </ol>

  <p>When the <a href=#current-playback-position id=playing-the-media-resource:current-playback-position-5>current playback position</a> reaches the <a href=#earliest-possible-position id=playing-the-media-resource:earliest-possible-position-3>earliest possible
  position</a> of the <a href=#media-resource id=playing-the-media-resource:media-resource-13>media resource</a> when the <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback-6>direction of playback</a> is
  backwards, then the user agent must only <a href=#queue-a-task id=playing-the-media-resource:queue-a-task-3>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-5 data-x-internal=concept-event-fire>fire an event</a> named <code id=playing-the-media-resource:event-media-timeupdate-3><a href=#event-media-timeupdate>timeupdate</a></code> at the element.</p>

  <p class=note>The word "reaches" here does not imply that the <a href=#current-playback-position id=playing-the-media-resource:current-playback-position-6>current playback
  position</a> needs to have changed during normal playback; it could be via <a href=#dom-media-seek id=playing-the-media-resource:dom-media-seek-2>seeking</a>, for instance.</p>

  <hr>

  <p>The <dfn id=dom-media-defaultplaybackrate><code>defaultPlaybackRate</code></dfn> attribute
  gives the desired speed at which the <a href=#media-resource id=playing-the-media-resource:media-resource-14>media resource</a> is to play, as a multiple of its
  intrinsic speed. The attribute is mutable: on getting it must return the last value it was set to,
  or 1.0 if it hasn't yet been set; on setting the attribute must be set to the new value.</p>

  <p class=note>The <code id=playing-the-media-resource:dom-media-defaultplaybackrate-2><a href=#dom-media-defaultplaybackrate>defaultPlaybackRate</a></code> is used
  by the user agent when it <a href=#expose-a-user-interface-to-the-user id=playing-the-media-resource:expose-a-user-interface-to-the-user>exposes a user
  interface to the user</a>.</p>

  <p>The <dfn id=dom-media-playbackrate><code>playbackRate</code></dfn> attribute gives the
  effective playback rate, which is the speed at which the <a href=#media-resource id=playing-the-media-resource:media-resource-15>media resource</a> plays, as a
  multiple of its intrinsic speed. If it is not equal to the <code id=playing-the-media-resource:dom-media-defaultplaybackrate-3><a href=#dom-media-defaultplaybackrate>defaultPlaybackRate</a></code>, then the implication is that
  the user is using a feature such as fast forward or slow motion playback. The attribute is
  mutable: on getting it must return the last value it was set to, or 1.0 if it hasn't yet been set;
  on setting the attribute must be set to the new value, and the playback will change speed (if the
  element is <a href=#potentially-playing id=playing-the-media-resource:potentially-playing-3>potentially playing</a>).</p>

  <p id=rateUpdate>When the <code id=playing-the-media-resource:dom-media-defaultplaybackrate-4><a href=#dom-media-defaultplaybackrate>defaultPlaybackRate</a></code>
  or <code id=playing-the-media-resource:dom-media-playbackrate-2><a href=#dom-media-playbackrate>playbackRate</a></code> attributes change value (either by
  being set by script or by being changed directly by the user agent, e.g. in response to user
  control) the user agent must <a href=#queue-a-task id=playing-the-media-resource:queue-a-task-4>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-6 data-x-internal=concept-event-fire>fire
  an event</a> named <code id=playing-the-media-resource:event-media-ratechange><a href=#event-media-ratechange>ratechange</a></code> at the <a href=#media-element id=playing-the-media-resource:media-element-20>media
  element</a>.</p>

  <hr>

  <p>The <dfn id=dom-media-played><code>played</code></dfn> attribute must return a new static
  <a href=#normalised-timeranges-object id=playing-the-media-resource:normalised-timeranges-object>normalized <code>TimeRanges</code> object</a> that represents the ranges of points on the
  <a href=#media-timeline id=playing-the-media-resource:media-timeline>media timeline</a> of the <a href=#media-resource id=playing-the-media-resource:media-resource-16>media resource</a> reached through the usual monotonic
  increase of the <a href=#current-playback-position id=playing-the-media-resource:current-playback-position-7>current playback position</a> during normal playback, if any, at the time
  the attribute is evaluated.</p>

  <hr>

  <p>Each <a href=#media-element id=playing-the-media-resource:media-element-21>media element</a> has a <dfn id=list-of-pending-play-promises>list of pending play promises</dfn>, which must
  initially be empty.</p>

  <p>To <dfn id=take-pending-play-promises>take pending play promises</dfn> for a <a href=#media-element id=playing-the-media-resource:media-element-22>media element</a>, the user agent must
  run the following steps:</p>

  <ol><li><p>Let <var>promises</var> be an empty list of promises.<li><p>Copy the <a href=#media-element id=playing-the-media-resource:media-element-23>media element</a>'s <a href=#list-of-pending-play-promises id=playing-the-media-resource:list-of-pending-play-promises>list of pending play promises</a> to
   <var>promises</var>.<li><p>Clear the <a href=#media-element id=playing-the-media-resource:media-element-24>media element</a>'s <a href=#list-of-pending-play-promises id=playing-the-media-resource:list-of-pending-play-promises-2>list of pending play
   promises</a>.<li>Return <var>promises</var>.</ol>

  <p>To <dfn id=resolve-pending-play-promises>resolve pending play promises</dfn> for a <a href=#media-element id=playing-the-media-resource:media-element-25>media element</a> with a list of
  promises <var>promises</var>, the user agent must resolve each promise in <var>promises</var> with
  undefined.</p>

  <p>To <dfn id=reject-pending-play-promises>reject pending play promises</dfn> for a <a href=#media-element id=playing-the-media-resource:media-element-26>media element</a> with a list of
  promise <var>promises</var> and an exception name <var>error</var>, the user agent must reject
  each promise in <var>promises</var> with <var>error</var>.</p>

  <p>To <dfn id=notify-about-playing>notify about playing</dfn> for a <a href=#media-element id=playing-the-media-resource:media-element-27>media element</a>, the user agent must run
  the following steps:</p>

  <ol><li><p><a href=#take-pending-play-promises id=playing-the-media-resource:take-pending-play-promises-2>Take pending play promises</a> and let <var>promises</var> be the
   result.<li>

    <p><a href=#queue-a-task id=playing-the-media-resource:queue-a-task-5>Queue a task</a> to run the following substeps:</p>

    <ol><li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-7 data-x-internal=concept-event-fire>Fire an event</a> named <code id=playing-the-media-resource:event-media-playing><a href=#event-media-playing>playing</a></code> at the element.<li><p><a href=#resolve-pending-play-promises id=playing-the-media-resource:resolve-pending-play-promises>Resolve pending play promises</a> with <var>promises</var>.</ol>

   </ol>

  <p>When the <dfn id=dom-media-play><code>play()</code></dfn> method on a <a href=#media-element id=playing-the-media-resource:media-element-28>media
  element</a> is invoked, the user agent must run the following steps.</p>

  <ol><li><p>If the <a href=#media-element id=playing-the-media-resource:media-element-29>media element</a> is not <a href=#allowed-to-play id=playing-the-media-resource:allowed-to-play>allowed to play</a>, return a promise
   rejected with a <a id=playing-the-media-resource:notallowederror href=https://heycam.github.io/webidl/#notallowederror data-x-internal=notallowederror>"<code>NotAllowedError</code>"</a> <code id=playing-the-media-resource:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort
   these steps.<li>

    <p>If the <a href=#media-element id=playing-the-media-resource:media-element-30>media element</a>'s <code id=playing-the-media-resource:dom-media-error><a href=#dom-media-error>error</a></code> attribute is
    not null and its <a href=#concept-mediaerror-code id=playing-the-media-resource:concept-mediaerror-code>code</a> is <code id=playing-the-media-resource:dom-mediaerror-media_err_src_not_supported><a href=#dom-mediaerror-media_err_src_not_supported>MEDIA_ERR_SRC_NOT_SUPPORTED</a></code>, return a
    promise rejected with a <a id=playing-the-media-resource:notsupportederror href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=playing-the-media-resource:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>
    and abort these steps.</p>

    <p class=note>This means that the <a href=#dedicated-media-source-failure-steps id=playing-the-media-resource:dedicated-media-source-failure-steps>dedicated media source failure steps</a> have run.
    Playback is not possible until the <a href=#media-element-load-algorithm id=playing-the-media-resource:media-element-load-algorithm>media element load algorithm</a> clears the <code id=playing-the-media-resource:dom-media-error-2><a href=#dom-media-error>error</a></code> attribute.</p>

   <li><p>Let <var>promise</var> be a new promise and append <var>promise</var> to the <a href=#list-of-pending-play-promises id=playing-the-media-resource:list-of-pending-play-promises-3>list of
   pending play promises</a>.<li><p>If the <a href=#media-element id=playing-the-media-resource:media-element-31>media element</a>'s <code id=playing-the-media-resource:dom-media-networkstate><a href=#dom-media-networkstate>networkState</a></code> attribute has the value <code id=playing-the-media-resource:dom-media-network_empty><a href=#dom-media-network_empty>NETWORK_EMPTY</a></code>, invoke the <a href=#media-element id=playing-the-media-resource:media-element-32>media element</a>'s
   <a href=#concept-media-load-algorithm id=playing-the-media-resource:concept-media-load-algorithm>resource selection algorithm</a>.<li>

    <p>If the <a href=#ended-playback id=playing-the-media-resource:ended-playback-5>playback has ended</a> and the <a href=#direction-of-playback id=playing-the-media-resource:direction-of-playback-7>direction of
    playback</a> is forwards, <a href=#dom-media-seek id=playing-the-media-resource:dom-media-seek-3>seek</a> to the <a href=#earliest-possible-position id=playing-the-media-resource:earliest-possible-position-4>earliest
    possible position</a> of the <a href=#media-resource id=playing-the-media-resource:media-resource-17>media resource</a>.</p>

    <p class=note>This <a href=#seekUpdate>will cause</a> the user agent to <a href=#queue-a-task id=playing-the-media-resource:queue-a-task-6>queue a
    task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-8 data-x-internal=concept-event-fire>fire an event</a> named <code id=playing-the-media-resource:event-media-timeupdate-4><a href=#event-media-timeupdate>timeupdate</a></code> at the <a href=#media-element id=playing-the-media-resource:media-element-33>media element</a>.</p>
    

   <li>

    <p>If the <a href=#media-element id=playing-the-media-resource:media-element-34>media element</a>'s <code id=playing-the-media-resource:dom-media-paused-10><a href=#dom-media-paused>paused</a></code> attribute is
    true, run the following substeps:</p>

    <ol><li><p>Change the value of <code id=playing-the-media-resource:dom-media-paused-11><a href=#dom-media-paused>paused</a></code> to false.<li><p>If the <a href=#show-poster-flag id=playing-the-media-resource:show-poster-flag>show poster flag</a> is true, set the element's <a href=#show-poster-flag id=playing-the-media-resource:show-poster-flag-2>show poster
     flag</a> to false and run the <i id=playing-the-media-resource:time-marches-on><a href=#time-marches-on>time marches on</a></i> steps.<li><p><a href=#queue-a-task id=playing-the-media-resource:queue-a-task-7>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-9 data-x-internal=concept-event-fire>fire an event</a>
     named <code id=playing-the-media-resource:event-media-play><a href=#event-media-play>play</a></code> at the element.<li>

      <p>If the <a href=#media-element id=playing-the-media-resource:media-element-35>media element</a>'s <code id=playing-the-media-resource:dom-media-readystate-7><a href=#dom-media-readystate>readyState</a></code>
      attribute has the value <code id=playing-the-media-resource:dom-media-have_nothing-2><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>, <code id=playing-the-media-resource:dom-media-have_metadata-4><a href=#dom-media-have_metadata>HAVE_METADATA</a></code>, or <code id=playing-the-media-resource:dom-media-have_current_data-2><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code>, <a href=#queue-a-task id=playing-the-media-resource:queue-a-task-8>queue a task</a> to
      <a href=https://dom.spec.whatwg.org/#concept-event-fire id=playing-the-media-resource:concept-event-fire-10 data-x-internal=concept-event-fire>fire an event</a> named <code id=playing-the-media-resource:event-media-waiting-2><a href=#event-media-waiting>waiting</a></code> at the element.</p>

      <p>Otherwise, the <a href=#media-element id=playing-the-media-resource:media-element-36>media element</a>'s <code id=playing-the-media-resource:dom-media-readystate-8><a href=#dom-media-readystate>readyState</a></code> attribute has the value <code id=playing-the-media-resource:dom-media-have_future_data-4><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> or <code id=playing-the-media-resource:dom-media-have_enough_data-3><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code>: <a href=#notify-about-playing id=playing-the-media-resource:notify-about-playing>notify about playing</a>
      for the element.</p>

     </ol>

   <li>

    <p>Otherwise, if the <a href=#media-element id=playing-the-media-resource:media-element-37>media element</a>'s <code id=playing-the-media-resource:dom-media-readystate-9><a href=#dom-media-readystate>readyState</a></code> attribute has the value <code id=playing-the-media-resource:dom-media-have_future_data-5><a href=#dom-media-have_future_data>HAVE_FUTURE_DATA</a></code> or <code id=playing-the-media-resource:dom-media-have_enough_data-4><a href=#dom-media-have_enough_data>HAVE_ENOUGH_DATA</a></code>, <a href=#take-pending-play-promises id=playing-the-media-resource:take-pending-play-promises-3>take pending play
    promises</a> and <a href=#queue-a-task id=playing-the-media-resource:queue-a-task-9>queue a task</a> to <a href=#resolve-pending-play-promises id=playing-the-media-resource:resolve-pending-play-promises-2>resolve pending play promises</a> with
    the result.</p>

    <p class=note>The media element is already playing. However, it's possible that
    <var>promise</var> will be <a href=#reject-pending-play-promises id=playing-the-media-resource:reject-pending-play-promises-2>rejected</a> before
    the queued task is run.</p>

   <li><p>Set the <a href=#media-element id=playing-the-media-resource:media-element-38>media element</a>'s <a href=#autoplaying-flag id=playing-the-media-resource:autoplaying-flag-2>autoplaying flag</a> to false.<li><p>Return <var>promise</var>.</ol>


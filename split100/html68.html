
  <ol><li><p>If this <code id=the-location-interface:location-62><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-19>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-17>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-16>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-17>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-16>origin</a>, then throw a
   <a id=the-location-interface:securityerror-16 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-17><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-63><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-20>url</a>.<li><p>If <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=the-location-interface:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is "<code>javascript</code>", terminate these steps.<li><p>Let <var>input</var> be the given value with a single leading "<code>#</code>"
   removed, if any.<li><p>Set <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=the-location-interface:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> to the empty
   string.<li><p><a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-7 data-x-internal=basic-url-parser>Basic URL parse</a> <var>input</var>, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:fragment-state href=https://url.spec.whatwg.org/#fragment-state data-x-internal=fragment-state>fragment state</a> as <var>state
   override</var>.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-8><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p class=note>Unlike the equivalent API for the <code id=the-location-interface:the-a-element><a href=#the-a-element>a</a></code> and <code id=the-location-interface:the-area-element><a href=#the-area-element>area</a></code> elements,
  the <code id=the-location-interface:dom-location-hash-4><a href=#dom-location-hash>hash</a></code> attribute's setter does not special case the
  empty string to remain compatible with deployed scripts.</p>

  <hr>

  <p>When the <dfn id=dom-location-assign><code>assign(<var>url</var>)</code></dfn>
  method is invoked, the user agent must run the following steps:

  <ol><li><p>If this <code id=the-location-interface:location-64><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-20>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-18>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-17>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-18>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-17>origin</a>, then throw a
   <a id=the-location-interface:securityerror-17 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-18><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p><a href=#parse-a-url id=the-location-interface:parse-a-url-2>Parse</a> <var>url</var> relative to the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-19>entry
   settings object</a>. If that failed, throw a <a id=the-location-interface:syntaxerror-2 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=the-location-interface:domexception-19><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate-2><code>Location</code>-object navigate</a> to the <a href=#resulting-url-record id=the-location-interface:resulting-url-record-2>resulting URL
   record</a>.</ol>

  <p>When the <dfn id=dom-location-replace><code>replace(<var>url</var>)</code></dfn>
  method is invoked, the user agent must run the following steps:

  <ol><li><p><a href=#parse-a-url id=the-location-interface:parse-a-url-3>Parse</a> <var>url</var> relative to the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-20>entry
   settings object</a>. If that failed, throw a <a id=the-location-interface:syntaxerror-3 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=the-location-interface:domexception-20><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate-3><code>Location</code>-object navigate</a> to the <a href=#resulting-url-record id=the-location-interface:resulting-url-record-3>resulting URL
   record</a> with the <var>replacement flag</var> set.</ol>

  <p class=note>The <code id=the-location-interface:dom-location-replace-3><a href=#dom-location-replace>replace()</a></code> method intentionally has
  no security check.</p>

  <p>When the <dfn id=dom-location-reload><code>reload()</code></dfn> method is invoked, the
  user agent must run the appropriate steps from the following list:</p>

  <dl class=switch><dt>If this <code id=the-location-interface:location-65><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-21>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-19>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-18>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-21>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-18>origin</a><dd><p>Throw a <a id=the-location-interface:securityerror-18 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-21><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<dt>If the currently executing <a href=#concept-task id=the-location-interface:concept-task-3>task</a> is the dispatch of a <code id=the-location-interface:event-resize><a data-x-internal=event-resize href=https://drafts.csswg.org/cssom-view/#eventdef-window-resize>resize</a></code> event in response to the user resizing the <a href=#browsing-context id=the-location-interface:browsing-context-6>browsing
   context</a><dd><p>Repaint the <a href=#browsing-context id=the-location-interface:browsing-context-7>browsing context</a> and abort these steps.<dt>If the <a href=#browsing-context id=the-location-interface:browsing-context-8>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-4>active document</a> is <a href=#an-iframe-srcdoc-document id=the-location-interface:an-iframe-srcdoc-document>an
   <code>iframe</code> <code>srcdoc</code> document</a><dd><p><a href=#process-the-iframe-attributes id=the-location-interface:process-the-iframe-attributes>Reprocess the <code>iframe</code>
   attributes</a> of the <a href=#browsing-context id=the-location-interface:browsing-context-9>browsing context</a>'s <a href=#browsing-context-container id=the-location-interface:browsing-context-container>browsing context
   container</a>.<dt>If the <a href=#browsing-context id=the-location-interface:browsing-context-10>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-5>active document</a> has its <a href=#reload-override-flag id=the-location-interface:reload-override-flag>reload
   override flag</a> set<dd><p>Perform <a href=#an-overridden-reload id=the-location-interface:an-overridden-reload>an overridden reload</a>, with the <a href=#browsing-context id=the-location-interface:browsing-context-11>browsing context</a> being
   navigated as the <a href=#responsible-browsing-context id=the-location-interface:responsible-browsing-context-2>responsible browsing context</a>. Rethrow any exceptions.<dt>Otherwise<dd><p><a href=#navigate id=the-location-interface:navigate-2>Navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-12>browsing context</a> to
   this <code id=the-location-interface:location-66><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-22>relevant <code>Document</code></a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-location-interface:the-document's-address-3" data-x-internal="the-document's-address">URL</a> to perform an <a href=#entry-update id=the-location-interface:entry-update>entry update</a> of the
   <a href=#browsing-context id=the-location-interface:browsing-context-13>browsing context</a>'s <a href=#current-entry id=the-location-interface:current-entry-2>current entry</a>, with the <var><a href=#exceptions-enabled id=the-location-interface:exceptions-enabled-2>exceptions
   enabled flag</a></var> set. The <a href=#source-browsing-context id=the-location-interface:source-browsing-context-2>source browsing context</a> must be the
   <a href=#browsing-context id=the-location-interface:browsing-context-14>browsing context</a> being navigated. This is a <a href=#reload-triggered-navigation id=the-location-interface:reload-triggered-navigation>reload-triggered
   navigation</a>. Rethrow any exceptions.</dl>

  <p>When a user requests that the <a href=#active-document id=the-location-interface:active-document-6>active document</a> of a <a href=#browsing-context id=the-location-interface:browsing-context-15>browsing context</a>
  be reloaded through a user interface element, the user agent should <a href=#navigate id=the-location-interface:navigate-3>navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-16>browsing context</a> to the same resource as that
  <code id=the-location-interface:document-9><a href=#document>Document</a></code>, to perform an <a href=#entry-update id=the-location-interface:entry-update-2>entry update</a> of the <a href=#browsing-context id=the-location-interface:browsing-context-17>browsing
  context</a>'s <a href=#current-entry id=the-location-interface:current-entry-3>current entry</a>. This is a <a href=#reload-triggered-navigation id=the-location-interface:reload-triggered-navigation-2>reload-triggered navigation</a>.
  In the case of non-idempotent methods (e.g. HTTP POST), the user agent should prompt the user to
  confirm the operation first, since otherwise transactions (e.g. purchases or database
  modifications) could be repeated. User agents may allow the user to explicitly override any caches
  when reloading. If <a href=#browsing-context id=the-location-interface:browsing-context-18>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-7>active document</a>'s <a href=#reload-override-flag id=the-location-interface:reload-override-flag-2>reload
  override flag</a> is set, then the user agent may instead perform <a href=#an-overridden-reload id=the-location-interface:an-overridden-reload-2>an overridden
  reload</a> rather than the navigation described in this paragraph (with the <a href=#browsing-context id=the-location-interface:browsing-context-19>browsing
  context</a> being reloaded as the <a href=#source-browsing-context id=the-location-interface:source-browsing-context-3>source browsing context</a>).</p>

  <hr>

  <p>The <dfn id=dom-location-ancestororigins><code>ancestorOrigins</code></dfn> attribute's
  getter must run these steps:

  <ol><li><p>If this <code id=the-location-interface:location-67><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-23>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-20>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-19>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-22>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-19>origin</a>, then throw a
   <a id=the-location-interface:securityerror-19 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-22><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Otherwise, return this <code id=the-location-interface:location-68><a href=#location>Location</a></code> object's <a href=#concept-location-ancestor-origins-list id=the-location-interface:concept-location-ancestor-origins-list-2>ancestor origins list</a>.</ol>

  <hr>

  <p>As explained earlier, the <code id=the-location-interface:location-69><a href=#location>Location</a></code> exotic object requires additional logic beyond
  IDL for security purposes. The internal slot and internal methods <code id=the-location-interface:location-70><a href=#location>Location</a></code> objects
  must implement are defined below.</p>

  <p>Every <code id=the-location-interface:location-71><a href=#location>Location</a></code> object has a <dfn id=defaultproperties>[[DefaultProperties]]</dfn> internal slot
  representing its own properties at time of its creation.</p>

  <h5 id=location-getprototypeof>7.7.4.1 [[GetPrototypeOf]] ( )<a href=#location-getprototypeof class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-getprototypeof:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return !
   <a id=location-getprototypeof:ordinarygetprototypeof href=https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof data-x-internal=ordinarygetprototypeof>OrdinaryGetPrototypeOf</a>(<b>this</b>).<li><p>Return null.</ol>

  <h5 id=location-setprototypeof>7.7.4.2 [[SetPrototypeOf]] ( <var>V</var> )<a href=#location-setprototypeof class=self-link></a></h5>

  <ol><li><p>Return false.</ol>

  <h5 id=location-isextensible>7.7.4.3 [[IsExtensible]] ( )<a href=#location-isextensible class=self-link></a></h5>

  <ol><li><p>Return true.</ol>

  <h5 id=location-preventextensions>7.7.4.4 [[PreventExtensions]] ( )<a href=#location-preventextensions class=self-link></a></h5>

  <ol><li><p>Return false.</ol>

  <h5 id=location-getownproperty>7.7.4.5 [[GetOwnProperty]] ( <var>P</var> )<a href=#location-getownproperty class=self-link></a></h5>

  <ol><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-getownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then:</p>

    <ol><li><p>Let <var>desc</var> be <a id=location-getownproperty:ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<b>this</b>,
     <var>P</var>).<li><p>If the value of the <a href=#defaultproperties id=location-getownproperty:defaultproperties>[[DefaultProperties]]</a> internal slot of <b>this</b>
     contains <var>P</var>, then set <var>desc</var>.[[Configurable]] to true.<li><p>Return <var>desc</var>.</ol>
   <li><p>Let <var>property</var> be ! <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=location-getownproperty:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>(<b>this</b>,
   <var>P</var>).<li><p>If <var>property</var> is not undefined, return <var>property</var>.<li><p>Throw a <a id=location-getownproperty:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-getownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=location-defineownproperty>7.7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var> )<a href=#location-defineownproperty class=self-link></a></h5>

  <ol><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-defineownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then:</p>

    <ol><li><p>If the value of the <a href=#defaultproperties id=location-defineownproperty:defaultproperties>[[DefaultProperties]]</a> internal slot of <b>this</b>
     contains <var>P</var>, then return false.<li><p>Return ? <a id=location-defineownproperty:ordinarydefineownproperty href=https://tc39.github.io/ecma262/#sec-ordinarydefineownproperty data-x-internal=ordinarydefineownproperty>OrdinaryDefineOwnProperty</a>(<b>this</b>, <var>P</var>,
     <var>Desc</var>).</ol>
   <li><p>Throw a <a id=location-defineownproperty:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-defineownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=location-get>7.7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )<a href=#location-get class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-get:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-get:ordinaryget href=https://tc39.github.io/ecma262/#sec-ordinaryget data-x-internal=ordinaryget>OrdinaryGet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).<li><p>Return ? <a href=#crossoriginget-(-o,-p,-receiver-) id=location-get:crossoriginget-(-o,-p,-receiver-)>CrossOriginGet</a>(<b>this</b>, <var>P</var>,
   <var>Receiver</var>).</ol>

  <h5 id=location-set>7.7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )<a href=#location-set class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-set:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-set:ordinaryset href=https://tc39.github.io/ecma262/#sec-ordinaryset data-x-internal=ordinaryset>OrdinarySet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).<li><p>Return ? <a href=#crossoriginset-(-o,-p,-v,-receiver-) id=location-set:crossoriginset-(-o,-p,-v,-receiver-)>CrossOriginSet</a>(<b>this</b>, <var>P</var>, <var>V</var>,
   <var>Receiver</var>).</ol>

  <h5 id=location-delete>7.7.4.9 [[Delete]] ( <var>P</var> )<a href=#location-delete class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-delete:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-delete:ordinarydelete href=https://tc39.github.io/ecma262/#sec-ordinarydelete data-x-internal=ordinarydelete>OrdinaryDelete</a>(<b>this</b>, <var>P</var>).<li><p>Throw a <a id=location-delete:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-delete:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=location-ownpropertykeys>7.7.4.10 [[OwnPropertyKeys]] ( )<a href=#location-ownpropertykeys class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-ownpropertykeys:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return !
   <a id=location-ownpropertykeys:ordinaryownpropertykeys href=https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys data-x-internal=ordinaryownpropertykeys>OrdinaryOwnPropertyKeys</a>(<b>this</b>).<li><p>Return ! <a href=#crossoriginownpropertykeys-(-o-) id=location-ownpropertykeys:crossoriginownpropertykeys-(-o-)>CrossOriginOwnPropertyKeys</a>(<b>this</b>).</ol>

  



  <h3 id=browsing-the-web>7.8 Browsing the Web<a href=#browsing-the-web class=self-link></a></h3>

  

  <h4 id=navigating-across-documents>7.8.1 Navigating across documents<a href=#navigating-across-documents class=self-link></a></h4>

  <p>Certain actions cause the <a href=#browsing-context id=navigating-across-documents:browsing-context>browsing context</a> to <i id=navigating-across-documents:navigate><a href=#navigate>navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class=example>For example, <a href=#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2>following a hyperlink</a>,
  <a href=#concept-form-submit id=navigating-across-documents:concept-form-submit>form submission</a>, and the <code id=navigating-across-documents:dom-open><a href=#dom-open>window.open()</a></code> and <code id=navigating-across-documents:dom-location-assign><a href=#dom-location-assign>location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class=note>A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a href=#an-iframe-srcdoc-document id=navigating-across-documents:an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id=source-browsing-context data-export="">source browsing context</dfn>, which is the
  browsing context which was responsible for starting the navigation.</p>

  
  
  <p>To <dfn id=navigate data-export="">navigate</dfn> a browsing context <var>browsingContext</var> to a
  resource <var>resource</var>, optionally with an <dfn data-export="" id=exceptions-enabled><var>exceptions enabled flag</var></dfn>, the user agent must run these steps:</p>

  <ol><li><p>If <var>resource</var> is a <a id=navigating-across-documents:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, then set <var>resource</var> to a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url data-x-internal=concept-request-url>url</a> is
   <var>resource</var>.<li id=sandboxLinks>
    <p>If the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context>source browsing context</a> is not <a href=#allowed-to-navigate id=navigating-across-documents:allowed-to-navigate>allowed to navigate</a>
    <var>browsingContext</var>, then:</p>

    <ol><li><p>If the <var><a href=#exceptions-enabled id=navigating-across-documents:exceptions-enabled>exceptions enabled flag</a></var> is set, then throw a
     <a id=navigating-across-documents:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=navigating-across-documents:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
      <p>Otherwise, the user agent may instead offer to open <var>resource</var> in a new
      <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context>top-level browsing context</a> or in the <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context-2>top-level browsing context</a> of
      the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-2>source browsing context</a>, at the user's option, in which case the user agent
      must <a href=#navigate id=navigating-across-documents:navigate-2>navigate</a> that designated <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context-3>top-level
      browsing context</a> to <var>resource</var> as if the user had requested it
      independently.</p>

      <p class=note>Doing so, however, can be dangerous, as it means that the user is overriding
      the author's explicit request to sandbox the content.</p>
     </ol>
   <li><p>If there is a preexisting attempt to navigate <var>browsingContext</var>, and the
   <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-3>source browsing context</a> is the same as <var>browsingContext</var>, and that attempt
   is currently running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document>unload a document</a> algorithm, then abort these steps without
   affecting the preexisting attempt to navigate <var>browsingContext</var>.<li><p>If the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document>prompt to unload a document</a> algorithm is being run for the
   <a href=#active-document id=navigating-across-documents:active-document>active document</a> of <var>browsingContext</var>, then abort these steps without
   affecting the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-2>prompt to unload a document</a> algorithm.<li id=navigate-fragid-step><p>If this is not a <dfn id=reload-triggered-navigation>reload-triggered navigation</dfn>,
   <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-2 data-x-internal=concept-request>request</a>, <var>resource</var>'s
   <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-2 data-x-internal=concept-request-url>url</a> <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals data-x-internal=concept-url-equals>equals</a>
   <var>browsingContext</var>'s <a href=#active-document id=navigating-across-documents:active-document-2>active document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">URL</a> with <var>exclude fragments flag</var> set, and
   <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-3 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is non-null, then <a href=#scroll-to-fragid id=navigating-across-documents:scroll-to-fragid>navigate to that fragment</a> and abort these steps.<li><p>Cancel any preexisting but not yet <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature>mature</a>
   attempt to navigate <var>browsingContext</var>, including canceling any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm started by those attempts. If one of those attempts
   has already created and <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object>initialized a new
   <code>Document</code> object</a>, <a href=#abort-a-document id=navigating-across-documents:abort-a-document>abort</a> that
   <code id=navigating-across-documents:document><a href=#document>Document</a></code> also. (Navigation attempts that have <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-2>matured</a> already have session history entries, and are
   therefore handled during the <a href=#update-the-session-history-with-the-new-page id=navigating-across-documents:update-the-session-history-with-the-new-page>update the session history with the new page</a> algorithm,
   later.)<li>

    <p><a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-3>Prompt to unload</a> the <a href=#active-document id=navigating-across-documents:active-document-3>active
    document</a> of <var>browsingContext</var>. If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=navigating-across-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document
    to be unloaded</a>, then abort these steps.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-3>navigation</a> algorithm gets canceled
    while this step is running, the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-4>prompt to unload a document</a> algorithm must
    nonetheless be run to completion.</p>

   <li><p><a href=#abort-a-document id=navigating-across-documents:abort-a-document-2>Abort</a> the <a href=#active-document id=navigating-across-documents:active-document-4>active document</a> of
   <var>browsingContext</var>.<li>

    <p>If <var>browsingContext</var> is a <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context>nested browsing context</a>, then put it in the
    <a href=#delaying-load-events-mode id=navigating-across-documents:delaying-load-events-mode>delaying <code>load</code> events mode</a>.</p>

    <p>The user agent must take this <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context-2>nested browsing context</a> out of the <a href=#delaying-load-events-mode id=navigating-across-documents:delaying-load-events-mode-2>delaying
    <code>load</code> events mode</a> when this <a href=#navigate id=navigating-across-documents:navigate-4>navigation</a> algorithm later <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-3>matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    

   <li><p>Let <var>navigationType</var> be "<code>form-submission</code>" if the <a href=#navigate id=navigating-across-documents:navigate-5>navigation algorithm</a> was invoked as a result of the <a href=#concept-form-submit id=navigating-across-documents:concept-form-submit-2>form submission algorithm</a>, and "<code>other</code>"
   otherwise.<li><p>Return to whatever algorithm invoked the navigation steps and continue running these steps
   <a href=#in-parallel id=navigating-across-documents:in-parallel>in parallel</a>.<li>

    <p>This is the step that attempts to obtain <var>resource</var>, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response data-x-internal=concept-response>response</a><dd><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response>process a navigate response</a> with null, <var>resource</var>,
     <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-4>source browsing context</a>, and
     <var>browsingContext</var>, and then abort these steps.<dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-3 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-4 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
     is "<code id=navigating-across-documents:javascript-protocol><a href=#javascript-protocol>javascript</a></code>"<dd>

      

      <p><a href=#queue-a-task id=navigating-across-documents:queue-a-task>Queue a task</a> to run <dfn id=javascript-protocol>these
      "<code>javascript:</code> URL" steps</dfn>, associated with the <a href=#active-document id=navigating-across-documents:active-document-5>active document</a>
      of <var>browsingContext</var>:</p>

      <ol id=concept-js-deref><li>
        <p>Let <var>result</var> be undefined, and jump to the step labeled <i>process result</i>
        below if either of the following are true:</p>

        <ul><li><p>The <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-5>source browsing context</a>'s <a href=#active-document id=navigating-across-documents:active-document-6>active document</a>'s
         <a href=#concept-origin id=navigating-across-documents:concept-origin>origin</a> is not the <a href=#same-origin id=navigating-across-documents:same-origin>same origin</a> as <var>browsingContext</var>'s
         <a href=#active-document id=navigating-across-documents:active-document-7>active document</a>'s <a href=#concept-origin id=navigating-across-documents:concept-origin-2>origin</a>.<li><p>The <a id=navigating-across-documents:should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation request of type from source in target be blocked by
         Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when
         executed upon <var>resource</var>, "<code>other</code>", the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-6>source
         browsing context</a>, and <var>browsingContext</var>. <a href=#refsCSP>[CSP]</a></ul>
       <li><p>Let <var>urlString</var> be the result of running the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> on <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-5 data-x-internal=concept-request-url>url</a>.<li><p>Remove the leading "<code>javascript:</code>" string from
       <var>urlString</var>.<li><p>Let <var>script source</var> be the result of applying the <a id=navigating-across-documents:percent-decode href=https://url.spec.whatwg.org/#percent-decode data-x-internal=percent-decode>percent decode</a>
       algorithm to <var>urlString</var>.<li><p>Replace <var>script source</var> with the result of applying the <a id=navigating-across-documents:utf-8-decode href=https://encoding.spec.whatwg.org/#utf-8-decode data-x-internal=utf-8-decode>UTF-8
       decode</a> algorithm to <var>script source</var>.<li><p>Let <var>address</var> be the <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the
       <a href=#active-document id=navigating-across-documents:active-document-8>active document</a> of <var>browsingContext</var>.<li><p>Let <var>settings</var> be the <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object>relevant settings object</a> for the
       <a href=#active-document id=navigating-across-documents:active-document-9>active document</a> of <var>browsingContext</var>.<li><p>Let <var>script</var> be the result of <a href=#creating-a-classic-script id=navigating-across-documents:creating-a-classic-script>creating a classic script</a> given
       <var>script source</var> and <var>settings</var>.<li><p>Let <var>result</var> be the result of <a href=#run-a-classic-script id=navigating-across-documents:run-a-classic-script>running the
       classic script</a> <var>script</var>. If evaluation was unsuccessful, let
       <var>result</var> be undefined instead. (The result will also be undefined if <a href=#concept-bc-noscript id=navigating-across-documents:concept-bc-noscript>scripting is disabled</a>.)<li><p>Let <var>response</var> be null.<li>

        <p><i>Process result</i>: If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=navigating-across-documents:js-type data-x-internal=js-type>Type</a>(<var>result</var>) is not
        String, then set <var>response</var> to a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-2 data-x-internal=concept-response>response</a> whose <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status data-x-internal=concept-response-status>status</a> is <code>204</code>.</p>

        <p>Otherwise, set <var>response</var> a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-3 data-x-internal=concept-response>response</a>
        whose <a href=https://fetch.spec.whatwg.org/#concept-response-header-list id=navigating-across-documents:concept-response-header-list data-x-internal=concept-response-header-list>header list</a> consists of `<code>Content-Type</code>`/`<code id=navigating-across-documents:text/html><a href=#text/html>text/html</a></code>` and `<code id=navigating-across-documents:http-referrer-policy><a data-x-internal=http-referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header-dfn>Referrer-Policy</a></code>`/<var>settings</var>'s <a id=navigating-across-documents:referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy data-x-internal=referrer-policy>referrer
        policy</a>, whose <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body data-x-internal=concept-response-body>body</a> is <var>result</var>,
        and whose <a href=https://fetch.spec.whatwg.org/#concept-response-https-state id=navigating-across-documents:concept-response-https-state data-x-internal=concept-response-https-state>HTTPS state</a> is
        <var>settings</var>'s <a href=#https-state id=navigating-across-documents:https-state>HTTPS state</a>.</p>

        <p class=warning>The exact conversion between the JavaScript string <var>result</var> and
        the bytes that comprise a <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body-2 data-x-internal=concept-response-body>response body</a> is
        not yet specified, pending further investigation into user agent behavior. See <a href=https://github.com/whatwg/html/issues/1129>issue #1129</a>.</p>

        <p>When it comes time to <a href="#set-the-document's-address" id="navigating-across-documents:set-the-document's-address">set the document's address</a>, use <var>address</var> as
        the <a href=#override-url id=navigating-across-documents:override-url>override URL</a>.</p>
       <li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-2>process a navigate response</a> with <var>resource</var>,
       <var>response</var>, <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-7>source browsing context</a>, and
       <var>browsingContext</var>, and then abort these steps.</ol>

      <p>The <a href=#task-source id=navigating-across-documents:task-source>task source</a> for this <a href=#concept-task id=navigating-across-documents:concept-task>task</a> is the
      <a href=#dom-manipulation-task-source id=navigating-across-documents:dom-manipulation-task-source>DOM manipulation task source</a>.</p>

      <div class=example>

       <p>So for example a <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-2><code>javascript:</code> URL</a> in
       an <code id=navigating-across-documents:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code> attribute of an <code id=navigating-across-documents:the-a-element><a href=#the-a-element>a</a></code> element
       would only be evaluated when the link was <a href=#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2-2>followed</a>, while such a URL in the <code id=navigating-across-documents:attr-iframe-src><a href=#attr-iframe-src>src</a></code> attribute of an <code id=navigating-across-documents:the-iframe-element><a href=#the-iframe-element>iframe</a></code> element would be
       evaluated in the context of the <code id=navigating-across-documents:the-iframe-element-2><a href=#the-iframe-element>iframe</a></code>'s own <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context-3>nested browsing
       context</a> when the <code id=navigating-across-documents:the-iframe-element-3><a href=#the-iframe-element>iframe</a></code> is being set up; once evaluated, its return value
       (if it was a string) would replace that <a href=#browsing-context id=navigating-across-documents:browsing-context-2>browsing context</a>'s
       <code id=navigating-across-documents:document-2><a href=#document>Document</a></code>, thus also changing the <code id=navigating-across-documents:window><a href=#window>Window</a></code> object of that
       <a href=#browsing-context id=navigating-across-documents:browsing-context-3>browsing context</a>.</p>

      </div>

     <dt>If <var>resource</var> is to be fetched using `<code>GET</code>`, and there are
     <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache>relevant application caches</a> that are
     identified by a URL with the <a href=#same-origin id=navigating-across-documents:same-origin-2>same origin</a> as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign>foreign</a>, and whose <a href=#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode>mode</a> is <a href=#concept-appcache-mode-fast id=navigating-across-documents:concept-appcache-mode-fast>fast</a>, and the user agent is not in a mode where it
     will avoid using <a href=#application-cache id=navigating-across-documents:application-cache>application caches</a><dd>

      <p>Fetch <var>resource</var> from the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection>most
      appropriate application cache</a> of those that match.</p>

      <p class=example>For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

      <p class=XXX>This still needs to be integrated with the Fetch
      standard. <a href=#refsFETCH>[FETCH]</a></p>

     <dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-4 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-6 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a>
     is a <a id=navigating-across-documents:fetch-scheme href=https://url.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a><dd><p>Run <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch>process a navigate fetch</a> given <var>resource</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-8>source
     browsing context</a>, and <var>browsing context</var>, and <var>type</var>.<dt>Otherwise, <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-5 data-x-internal=concept-request>request</a> whose
     <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-7 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-3 data-x-internal=concept-url-scheme>scheme</a>
     is neither "<code id=navigating-across-documents:javascript-protocol-3><a href=#javascript-protocol>javascript</a></code>" nor a <a id=navigating-across-documents:fetch-scheme-2 href=https://url.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch
     scheme</a><dd><p>Run <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme>process a navigate URL scheme</a> given <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-8 data-x-internal=concept-request-url>url</a> and <var>browsingContext</var>.</dl>
   </ol>

  <p>To <dfn id=process-a-navigate-fetch data-export="">process a navigate fetch</dfn>, given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-6 data-x-internal=concept-request>request</a> <var>request</var>, <a href=#browsing-context id=navigating-across-documents:browsing-context-4>browsing context</a>
  <var>sourceBrowsingContext</var>, <a href=#browsing-context id=navigating-across-documents:browsing-context-5>browsing context</a> <var>browsingContext</var>, and
  string <var>type</var>, run these steps:</p>

  <ol><li><p>Let <var>response</var> be null.<li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=navigating-across-documents:concept-request-client data-x-internal=concept-request-client>client</a> to
   <var>sourceBrowsingContext</var>'s <a href=#active-document id=navigating-across-documents:active-document-10>active document</a>'s <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object-2>relevant settings
   object</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=navigating-across-documents:concept-request-destination data-x-internal=concept-request-destination>destination</a> to "<code>document</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-mode id=navigating-across-documents:concept-request-mode data-x-internal=concept-request-mode>mode</a> to "<code>navigate</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-credentials-mode id=navigating-across-documents:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials
   mode</a> to "<code>include</code>", <a id=navigating-across-documents:use-url-credentials-flag href=https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-redirect-mode id=navigating-across-documents:concept-request-redirect-mode data-x-internal=concept-request-redirect-mode>redirect mode</a> to "<code>manual</code>",
   and <a href=https://fetch.spec.whatwg.org/#concept-request-target-client-id id=navigating-across-documents:concept-request-target-client-id data-x-internal=concept-request-target-client-id>target client id</a> to
   <var>browsingContext</var>'s <a href=#active-document id=navigating-across-documents:active-document-11>active document</a>'s <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object-3>relevant settings
   object</a>'s <a href=#concept-environment-id id=navigating-across-documents:concept-environment-id>id</a>.<li><p>If <var>browsingContext</var> is a <a href=#child-browsing-context id=navigating-across-documents:child-browsing-context>child browsing context</a> and the
   <a href=#browsing-context-container id=navigating-across-documents:browsing-context-container>browsing context container</a> of <var>browsingContext</var> has a <a href=#browsing-context-scope-origin id=navigating-across-documents:browsing-context-scope-origin>browsing
   context scope origin</a>, then set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-origin id=navigating-across-documents:concept-request-origin data-x-internal=concept-request-origin>origin</a> to that <a href=#browsing-context-scope-origin id=navigating-across-documents:browsing-context-scope-origin-2>browsing context scope
   origin</a>.<li>
    <p>Create a new <a href=#environment id=navigating-across-documents:environment>environment</a> <var>reservedEnvironment</var>, and set its <a href=#concept-environment-id id=navigating-across-documents:concept-environment-id-2>id</a> to a new unique opaque string, its <a href=#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url>creation URL</a> to <var>request</var>'s
    <a id=navigating-across-documents:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>url</a>, and its <a href=#concept-environment-target-browsing-context id=navigating-across-documents:concept-environment-target-browsing-context>target
    browsing context</a> to <var>browsingContext</var>.</p>

    <p class=note>The created environment's <a href=#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker>active service worker</a> is set in the
    <a href=https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm id=navigating-across-documents:on-fetch-request-algorithm data-x-internal=on-fetch-request-algorithm>handle fetch</a> algorithm during the fetch if its
    <a href=#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url-2>creation URL</a> matches a service worker
    registration. <a href=#refsSW>[SW]</a></p>
   <li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reserved-client id=navigating-across-documents:concept-request-reserved-client data-x-internal=concept-request-reserved-client>reserved
   client</a> to <var>reservedEnvironment</var>.<li>
    <p>If the <a id=navigating-across-documents:should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy-2 href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation request of type from source in target be blocked by Content
    Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon
    <var>request</var>, <var>navigationType</var>, <var>sourceBrowsingContext</var>, and
    <var>browsingContext</var>, then set <var>response</var> to a network error.
    <a href=#refsCSP>[CSP]</a></p>

    <p>Otherwise:</p>

    <ol><li><p><a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch-2 data-x-internal=concept-fetch>Fetch</a> <var>request</var>.<li><p>Wait for the <a href=#concept-task id=navigating-across-documents:concept-task-2>task</a> on the <a href=#networking-task-source id=navigating-across-documents:networking-task-source>networking task
     source</a> to <a id=navigating-across-documents:process-response href=https://fetch.spec.whatwg.org/#process-response data-x-internal=process-response>process response</a> and set <var>response</var> to the
     result.</ol>
   <li id=navigate-redirect-step>
    <p>If <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url data-x-internal=concept-response-location-url>location URL</a>
    and it is either failure or a <a id=navigating-across-documents:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is an <a id=navigating-across-documents:http(s)-scheme href=https://url.spec.whatwg.org/#http-scheme data-x-internal=http(s)-scheme>HTTP(S) scheme</a>, then set
    <var>response</var> to the result of performing <a id=navigating-across-documents:http-redirect-fetch href=https://fetch.spec.whatwg.org/#concept-http-redirect-fetch data-x-internal=http-redirect-fetch>HTTP-redirect fetch</a> using
    <var>request</var> and <var>response</var> and then run this step again.</p>

    <p class=note>Navigation handles redirects manually as navigation is the only place in the web
    platform that cares for redirects to <code id=navigating-across-documents:mailto-protocol><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URLs and
    such.</p>
   <li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-2 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-5 data-x-internal=concept-url-scheme>scheme</a> is "<code>blob</code>", "<code>file</code>", "<code>filesystem</code>", or "<code>javascript</code>", then set <var>response</var> to a network error.<li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-3 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-6 data-x-internal=concept-url-scheme>scheme</a> is a <a id=navigating-across-documents:fetch-scheme-3 href=https://url.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a>, then run
   <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch-2>process a navigate fetch</a> with a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-7 data-x-internal=concept-request>request</a>
   whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-9 data-x-internal=concept-request-url>url</a> is <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-4 data-x-internal=concept-response-location-url>location URL</a>, <var>sourceBrowsingContext</var>,
   <var>browsingContext</var>, and <var>type</var>.

   <li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-5 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, run the
   <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme-2>process a navigate URL scheme</a> given <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-6 data-x-internal=concept-response-location-url>location URL</a> and
   <var>browsingContext</var>.<li>

    <p><strong>Fallback in prefer-online mode</strong>: If <var>response</var> was not fetched from
    an <a href=#application-cache id=navigating-across-documents:application-cache-2>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    there are <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache-2>relevant application caches</a> that are
    identified by a URL with the <a href=#same-origin id=navigating-across-documents:same-origin-3>same origin</a> as the URL in question, and that have this
    URL as one of their entries, excluding entries marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-2>foreign</a>, and whose <a href=#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode-2>mode</a> is <a href=#concept-appcache-mode-prefer-online id=navigating-across-documents:concept-appcache-mode-prefer-online>prefer-online</a>, and the user didn't cancel
    the navigation attempt during the earlier step, and <var>response</var> is either a network
    error or its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-2 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok
    status</a>, then:</p>

    <p>Let <var>candidate</var> be the response identified by the URL in question from the
    <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-2>most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-3>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached response.</p>

   <li>

    <p><strong>Fallback for fallback entries</strong>: If <var>response</var> was not fetched from
    an <a href=#application-cache id=navigating-across-documents:application-cache-3>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    its URL <a href=#concept-appcache-matches-fallback id=navigating-across-documents:concept-appcache-matches-fallback>matches the fallback namespace</a>
    of one or more <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache-3>relevant application caches</a>, and
    the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-3>most appropriate application cache</a> of those
    that match does not have an entry in its <a href=#concept-appcache-onlinesafelist id=navigating-across-documents:concept-appcache-onlinesafelist>online
    safelist</a> that has the <a href=#same-origin id=navigating-across-documents:same-origin-4>same origin</a> as <var>response</var>'s URL and that is a
    <a href=#prefix-match id=navigating-across-documents:prefix-match>prefix match</a> for <var>response</var>'s URL, and the user didn't cancel the
    navigation attempt during the earlier step, and <var>response</var> is either a network error or
    its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-3 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status-2 href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok status</a>,
    then:</p>
    

    <p>Let <var>candidate</var> be the <a href=#concept-appcache-fallback id=navigating-across-documents:concept-appcache-fallback>fallback
    response</a> specified for the <a href=#concept-appcache-fallback-ns id=navigating-across-documents:concept-appcache-fallback-ns>fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-4>most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-4>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-3" data-x-internal="the-document's-address">URL</a>, if appropriate, will still be the
    originally requested URL, not the fallback URL, but the user agent may indicate to the user that
    the original page load failed, that the page used was a fallback response, and what the URL of
    the fallback response actually is.</p>
   <li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-3>process a navigate response</a> given <var>request</var>,
   <var>response</var>, <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-9>source browsing context</a>,
   <var>browsingContext</var>, and <var>reservedEnvironment</var>.</ol>

  <p>To <dfn id=process-a-navigate-response data-export="">process a navigate response</dfn>, given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-8 data-x-internal=concept-request>request</a> <var>request</var>, a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-4 data-x-internal=concept-response>response</a> <var>response</var>, a string <var>type</var>, two
  <a href=#browsing-context id=navigating-across-documents:browsing-context-6>browsing contexts</a> <var>source</var> and
  <var>browsingContext</var>, and an optional <a href=#environment id=navigating-across-documents:environment-2>environment</a>
  <var>reservedEnvironment</var>, run these steps:</p>

  <ol><li>
    <p>If any of the following are true, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline>display the inline
    content with an appropriate error shown to the user</a>, with the newly created
    <code id=navigating-across-documents:document-3><a href=#document>Document</a></code> object's <a href=#concept-origin id=navigating-across-documents:concept-origin-3>origin</a> set to a new <a href=#concept-origin-opaque id=navigating-across-documents:concept-origin-opaque>opaque origin</a>, and abort these steps.</p>

    <ul><li><p><var>response</var> is a network error.<li><p class=XXX>TODO: Define <code>X-Frame-Options</code>
     processing here [<a href=https://github.com/whatwg/html/issue/1230>whatwg/html#1230</a>].<li><p>The <a id=navigating-across-documents:should-navigation-response-to-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-response data-x-internal=should-navigation-response-to-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation response to navigation request of type from source in target
     be blocked by Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon <var>request</var>, <var>response</var>,
     <var>type</var>, <var>source</var>, and <var>browsingContext</var>. <a href=#refsCSP>[CSP]</a></ul>

    <p class=note>This is where the network errors defined and propagated by the WHATWG Fetch
    standard, such as DNS or TLS errors, end up being displayed to users. <a href=#refsFETCH>[FETCH]</a></p>
   <li><p>If <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-4 data-x-internal=concept-response-status>status</a> is
   <code>204</code> or <code>205</code>, then abort these steps.<li><p>If <var>response</var> has an `<code id=navigating-across-documents:http-content-disposition><a data-x-internal=http-content-disposition href=https://tools.ietf.org/html/rfc6266>Content-Disposition</a></code>` header specifying the <code>attachment</code> disposition type, then handle it <a href=#as-a-download id=navigating-across-documents:as-a-download>as a download</a> and abort
   these steps.<li><p>Let <var>type</var> be the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=navigating-across-documents:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed type of
   <var>response</var></a>.<li>
    <p>If the user agent has been configured to process resources of the given <var>type</var>
    using some mechanism other than rendering the content in a <a href=#browsing-context id=navigating-across-documents:browsing-context-7>browsing context</a>, then
    skip this step. Otherwise, if the <var>type</var> is one of the following types, jump to the
    appropriate entry in the following list, and process <var>response</var> as described there:</p>

    <dl class=switch><dt>an <a id=navigating-across-documents:html-mime-type href=https://mimesniff.spec.whatwg.org/#html-mime-type data-x-internal=html-mime-type>HTML MIME type</a><dd>Follow the steps given in the <a href=#read-html id=navigating-across-documents:read-html>HTML document</a> section,
     and then, once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-6>navigate</a> algorithm.<dt>an <a id=navigating-across-documents:xml-mime-type href=https://mimesniff.spec.whatwg.org/#xml-mime-type data-x-internal=xml-mime-type>XML MIME type</a> that is not an <a href=#explicitly-supported-xml-type id=navigating-across-documents:explicitly-supported-xml-type>explicitly supported XML
     type</a><dd>Follow the steps given in the <a href=#read-xml id=navigating-across-documents:read-xml>XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps
     given in the <a href=#read-xml id=navigating-across-documents:read-xml-2>XML document</a> section have completed, abort this
     <a href=#navigate id=navigating-across-documents:navigate-7>navigate</a> algorithm.<dt>a <a href=#javascript-mime-type id=navigating-across-documents:javascript-mime-type>JavaScript MIME type</a><dt>a <a href=#json-mime-type id=navigating-across-documents:json-mime-type>JSON MIME type</a> that is not an <a href=#explicitly-supported-json-type id=navigating-across-documents:explicitly-supported-json-type>explicitly supported JSON
     type</a><dt>"<code id=navigating-across-documents:text/cache-manifest><a href=#text/cache-manifest>text/cache-manifest</a></code>"<dt>"<code id=navigating-across-documents:text/css><a href=#text/css>text/css</a></code>"<dt>"<code id=navigating-across-documents:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>"<dt>"<code id=navigating-across-documents:text/vtt><a href=#text/vtt>text/vtt</a></code>"<dd>Follow the steps given in the <a href=#read-text id=navigating-across-documents:read-text>plain text file</a> section,
     and then, once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-8>navigate</a> algorithm.<dt>"<code id=navigating-across-documents:multipart/x-mixed-replace><a href=#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code>"<dd>Follow the steps given in the <a href=#read-multipart-x-mixed-replace id=navigating-across-documents:read-multipart-x-mixed-replace>multipart/x-mixed-replace</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-9>navigate</a> algorithm.<dt>A supported image, video, or audio type<dd>Follow the steps given in the <a href=#read-media id=navigating-across-documents:read-media>media</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-10>navigate</a> algorithm.<dt>A type that will use an external application to render the content in
     <var>browsingContext</var><dd>Follow the steps given in the <a href=#read-plugin id=navigating-across-documents:read-plugin>plugin</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-11>navigate</a> algorithm.</dl>

    <p>An <dfn id=explicitly-supported-xml-type>explicitly supported XML type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href=#plugin id=navigating-across-documents:plugin>plugin</a> rendering
    directly in <var>browsingContext</var>, or a separate application), or one for which the user
    agent has dedicated processing rules (e.g. a Web browser with a built-in Atom feed viewer would
    be said to explicitly support the <code id=navigating-across-documents:application/atom+xml><a href=#application/atom+xml>application/atom+xml</a></code> MIME type), or one for which
    the user agent has a dedicated handler (e.g. one registered using <code id=navigating-across-documents:dom-navigator-registercontenthandler><a href=#dom-navigator-registercontenthandler>registerContentHandler()</a></code>).</p>

    <p>The term <dfn id=json-mime-type>JSON MIME type</dfn> is used to refer to the <a href=https://mimesniff.spec.whatwg.org/#mime-type id=navigating-across-documents:mime-type data-x-internal=mime-type>MIME
    types</a> <code id=navigating-across-documents:application/json><a href=#application/json>application/json</a></code>, <code id=navigating-across-documents:text/json><a href=#text/json>text/json</a></code>, and any <a id=navigating-across-documents:mime-type-2 href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME
    type</a> whose subtype ends with the five characters "<code>+json</code>".

    <p>An <dfn id=explicitly-supported-json-type>explicitly supported JSON type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href=#plugin id=navigating-across-documents:plugin-2>plugin</a> rendering
    directly in <var>browsingContext</var>, or a separate application), or one for which the user
    agent has dedicated processing rules, or one for which the user agent has a dedicated handler
    (e.g. one registered using <code id=navigating-across-documents:dom-navigator-registercontenthandler-2><a href=#dom-navigator-registercontenthandler>registerContentHandler()</a></code>).</p>

    <p><dfn id="set-the-document's-address">Setting the document's address</dfn>: If there is no
    <dfn id=override-url>override URL</dfn>, then any <code id=navigating-across-documents:document-4><a href=#document>Document</a></code> created by these steps must have its
    <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">URL</a> set to the <a id=navigating-across-documents:url-7 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that was
    originally to be fetched, ignoring any other data that was used to obtain the resource. However,
    if there <em>is</em> an <a href=#override-url id=navigating-across-documents:override-url-2>override URL</a>, then any <code id=navigating-across-documents:document-5><a href=#document>Document</a></code> created by
    these steps must have its <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-5" data-x-internal="the-document's-address">URL</a> set to that
    <a id=navigating-across-documents:url-8 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> instead.</p>

    <p class=note>An <a href=#override-url id=navigating-across-documents:override-url-3>override URL</a> is set when <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-4>dereferencing a <code>javascript:</code> URL</a> and when
    performing <a href=#an-overridden-reload id=navigating-across-documents:an-overridden-reload>an overridden reload</a>.</p>

    <p><dfn id=initialise-the-document-object data-export="">Initializing a new <code>Document</code> object</dfn>: when a
    <code id=navigating-across-documents:document-6><a href=#document>Document</a></code> is created as part of the above steps, the user agent will be required to
    additionally run the following algorithm after creating the new object:</p>

    <ol><li><p>Let <var>window</var> be null.<li><p>Let <var>settingsObject</var> be null.<li><p>If <var>browsingContext</var>'s only entry in its <a href=#session-history id=navigating-across-documents:session-history>session history</a> is the
     <code id=navigating-across-documents:about:blank><a href=#about:blank>about:blank</a></code> <code id=navigating-across-documents:document-7><a href=#document>Document</a></code> that was added when <var>browsingContext</var>
     was <a href=#creating-a-new-browsing-context id=navigating-across-documents:creating-a-new-browsing-context>created</a>, and navigation is occurring
     with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled>replacement enabled</a>, and that <code id=navigating-across-documents:document-8><a href=#document>Document</a></code> has the <a href=#same-origin id=navigating-across-documents:same-origin-5>same
     origin</a> as the new <code id=navigating-across-documents:document-9><a href=#document>Document</a></code>, then set <var>window</var> to the
     <code id=navigating-across-documents:window-2><a href=#window>Window</a></code> object of that <code id=navigating-across-documents:document-10><a href=#document>Document</a></code>, and set <var>settingsObject</var> to
     <var>window</var>'s <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object-4>relevant settings object</a>.<li>
      <p>Otherwise,</p>

      <ol><li>
        <p>Call the JavaScript <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=navigating-across-documents:js-initializehostdefinedrealm data-x-internal=js-initializehostdefinedrealm>InitializeHostDefinedRealm()</a> abstract operation
        with the following customizations:</p>

        <ul><li><p>For the global object, create a new <code id=navigating-across-documents:window-3><a href=#window>Window</a></code> object and set
         <var>window</var> to it.<li><p>For the global <b>this</b> value, use <var>browsingContext</var>'s
         <code id=navigating-across-documents:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.<li><p>Let <var>realm execution context</var> be the created <a id=navigating-across-documents:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
         context</a>.</ul>
       <li><p><a href=#set-up-a-browsing-context-environment-settings-object id=navigating-across-documents:set-up-a-browsing-context-environment-settings-object>Set up a browsing context environment settings object</a> with <var>realm
       execution context</var> and <var>reservedEnvironment</var>, if present, and set
       <var>settingsObject</var> to the result.</ol>
     <li><p>Set <var>window</var>'s <a href=#concept-document-window id=navigating-across-documents:concept-document-window>associated
     <code>Document</code></a> to the new <code id=navigating-across-documents:document-11><a href=#document>Document</a></code>.<li><p>Set <var>browsingContext</var>'s <code id=navigating-across-documents:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object's
     <a href=#concept-windowproxy-window id=navigating-across-documents:concept-windowproxy-window>[[Window]]</a> internal slot
     value to <var>window</var>.<li><p>Set the <code id=navigating-across-documents:document-12><a href=#document>Document</a></code>'s <a href=#concept-document-https-state id=navigating-across-documents:concept-document-https-state>HTTPS
     state</a> to the <a href=https://fetch.spec.whatwg.org/#concept-response-https-state id=navigating-across-documents:concept-response-https-state-2 data-x-internal=concept-response-https-state>HTTPS state</a> of the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-5 data-x-internal=concept-response>response</a> used to generate the document.<li><p>Set the <code id=navigating-across-documents:document-13><a href=#document>Document</a></code>'s <a href=#concept-document-referrer-policy id=navigating-across-documents:concept-document-referrer-policy>referrer
     policy</a> to the result of <a href=https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header id=navigating-across-documents:parse-referrer-policy-header data-x-internal=parse-referrer-policy-header>parsing the
     `<code>Referrer-Policy</code>` header</a> of the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-6 data-x-internal=concept-response>response</a> used to generate the document. <a href=#refsREFERRERPOLICY>[REFERRERPOLICY]</a><li><p>Execute the <a id="navigating-across-documents:initialize-a-document's-csp-list" href=https://w3c.github.io/webappsec-csp/#initialize-document-csp data-x-internal="initialize-a-document's-csp-list">Initialize a <code>Document</code>'s CSP list</a>
     algorithm on the <code id=navigating-across-documents:document-14><a href=#document>Document</a></code> object and the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-7 data-x-internal=concept-response>response</a> used to generate the document. <a href=#refsCSP>[CSP]</a></p>

     <li>
      <p>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-9 data-x-internal=concept-request>request</a>, then set
      <a href="#the-document's-referrer" id="navigating-across-documents:the-document's-referrer">the document's referrer</a> to the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer-2 data-x-internal=concept-url-serializer>serialization</a> of <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer data-x-internal=concept-request-referrer>referrer</a>, if <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer-2 data-x-internal=concept-request-referrer>referrer</a> is a <a id=navigating-across-documents:url-record href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a>, and the empty
      string otherwise.</p>

      <p class=note>Per the WHATWG Fetch standard a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-10 data-x-internal=concept-request>request</a>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer-3 data-x-internal=concept-request-referrer>referrer</a> will be either a <a id=navigating-across-documents:url-record-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a> or
      "<code>no-referrer</code>" at this point.</p>
     <li><p><a href=#implement-the-sandboxing id=navigating-across-documents:implement-the-sandboxing>Implement the sandboxing</a> for the <code id=navigating-across-documents:document-15><a href=#document>Document</a></code>.<li><p><a href=#set-the-allow*-flags id=navigating-across-documents:set-the-allow*-flags>Set the allow* flags</a> for the <code id=navigating-across-documents:document-16><a href=#document>Document</a></code>.<li><p>Set <var>settingsObject</var>'s <a href=#concept-environment-execution-ready-flag id=navigating-across-documents:concept-environment-execution-ready-flag>execution ready flag</a>.<li>
      <p>If <var>settingsObject</var>'s <a href=#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker-2>active service worker</a> is not null,
      then:</p>

      <ol><li>
        <p>If <var>settingsObject</var> is a <a href=https://w3c.github.io/webappsec-secure-contexts/#secure-context id=navigating-across-documents:secure-context data-x-internal=secure-context>secure context</a>,
        then:</p>

        <ol><li><p>If <var>browsingContext</var> has an <a href=#opener-browsing-context id=navigating-across-documents:opener-browsing-context>opener browsing context</a> and
         <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=navigating-across-documents:concept-request-client-2 data-x-internal=concept-request-client>client</a> is a <a href=https://w3c.github.io/webappsec-secure-contexts/#non-secure-context id=navigating-across-documents:non-secure-context data-x-internal=non-secure-context>non-secure context</a>, then <a href=#disowned-its-opener id=navigating-across-documents:disowned-its-opener>disown <var>browsingContext</var>'s opener</a>.</ol>
       <li><p>Otherwise, set <var>settingsObject</var>'s <a href=#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker-3>active service worker</a> to
       null.</ol>
     </ol>

   <li id=navigate-non-Document>

    <p><i>Non-document content</i>: If, given <var>type</var>, the new resource is to be
    handled by displaying some sort of inline content, e.g. a native rendering of the content, an
    error message because the specified type is not supported, or an inline prompt to allow the user
    to select <a href=#dom-navigator-registercontenthandler id=navigating-across-documents:dom-navigator-registercontenthandler-3>a registered handler</a> for
    the given type, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-2>display the inline content</a>, and
    then abort these steps.</p>

    <p class=note>In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   <li><p>Otherwise, the document's <var>type</var> is such that the resource will not affect
   <var>browsingContext</var>, e.g., because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a href=#as-a-download id=navigating-across-documents:as-a-download-2>as a download</a>. <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software>Process the resource appropriately</a>.</p>

  </ol>

  <p>To <dfn id=process-a-navigate-url-scheme>process a navigate URL scheme</dfn>, given a <a id=navigating-across-documents:url-9 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>url</var> and
  <a href=#browsing-context id=navigating-across-documents:browsing-context-8>browsing context</a> <var>browsingContext</var>, run these steps:</p>

  <ol><li><p>If <var>url</var> is to be handled using a mechanism that does not affect
   <var>browsingContext</var>, e.g., because <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-7 data-x-internal=concept-url-scheme>scheme</a> is handled externally, then <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software-2>proceed with that mechanism instead</a>.<li>
    <p>Otherwise, <var>url</var> is to be handled by displaying some sort of inline content, e.g.,
    an error message because the specified scheme is not one of the supported protocols, or an
    inline prompt to allow the user to select <a href=#dom-navigator-registerprotocolhandler id=navigating-across-documents:dom-navigator-registerprotocolhandler>a
    registered handler</a> for the given scheme. <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-3>Display the
    inline content</a>.</p>

    <p class=note>In the case of a registered handler being used, <a href=#navigate id=navigating-across-documents:navigate-12>navigate</a> will be
    invoked with a new URL.</p>
   </ol>

  <p>When a resource is handled by <dfn id=hand-off-to-external-software>passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id=navigating-across-documents:mailto-protocol-2><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-10>source browsing
  context</a>'s <a href=#active-document id=navigating-across-documents:active-document-12>active document</a>'s <a href=#concept-origin id=navigating-across-documents:concept-origin-4>origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href=#navigate id=navigating-across-documents:navigate-13>navigate</a> algorithm, when it was invoked,
  was not <a href=#triggered-by-user-activation id=navigating-across-documents:triggered-by-user-activation>triggered by user activation</a>, the user agent should not invoke the external
  software package without prior user confirmation.</p>

  <p class=example>For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id=update-the-session-history-with-the-new-page>update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a href=#queue-a-task id=navigating-across-documents:queue-a-task-2>queue a task</a> (associated with the <code id=navigating-across-documents:document-17><a href=#document>Document</a></code>
  object of the <a href=#current-entry id=navigating-across-documents:current-entry>current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    <p><a href=#unload-a-document id=navigating-across-documents:unload-a-document-2>Unload</a> the <code id=navigating-across-documents:document-18><a href=#document>Document</a></code> object of the
    <a href=#current-entry id=navigating-across-documents:current-entry-2>current entry</a>, with the <var>recycle</var> parameter set to false.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-14>navigation</a> algorithm is canceled while
    this step is running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-3>unload a document</a> algorithm, then the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-4>unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href=#navigate id=navigating-across-documents:navigate-15>navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   <li>

    <dl><dt>If the navigation was initiated for <dfn id=entry-update>entry update</dfn> of an entry<dd>

      <ol><li><p>Replace the <code id=navigating-across-documents:document-19><a href=#document>Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code id=navigating-across-documents:document-20><a href=#document>Document</a></code>.<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history>Traverse the history</a> to the new entry.</ol>

     <dt>If the navigation was initiated with a <a id=navigating-across-documents:url-10 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals-2 data-x-internal=concept-url-equals>equals</a> the <a href=#browsing-context id=navigating-across-documents:browsing-context-9>browsing context</a>'s <a href=#active-document id=navigating-across-documents:active-document-13>active
     document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">URL</a><dd>
      <ol><li><p>Replace the <a href=#current-entry id=navigating-across-documents:current-entry-3>current entry</a> with a new entry representing the new resource
       and its <code id=navigating-across-documents:document-21><a href=#document>Document</a></code> object, related state, and the default <a href=#scroll-restoration-mode id=navigating-across-documents:scroll-restoration-mode>scroll restoration
       mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>".<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-2>Traverse the history</a> to the new entry.</ol>
     <dt>Otherwise<dd>

      <ol><li>

        <p>Remove all the entries in the <a href=#browsing-context id=navigating-across-documents:browsing-context-10>browsing context</a>'s <a href=#session-history id=navigating-across-documents:session-history-2>session
        history</a> after the <a href=#current-entry id=navigating-across-documents:current-entry-4>current entry</a>. If the <a href=#current-entry id=navigating-across-documents:current-entry-5>current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       <li><p>Append a new entry at the end of the <code id=navigating-across-documents:history-3><a href=#history-3>History</a></code> object representing the new
       resource and its <code id=navigating-across-documents:document-22><a href=#document>Document</a></code> object, related state, and the default <a href=#scroll-restoration-mode id=navigating-across-documents:scroll-restoration-mode-2>scroll
       restoration mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto-2><a href=#dom-scrollrestoration-auto>auto</a></code>".<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-3>Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-2>replacement enabled</a>, then the traversal must itself be initiated with
       <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-3>replacement enabled</a>.</p>

       </ol>

     </dl>

   <li><p>The <a href=#navigate id=navigating-across-documents:navigate-16>navigation algorithm</a> has now <dfn id=concept-navigate-mature>matured</dfn>.<li><p><i>Fragment loop</i>: <a href=#spin-the-event-loop id=navigating-across-documents:spin-the-event-loop>Spin the event loop</a> for a user-agent-defined amount of
   time, as desired by the user agent implementor. (This is intended to allow the user agent to
   optimize the user experience in the face of performance concerns.)<li><p>If the <code id=navigating-across-documents:document-23><a href=#document>Document</a></code> object has no parser, or its parser has <a href=#stop-parsing id=navigating-across-documents:stop-parsing>stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, then abort
   these steps.<li><p><a href=#scroll-to-the-fragment-identifier id=navigating-across-documents:scroll-to-the-fragment-identifier>Scroll to the fragment</a> given in the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-7" data-x-internal="the-document's-address">URL</a>. If this fails to find <a href=#the-indicated-part-of-the-document id=navigating-across-documents:the-indicated-part-of-the-document>an indicated part of the document</a>, then return to the <i>fragment
   loop</i> step.</ol>

  <p>The <a href=#task-source id=navigating-across-documents:task-source-2>task source</a> for this <a href=#concept-task id=navigating-across-documents:concept-task-3>task</a> is the
  <a href=#networking-task-source id=navigating-across-documents:networking-task-source-2>networking task source</a>.</p>


  <h4 id=read-html>7.8.2 <dfn>Page load processing model for HTML files</dfn><a href=#read-html class=self-link></a></h4>

  <p>When an HTML document is to be loaded in a <a href=#browsing-context id=read-html:browsing-context>browsing context</a>, the user agent must
  <a href=#queue-a-task id=read-html:queue-a-task>queue a task</a> to create a <code id=read-html:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-html:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-html:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-html:initialise-the-document-object>initialize the <code>Document</code> object</a>, and finally create an <a href=#html-parser id=read-html:html-parser>HTML
  parser</a> and associate it with the <code id=read-html:document-2><a href=#document>Document</a></code>. Each <a href=#concept-task id=read-html:concept-task>task</a> that the <a href=#networking-task-source id=read-html:networking-task-source>networking task source</a> places on the
  <a href=#task-queue id=read-html:task-queue>task queue</a> while fetching runs must then fill the parser's <a href=#the-input-byte-stream id=read-html:the-input-byte-stream>input byte
  stream</a> with the fetched bytes and cause the <a href=#html-parser id=read-html:html-parser-2>HTML parser</a> to perform the
  appropriate processing of the input stream.</p>

  <p class=note>The <a href=#the-input-byte-stream id=read-html:the-input-byte-stream-2>input byte stream</a> converts bytes into characters for use in the
  <a href=#tokenization id=read-html:tokenization>tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a href=#content-type id=read-html:content-type>Content-Type metadata</a> of the
  resource; the computed type is not used for this purpose.</p>

  

  <p>When no more bytes are available, the user agent must <a href=#queue-a-task id=read-html:queue-a-task-2>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-html:event-load><a href=#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-html:document-3><a href=#document>Document</a></code> object, but before any script execution, certainly
  before the parser <a href=#stop-parsing id=read-html:stop-parsing>stops</a>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-html:update-the-session-history-with-the-new-page>update the
  session history with the new page</a>.</p>

  <p class=note><a href=#concept-appcache-init id=read-html:concept-appcache-init>Application cache selection</a> happens <a href=#parser-appcache>in the HTML parser</a>.</p>

  <p>The <a href=#task-source id=read-html:task-source>task source</a> for the two tasks mentioned in this section must be the
  <a href=#networking-task-source id=read-html:networking-task-source-2>networking task source</a>.</p>



  <h4 id=read-xml>7.8.3 <dfn>Page load processing model for XML files</dfn><a href=#read-xml class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=17976" title="xml-stylesheet with type=text/xsl needs to be handled explicitly">17976</a></div>

  <p>When faced with displaying an XML file inline, user agents must follow the requirements defined
  in the XML and Namespaces in XML recommendations, RFC 7303, DOM, and other relevant specifications
  to create a <code id=read-xml:document><a href=#document>Document</a></code> object and a corresponding <a href=#xml-parser id=read-xml:xml-parser>XML parser</a>. <a href=#refsXML>[XML]</a> <a href=#refsXMLNS>[XMLNS]</a> <a href=#refsRFC7303>[RFC7303]</a> <a href=#refsDOM>[DOM]</a></p>

  <p class=note>At the time of writing, the XML specification community had not actually yet
  specified how XML and the DOM interact.</p> 

  <p>After the <code id=read-xml:document-2><a href=#document>Document</a></code> is created, the user agent must <a href=#initialise-the-document-object id=read-xml:initialise-the-document-object>initialize the
  <code>Document</code> object</a>.</p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a id="read-xml:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the <a id=read-xml:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a>, as parsed according to the XML specifications cited
  above, is found to be an <code id=read-xml:the-html-element><a href=#the-html-element>html</a></code> element with an attribute <code id=read-xml:attr-html-manifest><a href=#attr-html-manifest>manifest</a></code> whose value is not the empty string, then, as soon as
  the element is <a href=#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document>inserted into the document</a>,
  the user agent must <a href=#parse-a-url id=read-xml:parse-a-url>parse</a> the value of that attribute relative
  to that element's <a id=read-xml:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>, and if that is successful, must apply the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=read-xml:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> algorithm to the <a href=#resulting-url-record id=read-xml:resulting-url-record>resulting URL
  record</a> with the <i>exclude fragment flag</i> set to obtain <var>manifest URL</var>, and
  then run the <a href=#concept-appcache-init id=read-xml:concept-appcache-init>application cache selection algorithm</a>
  with <var>manifest URL</var> as the manifest URL, passing in the newly-created
  <code id=read-xml:document-3><a href=#document>Document</a></code>. Otherwise, if the attribute is absent, its value is the empty string, or
  parsing its value fails, then as soon as the <a id=read-xml:document-element-2 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> is <a href=#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document-2>inserted into the document</a>, the user agent must run the <a href=#concept-appcache-init id=read-xml:concept-appcache-init-2>application cache selection algorithm</a> with no manifest, and
  passing in the <code id=read-xml:document-4><a href=#document>Document</a></code>.</p>

  <p class=note>Because the processing of the <code id=read-xml:attr-html-manifest-2><a href=#attr-html-manifest>manifest</a></code>
  attribute happens only once the <a id=read-xml:document-element-3 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> is parsed, any URLs referenced by
  processing instructions before the <a id=read-xml:document-element-4 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> (such as <code>&lt;?xml-stylesheet?></code> PIs) will be fetched from the network and cannot be
  cached.</p>

  <p>User agents may examine the namespace of the root <code id=read-xml:element><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code> node of this
  <code id=read-xml:document-5><a href=#document>Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href=#navigate-non-Document>the next step</a> (labeled <i>non-document content</i>) in the
  <a href=#navigate id=read-xml:navigate>navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code id=read-xml:document-6><a href=#document>Document</a></code>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-xml:update-the-session-history-with-the-new-page>update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code id=read-xml:document-7><a href=#document>Document</a></code>.</p>


  <h4 id=read-text>7.8.4 <dfn>Page load processing model for text files</dfn><a href=#read-text class=self-link></a></h4>

  <p>When a plain text document is to be loaded in a <a href=#browsing-context id=read-text:browsing-context>browsing context</a>, the user agent
  must <a href=#queue-a-task id=read-text:queue-a-task>queue a task</a> to create a <code id=read-text:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-text:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-text:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var> in the
  <a href=#navigate id=read-text:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-text:initialise-the-document-object>initialize the <code>Document</code> object</a>,
  create an <a href=#html-parser id=read-text:html-parser>HTML parser</a>, associate it with the <code id=read-text:document-2><a href=#document>Document</a></code>, act as if the
  tokenizer had emitted a start tag token with the tag name "pre" followed by a single U+000A LINE
  FEED (LF) character, and switch the <a href=#html-parser id=read-text:html-parser-2>HTML parser</a>'s tokenizer to the <a href=#plaintext-state id=read-text:plaintext-state>PLAINTEXT
  state</a>. Each <a href=#concept-task id=read-text:concept-task>task</a> that the <a href=#networking-task-source id=read-text:networking-task-source>networking task
  source</a> places on the <a href=#task-queue id=read-text:task-queue>task queue</a> while fetching runs must then fill the
  parser's <a href=#the-input-byte-stream id=read-text:the-input-byte-stream>input byte stream</a> with the fetched bytes and cause the <a href=#html-parser id=read-text:html-parser-3>HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined by the specifications for the
  <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var>
  in the <a href=#navigate id=read-text:navigate-2>navigate</a> algorithm).</p>

  <p>The <a id="read-text:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code id=read-text:document-3><a href=#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-text:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-text:document-4><a href=#document>Document</a></code>.</p>

  

  <p>When no more bytes are available, the user agent must <a href=#queue-a-task id=read-text:queue-a-task-2>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-text:event-load><a href=#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-text:document-5><a href=#document>Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-text:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-text:the-head-element><a href=#the-head-element>head</a></code> element of the <code id=read-text:document-6><a href=#document>Document</a></code>,
  e.g., linking to a style sheet, providing script, or giving the document a <code id=read-text:the-title-element><a href=#the-title-element>title</a></code>.</p>

  <p class=note>In particular, if the user agent supports the <code>Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., a CSS
  extension.</p>

  <p>The <a href=#task-source id=read-text:task-source>task source</a> for the two tasks mentioned in this section must be the
  <a href=#networking-task-source id=read-text:networking-task-source-2>networking task source</a>.</p>


  <h4 id=read-multipart-x-mixed-replace>7.8.5 <dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn><a href=#read-multipart-x-mixed-replace class=self-link></a></h4>

  <p>When a resource with the type <code id=read-multipart-x-mixed-replace:multipart/x-mixed-replace><a href=#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code> is to be loaded in a
  <a href=#browsing-context id=read-multipart-x-mixed-replace:browsing-context>browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. <a href=#refsRFC2046>[RFC2046]</a></p>

  <p>For each body part obtained from the resource, the user agent must run <a href=#process-a-navigate-response id=read-multipart-x-mixed-replace:process-a-navigate-response>process a navigate
  response</a> using the new body part and the same <a href=#browsing-context id=read-multipart-x-mixed-replace:browsing-context-2>browsing context</a>, with
  <a href=#replacement-enabled id=read-multipart-x-mixed-replace:replacement-enabled>replacement enabled</a> if a previous body part from the same resource resulted in a
  <code id=read-multipart-x-mixed-replace:document><a href=#document>Document</a></code> object being created and <a href=#initialise-the-document-object id=read-multipart-x-mixed-replace:initialise-the-document-object>initialized</a>, and otherwise using the same setup as the <a href=#navigate id=read-multipart-x-mixed-replace:navigate>navigate</a>
  attempt that caused this section to be invoked in the first place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class=note>Thus, <code id=read-multipart-x-mixed-replace:event-load><a href=#event-load>load</a></code> events (and for that matter <code id=read-multipart-x-mixed-replace:event-unload><a href=#event-unload>unload</a></code> events) do fire for each body part loaded.</p>


  <h4 id=read-media>7.8.6 <dfn>Page load processing model for media</dfn><a href=#read-media class=self-link></a></h4>

  <p>When an image, video, or audio resource is to be loaded in a <a href=#browsing-context id=read-media:browsing-context>browsing context</a>, the
  user agent should create a <code id=read-media:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-media:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-media:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-media:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-media:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-media:initialise-the-document-object>initialize the
  <code>Document</code> object</a>, append an <code id=read-media:the-html-element><a href=#the-html-element>html</a></code> element to the
  <code id=read-media:document-2><a href=#document>Document</a></code>, append a <code id=read-media:the-head-element><a href=#the-head-element>head</a></code> element and a <code id=read-media:the-body-element><a href=#the-body-element>body</a></code> element to the
  <code id=read-media:the-html-element-2><a href=#the-html-element>html</a></code> element, append an element <var>host element</var> for the media, as described
  below, to the <code id=read-media:the-body-element-2><a href=#the-body-element>body</a></code> element, and set the appropriate attribute of the element
  <var>host element</var>, as described below, to the address of the image, video, or audio
  resource.</p>

  <p>The element <var>host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th> Type of media
         <th> Element for the media
         <th> Appropriate attribute
   <tbody><tr><td> Image
         <td> <code id=read-media:the-img-element><a href=#the-img-element>img</a></code>
         <td> <code id=read-media:attr-img-src><a href=#attr-img-src>src</a></code>
    <tr><td> Video
         <td> <code id=read-media:the-video-element><a href=#the-video-element>video</a></code>
         <td> <code id=read-media:attr-media-src><a href=#attr-media-src>src</a></code>
    <tr><td> Audio
         <td> <code id=read-media:the-audio-element><a href=#the-audio-element>audio</a></code>
         <td> <code id=read-media:attr-media-src-2><a href=#attr-media-src>src</a></code>
  </table>

  

  <p>Then, the user agent must act as if it had <a href=#stop-parsing id=read-media:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-media:document-3><a href=#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-media:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-media:document-4><a href=#document>Document</a></code>.</p>

  <p>After creating the <code id=read-media:document-5><a href=#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-media:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>


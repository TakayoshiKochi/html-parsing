
  <p>When defining our custom element, we have to also specify the <code>extends</code>
  option:</p>

  <pre>customElements.define("plastic-button", PlasticButton, { extends: "button" });</pre>

  <p>In general, the name of the element being extended cannot be determined simply by looking at
  what element interface it extends, as many elements share the same interface (such as
  <code id=custom-elements-customized-builtin-example:the-q-element><a href=#the-q-element>q</a></code> and <code id=custom-elements-customized-builtin-example:the-blockquote-element><a href=#the-blockquote-element>blockquote</a></code> both sharing <code id=custom-elements-customized-builtin-example:htmlquoteelement><a href=#htmlquoteelement>HTMLQuoteElement</a></code>).</p>

  <p>To use our <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-6>customized built-in element</a>, we use the <code id=custom-elements-customized-builtin-example:attr-is><a href=#attr-is>is</a></code> attribute on a <code id=custom-elements-customized-builtin-example:the-button-element><a href=#the-button-element>button</a></code> element:</p>

  <pre>&lt;button is="plastic-button">Click Me!&lt;/button></pre>

  <p>Trying to use a <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-7>customized built-in element</a> as an <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-4>autonomous custom
  element</a> will <em>not</em> work; that is, <code>&lt;plastic-button>Click
  me?&lt;/plastic-button></code> will simply create an <code id=custom-elements-customized-builtin-example:htmlelement-2><a href=#htmlelement>HTMLElement</a></code> with no special
  behavior.</p>

  <p>If you need to create a type-extended element programmatically, you can use the following form
  of <code id=custom-elements-customized-builtin-example:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://dom.spec.whatwg.org/#dom-document-createelement>createElement()</a></code>:</p>

  <pre>const plasticButton = document.createElement("button", { is: "plastic-button" });
plasticButton.textContent = "Click me!";</pre>

  <p>And as before, the constructor will also work:</p>

  <pre>const plasticButton2 = new PlasticButton();
console.log(plasticButton2.localName);          // will output "button"
console.log(plasticButton2.getAttribute("is")); // will output "plastic-button"</pre>

  <p>Notably, all the of the ways in which <code id=custom-elements-customized-builtin-example:the-button-element-2><a href=#the-button-element>button</a></code> is special apply to such "plastic
  buttons" as well: their focus behavior, ability to participate in <a href=#concept-form-submit id=custom-elements-customized-builtin-example:concept-form-submit>form submission</a>, the <code id=custom-elements-customized-builtin-example:attr-fe-disabled><a href=#attr-fe-disabled>disabled</a></code> attribute, and so on.</p>

  <p id=customized-built-in-element-restrictions><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-8>Customized built-in elements</a> are designed to allow extension of existing HTML
  elements that have useful user-agent supplied behavior or APIs. As such, they can only extend
  existing HTML elements defined in this specification, and cannot extend legacy elements such as
  <code id=custom-elements-customized-builtin-example:bgsound><a href=#bgsound>bgsound</a></code>, <code id=custom-elements-customized-builtin-example:blink><a href=#blink>blink</a></code>, <code id=custom-elements-customized-builtin-example:isindex><a href=#isindex>isindex</a></code>, <code id=custom-elements-customized-builtin-example:keygen><a href=#keygen>keygen</a></code>,
  <code id=custom-elements-customized-builtin-example:multicol><a href=#multicol>multicol</a></code>, <code id=custom-elements-customized-builtin-example:nextid><a href=#nextid>nextid</a></code>, or <code id=custom-elements-customized-builtin-example:spacer><a href=#spacer>spacer</a></code> that have been defined to use
  <code id=custom-elements-customized-builtin-example:htmlunknownelement><a href=#htmlunknownelement>HTMLUnknownElement</a></code> as their <a id=custom-elements-customized-builtin-example:element-interface href=https://dom.spec.whatwg.org/#concept-element-interface data-x-internal=element-interface>element interface</a>.</p>

  <p>One reason for this requirement is future-compatibility: if a <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-9>customized built-in
  element</a> was defined that extended a currently-unknown element, for example <code>combobox</code>, this would prevent this specification from defining a <code>combobox</code> element in the future, as consumers of the derived <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-10>customized
  built-in element</a> would have come to depend on their base element having no interesting
  user-agent-supplied behavior.</p>

  <p>Additionally, <code id=custom-elements-customized-builtin-example:the-applet-element><a href=#the-applet-element>applet</a></code> elements cannot be extended, as they are in the process of
  being removed from the Web platform.</p>

  <h5 id=custom-elements-autonomous-drawbacks>4.13.1.3 Drawbacks of autonomous custom elements<a href=#custom-elements-autonomous-drawbacks class=self-link></a></h5>

  <p><i>This section is non-normative.</i></p>

  <p>As specified below, and alluded to above, simply defining and using an element called
  <code>taco-button</code> does not mean that such elements <a href=#represents id=custom-elements-autonomous-drawbacks:represents>represent</a> buttons. That is, tools such as Web browsers, search engines,
  or accessibility technology will not automatically treat the resulting element as a button just
  based on its defined name.</p>

  <p>To convey the desired button semantics to a variety of users, while still using an
  <a href=#autonomous-custom-element id=custom-elements-autonomous-drawbacks:autonomous-custom-element>autonomous custom element</a>, a number of techniques would need to be employed:</p>

  <ul><li><p>The addition of the <code id=custom-elements-autonomous-drawbacks:attr-tabindex><a href=#attr-tabindex>tabindex</a></code> attribute would make the
   <code>taco-button</code> <a href=#interactive-content-2 id=custom-elements-autonomous-drawbacks:interactive-content-2>interactive content</a>, thus making it
   <a href=#focusable-area id=custom-elements-autonomous-drawbacks:focusable-area>focusable</a>. Note that if the
   <code>taco-button</code> were to become logically disabled, the <code id=custom-elements-autonomous-drawbacks:attr-tabindex-2><a href=#attr-tabindex>tabindex</a></code> attribute would need to be removed.<li><p>The addition of various ARIA attributes helps convey semantics to accessibility
   technology. For example, setting the <code id=custom-elements-autonomous-drawbacks:attr-aria-role><a href=#attr-aria-role>role</a></code> attribute to
   "<code id=custom-elements-autonomous-drawbacks:attr-aria-role-button><a data-x-internal=attr-aria-role-button href=https://w3c.github.io/aria/aria/aria.html#button>button</a></code>" will convey the semantics that this is a
   button, enabling users to successfully interact with the control using usual button-like
   interactions in their accessibility technology. Setting the <code id=custom-elements-autonomous-drawbacks:attr-aria-label><a data-x-internal=attr-aria-label href=https://w3c.github.io/aria/aria/aria.html#aria-label>aria-label</a></code> attribute is necessary to give the button an
   <a href=https://w3c.github.io/aria/aria/aria.html#dfn-accessible-name id=custom-elements-autonomous-drawbacks:concept-accessible-name data-x-internal=concept-accessible-name>accessible name</a>, instead of having accessibility
   technology traverse its child text nodes and announce them. And setting <code id=custom-elements-autonomous-drawbacks:attr-aria-disabled><a data-x-internal=attr-aria-disabled href=https://w3c.github.io/aria/aria/aria.html#aria-disabled>aria-disabled</a></code> to "<code>true</code>" when the button
   is logically disabled conveys to accessibility technology the button's disabled state.<li><p>The addition of event handlers to handle commonly-expected button behaviors helps convey
   the semantics of the button to Web browser users. In this case, the most relevant event handler
   would be one that proxies appropriate <code id=custom-elements-autonomous-drawbacks:event-keydown><a data-x-internal=event-keydown href=https://w3c.github.io/uievents/#event-type-keydown>keydown</a></code> events to
   become <code id=custom-elements-autonomous-drawbacks:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> events, so that you can activate the button both
   with keyboard and by clicking.<li><p>In addition to any default visual styling provided for <code>taco-button</code>
   elements, the visual styling will also need to be updated to reflect changes in logical state,
   such as becoming disabled; that is, whatever stylesheet has rules for <code>taco-button</code> will also need to have rules for <code>taco-button[disabled]</code>.</ul>

  <p>With these points in mind, a full-featured <code>taco-button</code> that took on the
  responsibility of conveying button semantics (including the ability to be disabled) might look
  something like this:</p>

  <pre>class TacoButton extends HTMLElement {
  static get observedAttributes() { return ["disabled"]; }

  constructor() {
    super();

    this.addEventListener("keydown", e => {
      if (e.keyCode === 32 || e.keyCode === 13) {
        this.dispatchEvent(new MouseEvent("click", {
          bubbles: true,
          cancelable: true
        }));
      }
    });

    this.addEventListener("click", e => {
      if (this.disabled) {
        e.preventDefault();
        e.stopPropagation();
      }
    });

    this._observer = new MutationObserver(() => {
      this.setAttribute("aria-label", this.textContent);
    });
  }

  connectedCallback() {
    this.setAttribute("role", "button");
    this.setAttribute("tabindex", "0");

    this._observer.observe(this, {
      childList: true,
      characterData: true,
      subtree: true
    });
  }

  disconnectedCallback() {
    this._observer.disconnect();
  }

  get disabled() {
    return this.hasAttribute("disabled");
  }

  set disabled(v) {
    if (v) {
      this.setAttribute("disabled", "");
    } else {
      this.removeAttribute("disabled");
    }
  }

  attributeChangedCallback() {
    // only is called for the disabled attribute due to observedAttributes
    if (this.disabled) {
      this.removeAttribute("tabindex");
      this.setAttribute("aria-disabled", "true");
    } else {
      this.setAttribute("tabindex", "0");
      this.setAttribute("aria-disabled", "false");
    }
  }
}</pre>

  <p>Even with this rather-complicated element definition, the element is not a pleasure to use for
  consumers: it will be continually "sprouting" <code id=custom-elements-autonomous-drawbacks:attr-tabindex-3><a href=#attr-tabindex>tabindex</a></code> and
  <code id=custom-elements-autonomous-drawbacks:attr-aria-*><a href=#attr-aria-*>aria-*</a></code> attributes of its own volition. This is because as of now
  there is no way to specify default accessibility semantics or focus behavior for custom elements,
  forcing the use of these attributes to do so (even though they are usually reserved for allowing
  the consumer to override default behavior).</p>

  <p>In contrast, a simple <a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element>customized built-in element</a>, as shown in the previous
  section, would automatically inherit the semantics and behavior of the <code id=custom-elements-autonomous-drawbacks:the-button-element><a href=#the-button-element>button</a></code>
  element, with no need to implement these behaviors manually. In general, for any elements with
  nontrivial behavior and semantics that build on top of existing elements of HTML, <a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element-2>customized built-in elements</a> will be easier to
  develop, maintain, and consume.</p>

  <h5 id=custom-elements-upgrades-examples>4.13.1.4 Upgrading elements after their creation<a href=#custom-elements-upgrades-examples class=self-link></a></h5>

  <p><i>This section is non-normative.</i></p>

  <p>Because <a href=#element-definition id=custom-elements-upgrades-examples:element-definition>element definition</a> can occur at any time, a non-custom element could be
  <a href=https://dom.spec.whatwg.org/#concept-create-element id=custom-elements-upgrades-examples:create-an-element data-x-internal=create-an-element>created</a>, and then later become a <a href=#custom-element id=custom-elements-upgrades-examples:custom-element>custom
  element</a> after an appropriate <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition>definition</a> is
  registered. We call this process "upgrading" the element, from a normal element into a custom
  element.</p>

  <p><a href=#upgrades id=custom-elements-upgrades-examples:upgrades>Upgrades</a> enable scenarios where it may be
  preferable for <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition-2>custom element definitions</a> to be
  registered after relevant elements has been initially created, such as by the parser. They allow
  progressive enhancement of the content in the custom element. For example, in the following HTML
  document the element definition for <code>img-viewer</code> is loaded
  asynchronously:</p>

  <pre>&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;title>Image viewer example&lt;/title>

&lt;img-viewer filter="Kelvin">
  &lt;img src="images/tree.jpg" alt="A beautiful tree towering over an empty savannah">
&lt;/img-viewer>

&lt;script src="js/elements/img-viewer.js" async>&lt;/script></pre>

  <p>The definition for the <code>img-viewer</code> element here is loaded using a
  <code id=custom-elements-upgrades-examples:the-script-element><a href=#the-script-element>script</a></code> element marked with the <code id=custom-elements-upgrades-examples:attr-script-async><a href=#attr-script-async>async</a></code>
  attribute, placed after the <code>&lt;img-viewer></code> tag in the markup. While the
  script is loading, the <code>img-viewer</code> element will be treated as an undefined
  element, similar to a <code id=custom-elements-upgrades-examples:the-span-element><a href=#the-span-element>span</a></code>. Once the script loads, it will define the <code>img-viewer</code> element, and the existing <code>img-viewer</code> element on
  the page will be upgraded, applying the custom element's definition (which presumably includes
  applying an image filter identified by the string "Kelvin", enhancing the image's visual
  appearance).</p>

  <hr>

  <p>Note that <a href=#upgrades id=custom-elements-upgrades-examples:upgrades-2>upgrades</a> only apply to elements in the
  document tree. (Formally, elements that are <a id=custom-elements-upgrades-examples:connected href=https://dom.spec.whatwg.org/#connected data-x-internal=connected>connected</a>.) An element that is not
  inserted into a document will stay un-upgraded. An example illustrates this point:</p>

  <pre>&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;title>Upgrade edge-cases example&lt;/title>

&lt;example-element>&lt;/example-element>

&lt;script>
  "use strict";

  const inDocument = document.querySelector("example-element");
  const outOfDocument = document.createElement("example-element");

  // Before the element definition, both are HTMLElement:
  console.assert(inDocument instanceof HTMLElement);
  console.assert(outOfDocument instanceof HTMLElement);

  class ExampleElement extends HTMLElement {}
  customElements.define("example-element", ExampleElement);

  // After element definition, the in-document element was upgraded:
  console.assert(inDocument instanceof ExampleElement);
  console.assert(!(outOfDocument instanceof ExampleElement));

  document.body.appendChild(outOfDocument);

  // Now that we've moved the element into the document, it too was upgraded:
  console.assert(outOfDocument instanceof ExampleElement);
&lt;/script></pre>

  <h4 id=custom-element-conformance>4.13.2 Requirements for custom element constructors<a href=#custom-element-conformance class=self-link></a></h4>

  <p>When authoring <a href=#custom-element-constructor id=custom-element-conformance:custom-element-constructor>custom element constructors</a>,
  authors are bound by the following conformance requirements:</p>

  <ul><li><p>A parameter-less call to <code>super()</code> must be the first statement in the
   constructor body, to establish the correct prototype chain and <b>this</b> value before any
   further code is run.<li><p>A <code>return</code> statement must not appear anywhere inside the constructor
   body, unless it is a simple early-return (<code>return</code> or <code>return
   this</code>).<li><p>The constructor must not use the <code id=custom-element-conformance:dom-document-write><a href=#dom-document-write>document.write()</a></code>
   or <code id=custom-element-conformance:dom-document-open><a href=#dom-document-open>document.open()</a></code> methods.<li><p>The element's attributes and children must not be inspected, as in the non-<a href=#upgrades id=custom-element-conformance:upgrades>upgrade</a> case none will be present, and relying on
   upgrades makes the element less usable.<li><p>The element must not gain any attributes or children, as this violates the expectations of
   consumers who use the <code id=custom-element-conformance:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://dom.spec.whatwg.org/#dom-document-createelement>createElement</a></code> or <code id=custom-element-conformance:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://dom.spec.whatwg.org/#dom-document-createelementns>createElementNS</a></code> methods.<li><p>In general, work should be deferred to <code>connectedCallback</code> as much as
   possibleâ€”especially work involving fetching resources or rendering. However, note that <code>connectedCallback</code> can be called more than once, so any initialization work that
   is truly one-time will need a guard to prevent it from running twice.<li><p>In general, the constructor should be used to set up initial state and default values, and
   to set up event listeners and possibly a <a id=custom-element-conformance:shadow-root href=https://dom.spec.whatwg.org/#concept-shadow-root data-x-internal=shadow-root>shadow root</a>.</ul>

  <p>Several of these requirements are checked during <a href=https://dom.spec.whatwg.org/#concept-create-element id=custom-element-conformance:create-an-element data-x-internal=create-an-element>element
  creation</a>, either directly or indirectly, and failing to follow them will result in a custom
  element that cannot be instantiated by the parser or DOM APIs.</p>

  <h4 id=custom-elements-core-concepts>4.13.3 Core concepts<a href=#custom-elements-core-concepts class=self-link></a></h4>

  <p>A <dfn id=custom-element>custom element</dfn> is an element that is <a href=https://dom.spec.whatwg.org/#concept-element-custom id=custom-elements-core-concepts:concept-element-custom data-x-internal=concept-element-custom>custom</a>. Informally, this means that its constructor and
  prototype are defined by the author, instead of by the user agent. This author-supplied
  constructor function is called the <dfn id=custom-element-constructor data-export="">custom element constructor</dfn>.</p>

  <p>Two distinct types of <a href=#custom-element id=custom-elements-core-concepts:custom-element>custom elements</a> can be defined:</p>

  <ol><li><p>An <dfn id=autonomous-custom-element data-export="">autonomous custom element</dfn>, which is defined with no <code>extends</code> option. These types of custom elements have a local name equal to their
   <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name>defined name</a>.<li><p>A <dfn id=customized-built-in-element data-export="">customized built-in element</dfn>, which is defined with an <code>extends</code> option. These types of custom elements have a local name equal to the
   value passed in their <code>extends</code> option, and their <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-2>defined name</a> is used as the value of the
   <dfn id=attr-is><code>is</code></dfn> attribute, which therefore must be a <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name>valid
   custom element name</a>.</ol>

  <p>After a <a href=#custom-element id=custom-elements-core-concepts:custom-element-2>custom element</a> is <a href=https://dom.spec.whatwg.org/#concept-create-element id=custom-elements-core-concepts:create-an-element data-x-internal=create-an-element>created</a>,
  changing the value of the <code id=custom-elements-core-concepts:attr-is><a href=#attr-is>is</a></code> attribute does not
  change the element's behavior, as it is saved on the element as its <a href=https://dom.spec.whatwg.org/#concept-element-is-value id=custom-elements-core-concepts:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code> value</a>.</p>

  <p><a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element>Autonomous custom elements</a> have the following
  element definition:</p>

  <dl class=element><dt><a href=#concept-element-categories id=custom-elements-core-concepts:concept-element-categories>Categories</a>:<dd><a href=#flow-content-2 id=custom-elements-core-concepts:flow-content-2>Flow content</a>.<dd><a href=#phrasing-content-2 id=custom-elements-core-concepts:phrasing-content-2>Phrasing content</a>.<dd><a href=#palpable-content-2 id=custom-elements-core-concepts:palpable-content-2>Palpable content</a>.<dt><a href=#concept-element-contexts id=custom-elements-core-concepts:concept-element-contexts>Contexts in which this element can be used</a>:<dd>Where <a href=#phrasing-content-2 id=custom-elements-core-concepts:phrasing-content-2-2>phrasing content</a> is expected.<dt><a href=#concept-element-content-model id=custom-elements-core-concepts:concept-element-content-model>Content model</a>:<dd><a href=#transparent id=custom-elements-core-concepts:transparent>Transparent</a>.<dt><a href=#concept-element-attributes id=custom-elements-core-concepts:concept-element-attributes>Content attributes</a>:<dd><a href=#global-attributes id=custom-elements-core-concepts:global-attributes>Global attributes</a>, except the <code id=custom-elements-core-concepts:attr-is-2><a href=#attr-is>is</a></code> attribute<dd>Any other attribute that has no namespace (see prose).<dt><a href=#concept-element-dom id=custom-elements-core-concepts:concept-element-dom>DOM interface</a>:<dd>Supplied by the element's author (inherits from <code id=custom-elements-core-concepts:htmlelement><a href=#htmlelement>HTMLElement</a></code>)</dl>


  <p>An <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-2>autonomous custom element</a> does not have any special meaning: it
  <a href=#represents id=custom-elements-core-concepts:represents>represents</a> its children. A <a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element>customized built-in element</a> inherits the
  semantics of the element that it extends.</p>

  <p>Any namespace-less attribute that is relevant to the element's functioning, as determined by
  the element's author, may be specified on an <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-3>autonomous custom element</a>, so long as
  the attribute name is <a href=#xml-compatible id=custom-elements-core-concepts:xml-compatible>XML-compatible</a> and contains no <a href=#uppercase-ascii-letters id=custom-elements-core-concepts:uppercase-ascii-letters>uppercase ASCII
  letters</a>. The exception is the <code id=custom-elements-core-concepts:attr-is-3><a href=#attr-is>is</a></code> attribute, which must not
  be specified on an <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-4>autonomous custom element</a> (and which will have no effect if it
  is).</p>

  <p><a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element-2>Customized built-in elements</a> follow the
  normal requirements for attributes, based on the elements they extend. To add custom
  attribute-based behavior, use <code id=custom-elements-core-concepts:attr-data-*><a href=#attr-data-*>data-*</a></code> attributes.</p>

  <hr>

  <p>A <dfn id=valid-custom-element-name data-export="">valid custom element name</dfn> is a sequence of characters
  <var>name</var> that meets all of the following requirements:</p>

  <ul><li>
    <p><var>name</var> must match the <code id=custom-elements-core-concepts:prod-potentialcustomelementname><a href=#prod-potentialcustomelementname>PotentialCustomElementName</a></code> production:</p>

    <dl><dt><code><dfn id=prod-potentialcustomelementname>PotentialCustomElementName</dfn> ::=</code><dd><code>[a-z] (<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar>PCENChar</a>)* '-'
     (<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar-2>PCENChar</a>)*</code><dt><code><dfn id=prod-pcenchar>PCENChar</dfn> ::=</code><dd><code>"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] |
     [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] |
     [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] |
     [#x10000-#xEFFFF]</code></dl>

    <p>This uses the <a href=https://www.w3.org/TR/xml/#sec-notation>EBNF notation</a> from the
    <cite>XML</cite> specification. <a href=#refsXML>[XML]</a></p>
   <li>
    <p><var>name</var> must not be any of the following:</p>

    <ul class=brief><li><code>annotation-xml</code><li><code>color-profile</code><li><code>font-face</code><li><code>font-face-src</code><li><code>font-face-uri</code><li><code>font-face-format</code><li><code>font-face-name</code><li><code>missing-glyph</code></ul>

    <p class=note>The list of names above is the summary of all hyphen-containing element names
    from the <a href=#other-applicable-specifications id=custom-elements-core-concepts:other-applicable-specifications>applicable specifications</a>, namely
    <cite>SVG</cite> and <cite>MathML</cite>. <a href=#refsSVG>[SVG]</a> <a href=#refsMATHML>[MATHML]</a></p>
   </ul>

  <div class=note>
   <p>These requirements ensure a number of goals for <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-2>valid
   custom element names</a>:</p>

   <ul><li><p>They start with a <a href=#lowercase-ascii-letters id=custom-elements-core-concepts:lowercase-ascii-letters>lowercase ASCII letter</a>,
    ensuring that the HTML parser will treat them as tags instead of as text.<li><p>They do not contain any <a href=#uppercase-ascii-letters id=custom-elements-core-concepts:uppercase-ascii-letters-2>uppercase ASCII letters</a>, ensuring that the user
    agent can always treat HTML elements ASCII-case-insensitively.<li><p>They contain a hyphen, used for namespacing and to ensure forward compatibility (since no
    elements will be added to HTML, SVG, or MathML with hyphen-containing local names in the
    future).<li><p>They can always be created with <code id=custom-elements-core-concepts:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://dom.spec.whatwg.org/#dom-document-createelement>createElement()</a></code> and <code id=custom-elements-core-concepts:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://dom.spec.whatwg.org/#dom-document-createelementns>createElementNS()</a></code>, which have restrictions that go
    beyond the parser's.</ul>

   <p>Apart from these restrictions, a large variety of names is allowed, to give maximum
   flexibility for use cases like <code>&lt;math-Î±></code> or <code>&lt;emotion-ðŸ˜></code>.</p>
  </div>

  <p>A <dfn id=custom-element-definition>custom element definition</dfn> describes a <a href=#custom-element id=custom-elements-core-concepts:custom-element-3>custom element</a> and consists
  of:</p>

  <dl><dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-name data-export="">name</dfn><dd>A <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-3>valid custom element name</a><dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-local-name data-export="">local name</dfn><dd>A local name<dt>A <dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-constructor data-export="">constructor</dfn><dd>A <a href=#custom-element-constructor id=custom-elements-core-concepts:custom-element-constructor>custom element constructor</a><dt>A list of <dfn id=concept-custom-element-definition-observed-attributes>observed
   attributes</dfn><dd>A <code>sequence&lt;DOMString></code><dt>A collection of <dfn id=concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</dfn><dd>A map, whose four keys are the strings "<code>connectedCallback</code>",
   "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and
   "<code>attributeChangedCallback</code>". The corresponding values are either a Web IDL
   <code id=custom-elements-core-concepts:idl-function><a data-x-internal=idl-function href=https://heycam.github.io/webidl/#common-Function>Function</a></code> callback function type value, or null. By default the
   value of each entry is null.<dt>A <dfn id=concept-custom-element-definition-construction-stack>construction
   stack</dfn><dd>A list, initially empty, that is manipulated by the <a href=#concept-upgrade-an-element id=custom-elements-core-concepts:concept-upgrade-an-element>upgrade an element</a> algorithm and the <a href=#html-element-constructors>HTML element constructors</a>. Each entry in the list will be
   either an element or an <dfn id=concept-already-constructed-marker><i>already
   constructed</i> marker</dfn>.</dl>

  <p>To <dfn id=look-up-a-custom-element-definition data-export="">look up a custom element definition</dfn>, given a <var>document</var>,
  <var>namespace</var>, <var>localName</var>, and <var>is</var>, perform the following steps. They
  will return either a <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition>custom element definition</a> or null:</p>

  <ol><li><p>If <var>namespace</var> is not the <a id=custom-elements-core-concepts:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML namespace</a>, return null.<li><p>If <var>document</var> does not have a <a href=#concept-document-bc id=custom-elements-core-concepts:concept-document-bc>browsing
   context</a>, return null.<li><p>Let <var>registry</var> be <var>document</var>'s <a href=#concept-document-bc id=custom-elements-core-concepts:concept-document-bc-2>browsing context</a>'s <code id=custom-elements-core-concepts:window><a href=#window>Window</a></code>'s
   <code id=custom-elements-core-concepts:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> object.<li><p>If there is <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-2>custom element definition</a> in <var>registry</var> with <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-3>name</a> and <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name>local name</a> both equal to
   <var>localName</var>, return that <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-3>custom element definition</a>.<li><p>If there is a <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-4>custom element definition</a> in <var>registry</var> with <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-4>name</a> equal to <var>is</var> and <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name-2>local name</a> equal to
   <var>localName</var>, return that <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-5>custom element definition</a>.<li><p>Return null.</ol>

  <h4 id=custom-elements-api>4.13.4 The <code id=custom-elements-api:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> interface<a href=#custom-elements-api class=self-link></a></h4>

  <p>Each <code id=custom-elements-api:window><a href=#window>Window</a></code> object is associated with a unique instance of a
  <code id=custom-elements-api:customelementregistry-2><a href=#customelementregistry>CustomElementRegistry</a></code> object, allocated when the <code id=custom-elements-api:window-2><a href=#window>Window</a></code> object is
  created.</p>

  <p class=note>Custom element registries are associated with <code id=custom-elements-api:window-3><a href=#window>Window</a></code> objects, instead
  of <code id=custom-elements-api:document><a href=#document>Document</a></code> objects, since each <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor>custom element constructor</a> inherits from
  the <code id=custom-elements-api:htmlelement><a href=#htmlelement>HTMLElement</a></code> interface, and there is exactly one <code id=custom-elements-api:htmlelement-2><a href=#htmlelement>HTMLElement</a></code>
  interface per <code id=custom-elements-api:window-4><a href=#window>Window</a></code> object.</p>

  <p>The <dfn id=dom-window-customelements><code>customElements</code></dfn> attribute of the
  <code id=custom-elements-api:window-5><a href=#window>Window</a></code> interface must return the <code id=custom-elements-api:customelementregistry-3><a href=#customelementregistry>CustomElementRegistry</a></code> object for that
  <code id=custom-elements-api:window-6><a href=#window>Window</a></code> object.</p>

  <pre class=idl>interface <dfn id=customelementregistry>CustomElementRegistry</dfn> {
  [<a href=#cereactions id=custom-elements-api:cereactions>CEReactions</a>] void <a href=#dom-customelementregistry-define id=custom-elements-api:dom-customelementregistry-define>define</a>(DOMString name, Function constructor, optional ElementDefinitionOptions options);
  any <a href=#dom-customelementregistry-get id=custom-elements-api:dom-customelementregistry-get>get</a>(DOMString name);
  Promise&lt;void> <a href=#dom-customelementregistry-whendefined id=custom-elements-api:dom-customelementregistry-whendefined>whenDefined</a>(DOMString name);
};

dictionary <dfn id=elementdefinitionoptions>ElementDefinitionOptions</dfn> {
  DOMString extends;
};</pre>

  <p>Every <code id=custom-elements-api:customelementregistry-4><a href=#customelementregistry>CustomElementRegistry</a></code> has a set of <a href=#custom-element-definition id=custom-elements-api:custom-element-definition>custom element definitions</a>, initially empty. In general, algorithms in this
  specification look up elements in the registry by any of <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name>name</a>, <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name>local name</a>, or <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor>constructor</a>.</p>

  <p>Every <code id=custom-elements-api:customelementregistry-5><a href=#customelementregistry>CustomElementRegistry</a></code> also has an <dfn id=element-definition-is-running>element definition is running</dfn>
  flag which is used to prevent reentrant invocations of <a href=#element-definition id=custom-elements-api:element-definition>element definition</a>. It is
  initially unset.</p>

  <p>Every <code id=custom-elements-api:customelementregistry-6><a href=#customelementregistry>CustomElementRegistry</a></code> also has a <dfn id=when-defined-promise-map>when-defined promise map</dfn>,
  mapping <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name>valid custom element names</a> to promises. It
  is used to implement the <code id=custom-elements-api:dom-customelementregistry-whendefined-2><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> method.</p>

  <dl class=domintro><dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-define-2><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>,
   <var>constructor</var>)<dd>Defines a new <a href=#custom-element id=custom-elements-api:custom-element>custom element</a>, mapping the given name to the given constructor as
   an <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element>autonomous custom element</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-2><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-define-3><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>, <var>constructor</var>,
   { extends: <var>baseLocalName</var> })<dd>Defines a new <a href=#custom-element id=custom-elements-api:custom-element-2>custom element</a>, mapping the given name to the given constructor as
   a <a href=#customized-built-in-element id=custom-elements-api:customized-built-in-element>customized built-in element</a> for the <a href=#element-type id=custom-elements-api:element-type>element type</a> identified by the
   supplied <var>baseLocalName</var>. A <a id=custom-elements-api:notsupportederror href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a>
   <code id=custom-elements-api:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> will be thrown upon trying to extend a <a href=#custom-element id=custom-elements-api:custom-element-3>custom element</a> or
   an unknown element.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-3><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-get-2><a href=#dom-customelementregistry-get>get</a></code>(<var>name</var>)<dd>Retrieves the <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor-2>custom element constructor</a> defined for the given <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-2>name</a>. Returns undefined if there is no
   <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-2>custom element definition</a> with the given <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-3>name</a>.<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-4><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-whendefined-3><a href=#dom-customelementregistry-whendefined>whenDefined</a></code>(<var>name</var>)<dd>Returns a promise that will be fulfilled when a <a href=#custom-element id=custom-elements-api:custom-element-4>custom element</a> becomes defined
   with the given name. (If such a <a href=#custom-element id=custom-elements-api:custom-element-5>custom element</a> is already defined, the returned
   promise will be immediately fulfilled.) Returns a promise rejected with a
   <a id=custom-elements-api:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> if not given a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-2>valid
   custom element name</a>.</dl>

  <p><dfn id=element-definition>Element definition</dfn> is a process of adding a <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-3>custom element definition</a>
  to the <code id=custom-elements-api:customelementregistry-7><a href=#customelementregistry>CustomElementRegistry</a></code>. This is accomplished by the <code id=custom-elements-api:dom-customelementregistry-define-4><a href=#dom-customelementregistry-define>define()</a></code> method. When invoked, the <dfn id=dom-customelementregistry-define><code>define(<var>name</var>, <var>constructor</var>,
  <var>options</var>)</code></dfn> method must run these steps:</p>

  <ol><li><p>If <a id=custom-elements-api:isconstructor href=https://tc39.github.io/ecma262/#sec-isconstructor data-x-internal=isconstructor>IsConstructor</a>(<var>constructor</var>) is false, then throw a
   <code id=custom-elements-api:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> and abort these steps.<li><p>If <var>name</var> is not a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-3>valid custom element name</a>, then throw a
   <a id=custom-elements-api:syntaxerror-2 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these steps.<li><p>If this <code id=custom-elements-api:customelementregistry-8><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-4>name</a> <var>name</var>, then throw a
   <a id=custom-elements-api:notsupportederror-2 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these
   steps.<li><p>If this <code id=custom-elements-api:customelementregistry-9><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-2>constructor</a> <var>constructor</var>,
   then throw a <a id=custom-elements-api:notsupportederror-3 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort
   these steps.<li><p>Let <var>localName</var> be <var>name</var>.<li><p>Let <var>extends</var> be the value of the <code>extends</code> member of
   <var>options</var>, or null if no such member exists.<li>
    <p>If <var>extends</var> is not null, then:</p>

    <ol><li><p>If <var>extends</var> is a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-4>valid custom element name</a>, then throw a
     <a id=custom-elements-api:notsupportederror-4 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If the <a id=custom-elements-api:element-interface href=https://dom.spec.whatwg.org/#concept-element-interface data-x-internal=element-interface>element interface</a> for <var>extends</var> and the <a id=custom-elements-api:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML
     namespace</a> is <code id=custom-elements-api:htmlunknownelement><a href=#htmlunknownelement>HTMLUnknownElement</a></code> (e.g., if <var>extends</var> does not
     indicate an element definition in this specification), then throw a
     <a id=custom-elements-api:notsupportederror-5 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Set <var>localName</var> to <var>extends</var>.</ol>
   <li><p>If this <code id=custom-elements-api:customelementregistry-10><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running>element definition is running</a>
   flag is set, then throw a <a id=custom-elements-api:notsupportederror-6 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-8><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>
   and abort these steps.<li><p>Set this <code id=custom-elements-api:customelementregistry-11><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-2>element definition is running</a>
   flag.<li>
    <p>Run the following substeps while catching any exceptions:</p>

    <ol><li><p>Let <var>prototype</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get data-x-internal=js-get>Get</a>(<var>constructor</var>,
     "prototype"). Rethrow any exceptions.<li><p>If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=custom-elements-api:js-type data-x-internal=js-type>Type</a>(<var>prototype</var>) is not Object, then throw a
     <code id=custom-elements-api:typeerror-2><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.<li><p>Let <var>lifecycleCallbacks</var> be a map with the four keys "<code>connectedCallback</code>", "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and "<code>attributeChangedCallback</code>", each
     of which belongs to an entry whose value is null.</p>

     <li>
      <p>For each of the four keys <var>callbackName</var> in <var>lifecycleCallbacks</var>, in the
      order listed in the previous step:</p>

      <ol><li><p>Let <var>callbackValue</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-2 data-x-internal=js-get>Get</a>(<var>prototype</var>,
       <var>callbackName</var>). Rethrow any exceptions.</p>

       <li><p>If <var>callbackValue</var> is not undefined, then set the value of the entry in
       <var>lifecycleCallbacks</var> with key <var>callbackName</var> to the result of <a href=https://heycam.github.io/webidl/#es-type-mapping id=custom-elements-api:concept-idl-convert data-x-internal=concept-idl-convert>converting</a> <var>callbackValue</var> to the Web IDL
       <code id=custom-elements-api:idl-function><a data-x-internal=idl-function href=https://heycam.github.io/webidl/#common-Function>Function</a></code> callback type. Rethrow any exceptions from the
       conversion.</ol>
     <li><p>Let <var>observedAttributes</var> be an empty <code>sequence&lt;DOMString></code>.<li>
      <p>If the value of the entry in <var>lifecycleCallbacks</var> with key "<code>attributeChangedCallback</code>" is not null, then:</p>

      <ol><li><p>Let <var>observedAttributesIterable</var> be <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-3 data-x-internal=js-get>Get</a>(<var>constructor</var>, "observedAttributes"). Rethrow any
       exceptions.<li><p>If <var>observedAttributesIterable</var> is not undefined, then set
       <var>observedAttributes</var> to the result of <a href=https://heycam.github.io/webidl/#es-type-mapping id=custom-elements-api:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a> <var>observedAttributesIterable</var> to a
       <code>sequence&lt;DOMString></code>. Rethrow any exceptions from the
       conversion.</ol>
    </ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception
    or not:</p>

    <ol><li><p>Unset this <code id=custom-elements-api:customelementregistry-12><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-3>element definition is
     running</a> flag.</ol>

    <p>Finally, if the first set of substeps threw an exception, then rethrow that exception, and
    terminate this algorithm. Otherwise, continue onward.</p>
   <li><p>Let <var>definition</var> be a new <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-4>custom element definition</a> with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-5>name</a> <var>name</var>, <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name-2>local name</a> <var>localName</var>,
   <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-3>constructor</a>
   <var>constructor</var>, <a href=#concept-custom-element-definition-observed-attributes id=custom-elements-api:concept-custom-element-definition-observed-attributes>observed attributes</a>
   <var>observedAttributes</var>, and <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-elements-api:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a>
   <var>lifecycleCallbacks</var>.<li><p>Add <var>definition</var> to this <code id=custom-elements-api:customelementregistry-13><a href=#customelementregistry>CustomElementRegistry</a></code>.<li><p>Let <var>document</var> be this <code id=custom-elements-api:customelementregistry-14><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#concept-relevant-global id=custom-elements-api:concept-relevant-global>relevant global object</a>'s <a href=#concept-document-window id=custom-elements-api:concept-document-window>associated <code>Document</code></a>.<li><p>Let <var>upgrade candidates</var> be all elements that are <a href=https://dom.spec.whatwg.org/#concept-shadow-including-descendant id=custom-elements-api:shadow-including-descendant data-x-internal=shadow-including-descendant>shadow-including descendants</a> of <var>document</var>, whose namespace
   is the <a id=custom-elements-api:html-namespace-2-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML namespace</a> and whose local name is <var>localName</var>, in
   <a id=custom-elements-api:shadow-including-tree-order href=https://dom.spec.whatwg.org/#concept-shadow-including-tree-order data-x-internal=shadow-including-tree-order>shadow-including tree order</a>. Additionally, if <var>extends</var> is non-null, only
   include elements whose <a href=https://dom.spec.whatwg.org/#concept-element-is-value id=custom-elements-api:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   value</a> is equal to <var>name</var>.<li><p>For each element <var>element</var> in <var>upgrade candidates</var>, <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-elements-api:enqueue-a-custom-element-upgrade-reaction>enqueue a
   custom element upgrade reaction</a> given <var>element</var> and
   <var>definition</var>.<li>
    <p>If this <code id=custom-elements-api:customelementregistry-15><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map>when-defined promise map</a>
    contains an entry with key <var>name</var>:</p>

    <ol><li><p>Let <var>promise</var> be the value of that entry.<li><p>Resolve <var>promise</var> with undefined.<li><p>Delete the entry with key <var>name</var> from this
     <code id=custom-elements-api:customelementregistry-16><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-2>when-defined promise map</a>.</ol>
   </ol>

  <p>When invoked, the <dfn id=dom-customelementregistry-get><code>get(<var>name</var>)</code></dfn> method must run these
  steps:</p>

  <ol><li><p>If this <code id=custom-elements-api:customelementregistry-17><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-6>name</a> <var>name</var>, then return that
   entry's <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-4>constructor</a>.<li><p>Otherwise, return undefined.</ol>

  <p>When invoked, the <dfn id=dom-customelementregistry-whendefined><code>whenDefined(<var>name</var>)</code></dfn> method
  must run these steps:</p>

  <ol><li><p>If <var>name</var> is not a <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-5>valid custom element name</a>, then return a new
   promise rejected with a <a id=custom-elements-api:syntaxerror-3 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-9><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and
   abort these steps.<li><p>If this <code id=custom-elements-api:customelementregistry-18><a href=#customelementregistry>CustomElementRegistry</a></code> contains an entry with <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-7>name</a> <var>name</var>, then return a new
   promise resolved with undefined and abort these steps.<li><p>Let <var>map</var> be this <code id=custom-elements-api:customelementregistry-19><a href=#customelementregistry>CustomElementRegistry</a></code>'s <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-3>when-defined
   promise map</a>.<li><p>If <var>map</var> does not contain an entry with key <var>name</var>, create an entry in
   <var>map</var> with key <var>name</var> and whose value is a new promise.<li><p>Let <var>promise</var> be the value of the entry in <var>map</var> with key
   <var>name</var>.<li><p>Return <var>promise</var>.</ol>

  <div class=example>
   <p>The <code id=custom-elements-api:dom-customelementregistry-whendefined-4><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> method can be
   used to avoid performing an action until all appropriate <a href=#custom-element id=custom-elements-api:custom-element-6>custom
   elements</a> are <a href=https://dom.spec.whatwg.org/#concept-element-defined id=custom-elements-api:concept-element-defined data-x-internal=concept-element-defined>defined</a>. In this example, we
   combine it with the <code id=custom-elements-api:selector-defined><a href=#selector-defined>:defined</a></code> pseudo-class to hide a
   dynamically-loaded article's contents until we're sure that all of the <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element-2>autonomous custom elements</a> it uses are defined.</p>

   <pre>articleContainer.hidden = true;

fetch(articleURL)
  .then(response => response.text())
  .then(text => {
    articleContainer.innerHTML = text;

    return Promise.all(
      [...articleContainer.querySelectorAll(":not(:defined)")]
        .map(el => customElements.whenDefined(el.localName))
    );
  })
  .then(() => {
    articleContainer.hidden = false;
  });</pre>
  </div>

  <h4 id=upgrades>4.13.5 <dfn>Upgrades</dfn><a href=#upgrades class=self-link></a></h4>

  <p>To <dfn id=concept-upgrade-an-element data-export="">upgrade an element</dfn>, given as
  input a <a href=#custom-element-definition id=upgrades:custom-element-definition>custom element definition</a> <var>definition</var> and an element
  <var>element</var>, run the following steps:</p>

  <ol><li>
    <p>If <var>element</var> is <a href=https://dom.spec.whatwg.org/#concept-element-custom id=upgrades:concept-element-custom data-x-internal=concept-element-custom>custom</a>, abort these
    steps.</p>

    <div class=example>
     <p>This can occur due to reentrant invocation of this algorithm, as in the following
     example:</p>

     <pre>&lt;!DOCTYPE html>
&lt;x-foo id="a">&lt;/x-foo>
&lt;x-foo id="b">&lt;/x-foo>

&lt;script>
// Defining enqueues upgrade reactions for both "a" and "b"
customElements.define("x-foo", class extends HTMLElement {
  constructor() {
    super();

    const b = document.querySelector("#b");
    b.remove();

    // While this constructor is running for "a", "b" is still
    // undefined, and so inserting it into the document will enqueue a
    // second upgrade reaction for "b" in addition to the one enqueued
    // by defining x-foo.
    document.body.appendChild(b);
  }
})
&lt;/script></pre>

     <p>This step will thus bail out the algorithm early when <a href=#concept-upgrade-an-element id=upgrades:concept-upgrade-an-element>upgrade an element</a> is invoked
     with "<code>b</code>" a second time.</p>
    </div>
   <li><p>If <var>element</var>'s <a id=upgrades:custom-element-state href=https://dom.spec.whatwg.org/#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> is "<code>failed</code>", then abort these steps.<li><p>For each <var>attribute</var> in <var>element</var>'s <a id=upgrades:attribute-list href=https://dom.spec.whatwg.org/#concept-element-attribute data-x-internal=attribute-list>attribute list</a>, in
   order, <a href=#enqueue-a-custom-element-callback-reaction id=upgrades:enqueue-a-custom-element-callback-reaction>enqueue a custom element callback reaction</a> with <var>element</var>, callback
   name "<code>attributeChangedCallback</code>", and an argument list containing
   <var>attribute</var>'s local name, null, <var>attribute</var>'s value, and <var>attribute</var>'s
   namespace.<li><p>If <var>element</var> is <a id=upgrades:connected href=https://dom.spec.whatwg.org/#connected data-x-internal=connected>connected</a>, then <a href=#enqueue-a-custom-element-callback-reaction id=upgrades:enqueue-a-custom-element-callback-reaction-2>enqueue a custom element
   callback reaction</a> with <var>element</var>, callback name "<code>connectedCallback</code>", and an empty argument list.<li><p>Add <var>element</var> to the end of <var>definition</var>'s <a href=#concept-custom-element-definition-construction-stack id=upgrades:concept-custom-element-definition-construction-stack>construction stack</a>.<li><p>Let <var>C</var> be <var>definition</var>'s <a href=#concept-custom-element-definition-constructor id=upgrades:concept-custom-element-definition-constructor>constructor</a>.<li>
    <p>Run the following substeps while catching any exceptions:</p>

    <ol><li>
      <p>Let <var>constructResult</var> be <a id=upgrades:construct href=https://tc39.github.io/ecma262/#sec-construct data-x-internal=construct>Construct</a>(<var>C</var>).</p>

      <p class=note>If <var>C</var> <a href=#custom-element-conformance>non-conformantly</a>
      uses an API decorated with the <code id=upgrades:cereactions><a href=#cereactions>[CEReactions]</a></code> extended
      attribute, then the reactions enqueued at the beginning of this algorithm will execute during
      this step, before <var>C</var> finishes and control returns to this algorithm. Otherwise, they
      will execute after <var>C</var> and the rest of the upgrade process finishes.</p>
     <li>
      <p>If <a id=upgrades:samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>constructResult</var>, <var>element</var>) is false,
      then throw an <a id=upgrades:invalidstateerror href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=upgrades:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

      <p class=note>This can occur if <var>C</var> constructs another instance of the same custom
      element before calling <code>super()</code>, or if <var>C</var> uses JavaScript's
      <code>return</code>-override feature to return an arbitrary object from the
      constructor.</p>
     </ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception
    or not:</p>

    <ol><li>
      <p>Remove the last entry from the end of <var>definition</var>'s <a href=#concept-custom-element-definition-construction-stack id=upgrades:concept-custom-element-definition-construction-stack-2>construction stack</a>.</p>

      <div class=note>
       <p>Assuming <var>C</var> calls <code>super()</code> (as it will if it is <a href=#custom-element-conformance>conformant</a>), and that the call succeeds, this will be
       the <a href=#concept-already-constructed-marker id=upgrades:concept-already-constructed-marker><i>already
       constructed</i> marker</a> that replaced the <var>element</var> we pushed at the beginning
       of this algorithm. (The <a href=#html-element-constructors>HTML element constructor</a>
       carries out this replacement.)</p>

       <p>If <var>C</var> does not call <code>super()</code> (i.e. it is not <a href=#custom-element-conformance>conformant</a>), or if any step in the <a href=#html-element-constructors>HTML element constructor</a> throws, then this entry will
       still be <var>element</var>.</p>
      </div>
     </ol>

    <p>Finally, if the above steps threw an exception, then:</p>

    <ol><li><p>Set <var>element</var>'s <a id=upgrades:custom-element-state-2 href=https://dom.spec.whatwg.org/#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> to "<code>failed</code>".<li><p>Empty <var>element</var>'s <a href=#custom-element-reaction-queue id=upgrades:custom-element-reaction-queue>custom element reaction queue</a>.</p>

     <li><p>Rethrow the exception, and terminate this algorithm.</ol>
   <li><p>Set <var>element</var>'s <a id=upgrades:custom-element-state-3 href=https://dom.spec.whatwg.org/#concept-element-custom-element-state data-x-internal=custom-element-state>custom element state</a> to "<code>custom</code>".<li><p>Set <var>element</var>'s <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-definition id=upgrades:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom
   element definition</a> to <var>definition</var>.</ol>

  <p>To <dfn id=concept-try-upgrade data-export="">try to upgrade an element</dfn>, given as
  input an element <var>element</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be the result of <a href=#look-up-a-custom-element-definition id=upgrades:look-up-a-custom-element-definition>looking up a custom element definition</a> given <var>element</var>'s <a id=upgrades:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node
   document</a>, <var>element</var>'s namespace, <var>element</var>'s local name, and
   <var>element</var>'s <a href=https://dom.spec.whatwg.org/#concept-element-is-value id=upgrades:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   value</a>.<li><p>If <var>definition</var> is not null, then <a href=#enqueue-a-custom-element-upgrade-reaction id=upgrades:enqueue-a-custom-element-upgrade-reaction>enqueue a custom element upgrade
   reaction</a> given <var>element</var> and <var>definition</var>.</ol>

  <h4 id=custom-element-reactions>4.13.6 Custom element reactions<a href=#custom-element-reactions class=self-link></a></h4>

  <p>A <a href=#custom-element id=custom-element-reactions:custom-element>custom element</a> possesses the ability to respond to certain occurrences by
  running author code:</p>

  <ul><li><p>When <a href=#upgrades id=custom-element-reactions:upgrades>upgraded</a>, its <a href=#custom-element-constructor id=custom-element-reactions:custom-element-constructor>constructor</a> is run.<li><p>When it <a href=#becomes-connected id=custom-element-reactions:becomes-connected>becomes connected</a>, its <code>connectedCallback</code> is
   run.<li><p>When it <a href=#becomes-disconnected id=custom-element-reactions:becomes-disconnected>becomes disconnected</a>, its <code>disconnectedCallback</code>
   is run.<li><p>When it is <a href=https://dom.spec.whatwg.org/#concept-node-adopt id=custom-element-reactions:concept-node-adopt data-x-internal=concept-node-adopt>adopted</a> into a new document, its <code>adoptedCallback</code> is run.<li><p>When any of its attributes are <a href=https://dom.spec.whatwg.org/#concept-element-attributes-change id=custom-element-reactions:concept-element-attributes-change data-x-internal=concept-element-attributes-change>changed</a>, <a href=https://dom.spec.whatwg.org/#concept-element-attributes-append id=custom-element-reactions:concept-element-attributes-append data-x-internal=concept-element-attributes-append>appended</a>, <a href=https://dom.spec.whatwg.org/#concept-element-attributes-remove id=custom-element-reactions:concept-element-attributes-remove data-x-internal=concept-element-attributes-remove>removed</a>, or <a href=https://dom.spec.whatwg.org/#concept-element-attributes-replace id=custom-element-reactions:concept-element-attributes-replace data-x-internal=concept-element-attributes-replace>replaced</a>, its <code>attributeChangedCallback</code> is run.</ul>

  <p>We call these reactions collectively <dfn id=concept-custom-element-reaction>custom
  element reactions</dfn>.</p>

  <p>The way in which <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction>custom element reactions</a>
  are invoked is done with special care, to avoid running author code during the middle of delicate
  operations. Effectively, they are delayed until "just before returning to user script". This means
  that for most purposes they appear to execute synchronously, but in the case of complicated
  composite operations (like <a href=https://dom.spec.whatwg.org/#concept-node-clone id=custom-element-reactions:concept-node-clone data-x-internal=concept-node-clone>cloning</a>, or <a href=https://dom.spec.whatwg.org/#concept-range id=custom-element-reactions:concept-range data-x-internal=concept-range>range</a> manipulation), they will instead be delayed until after all
  the relevant user agent processing steps have completed, and then run together as a batch.</p>

  <p>Additionally, the precise ordering of these reactions is managed via a somewhat-complicated
  stack-of-queues system, described below. The intention behind this system is to guarantee that
  <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-2>custom element reactions</a> always are invoked
  in the same order as their triggering actions, at least within the local context of a single
  <a href=#custom-element id=custom-element-reactions:custom-element-2>custom element</a>. (Because <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-3>custom
  element reaction</a> code can perform its own mutations, it is not possible to give a global
  ordering guarantee across multiple elements.)</p>

  <hr>

  <p>Each <a href=#unit-of-related-similar-origin-browsing-contexts id=custom-element-reactions:unit-of-related-similar-origin-browsing-contexts>unit of related similar-origin browsing contexts</a> has a <dfn id=custom-element-reactions-stack>custom element
  reactions stack</dfn>, which is initially empty. The <dfn id=current-element-queue>current element queue</dfn> is the
  <a href=#element-queue id=custom-element-reactions:element-queue>element queue</a> at the top of the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack>custom element reactions stack</a>. Each
  item in the stack is an <dfn id=element-queue>element queue</dfn>, which is initially empty as well. Each item in
  an <a href=#element-queue id=custom-element-reactions:element-queue-2>element queue</a> is an element. (The elements are not necessarily <a href=https://dom.spec.whatwg.org/#concept-element-custom id=custom-element-reactions:concept-element-custom data-x-internal=concept-element-custom>custom</a> yet, since this queue is used for <a href=#upgrades id=custom-element-reactions:upgrades-2>upgrades</a> as well.)</p>

  <p>Each <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-2>custom element reactions stack</a> has an associated <dfn id=backup-element-queue>backup element
  queue</dfn>, which an initially-empty <a href=#element-queue id=custom-element-reactions:element-queue-3>element queue</a>. Elements are pushed onto the
  <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue>backup element queue</a> during operations that affect the DOM without going through an
  API decorated with <code id=custom-element-reactions:cereactions><a href=#cereactions>[CEReactions]</a></code>, or through the parser's
  <a href=#create-an-element-for-the-token id=custom-element-reactions:create-an-element-for-the-token>create an element for the token</a> algorithm. An example of this is a user-initiated
  editing operation which modifies the descendants or attributes of an <a id=custom-element-reactions:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a>
  element. To prevent reentrancy when processing the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-2>backup element queue</a>, each
  <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-3>custom element reactions stack</a> also has a <dfn id=processing-the-backup-element-queue>processing the backup element
  queue</dfn> flag, initially unset.</p>

  <p>All elements have an associated <dfn id=custom-element-reaction-queue>custom element reaction queue</dfn>, initially empty. Each
  item in the <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue>custom element reaction queue</a> is of one of two types:</p>

  <ul><li><p>An <dfn id=upgrade-reaction>upgrade reaction</dfn>, which will <a href=#upgrades id=custom-element-reactions:upgrades-3>upgrade</a> the custom element and contains a <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition>custom
   element definition</a>; or<li><p>A <dfn id=callback-reaction>callback reaction</dfn>, which will call a lifecycle callback, and contains a
   callback function as well as a list of arguments.</ul>

  <p>This is all summarized in the following schematic diagram:</p>

  <p><img src=/images/custom-element-reactions.svg alt="A custom element reactions stack consists of a stack of element queues. Zooming in on a particular queue, we see that it contains a number of elements (in our example, <x-a>, then <x-b>, then <x-c>). Any particular element in the queue then has a custom element reaction queue. Zooming in on the custom element reaction queue, we see that it contains a variety of queued-up reactions (in our example, upgrade, then attribute changed, then another attribute changed, then connected)." style="width: 80%; max-width: 580px;"></p>

  <p>To <dfn id=enqueue-an-element-on-the-appropriate-element-queue>enqueue an element on the appropriate element queue</dfn>, given an element
  <var>element</var>, run the following steps:</p>

  <ol><li>
    <p>If the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-4>custom element reactions stack</a> is empty, then:</p>

    <ol><li><p>Add <var>element</var> to the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-3>backup element queue</a>.<li><p>If the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue>processing the backup element queue</a> flag is set, abort this
     algorithm.<li><p>Set the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-2>processing the backup element queue</a> flag.<li>
      <p><a href=#queue-a-microtask id=custom-element-reactions:queue-a-microtask>Queue a microtask</a> to perform the following steps:</p>

      <ol><li><p><a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions>Invoke custom element reactions</a> in the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-4>backup element
       queue</a>.<li><p>Unset the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-3>processing the backup element queue</a> flag.</ol>
     </ol>
   <li><p>Otherwise, add <var>element</var> to the <a href=#current-element-queue id=custom-element-reactions:current-element-queue>current element queue</a>.</ol>

  <p>To <dfn id=enqueue-a-custom-element-callback-reaction data-export="">enqueue a custom element callback reaction</dfn>, given a <a href=#custom-element id=custom-element-reactions:custom-element-3>custom
  element</a> <var>element</var>, a callback name <var>callbackName</var>, and a list of
  arguments <var>args</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be <var>element</var>'s <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-definition id=custom-element-reactions:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom element definition</a>.</p>

   <li><p>Let <var>callback</var> be the value of the entry in <var>definition</var>'s <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-element-reactions:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a> with
   key <var>callbackName</var>.<li><p>If <var>callback</var> is null, then abort these steps.<li>
    <p>If <var>callbackName</var> is "<code>attributeChangedCallback</code>", then:</p>

    <ol><li><p>Let <var>attributeName</var> be the first element of <var>args</var>.<li><p>If <var>definition</var>'s <a href=#concept-custom-element-definition-observed-attributes id=custom-element-reactions:concept-custom-element-definition-observed-attributes>observed attributes</a> does
     not contain <var>attributeName</var>, then abort these steps.</ol>
   <li><p>Add a new <a href=#callback-reaction id=custom-element-reactions:callback-reaction>callback reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-2>custom element
   reaction queue</a>, with callback function <var>callback</var> and arguments
   <var>args</var>.<li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</ol>

  <p>To <dfn id=enqueue-a-custom-element-upgrade-reaction data-export="">enqueue a custom element upgrade reaction</dfn>, given an element
  <var>element</var> and <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-2>custom element definition</a> <var>definition</var>, run the
  following steps:</p>

  <ol><li><p>Add a new <a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction>upgrade reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-3>custom element
   reaction queue</a>, with <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-3>custom element definition</a>
   <var>definition</var>.<li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue-2>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</ol>

  <p>To <dfn id=invoke-custom-element-reactions>invoke custom element reactions</dfn> in an <a href=#element-queue id=custom-element-reactions:element-queue-4>element queue</a>
  <var>queue</var>, run the following steps:</p>

  <ol><li>
    <p>For each <a href=#custom-element id=custom-element-reactions:custom-element-4>custom element</a> <var>element</var> in <var>queue</var>:</p>

    <ol><li><p>Let <var>reactions</var> be <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-4>custom element reaction
     queue</a>.<li>
      <p>Repeat until <var>reactions</var> is empty:</p>

      <ol><li>
        <p>Remove the first element of <var>reactions</var>, and let <var>reaction</var> be that
        element. Switch on <var>reaction</var>'s type:</p>

        <dl class=switch><dt><a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction-2>upgrade reaction</a><dd><a href=#concept-upgrade-an-element id=custom-element-reactions:concept-upgrade-an-element>Upgrade</a> <var>element</var> using
         <var>reaction</var>'s <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-4>custom element definition</a>.<dt><a href=#callback-reaction id=custom-element-reactions:callback-reaction-2>callback reaction</a><dd><a href=https://heycam.github.io/webidl/#es-invoking-callback-functions id=custom-element-reactions:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>Invoke</a> <var>reaction</var>'s
         callback function with <var>reaction</var>'s arguments, and with <var>element</var> as the
         <a href=https://heycam.github.io/webidl/#dfn-callback-this-value id=custom-element-reactions:dfn-callback-this-value data-x-internal=dfn-callback-this-value>callback this value</a>.</dl>

        <p>If this throws any exception, then <a href=#report-the-exception id=custom-element-reactions:report-the-exception>report the exception</a>.</p>
       </ol>
     </ol>
   </ol>

  <hr>

  <p>To ensure <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-4>custom element reactions</a> are
  triggered appropriately, we introduce the <dfn id=cereactions data-dfn-type=extended-attribute data-lt=CEReactions data-export=""><code>[CEReactions]</code></dfn> IDL <a id=custom-element-reactions:extended-attribute href=https://heycam.github.io/webidl/#dfn-extended-attribute data-x-internal=extended-attribute>extended
  attribute</a>. It indicates that the relevant algorithm is to be supplemented with additional
  steps in order to appropriately track and invoke <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-5>custom element reactions</a>.</p>

  <p>The <code id=custom-element-reactions:cereactions-2><a href=#cereactions>[CEReactions]</a></code> extended attribute must take no
  arguments, and must not appear on anything other than an operation, attribute, setter, or deleter.
  Additionally, it must not appear on readonly attributes, unless the readonly attribute is also
  annotated with <code>[PutForwards]</code>.</p>

  <p>Operations, attributes, setters, or deleters annotated with the <code id=custom-element-reactions:cereactions-3><a href=#cereactions>[CEReactions]</a></code> extended attribute must run the following steps
  surrounding the main algorithm specified for the operation, setter, deleter, or for the
  attribute's setter:</p>

  <dl><dt>Before executing the algorithm's steps<dd>Push a new <a href=#element-queue id=custom-element-reactions:element-queue-5>element queue</a> onto the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-5>custom element reactions
   stack</a>.<dt>After executing the algorithm's steps<dd>Pop the <a href=#element-queue id=custom-element-reactions:element-queue-6>element queue</a> from the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-6>custom element reactions stack</a>, and
   <a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions-2>invoke custom element reactions</a> in that queue.</dl>

  <div class=note>
   <p>The intent behind this extended attribute is somewhat subtle. One way of accomplishing its
   goals would be to say that every operation, attribute, setter, and deleter on the platform should
   have these steps inserted, and to allow implementers to optimize away unnecessary cases (where no
   DOM mutation is possible that could cause <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-6>custom
   element reactions</a> to occur).</p>

   <p>However, in practice this imprecision could lead to non-interoperable implementations of <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-7>custom element reactions</a>, as some implementations
   might forget to invoke these steps in some cases. Instead, we settled on the approach of
   explicitly annotating all relevant IDL constructs, as a way of ensuring interoperable behavior
   and helping implementations easily pinpoint all cases where these steps are necessary.</p>
  </div>

  <p>Any nonstandard APIs introduced by the user agent that could modify the DOM in such a way as to
  cause <a href=#enqueue-a-custom-element-callback-reaction id=custom-element-reactions:enqueue-a-custom-element-callback-reaction>enqueuing a custom element
  callback reaction</a> or <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-element-reactions:enqueue-a-custom-element-upgrade-reaction>enqueuing a
  custom element upgrade reaction</a>, for example by modifying any attributes or child elements,
  must also be decorated with the <code id=custom-element-reactions:cereactions-4><a href=#cereactions>[CEReactions]</a></code> attribute.</p>

  <div class=note>
   <p>As of the time of this writing, the following nonstandard or not-yet-standardized APIs are
   known to fall into this category:</p>

   <ul><li><p><code id=custom-element-reactions:htmlelement><a href=#htmlelement>HTMLElement</a></code>'s <code>outerText</code> IDL attribute<li><p><code id=custom-element-reactions:htmlinputelement><a href=#htmlinputelement>HTMLInputElement</a></code>'s <code>webkitdirectory</code> and <code>incremental</code> IDL attributes<li><p><code id=custom-element-reactions:htmllinkelement><a href=#htmllinkelement>HTMLLinkElement</a></code>'s <code>disabled</code> and <code>scope</code> IDL attributes<li><p><code id=custom-element-reactions:shadowroot><a data-x-internal=shadowroot href=https://dom.spec.whatwg.org/#interface-shadowroot>ShadowRoot</a></code>'s <code>innerHTML</code> IDL attribute</ul>
  </div>



  <h3 id=common-idioms>4.14 Common idioms without dedicated elements<a href=#common-idioms class=self-link></a></h3>

  <h4 id=the-main-part-of-the-content>4.14.1 The main part of the content<a href=#the-main-part-of-the-content class=self-link></a></h4>

  <p>The main content of a page â€” not including headers and footers, navigation links,
  sidebars, advertisements, and so forth â€” can be marked up in a variety of ways, depending on
  the needs of the author.</p>

  <p>The simplest solution is to not mark up the main content at all, and just leave it as implicit.
  Another way to think of this is that the <code id=the-main-part-of-the-content:the-body-element><a href=#the-body-element>body</a></code> elements marks up the main content of
  the page, and the bits that aren't main content are excluded through the use of more appropriate
  elements like <code id=the-main-part-of-the-content:the-aside-element><a href=#the-aside-element>aside</a></code> and <code id=the-main-part-of-the-content:the-nav-element><a href=#the-nav-element>nav</a></code>.</p>

  <div class=example>

   <p>Here is a short Web page marked up along this minimalistic school of thought. The main content
   is highlighted. Notice how all the <em>other</em> content in the <code id=the-main-part-of-the-content:the-body-element-2><a href=#the-body-element>body</a></code> is marked up
   with elements to indicate that it's not part of the main content, in this case
   <code id=the-main-part-of-the-content:the-header-element><a href=#the-header-element>header</a></code>, <code id=the-main-part-of-the-content:the-nav-element-2><a href=#the-nav-element>nav</a></code>, and <code id=the-main-part-of-the-content:the-footer-element><a href=#the-footer-element>footer</a></code>.</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;title> My Toys &lt;/title>
 &lt;/head>
 &lt;body>
  &lt;header>
   &lt;h1>My toys&lt;/h1>
  &lt;/header>
  &lt;nav>
   &lt;p>&lt;a href="/">Home&lt;/a>&lt;/p>
   &lt;p>&lt;a href="/contact">Contact&lt;/a>&lt;/p>
  &lt;/nav>
<strong>  &lt;p>I really like my chained book and my telephone. I'm not such a
  fan of my big ball.&lt;/p>
  &lt;p>Another toy I like is my mirror.&lt;/p></strong>
  &lt;footer>
   &lt;p>Â© copyright 2010 by the boy&lt;/p>
  &lt;/footer>
 &lt;/body>
&lt;/html></pre>

  </div>

  <p>If the main content is an independent unit of content that one could imagine syndicating
  independently, then the <code id=the-main-part-of-the-content:the-article-element><a href=#the-article-element>article</a></code> element would be appropriate to mark up the main
  content of the document.</p>

  <div class=example>

   <p>The document in the previous example is here recast as a blog post:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;title> The Boy Blog: My Toys &lt;/title>

  [<a href=#cereactions id=media-elements:cereactions-6>CEReactions</a>] attribute boolean <a href=#dom-media-controls id=media-elements:dom-media-controls>controls</a>;
  attribute double <a href=#dom-media-volume id=media-elements:dom-media-volume>volume</a>;
  attribute boolean <a href=#dom-media-muted id=media-elements:dom-media-muted>muted</a>;
  [<a href=#cereactions id=media-elements:cereactions-7>CEReactions</a>] attribute boolean <a href=#dom-media-defaultmuted id=media-elements:dom-media-defaultmuted>defaultMuted</a>;

  // tracks
  [SameObject] readonly attribute <a href=#audiotracklist id=media-elements:audiotracklist>AudioTrackList</a> <a href=#dom-media-audiotracks id=media-elements:dom-media-audiotracks>audioTracks</a>;
  [SameObject] readonly attribute <a href=#videotracklist id=media-elements:videotracklist>VideoTrackList</a> <a href=#dom-media-videotracks id=media-elements:dom-media-videotracks>videoTracks</a>;
  [SameObject] readonly attribute <a href=#texttracklist id=media-elements:texttracklist>TextTrackList</a> <a href=#dom-media-texttracks id=media-elements:dom-media-texttracks>textTracks</a>;
  <a href=#texttrack id=media-elements:texttrack>TextTrack</a> <a href=#dom-media-addtexttrack id=media-elements:dom-media-addtexttrack>addTextTrack</a>(<a href=#texttrackkind id=media-elements:texttrackkind>TextTrackKind</a> kind, optional DOMString label = "", optional DOMString language = "");
};</pre>

  <p>The <dfn id=media-element-attributes>media element attributes</dfn>, <code id=media-elements:attr-media-src><a href=#attr-media-src>src</a></code>, <code id=media-elements:attr-media-crossorigin><a href=#attr-media-crossorigin>crossorigin</a></code>, <code id=media-elements:attr-media-preload><a href=#attr-media-preload>preload</a></code>, <code id=media-elements:attr-media-autoplay><a href=#attr-media-autoplay>autoplay</a></code>,
  <code id=media-elements:attr-media-loop><a href=#attr-media-loop>loop</a></code>, <code id=media-elements:attr-media-muted><a href=#attr-media-muted>muted</a></code>, and
  <code id=media-elements:attr-media-controls><a href=#attr-media-controls>controls</a></code>, apply to all <a href=#media-element id=media-elements:media-element>media elements</a>. They are defined in this section.</p>

  

  

  <p><a href=#media-element id=media-elements:media-element-2>Media elements</a> are used to present audio data, or video and
  audio data, to the user. This is referred to as <dfn id=media-data>media data</dfn> in this section, since this
  section applies equally to <a href=#media-element id=media-elements:media-element-3>media elements</a> for audio or for
  video.

  The term <dfn id=media-resource>media resource</dfn> is used to refer to the complete set of media data, e.g. the
  complete video file, or complete audio file.

  </p>

  <p>A <a href=#media-resource id=media-elements:media-resource>media resource</a> can have multiple audio and video tracks. For the purposes of a
  <a href=#media-element id=media-elements:media-element-4>media element</a>, the video data of the <a href=#media-resource id=media-elements:media-resource-2>media resource</a> is only that of the
  currently selected track (if any) as given by the element's <code id=media-elements:dom-media-videotracks-2><a href=#dom-media-videotracks>videoTracks</a></code> attribute when the <a href=#event-loop id=media-elements:event-loop>event loop</a> last
  reached <a href=#step1>step 1</a>, and the audio data of the <a href=#media-resource id=media-elements:media-resource-3>media resource</a> is the result of mixing all
  the currently enabled tracks (if any) given by the element's <code id=media-elements:dom-media-audiotracks-2><a href=#dom-media-audiotracks>audioTracks</a></code> attribute when the <a href=#event-loop id=media-elements:event-loop-2>event loop</a> last
  reached <a href=#step1>step 1</a>.</p>

  <p class=note>Both <code id=media-elements:the-audio-element-2><a href=#the-audio-element>audio</a></code> and <code id=media-elements:the-video-element-2><a href=#the-video-element>video</a></code> elements can be used for both audio
  and video. The main difference between the two is simply that the <code id=media-elements:the-audio-element-3><a href=#the-audio-element>audio</a></code> element has
  no playback area for visual content (such as video or captions), whereas the <code id=media-elements:the-video-element-3><a href=#the-video-element>video</a></code>
  element does.</p>

  

  <p>Except where otherwise explicitly specified, the <a href=#task-source id=media-elements:task-source>task source</a> for all the tasks
  <a href=#queue-a-task id=media-elements:queue-a-task>queued</a> in this section and its subsections is the <dfn id=media-element-event-task-source>media
  element event task source</dfn> of the <a href=#media-element id=media-elements:media-element-5>media element</a> in question.</p>

  



  <h5 id=error-codes>4.8.12.1 Error codes<a href=#error-codes class=self-link></a></h5>

  <dl class=domintro><dt><var>media</var> . <code id=error-codes:dom-media-error><a href=#dom-media-error>error</a></code><dd>

    <p>Returns a <code id=error-codes:mediaerror><a href=#mediaerror>MediaError</a></code> object representing the current error state of the
    element.</p>

    <p>Returns null if there is no error.</p>

   </dl>

  

  <p>All <a href=#media-element id=error-codes:media-element>media elements</a> have an associated error status, which
  records the last error the element encountered since its <a href=#concept-media-load-algorithm id=error-codes:concept-media-load-algorithm>resource selection algorithm</a> was last invoked. The
  <dfn id=dom-media-error><code>error</code></dfn> attribute, on getting, must return the
  <code id=error-codes:mediaerror-2><a href=#mediaerror>MediaError</a></code> object created for this last error, or null if there has not been an
  error.</p>

  

  <pre class=idl>interface <dfn id=mediaerror>MediaError</dfn> {
  const unsigned short <a href=#dom-mediaerror-media_err_aborted id=error-codes:dom-mediaerror-media_err_aborted>MEDIA_ERR_ABORTED</a> = 1;
  const unsigned short <a href=#dom-mediaerror-media_err_network id=error-codes:dom-mediaerror-media_err_network>MEDIA_ERR_NETWORK</a> = 2;
  const unsigned short <a href=#dom-mediaerror-media_err_decode id=error-codes:dom-mediaerror-media_err_decode>MEDIA_ERR_DECODE</a> = 3;
  const unsigned short <a href=#dom-mediaerror-media_err_src_not_supported id=error-codes:dom-mediaerror-media_err_src_not_supported>MEDIA_ERR_SRC_NOT_SUPPORTED</a> = 4;

  readonly attribute unsigned short <a href=#dom-mediaerror-code id=error-codes:dom-mediaerror-code>code</a>;
  readonly attribute DOMString <a href=#dom-mediaerror-message id=error-codes:dom-mediaerror-message>message</a>;
};</pre>

  <dl class=domintro><dt><var>media</var> . <code id=error-codes:dom-media-error-2><a href=#dom-media-error>error</a></code> . <code id=error-codes:dom-mediaerror-code-2><a href=#dom-mediaerror-code>code</a></code><dd>

    <p>Returns the current error's error code, from the list below.</p>

   <dt><var>media</var> . <code id=error-codes:dom-media-error-3><a href=#dom-media-error>error</a></code> . <code id=error-codes:dom-mediaerror-message-2><a href=#dom-mediaerror-message>message</a></code><dd>

    <p>Returns a specific informative diagnostic message about the error condition encountered. The
    message and message format are not generally uniform across different user agents. If no such
    message is available, then the empty string is returned.</p>

   </dl>

  

  <p>Every <code id=error-codes:mediaerror-3><a href=#mediaerror>MediaError</a></code> object has a <dfn id=concept-mediaerror-message>message</dfn>, which is a string, and a <dfn id=concept-mediaerror-code>code</dfn>, which is one of the following:</p>

  

  <dl><dt><dfn id=dom-mediaerror-media_err_aborted><code>MEDIA_ERR_ABORTED</code></dfn> (numeric value 1)<dd>The fetching process for the <a href=#media-resource id=error-codes:media-resource>media resource</a> was aborted by the user agent at the
   user's request.<dt><dfn id=dom-mediaerror-media_err_network><code>MEDIA_ERR_NETWORK</code></dfn> (numeric value 2)<dd>A network error of some description caused the user agent to stop fetching the <a href=#media-resource id=error-codes:media-resource-2>media
   resource</a>, after the resource was established to be usable.<dt><dfn id=dom-mediaerror-media_err_decode><code>MEDIA_ERR_DECODE</code></dfn> (numeric value 3)<dd>An error of some description occurred while decoding the <a href=#media-resource id=error-codes:media-resource-3>media resource</a>, after
   the resource was established to be usable.<dt><dfn id=dom-mediaerror-media_err_src_not_supported><code>MEDIA_ERR_SRC_NOT_SUPPORTED</code></dfn> (numeric value 4)<dd>The <a href=#media-resource id=error-codes:media-resource-4>media resource</a> indicated by the <code id=error-codes:attr-media-src><a href=#attr-media-src>src</a></code>
   attribute or <a href=#assigned-media-provider-object id=error-codes:assigned-media-provider-object>assigned media provider object</a> was not suitable.</dl>

  

  <p>To <dfn id=creating-a-mediaerror data-export="">create a <code>MediaError</code></dfn>,
  given an error code which is one of the above values, return a new <code id=error-codes:mediaerror-4><a href=#mediaerror>MediaError</a></code> object
  whose <a href=#concept-mediaerror-code id=error-codes:concept-mediaerror-code>code</a> is the given error code and whose <a href=#concept-mediaerror-message id=error-codes:concept-mediaerror-message>message</a> is a string containing any details the user
  agent is able to supply about the cause of the error condition, or the empty string if the user
  agent is unable to supply such details. This message string must not contain only the information
  already available via the supplied error code; for example, it must not simply be a translation of
  the code into a string format. If no additional information is available beyond that provided by
  the error code, the <a href=#concept-mediaerror-message id=error-codes:concept-mediaerror-message-2>message</a> must be set to the
  empty string.</p>

  <p>The <dfn id=dom-mediaerror-code><code>code</code></dfn> attribute of a
  <code id=error-codes:mediaerror-5><a href=#mediaerror>MediaError</a></code> object must return this <code id=error-codes:mediaerror-6><a href=#mediaerror>MediaError</a></code> object's <a href=#concept-mediaerror-code id=error-codes:concept-mediaerror-code-2>code</a>.</p>

  <p>The <dfn id=dom-mediaerror-message><code>message</code></dfn> attribute of a
  <code id=error-codes:mediaerror-7><a href=#mediaerror>MediaError</a></code> object must return this <code id=error-codes:mediaerror-8><a href=#mediaerror>MediaError</a></code> object's <a href=#concept-mediaerror-message id=error-codes:concept-mediaerror-message-3>message</a>.</p>

  




  <h5 id=location-of-the-media-resource>4.8.12.2 Location of the media resource<a href=#location-of-the-media-resource class=self-link></a></h5>

  <p>The <dfn id=attr-media-src><code>src</code></dfn> content attribute on <a href=#media-element id=location-of-the-media-resource:media-element>media elements</a> gives the <a id=location-of-the-media-resource:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the media resource (video, audio) to
  show. The attribute, if present, must contain a <a href=#valid-non-empty-url-potentially-surrounded-by-spaces id=location-of-the-media-resource:valid-non-empty-url-potentially-surrounded-by-spaces>valid non-empty URL potentially surrounded
  by spaces</a>.</p>

  <p>If the <code id=location-of-the-media-resource:names:-the-itemprop-attribute><a href=#names:-the-itemprop-attribute>itemprop</a></code> attribute is specified on the <a href=#media-element id=location-of-the-media-resource:media-element-2>media
  element</a>, then the <code id=location-of-the-media-resource:attr-media-src><a href=#attr-media-src>src</a></code> attribute must also be
  specified.</p>

  <p>The <dfn id=attr-media-crossorigin><code>crossorigin</code></dfn> content attribute on
  <a href=#media-element id=location-of-the-media-resource:media-element-3>media elements</a> is a <a href=#cors-settings-attribute id=location-of-the-media-resource:cors-settings-attribute>CORS settings attribute</a>.</p>

  

  <p id=concept-media-load-algorithm-at-creation>If a <a href=#media-element id=location-of-the-media-resource:media-element-4>media element</a> is created with a
  <code id=location-of-the-media-resource:attr-media-src-2><a href=#attr-media-src>src</a></code> attribute, the user agent must <a href=#immediately id=location-of-the-media-resource:immediately>immediately</a> invoke the
  <a href=#media-element id=location-of-the-media-resource:media-element-5>media element</a>'s <a href=#concept-media-load-algorithm id=location-of-the-media-resource:concept-media-load-algorithm>resource selection
  algorithm</a>.</p>

  <p>If a <code id=location-of-the-media-resource:attr-media-src-3><a href=#attr-media-src>src</a></code> attribute of a <a href=#media-element id=location-of-the-media-resource:media-element-6>media element</a> is set
  or changed, the user agent must invoke the <a href=#media-element id=location-of-the-media-resource:media-element-7>media element</a>'s <a href=#media-element-load-algorithm id=location-of-the-media-resource:media-element-load-algorithm>media element load
  algorithm</a>. (<em>Removing</em> the <code id=location-of-the-media-resource:attr-media-src-4><a href=#attr-media-src>src</a></code> attribute does
  not do this, even if there are <code id=location-of-the-media-resource:the-source-element><a href=#the-source-element>source</a></code> elements present.)</p>

  <p>The <dfn id=dom-media-src><code>src</code></dfn> IDL attribute on <a href=#media-element id=location-of-the-media-resource:media-element-8>media elements</a> must <a href=#reflect id=location-of-the-media-resource:reflect>reflect</a> the content attribute of the same
  name.</p>

  <p>The <dfn id=dom-media-crossorigin><code>crossOrigin</code></dfn> IDL attribute must
  <a href=#reflect id=location-of-the-media-resource:reflect-2>reflect</a> the <code id=location-of-the-media-resource:attr-media-crossorigin><a href=#attr-media-crossorigin>crossorigin</a></code> content attribute.</p>

  

  <p>A <dfn id=media-provider-object>media provider object</dfn> is an object that can represent a <a href=#media-resource id=location-of-the-media-resource:media-resource>media
  resource</a>, separate from a <a id=location-of-the-media-resource:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>. <code id=location-of-the-media-resource:mediastream><a data-x-internal=mediastream href=https://w3c.github.io/mediacapture-main/getusermedia.html#idl-def-MediaStream>MediaStream</a></code> objects,
  <code id=location-of-the-media-resource:mediasource><a data-x-internal=mediasource href=https://w3c.github.io/media-source/#idl-def-MediaSource>MediaSource</a></code> objects, and <code id=location-of-the-media-resource:blob><a data-x-internal=blob href=https://w3c.github.io/FileAPI/#blob>Blob</a></code> objects are all <a href=#media-provider-object id=location-of-the-media-resource:media-provider-object>media provider objects</a>.</p>

  

  <p>Each <a href=#media-element id=location-of-the-media-resource:media-element-9>media element</a> can have an <dfn id=assigned-media-provider-object>assigned media provider object</dfn>, which is a
  <a href=#media-provider-object id=location-of-the-media-resource:media-provider-object-2>media provider object</a>. When a <a href=#media-element id=location-of-the-media-resource:media-element-10>media element</a> is created, it has no
  <a href=#assigned-media-provider-object id=location-of-the-media-resource:assigned-media-provider-object>assigned media provider object</a>.</p>

  

  <dl class=domintro><dt><var>media</var> . <code id=location-of-the-media-resource:dom-media-srcobject><a href=#dom-media-srcobject>srcObject</a></code> [ = <var>source</var> ]<dd>

    <p>Allows the <a href=#media-element id=location-of-the-media-resource:media-element-11>media element</a> to be assigned a <a href=#media-provider-object id=location-of-the-media-resource:media-provider-object-3>media provider object</a>.</p>

   <dt><var>media</var> . <code id=location-of-the-media-resource:dom-media-currentsrc><a href=#dom-media-currentsrc>currentSrc</a></code><dd>

    <p>Returns the <a id=location-of-the-media-resource:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the current <a href=#media-resource id=location-of-the-media-resource:media-resource-2>media resource</a>, if any.</p>

    <p>Returns the empty string when there is no <a href=#media-resource id=location-of-the-media-resource:media-resource-3>media resource</a>, or it doesn't have a
    <a id=location-of-the-media-resource:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>.</p>

   </dl>

  

  <p>The <dfn id=dom-media-currentsrc><code>currentSrc</code></dfn> IDL attribute must initially be set to
  the empty string. Its value is changed by the <a href=#concept-media-load-algorithm id=location-of-the-media-resource:concept-media-load-algorithm-2>resource
  selection algorithm</a> defined below.</p>

  <p>The <dfn id=dom-media-srcobject><code>srcObject</code></dfn> IDL attribute, on getting,
  must return the element's <a href=#assigned-media-provider-object id=location-of-the-media-resource:assigned-media-provider-object-2>assigned media provider object</a>, if any, or null otherwise.
  On setting, it must set the element's <a href=#assigned-media-provider-object id=location-of-the-media-resource:assigned-media-provider-object-3>assigned media provider object</a> to the new
  value, and then invoke the element's <a href=#media-element-load-algorithm id=location-of-the-media-resource:media-element-load-algorithm-2>media element load algorithm</a>.</p>

  

  <p class=note>There are three ways to specify a <a href=#media-resource id=location-of-the-media-resource:media-resource-4>media resource</a>: the <code id=location-of-the-media-resource:dom-media-srcobject-2><a href=#dom-media-srcobject>srcObject</a></code> IDL attribute, the <code id=location-of-the-media-resource:attr-media-src-5><a href=#attr-media-src>src</a></code> content attribute, and <code id=location-of-the-media-resource:the-source-element-2><a href=#the-source-element>source</a></code> elements. The IDL
  attribute takes priority, followed by the content attribute, followed by the elements.</p>



  <h5 id=mime-types>4.8.12.3 MIME types<a href=#mime-types class=self-link></a></h5>

  <p>A <a href=#media-resource id=mime-types:media-resource>media resource</a> can be described in terms of its <em>type</em>, specifically a
  <a id=mime-types:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a>, in some cases with a <code>codecs</code> parameter. (Whether the
  <code>codecs</code> parameter is allowed or not depends on the MIME type.) <a href=#refsRFC6381>[RFC6381]</a></p>

  <p>Types are usually somewhat incomplete descriptions; for example "<code>video/mpeg</code>" doesn't say anything except what the container type is, and even a
  type like "<code>video/mp4; codecs="avc1.42E01E, mp4a.40.2"</code>" doesn't
  include information like the actual bitrate (only the maximum bitrate). Thus, given a type, a user
  agent can often only know whether it <em>might</em> be able to play media of that type (with
  varying levels of confidence), or whether it definitely <em>cannot</em> play media of that
  type.</p>

  <p><dfn id=a-type-that-the-user-agent-knows-it-cannot-render>A type that the user agent knows it cannot render</dfn> is one that describes a resource
  that the user agent definitely does not support, for example because it doesn't recognize the
  container type, or it doesn't support the listed codecs.</p>

  <p>The <a id=mime-types:mime-type-2 href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a> "<code id=mime-types:application/octet-stream><a data-x-internal=application/octet-stream href=https://tools.ietf.org/html/rfc2046#section-4.5.1>application/octet-stream</a></code>" with no parameters is never
  <a href=#a-type-that-the-user-agent-knows-it-cannot-render id=mime-types:a-type-that-the-user-agent-knows-it-cannot-render>a type that the user agent knows it cannot render</a>. User agents must treat that type
  as equivalent to the lack of any explicit <a href=#content-type id=mime-types:content-type>Content-Type metadata</a>
  when it is used to label a potential <a href=#media-resource id=mime-types:media-resource-2>media resource</a>.</p>

  <p class=note>Only the <a id=mime-types:mime-type-3 href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a> "<code id=mime-types:application/octet-stream-2><a data-x-internal=application/octet-stream href=https://tools.ietf.org/html/rfc2046#section-4.5.1>application/octet-stream</a></code>" with no
  parameters is special-cased here; if any parameter appears with it, it will be treated just like
  any other <a id=mime-types:mime-type-4 href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a>. This is a deviation from the rule  that unknown <a id=mime-types:mime-type-5 href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a> parameters should be ignored.</p> 

  <dl class=domintro><dt><var>media</var> . <code id=mime-types:dom-navigator-canplaytype><a href=#dom-navigator-canplaytype>canPlayType</a></code>(<var>type</var>)<dd>

    <p>Returns the empty string (a negative response), "maybe", or "probably" based on how confident
    the user agent is that it can play media resources of the given type.</p>

   </dl>

  

  <p>The <dfn id=dom-navigator-canplaytype><code>canPlayType(<var>type</var>)</code></dfn> method must return <dfn id=dom-canplaytyperesult-nil>the
  empty string</dfn> if <var>type</var> is <a href=#a-type-that-the-user-agent-knows-it-cannot-render id=mime-types:a-type-that-the-user-agent-knows-it-cannot-render-2>a type that the user agent knows it cannot
  render</a> or is the type "<code id=mime-types:application/octet-stream-3><a data-x-internal=application/octet-stream href=https://tools.ietf.org/html/rfc2046#section-4.5.1>application/octet-stream</a></code>"; it must return "<dfn id=dom-canplaytyperesult-probably><code>probably</code></dfn>" if the user agent is confident
  that the type represents a <a href=#media-resource id=mime-types:media-resource-3>media resource</a> that it can render if used in with this
  <code id=mime-types:the-audio-element><a href=#the-audio-element>audio</a></code> or <code id=mime-types:the-video-element><a href=#the-video-element>video</a></code> element; and it must return "<dfn id=dom-canplaytyperesult-maybe><code>maybe</code></dfn>" otherwise. Implementors are encouraged
  to return "<code id=mime-types:dom-canplaytyperesult-maybe><a href=#dom-canplaytyperesult-maybe>maybe</a></code>" unless the type can be
  confidently established as being supported or not. Generally, a user agent should never return
  "<code id=mime-types:dom-canplaytyperesult-probably><a href=#dom-canplaytyperesult-probably>probably</a></code>" for a type that allows the <code>codecs</code> parameter if that parameter is not present.</p>

  

  <div class=example>

   <p>This script tests to see if the user agent supports a (fictional) new format to dynamically
   decide whether to use a <code id=mime-types:the-video-element-2><a href=#the-video-element>video</a></code> element or a plugin:</p>

   <pre>&lt;section id="video">
 &lt;p>&lt;a href="playing-cats.nfv">Download video&lt;/a>&lt;/p>
&lt;/section>
&lt;script>
 var videoSection = document.getElementById('video');
 var videoElement = document.createElement('video');
 var support = videoElement.canPlayType('video/x-new-fictional-format;codecs="kittens,bunnies"');
 if (support != "probably" &amp;&amp; "New Fictional Video Plugin" in navigator.plugins) {
   // not confident of browser support
   // but we have a plugin
   // so use plugin instead
   videoElement = document.createElement("embed");
 } else if (support == "") {
   // no support from browser and no plugin
   // do nothing
   videoElement = null;
 }
 if (videoElement) {
   while (videoSection.hasChildNodes())
     videoSection.removeChild(videoSection.firstChild);
   videoElement.setAttribute("src", "playing-cats.nfv");
   videoSection.appendChild(videoElement);
 }
&lt;/script></pre>

  </div>

  <p class=note>The <code id=mime-types:attr-source-type><a href=#attr-source-type>type</a></code> attribute of the
  <code id=mime-types:the-source-element><a href=#the-source-element>source</a></code> element allows the user agent to avoid downloading resources that use formats
  it cannot render.</p>


  <h5 id=network-states>4.8.12.4 Network states<a href=#network-states class=self-link></a></h5>

  <dl class=domintro><dt><var>media</var> . <code id=network-states:dom-media-networkstate><a href=#dom-media-networkstate>networkState</a></code><dd>

    <p>Returns the current state of network activity for the element, from the codes in the list
    below.</p>

   </dl>

  

  <p>As <a href=#media-element id=network-states:media-element>media elements</a> interact with the network, their current
  network activity is represented by the <dfn id=dom-media-networkstate><code>networkState</code></dfn> attribute. On getting, it must
  return the current network state of the element, which must be one of the following values:</p>

  

  <dl><dt><dfn id=dom-media-network_empty><code>NETWORK_EMPTY</code></dfn> (numeric value 0)<dd>The element has not yet been initialized. All attributes are in their initial states.<dt><dfn id=dom-media-network_idle><code>NETWORK_IDLE</code></dfn> (numeric value 1)<dd>The element's <a href=#concept-media-load-algorithm id=network-states:concept-media-load-algorithm>resource
   selection algorithm</a> is active and has selected a <a href=#media-resource id=network-states:media-resource>resource</a>, but it is not actually using the network at this time.<dt><dfn id=dom-media-network_loading><code>NETWORK_LOADING</code></dfn> (numeric value 2)<dd>The user agent is actively trying to download data.<dt><dfn id=dom-media-network_no_source><code>NETWORK_NO_SOURCE</code></dfn> (numeric value 3)<dd>The element's <a href=#concept-media-load-algorithm id=network-states:concept-media-load-algorithm-2>resource
   selection algorithm</a> is active, but it has not yet found a <a href=#media-resource id=network-states:media-resource-2>resource</a> to use.</dl>

  

  <p>The <a href=#concept-media-load-algorithm id=network-states:concept-media-load-algorithm-3>resource selection algorithm</a> defined
  below describes exactly when the <code id=network-states:dom-media-networkstate-2><a href=#dom-media-networkstate>networkState</a></code>
  attribute changes value and what events fire to indicate changes in this state.</p>

  




  <h5 id=loading-the-media-resource>4.8.12.5 Loading the media resource<a href=#loading-the-media-resource class=self-link></a></h5><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=27989" title="Should audio and video tracks be exposed cross-origin?">27989</a>, <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=22471" title="&quot;buffered&quot; attribute returns a new object each time">22471</a></div>

  <dl class=domintro><dt><var>media</var> . <code id=loading-the-media-resource:dom-media-load><a href=#dom-media-load>load</a></code>()<dd>

    <p>Causes the element to reset and start selecting and loading a new <a href=#media-resource id=loading-the-media-resource:media-resource>media resource</a>
    from scratch.</p>

   </dl>

  

  <p>All <a href=#media-element id=loading-the-media-resource:media-element>media elements</a> have an <dfn id=autoplaying-flag>autoplaying flag</dfn>,
  which must begin in the true state, and a <dfn id=delaying-the-load-event-flag>delaying-the-load-event flag</dfn>, which must
  begin in the false state. While the <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag>delaying-the-load-event flag</a> is true, the element
  must <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event>delay the load event</a> of its document.</p>

  <p>When the <dfn id=dom-media-load><code>load()</code></dfn> method on a <a href=#media-element id=loading-the-media-resource:media-element-2>media
  element</a> is invoked, the user agent must run the <a href=#media-element-load-algorithm id=loading-the-media-resource:media-element-load-algorithm>media element load
  algorithm</a>.</p>

  <p>The <dfn id=media-element-load-algorithm>media element load algorithm</dfn> consists of the following steps.</p>

  <ol><li><p>Abort any already-running instance of the <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm>resource selection algorithm</a> for this
   element.<li><p>Let <var>pending tasks</var> be a list of all <a href=#concept-task id=loading-the-media-resource:concept-task>tasks</a>
   from the <a href=#media-element id=loading-the-media-resource:media-element-3>media element</a>'s <a href=#media-element-event-task-source id=loading-the-media-resource:media-element-event-task-source>media element event task source</a> in one of the
   <a href=#task-queue id=loading-the-media-resource:task-queue>task queues</a>.<li><p>For each task in <var>pending tasks</var> that would <a href=#resolve-pending-play-promises id=loading-the-media-resource:resolve-pending-play-promises>resolve pending play
   promises</a> or <a href=#reject-pending-play-promises id=loading-the-media-resource:reject-pending-play-promises>reject pending play promises</a>, immediately resolve or reject those
   promises in the order the corresponding tasks were queued.<li>

    <p>Remove each <a href=#concept-task id=loading-the-media-resource:concept-task-2>task</a> in <var>pending tasks</var> from its
    <a href=#task-queue id=loading-the-media-resource:task-queue-2>task queue</a></p>

    <p class=note>Basically, pending events and callbacks are discarded and promises in-flight to
    be resolved/rejected are resolved/rejected immediately when the media element starts loading a
    new resource.</p>

   <li><p>If the <a href=#media-element id=loading-the-media-resource:media-element-4>media element</a>'s <code id=loading-the-media-resource:dom-media-networkstate><a href=#dom-media-networkstate>networkState</a></code> is set to <code id=loading-the-media-resource:dom-media-network_loading><a href=#dom-media-network_loading>NETWORK_LOADING</a></code> or <code id=loading-the-media-resource:dom-media-network_idle><a href=#dom-media-network_idle>NETWORK_IDLE</a></code>, <a href=#queue-a-task id=loading-the-media-resource:queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-abort><a href=#event-media-abort>abort</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-5>media element</a>.<li>

    <p>If the <a href=#media-element id=loading-the-media-resource:media-element-6>media element</a>'s <code id=loading-the-media-resource:dom-media-networkstate-2><a href=#dom-media-networkstate>networkState</a></code>
    is not set to <code id=loading-the-media-resource:dom-media-network_empty><a href=#dom-media-network_empty>NETWORK_EMPTY</a></code>, then run these
    substeps:</p>

    <ol><li><p><a href=#queue-a-task id=loading-the-media-resource:queue-a-task-2>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a>
     named <code id=loading-the-media-resource:event-media-emptied><a href=#event-media-emptied>emptied</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-7>media
     element</a>.<li><p>If a fetching process is in progress for the <a href=#media-element id=loading-the-media-resource:media-element-8>media
     element</a>, the user agent should stop it.<li><p>If the <a href=#media-element id=loading-the-media-resource:media-element-9>media element</a>'s <a href=#assigned-media-provider-object id=loading-the-media-resource:assigned-media-provider-object>assigned media provider object</a> is a
     <code id=loading-the-media-resource:mediasource><a data-x-internal=mediasource href=https://w3c.github.io/media-source/#idl-def-MediaSource>MediaSource</a></code> object, then <a href=https://w3c.github.io/media-source/#mediasource-detach id=loading-the-media-resource:detaching-from-a-media-element data-x-internal=detaching-from-a-media-element>detach</a> it.<li><p><a href="#forget-the-media-element's-media-resource-specific-tracks" id="loading-the-media-resource:forget-the-media-element's-media-resource-specific-tracks">Forget the media element's media-resource-specific tracks</a>.<li><p>If <code id=loading-the-media-resource:dom-media-readystate><a href=#dom-media-readystate>readyState</a></code> is not set to <code id=loading-the-media-resource:dom-media-have_nothing><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>, then set it to that state.<li>

     <p>If the <code id=loading-the-media-resource:dom-media-paused><a href=#dom-media-paused>paused</a></code> attribute is false, then run these
     substeps:</p>

      <ol><li><p>Set the <code id=loading-the-media-resource:dom-media-paused-2><a href=#dom-media-paused>paused</a></code> attribute to true.<li><p><a href=#take-pending-play-promises id=loading-the-media-resource:take-pending-play-promises>Take pending play promises</a> and <a href=#reject-pending-play-promises id=loading-the-media-resource:reject-pending-play-promises-2>reject pending play promises</a>
       with the result and an <a id=loading-the-media-resource:aborterror href=https://heycam.github.io/webidl/#aborterror data-x-internal=aborterror>"<code>AbortError</code>"</a>
       <code id=loading-the-media-resource:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

     <li><p>If <code id=loading-the-media-resource:dom-media-seeking><a href=#dom-media-seeking>seeking</a></code> is true, set it to false.<li>

      <p>Set the <a href=#current-playback-position id=loading-the-media-resource:current-playback-position>current playback position</a> to 0.</p>

      <p>Set the <a href=#official-playback-position id=loading-the-media-resource:official-playback-position>official playback position</a> to 0.</p>

      <p>If this changed the <a href=#official-playback-position id=loading-the-media-resource:official-playback-position-2>official playback position</a>, then <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-3>queue a task</a>
      to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-3 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-timeupdate><a href=#event-media-timeupdate>timeupdate</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-10>media element</a>.</p>

     <li><p>Set the <a href=#timeline-offset id=loading-the-media-resource:timeline-offset>timeline offset</a> to Not-a-Number (NaN).<li>

      <p>Update the <code id=loading-the-media-resource:dom-media-duration><a href=#dom-media-duration>duration</a></code> attribute to Not-a-Number
      (NaN).</p>

      <p class=note>The user agent <a href=#durationChange>will not</a> fire a <code id=loading-the-media-resource:event-media-durationchange><a href=#event-media-durationchange>durationchange</a></code> event for this particular change of
      the duration.</p>

     </ol>

   <li><p>Set the <code id=loading-the-media-resource:dom-media-playbackrate><a href=#dom-media-playbackrate>playbackRate</a></code> attribute to the value of
   the <code id=loading-the-media-resource:dom-media-defaultplaybackrate><a href=#dom-media-defaultplaybackrate>defaultPlaybackRate</a></code> attribute.<li><p>Set the <code id=loading-the-media-resource:dom-media-error><a href=#dom-media-error>error</a></code> attribute to null and the
   <a href=#autoplaying-flag id=loading-the-media-resource:autoplaying-flag>autoplaying flag</a> to true.<li><p>Invoke the <a href=#media-element id=loading-the-media-resource:media-element-11>media element</a>'s <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm-2>resource selection algorithm</a>.<li>

    <p class=note>Playback of any previously playing <a href=#media-resource id=loading-the-media-resource:media-resource-2>media resource</a> for this element
    stops.</p>

   </ol>

  <p>The <dfn id=concept-media-load-algorithm>resource selection algorithm</dfn> for a
  <a href=#media-element id=loading-the-media-resource:media-element-12>media element</a> is as follows. This algorithm is always invoked as part of a <a href=#concept-task id=loading-the-media-resource:concept-task-3>task</a>, but one
  of the first steps in the algorithm is to return and continue running the remaining steps
  <a href=#in-parallel id=loading-the-media-resource:in-parallel>in parallel</a>. In addition, this algorithm interacts
  closely with the <a href=#event-loop id=loading-the-media-resource:event-loop>event loop</a> mechanism; in particular, it has <a href=#synchronous-section id=loading-the-media-resource:synchronous-section>synchronous sections</a> (which are triggered as part of the <a href=#event-loop id=loading-the-media-resource:event-loop-2>event loop</a>
  algorithm). Steps in such sections are marked with ⌛.</p>

  <ol><li><p>Set the element's <code id=loading-the-media-resource:dom-media-networkstate-3><a href=#dom-media-networkstate>networkState</a></code> attribute to
   the <code id=loading-the-media-resource:dom-media-network_no_source><a href=#dom-media-network_no_source>NETWORK_NO_SOURCE</a></code> value.<li><p>Set the element's <a href=#show-poster-flag id=loading-the-media-resource:show-poster-flag>show poster flag</a> to true.<li><p>Set the <a href=#media-element id=loading-the-media-resource:media-element-13>media element</a>'s <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-2>delaying-the-load-event flag</a> to true
   (this <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-2>delays the load event</a>).<li><p><a href=#await-a-stable-state id=loading-the-media-resource:await-a-stable-state>Await a stable state</a>, allowing the <a href=#concept-task id=loading-the-media-resource:concept-task-4>task</a> that invoked this algorithm to continue. The <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-2>synchronous
   section</a> consists of all the remaining steps of this algorithm until the algorithm says the
   <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-3>synchronous section</a> has ended. (Steps in <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-4>synchronous sections</a> are marked with ⌛.)<li>

    <p>⌛ If the <a href=#media-element id=loading-the-media-resource:media-element-14>media element</a>'s <a href=#blocked-on-parser id=loading-the-media-resource:blocked-on-parser>blocked-on-parser</a> flag is false,
    then <a href=#populate-the-list-of-pending-text-tracks id=loading-the-media-resource:populate-the-list-of-pending-text-tracks>populate the list of pending text tracks</a>.</p>

   <li>

    <p>⌛ If the <a href=#media-element id=loading-the-media-resource:media-element-15>media element</a> has an <a href=#assigned-media-provider-object id=loading-the-media-resource:assigned-media-provider-object-2>assigned media provider
    object</a>, then let <var>mode</var> be <i>object</i>.</p>

    <p>⌛ Otherwise, if the <a href=#media-element id=loading-the-media-resource:media-element-16>media element</a> has no <a href=#assigned-media-provider-object id=loading-the-media-resource:assigned-media-provider-object-3>assigned media provider
    object</a> but has a <code id=loading-the-media-resource:attr-media-src><a href=#attr-media-src>src</a></code>
    attribute, then let <var>mode</var> be <i>attribute</i>.</p>

    <p>⌛ Otherwise, if the <a href=#media-element id=loading-the-media-resource:media-element-17>media element</a> does not have an <a href=#assigned-media-provider-object id=loading-the-media-resource:assigned-media-provider-object-4>assigned media provider
    object</a> and does not have a <code id=loading-the-media-resource:attr-media-src-2><a href=#attr-media-src>src</a></code> attribute, but does have a <code id=loading-the-media-resource:the-source-element><a href=#the-source-element>source</a></code> element child, then
    let <var>mode</var> be <i>children</i> and let <var>candidate</var>
    be the first such <code id=loading-the-media-resource:the-source-element-2><a href=#the-source-element>source</a></code> element child in <a id=loading-the-media-resource:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a>.</p>

    <p>⌛ Otherwise the <a href=#media-element id=loading-the-media-resource:media-element-18>media element</a> has no <a href=#assigned-media-provider-object id=loading-the-media-resource:assigned-media-provider-object-5>assigned media provider
    object</a> and has neither a <code id=loading-the-media-resource:attr-media-src-3><a href=#attr-media-src>src</a></code> attribute nor a <code id=loading-the-media-resource:the-source-element-3><a href=#the-source-element>source</a></code> element child: set the
    <code id=loading-the-media-resource:dom-media-networkstate-4><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_empty-2><a href=#dom-media-network_empty>NETWORK_EMPTY</a></code>, and abort these steps; the
    <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-5>synchronous section</a> ends.</p>

   <li><p>⌛ Set the <a href=#media-element id=loading-the-media-resource:media-element-19>media element</a>'s <code id=loading-the-media-resource:dom-media-networkstate-5><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_loading-2><a href=#dom-media-network_loading>NETWORK_LOADING</a></code>.<li><p>⌛ <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-4>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-4 data-x-internal=concept-event-fire>fire an
   event</a> named <code id=loading-the-media-resource:event-media-loadstart><a href=#event-media-loadstart>loadstart</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-20>media
   element</a>.<li>

    <p>Run the appropriate steps from the following list:</p>

    <dl class=switch><dt>If <var>mode</var> is <i>object</i><dd>

      <ol><li><p>⌛ Set the <code id=loading-the-media-resource:dom-media-currentsrc><a href=#dom-media-currentsrc>currentSrc</a></code> attribute to
       the empty string.<li><p>End the <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-6>synchronous section</a>, continuing the remaining steps
       <a href=#in-parallel id=loading-the-media-resource:in-parallel-2>in parallel</a>.<li><p>Run the <a href=#concept-media-load-resource id=loading-the-media-resource:concept-media-load-resource>resource fetch algorithm</a>
       with the <a href=#assigned-media-provider-object id=loading-the-media-resource:assigned-media-provider-object-6>assigned media provider object</a>. If that algorithm returns without
       aborting <em>this</em> one, then the load failed.<li><p><i>Failed with media provider</i>: Reaching this step indicates that the media
       resource failed to load. <a href=#take-pending-play-promises id=loading-the-media-resource:take-pending-play-promises-2>Take pending play promises</a> and <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-5>queue a
       task</a> to run the <a href=#dedicated-media-source-failure-steps id=loading-the-media-resource:dedicated-media-source-failure-steps>dedicated media source failure steps</a> with the
       result.<li><p>Wait for the <a href=#concept-task id=loading-the-media-resource:concept-task-5>task</a> queued by the previous step to have
       executed.<li><p>Abort these steps. The element won't attempt to load another resource until this
       algorithm is triggered again.</ol>

     <dt>If <var>mode</var> is <i>attribute</i><dd>

      <ol><li><p>⌛ If the <code id=loading-the-media-resource:attr-media-src-4><a href=#attr-media-src>src</a></code>
       attribute's value is the empty string, then end the <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-7>synchronous section</a>, and jump
       down to the <i>failed with attribute</i> step below.<li><p>⌛ Let <var>urlString</var> and <var>urlRecord</var> be the <a href=#resulting-url-string id=loading-the-media-resource:resulting-url-string>resulting URL
       string</a> and the <a href=#resulting-url-record id=loading-the-media-resource:resulting-url-record>resulting URL record</a>, respectively, that would have
       resulted from <a href=#parse-a-url id=loading-the-media-resource:parse-a-url>parsing</a> the <a id=loading-the-media-resource:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> specified by the
       <code id=loading-the-media-resource:attr-media-src-5><a href=#attr-media-src>src</a></code> attribute's value relative to the <a href=#media-element id=loading-the-media-resource:media-element-21>media
       element</a>'s <a id=loading-the-media-resource:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> when the <code id=loading-the-media-resource:attr-media-src-6><a href=#attr-media-src>src</a></code>
       attribute was last changed.</p> 

       <li><p>⌛ If <var>urlString</var> was obtained successfully, set the <code id=loading-the-media-resource:dom-media-currentsrc-2><a href=#dom-media-currentsrc>currentSrc</a></code> attribute to <var>urlString</var>.<li><p>End the <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-8>synchronous section</a>, continuing the remaining steps
       <a href=#in-parallel id=loading-the-media-resource:in-parallel-3>in parallel</a>.<li><p>If <var>urlRecord</var> was obtained successfully, run the <a href=#concept-media-load-resource id=loading-the-media-resource:concept-media-load-resource-2>resource fetch algorithm</a> with
       <var>urlRecord</var>. If that algorithm returns without aborting <em>this</em> one, then the
       load failed.<li><p><i>Failed with attribute</i>: Reaching this step indicates that the media resource
       failed to load or that the given <a id=loading-the-media-resource:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> could not be <a href=#parse-a-url id=loading-the-media-resource:parse-a-url-2>parsed</a>. <a href=#take-pending-play-promises id=loading-the-media-resource:take-pending-play-promises-3>Take pending play promises</a> and <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-6>queue a task</a> to
       run the <a href=#dedicated-media-source-failure-steps id=loading-the-media-resource:dedicated-media-source-failure-steps-2>dedicated media source failure steps</a> with the result.<li><p>Wait for the <a href=#concept-task id=loading-the-media-resource:concept-task-6>task</a> queued by the previous step to have
       executed.<li><p>Abort these steps. The element won't attempt to load another resource until this
       algorithm is triggered again.</ol>

     <dt>Otherwise (<var>mode</var> is <i>children</i>)<dd>

      <ol><li>

        <p>⌛ Let <var>pointer</var> be a position defined by two adjacent nodes in the
        <a href=#media-element id=loading-the-media-resource:media-element-22>media element</a>'s child list, treating the start of the list (before the first
        child in the list, if any) and end of the list (after the last child in the list, if any) as
        nodes in their own right. One node is the node before <var>pointer</var>, and the
        other node is the node after <var>pointer</var>. Initially, let <var>pointer</var> be the position between the <var>candidate</var> node and the
        next node, if there are any, or the end of the list, if it is the last node.</p>

        <p>As <a href=#nodes-are-inserted id=loading-the-media-resource:nodes-are-inserted>nodes are inserted</a> and <a href=#nodes-are-removed id=loading-the-media-resource:nodes-are-removed>removed</a> into the <a href=#media-element id=loading-the-media-resource:media-element-23>media element</a>, <var>pointer</var> must be updated as follows:</p>

        <dl><dt>If a new <a href=#nodes-are-inserted id=loading-the-media-resource:nodes-are-inserted-2>node is inserted</a> between the two nodes that define <var>pointer</var><dd>Let <var>pointer</var> be the point between the node before <var>pointer</var> and the new node. In other words, insertions at <var>pointer</var> go after <var>pointer</var>.<dt>If the node before <var>pointer</var> is removed<dd>Let <var>pointer</var> be the point between the node after <var>pointer</var> and the node before the node after <var>pointer</var>. In
         other words, <var>pointer</var> doesn't move relative to the remaining nodes.<dt>If the node after <var>pointer</var> is removed<dd>Let <var>pointer</var> be the point between the node before <var>pointer</var> and the node after the node before <var>pointer</var>. Just
         as with the previous case, <var>pointer</var> doesn't move relative to the remaining
         nodes.</dl>

        <p>Other changes don't affect <var>pointer</var>.</p>

       <li><p>⌛ <i>Process candidate</i>: If <var>candidate</var> does not have a
       <code id=loading-the-media-resource:attr-source-src><a href=#attr-source-src>src</a></code> attribute, or if its <code id=loading-the-media-resource:attr-source-src-2><a href=#attr-source-src>src</a></code> attribute's value is the empty string, then end the
       <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-9>synchronous section</a>, and jump down to the <i>failed with elements</i> step
       below.<li><p>⌛ Let <var>urlString</var> and <var>urlRecord</var> be the <a href=#resulting-url-string id=loading-the-media-resource:resulting-url-string-2>resulting URL
       string</a> and the <a href=#resulting-url-record id=loading-the-media-resource:resulting-url-record-2>resulting URL record</a>, respectively, that would have
       resulted from <a href=#parse-a-url id=loading-the-media-resource:parse-a-url-3>parsing</a> the <a id=loading-the-media-resource:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> specified by
       <var>candidate</var>'s <code id=loading-the-media-resource:attr-source-src-3><a href=#attr-source-src>src</a></code> attribute's value relative
       to the <var>candidate</var>'s <a id=loading-the-media-resource:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> when the <code id=loading-the-media-resource:attr-source-src-4><a href=#attr-source-src>src</a></code> attribute was last changed.</p> 

       <li><p>⌛ If <var>urlString</var> was not obtained successfully, then end the
       <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-10>synchronous section</a>, and jump down to the <i>failed with elements</i> step
       below.<li><p>⌛ If <var>candidate</var> has a <code id=loading-the-media-resource:attr-source-type><a href=#attr-source-type>type</a></code> attribute whose value, when parsed as a <a id=loading-the-media-resource:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME
       type</a> (including any codecs described by the <code>codecs</code> parameter, for
       types that define that parameter), represents <a href=#a-type-that-the-user-agent-knows-it-cannot-render id=loading-the-media-resource:a-type-that-the-user-agent-knows-it-cannot-render>a type that the user agent knows it cannot
       render</a>, then end the <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-11>synchronous section</a>, and jump down to the <i>failed with elements</i> step below.<li><p>⌛ Set the <code id=loading-the-media-resource:dom-media-currentsrc-3><a href=#dom-media-currentsrc>currentSrc</a></code> attribute to
       <var>urlString</var>.<li><p>End the <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-12>synchronous section</a>, continuing the remaining steps
       <a href=#in-parallel id=loading-the-media-resource:in-parallel-4>in parallel</a>.<li><p>Run the <a href=#concept-media-load-resource id=loading-the-media-resource:concept-media-load-resource-3>resource fetch algorithm</a>
       with <var>urlRecord</var>. If that algorithm returns without aborting <em>this</em> one,
       then the load failed.<li><p><i>Failed with elements</i>: <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-7>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-5 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-source-error><a href=#event-source-error>error</a></code> at the <var>candidate</var> element.<li><p><a href=#await-a-stable-state id=loading-the-media-resource:await-a-stable-state-2>Await a stable state</a>. The <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-13>synchronous section</a>
       consists of all the remaining steps of this algorithm until the algorithm says the
       <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-14>synchronous section</a> has ended. (Steps in <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-15>synchronous sections</a> are marked with ⌛.)<li><p>⌛ <a href="#forget-the-media-element's-media-resource-specific-tracks" id="loading-the-media-resource:forget-the-media-element's-media-resource-specific-tracks-2">Forget the media element's media-resource-specific
       tracks</a>.<li><p>⌛ <i>Find next candidate</i>: Let <var>candidate</var> be
       null.<li><p>⌛ <i>Search loop</i>: If the node after <var>pointer</var> is
       the end of the list, then jump to the <i>waiting</i> step below.<li><p>⌛ If the node after <var>pointer</var> is a <code id=loading-the-media-resource:the-source-element-4><a href=#the-source-element>source</a></code> element,
       let <var>candidate</var> be that element.<li><p>⌛ Advance <var>pointer</var> so that the node before <var>pointer</var> is now the node that was after <var>pointer</var>, and the node
       after <var>pointer</var> is the node after the node that used to be after <var>pointer</var>, if any.<li><p>⌛ If <var>candidate</var> is null, jump back to the <i>search
       loop</i> step. Otherwise, jump back to the <i>process candidate</i> step.<li><p>⌛ <i>Waiting</i>: Set the element's <code id=loading-the-media-resource:dom-media-networkstate-6><a href=#dom-media-networkstate>networkState</a></code> attribute to the <code id=loading-the-media-resource:dom-media-network_no_source-2><a href=#dom-media-network_no_source>NETWORK_NO_SOURCE</a></code> value.<li><p>⌛ Set the element's <a href=#show-poster-flag id=loading-the-media-resource:show-poster-flag-2>show poster flag</a> to true.<li><p>⌛ <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-8>Queue a task</a> to set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-3>delaying-the-load-event
       flag</a> to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-3>delaying the load
       event</a>.<li><p>End the <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-16>synchronous section</a>, continuing the remaining steps
       <a href=#in-parallel id=loading-the-media-resource:in-parallel-5>in parallel</a>.<li><p>Wait until the node after <var>pointer</var> is a node other than the end of
       the list. (This step might wait forever.)<li><p><a href=#await-a-stable-state id=loading-the-media-resource:await-a-stable-state-3>Await a stable state</a>. The <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-17>synchronous section</a>
       consists of all the remaining steps of this algorithm until the algorithm says the
       <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-18>synchronous section</a> has ended. (Steps in <a href=#synchronous-section id=loading-the-media-resource:synchronous-section-19>synchronous sections</a> are marked with ⌛.)<li><p>⌛ Set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-4>delaying-the-load-event flag</a> back to true (this
       <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-4>delays the load event</a> again, in case it hasn't been
       fired yet).</p>

       <li><p>⌛ Set the <code id=loading-the-media-resource:dom-media-networkstate-7><a href=#dom-media-networkstate>networkState</a></code> back to <code id=loading-the-media-resource:dom-media-network_loading-3><a href=#dom-media-network_loading>NETWORK_LOADING</a></code>.<li><p>⌛ Jump back to the <i>find next candidate</i> step above.</ol>

     </dl>

    <p>The <dfn id=dedicated-media-source-failure-steps>dedicated media source failure steps</dfn> with a list of promises
    <var>promises</var> are the following steps:</p>

    <ol><li><p>Set the <code id=loading-the-media-resource:dom-media-error-2><a href=#dom-media-error>error</a></code> attribute to the result of
     <a href=#creating-a-mediaerror id=loading-the-media-resource:creating-a-mediaerror>creating a <code>MediaError</code></a> with <code id=loading-the-media-resource:dom-mediaerror-media_err_src_not_supported><a href=#dom-mediaerror-media_err_src_not_supported>MEDIA_ERR_SRC_NOT_SUPPORTED</a></code>.<li><p><a href="#forget-the-media-element's-media-resource-specific-tracks" id="loading-the-media-resource:forget-the-media-element's-media-resource-specific-tracks-3">Forget the media element's media-resource-specific tracks</a>.<li><p>Set the element's <code id=loading-the-media-resource:dom-media-networkstate-8><a href=#dom-media-networkstate>networkState</a></code> attribute to
     the <code id=loading-the-media-resource:dom-media-network_no_source-3><a href=#dom-media-network_no_source>NETWORK_NO_SOURCE</a></code> value.<li><p>Set the element's <a href=#show-poster-flag id=loading-the-media-resource:show-poster-flag-3>show poster flag</a> to true.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-6 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-error><a href=#event-media-error>error</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-24>media element</a>.<li><p><a href=#reject-pending-play-promises id=loading-the-media-resource:reject-pending-play-promises-3>Reject pending play promises</a> with <var>promises</var> and a
     <a id=loading-the-media-resource:notsupportederror href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=loading-the-media-resource:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-5>delaying-the-load-event flag</a> to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-5>delaying the load event</a>.</ol>

   </ol>

  <p>The <dfn id=concept-media-load-resource>resource fetch algorithm</dfn> for a <a href=#media-element id=loading-the-media-resource:media-element-25>media
  element</a> and a given <a id=loading-the-media-resource:url-record href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a> or <a href=#media-provider-object id=loading-the-media-resource:media-provider-object>media provider object</a> is as
  follows:</p>

  <ol><li><p>If the algorithm was invoked with <a href=#media-provider-object id=loading-the-media-resource:media-provider-object-2>media provider object</a> or a <a id=loading-the-media-resource:url-record-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL
   record</a> whose <a href=https://url.spec.whatwg.org/#concept-url-object id=loading-the-media-resource:concept-url-object data-x-internal=concept-url-object>object</a> is a <a href=#media-provider-object id=loading-the-media-resource:media-provider-object-3>media provider
   object</a>, then let <var>mode</var> be <i>local</i>. Otherwise let <var>mode</var> be
   <i>remote</i>.<li><p>If <var>mode</var> is <i>remote</i>, then let the <var>current media resource</var> be the
   resource given by the <a id=loading-the-media-resource:url-record-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a> passed to this algorithm; otherwise, let the
   <var>current media resource</var> be the resource given by the <a href=#media-provider-object id=loading-the-media-resource:media-provider-object-4>media provider
   object</a>. Either way, the <var>current media resource</var> is now the element's <a href=#media-resource id=loading-the-media-resource:media-resource-3>media
   resource</a>.<li><p>Remove all <a href=#media-resource-specific-text-track id=loading-the-media-resource:media-resource-specific-text-track>media-resource-specific text
   tracks</a> from the <a href=#media-element id=loading-the-media-resource:media-element-26>media element</a>'s <a href=#list-of-pending-text-tracks id=loading-the-media-resource:list-of-pending-text-tracks>list of pending text tracks</a>, if
   any.</p>


   <li>

    <p>Run the appropriate steps from the following list:</p>

    <dl class=switch><dt>If <var>mode</var> is remote<dd>

      <ol><li>

        <p>Optionally, run the following substeps. This is the expected behavior if the user agent
        intends to not attempt to fetch the resource until the user requests it explicitly (e.g. as
        a way to implement the <code id=loading-the-media-resource:attr-media-preload><a href=#attr-media-preload>preload</a></code> attribute's <code id=loading-the-media-resource:attr-media-preload-none><a href=#attr-media-preload-none>none</a></code> keyword).</p>

        <ol><li><p>Set the <code id=loading-the-media-resource:dom-media-networkstate-9><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_idle-2><a href=#dom-media-network_idle>NETWORK_IDLE</a></code>.<li><p><a href=#queue-a-task id=loading-the-media-resource:queue-a-task-9>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-7 data-x-internal=concept-event-fire>fire an event</a>
         named <code id=loading-the-media-resource:event-media-suspend><a href=#event-media-suspend>suspend</a></code> at the element.<li><p><a href=#queue-a-task id=loading-the-media-resource:queue-a-task-10>Queue a task</a> to set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-6>delaying-the-load-event flag</a>
         to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-6>delaying the load
         event</a>.<li><p>Wait for the task to be run.<li><p>Wait for an implementation-defined event (e.g. the user requesting that the media
         element begin playback).<li><p>Set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-7>delaying-the-load-event flag</a> back to true (this <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-7>delays the load event</a> again, in case it hasn't been fired
         yet).</p>

         <li><p>Set the <code id=loading-the-media-resource:dom-media-networkstate-10><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_loading-4><a href=#dom-media-network_loading>NETWORK_LOADING</a></code>.</ol>

       <li>

        <p>Let <var>request</var> be the result of <a href=#create-a-potential-cors-request id=loading-the-media-resource:create-a-potential-cors-request>creating a potential-CORS request</a> given
        <var>current media resource</var>'s <a id=loading-the-media-resource:url-record-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a>, "<code>media</code>",
        and the <a href=#media-element id=loading-the-media-resource:media-element-27>media element</a>'s <code id=loading-the-media-resource:attr-media-crossorigin><a href=#attr-media-crossorigin>crossorigin</a></code> content attribute value.

        <p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=loading-the-media-resource:concept-request-client data-x-internal=concept-request-client>client</a> to the
        <a href=#media-element id=loading-the-media-resource:media-element-28>media element</a>'s <a id=loading-the-media-resource:node-document-3 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <code id=loading-the-media-resource:window><a href=#window>Window</a></code> object's
        <a href=#environment-settings-object id=loading-the-media-resource:environment-settings-object>environment settings object</a> and <a href=https://fetch.spec.whatwg.org/#concept-request-type id=loading-the-media-resource:concept-request-type data-x-internal=concept-request-type>type</a>
        to "<code>audio</code>" if the <a href=#media-element id=loading-the-media-resource:media-element-29>media element</a> is an <code id=loading-the-media-resource:the-audio-element><a href=#the-audio-element>audio</a></code>
        element and to "<code>video</code>" otherwise.

        <p><a href=https://fetch.spec.whatwg.org/#concept-fetch id=loading-the-media-resource:concept-fetch data-x-internal=concept-fetch>Fetch</a> <var>request</var>.

        <p>The <var>response</var>'s <a href=#unsafe-response id=loading-the-media-resource:unsafe-response>unsafe response</a> obtained in this fashion, if any,
        contains the <a href=#media-data id=loading-the-media-resource:media-data>media data</a>. It can be <a href=#cors-same-origin id=loading-the-media-resource:cors-same-origin>CORS-same-origin</a> or
        <a href=#cors-cross-origin id=loading-the-media-resource:cors-cross-origin>CORS-cross-origin</a>; this affects whether subtitles referenced in the <a href=#media-data id=loading-the-media-resource:media-data-2>media
        data</a> are exposed in the API and, for <code id=loading-the-media-resource:the-video-element><a href=#the-video-element>video</a></code> elements, whether a
        <code id=loading-the-media-resource:the-canvas-element><a href=#the-canvas-element>canvas</a></code> gets tainted when the video is drawn on it.</p>

        <p>The <dfn id=stall-timeout>stall timeout</dfn> is a user-agent defined length of time, which should be
        about three seconds. When a <a href=#media-element id=loading-the-media-resource:media-element-30>media element</a> that is actively attempting to obtain
        <a href=#media-data id=loading-the-media-resource:media-data-3>media data</a> has failed to receive any data for a duration equal to the
        <a href=#stall-timeout id=loading-the-media-resource:stall-timeout>stall timeout</a>, the user agent must <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-11>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-8 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-stalled><a href=#event-media-stalled>stalled</a></code> at the element.</p>

        <p>User agents may allow users to selectively block or slow <a href=#media-data id=loading-the-media-resource:media-data-4>media data</a> downloads.
        When a <a href=#media-element id=loading-the-media-resource:media-element-31>media element</a>'s download has been blocked altogether, the user agent must
        act as if it was stalled (as opposed to acting as if the connection was closed). The rate of the
        download may also be throttled automatically by the user agent, e.g. to balance the download
        with other connections sharing the same bandwidth.</p>

        <p id=resourceSuspend>User agents may decide to not download more content at any time, e.g.
        after buffering five minutes of a one hour media resource, while waiting for the user to decide
        whether to play the resource or not, while waiting for user input in an interactive resource, or
        when the user navigates away from the page. When a <a href=#media-element id=loading-the-media-resource:media-element-32>media element</a>'s download has
        been suspended, the user agent must <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-12>queue a task</a>, to set the <code id=loading-the-media-resource:dom-media-networkstate-11><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_idle-3><a href=#dom-media-network_idle>NETWORK_IDLE</a></code> and <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-9 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-suspend-2><a href=#event-media-suspend>suspend</a></code> at the element. If and when downloading of the
        resource resumes, the user agent must <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-13>queue a task</a> to set the <code id=loading-the-media-resource:dom-media-networkstate-12><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_loading-5><a href=#dom-media-network_loading>NETWORK_LOADING</a></code>. Between the queuing of these
        tasks, the load is suspended (so <code id=loading-the-media-resource:event-media-progress><a href=#event-media-progress>progress</a></code> events
        don't fire, as described above).</p>

        <p class=note>The <code id=loading-the-media-resource:attr-media-preload-2><a href=#attr-media-preload>preload</a></code> attribute provides a hint
        regarding how much buffering the author thinks is advisable, even in the absence of the <code id=loading-the-media-resource:attr-media-autoplay><a href=#attr-media-autoplay>autoplay</a></code> attribute.</p>

        <p>When a user agent decides to completely suspend a download, e.g., if it is waiting until
        the user starts playback before downloading any further content, the user agent must
        <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-14>queue a task</a> to set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-8>delaying-the-load-event flag</a> to
        false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-8>delaying the load event</a>.</p>

        <p>The user agent may use whatever means necessary to fetch the resource (within the constraints
        put forward by this and other specifications); for example, reconnecting to the server in the
        face of network errors, using HTTP range retrieval requests, or switching to a streaming
        protocol. The user agent must consider a resource erroneous only if it has given up trying to
        fetch it.</p>

        <p>To determine the format of the <a href=#media-resource id=loading-the-media-resource:media-resource-4>media resource</a>, the user agent must use the
        <a href=https://mimesniff.spec.whatwg.org/#rules-for-sniffing-audio-and-video-specifically id=loading-the-media-resource:content-type-sniffing:-video data-x-internal=content-type-sniffing:-video>rules for sniffing audio and video specifically</a>.</p>

        <p>While the load is not suspended (see below), every 350ms (±200ms) or for every byte
        received, whichever is <em>least</em> frequent, <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-15>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-10 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-progress-2><a href=#event-media-progress>progress</a></code> at the element.</p>

        <p>The <a href=#networking-task-source id=loading-the-media-resource:networking-task-source>networking task source</a> <a href=#concept-task id=loading-the-media-resource:concept-task-7>tasks</a> to
        process the data as it is being fetched must each <a href=#immediately id=loading-the-media-resource:immediately>immediately</a> <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-16>queue a task</a> to
        run the first appropriate steps from the <a href=#media-data-processing-steps-list id=loading-the-media-resource:media-data-processing-steps-list>media data processing steps list</a>
        below. (A new task is used for this so that the work described below occurs relative to the
        <a href=#media-element-event-task-source id=loading-the-media-resource:media-element-event-task-source-2>media element event task source</a> rather than the <a href=#networking-task-source id=loading-the-media-resource:networking-task-source-2>networking task
        source</a>.)</p>

        <p>When the <a href=#networking-task-source id=loading-the-media-resource:networking-task-source-3>networking task source</a> has <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-17>queued</a> the last <a href=#concept-task id=loading-the-media-resource:concept-task-8>task</a> as part of fetching the
        <a href=#media-resource id=loading-the-media-resource:media-resource-5>media resource</a> (i.e. once the download has completed), if the fetching process
        completes without errors, including decoding the media data, and if all of the data is available
        to the user agent without network access, then, the user agent must move on to the <i>final step</i> below.
        This might never happen, e.g. when streaming an infinite resource such as Web radio, or if the
        resource is longer than the user agent's ability to cache data.</p>

        <p>While the user agent might still need network access to obtain parts of the <a href=#media-resource id=loading-the-media-resource:media-resource-6>media
        resource</a>, the user agent must remain on this step.</p>

        <p class=example>For example, if the user agent has discarded the first half of a video, the
        user agent will remain at this step even once the <a href=#ended-playback id=loading-the-media-resource:ended-playback>playback has
        ended</a>, because there is always the chance the user will seek back to the start. In fact,
        in this situation, once <a href=#ended-playback id=loading-the-media-resource:ended-playback-2>playback has ended</a>, the user agent
        will end up firing a <code id=loading-the-media-resource:event-media-suspend-3><a href=#event-media-suspend>suspend</a></code> event, as described
        earlier.</p>

       </ol>

     <dt>Otherwise (<var>mode</var> is <i>local</i>)<dd>

      <p>The resource described by the <var>current media resource</var>, if any, contains the
      <a href=#media-data id=loading-the-media-resource:media-data-5>media data</a>. It is <a href=#cors-same-origin id=loading-the-media-resource:cors-same-origin-2>CORS-same-origin</a>. </p>

      <p>If the <var>current media resource</var> is a raw data stream (e.g. from a
      <code id=loading-the-media-resource:file><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code> object), then to determine the format of the <a href=#media-resource id=loading-the-media-resource:media-resource-7>media resource</a>,
      the user agent must use the <a href=https://mimesniff.spec.whatwg.org/#rules-for-sniffing-audio-and-video-specifically id=loading-the-media-resource:content-type-sniffing:-video-2 data-x-internal=content-type-sniffing:-video>rules for sniffing audio and video specifically</a>.
      Otherwise, if the data stream is pre-decoded, then the format is the format given by the
      relevant specification.</p>

      <p>Whenever new data for the <var>current media resource</var> becomes available, <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-18>queue
      a task</a> to run the first appropriate steps from the <a href=#media-data-processing-steps-list id=loading-the-media-resource:media-data-processing-steps-list-2>media data processing steps
      list</a> below.</p>

      <p>When the <var>current media resource</var> is permanently exhausted (e.g. all the bytes of
      a <code id=loading-the-media-resource:blob><a data-x-internal=blob href=https://w3c.github.io/FileAPI/#blob>Blob</a></code> have been processed), if there were no decoding errors, then the user
      agent must move on to the <i>final step</i> below. This might never happen, e.g. if the
      <var>current media resource</var> is a <code id=loading-the-media-resource:mediastream><a data-x-internal=mediastream href=https://w3c.github.io/mediacapture-main/getusermedia.html#idl-def-MediaStream>MediaStream</a></code>.</p>

     </dl>

    <p>The <dfn id=media-data-processing-steps-list>media data processing steps list</dfn> is as follows:</p>

    <dl class=switch><dt>If the <a href=#media-data id=loading-the-media-resource:media-data-6>media data</a> cannot be fetched at all, due to network errors, causing the
     user agent to give up trying to fetch the resource<dt>If the <a href=#media-data id=loading-the-media-resource:media-data-7>media data</a> can be fetched but is found by inspection to be in an
     unsupported format, or can otherwise not be rendered at all<dd>

      <p>DNS errors, HTTP 4xx and 5xx errors (and equivalents in other protocols), and other fatal
      network errors that occur before the user agent has established whether the <var>current media resource</var> is usable, as well as the file using an unsupported
      container format, or using unsupported codecs for all the data, must cause the user agent to
      execute the following steps:</p>

      <ol><li><p>The user agent should cancel the fetching process.<li><p>Abort this subalgorithm, returning to the <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm-3>resource selection algorithm</a>.</p>

      </ol>

     <dt id=found-another-audio-track>If the <a href=#media-resource id=loading-the-media-resource:media-resource-8>media resource</a> is found to have an audio
     track<dd>

      <ol><li><p>Create an <code id=loading-the-media-resource:audiotrack><a href=#audiotrack>AudioTrack</a></code> object to represent the audio track.<li><p>Update the <a href=#media-element id=loading-the-media-resource:media-element-33>media element</a>'s <code id=loading-the-media-resource:dom-media-audiotracks><a href=#dom-media-audiotracks>audioTracks</a></code> attribute's <code id=loading-the-media-resource:audiotracklist><a href=#audiotracklist>AudioTrackList</a></code>
       object with the new <code id=loading-the-media-resource:audiotrack-2><a href=#audiotrack>AudioTrack</a></code> object.<li><p>Let <var>enable</var> be <i>unknown</i>.<li>

        <p>If either the <a href=#media-resource id=loading-the-media-resource:media-resource-9>media resource</a> or the <a id=loading-the-media-resource:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <var>current
        media resource</var> indicate a particular set of audio tracks to enable, or if the user
        agent has information that would facilitate the selection of specific audio tracks to
        improve the user's experience, then: if this audio track is one of the ones to enable, then
        set <var>enable</var> to <i>true</i>, otherwise, set <var>enable</var>
        to <i>false</i>.</p>

        <p class=example>This could be triggered by <a id=loading-the-media-resource:media-fragment-syntax href=https://www.w3.org/TR/media-frags/#media-fragment-syntax data-x-internal=media-fragment-syntax>media fragment syntax</a>, but it
        could also be triggered e.g. by the user agent selecting a 5.1 surround sound audio track
        over a stereo audio track.</p>

       <li><p>If <var>enable</var> is still <i>unknown</i>, then, if the <a href=#media-element id=loading-the-media-resource:media-element-34>media
       element</a> does not yet have an <a href=#dom-audiotrack-enabled id=loading-the-media-resource:dom-audiotrack-enabled>enabled</a>
       audio track, then set <var>enable</var> to <i>true</i>, otherwise, set <var>enable</var> to <i>false</i>.<li><p>If <var>enable</var> is <i>true</i>, then enable this audio track,
       otherwise, do not enable this audio track.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-11 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-addtrack><a href=#event-media-addtrack>addtrack</a></code> at this <code id=loading-the-media-resource:audiotracklist-2><a href=#audiotracklist>AudioTrackList</a></code> object,
       using <code id=loading-the-media-resource:trackevent><a href=#trackevent>TrackEvent</a></code>, with the <code id=loading-the-media-resource:dom-trackevent-track><a href=#dom-trackevent-track>track</a></code>
       attribute initialized to the new <code id=loading-the-media-resource:audiotrack-3><a href=#audiotrack>AudioTrack</a></code> object.</ol>

     <dt id=found-another-video-track>If the <a href=#media-resource id=loading-the-media-resource:media-resource-10>media resource</a> is found to have a video
     track<dd>

      <ol><li><p>Create a <code id=loading-the-media-resource:videotrack><a href=#videotrack>VideoTrack</a></code> object to represent the video track.<li><p>Update the <a href=#media-element id=loading-the-media-resource:media-element-35>media element</a>'s <code id=loading-the-media-resource:dom-media-videotracks><a href=#dom-media-videotracks>videoTracks</a></code> attribute's <code id=loading-the-media-resource:videotracklist><a href=#videotracklist>VideoTrackList</a></code>
       object with the new <code id=loading-the-media-resource:videotrack-2><a href=#videotrack>VideoTrack</a></code> object.<li><p>Let <var>enable</var> be <i>unknown</i>.<li>

        <p>If either the <a href=#media-resource id=loading-the-media-resource:media-resource-11>media resource</a> or the <a id=loading-the-media-resource:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <var>current
        media resource</var> indicate a particular set of video tracks to enable, or if the user
        agent has information that would facilitate the selection of specific video tracks to
        improve the user's experience, then: if this video track is the first such video track, then
        set <var>enable</var> to <i>true</i>, otherwise, set <var>enable</var>
        to <i>false</i>.</p>

        <p class=example>This could again be triggered by <a id=loading-the-media-resource:media-fragment-syntax-2 href=https://www.w3.org/TR/media-frags/#media-fragment-syntax data-x-internal=media-fragment-syntax>media fragment syntax</a>.</p>

       <li><p>If <var>enable</var> is still <i>unknown</i>, then, if the <a href=#media-element id=loading-the-media-resource:media-element-36>media
       element</a> does not yet have a <a href=#dom-videotrack-selected id=loading-the-media-resource:dom-videotrack-selected>selected</a>
       video track, then set <var>enable</var> to <i>true</i>, otherwise, set <var>enable</var> to <i>false</i>.<li><p>If <var>enable</var> is <i>true</i>, then select this track and unselect any
       previously selected video tracks, otherwise, do not select this video track. If other tracks
       are unselected, then <a href=#toggle-video-track>a <code>change</code> event will be fired.</a><li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-12 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-addtrack-2><a href=#event-media-addtrack>addtrack</a></code> at this <code id=loading-the-media-resource:videotracklist-2><a href=#videotracklist>VideoTrackList</a></code> object,
       using <code id=loading-the-media-resource:trackevent-2><a href=#trackevent>TrackEvent</a></code>, with the <code id=loading-the-media-resource:dom-trackevent-track-2><a href=#dom-trackevent-track>track</a></code>
       attribute initialized to the new <code id=loading-the-media-resource:videotrack-3><a href=#videotrack>VideoTrack</a></code> object.</ol>

     <dt id=getting-media-metadata>Once enough of the <a href=#media-data id=loading-the-media-resource:media-data-8>media data</a> has been fetched to
     determine the duration of the <a href=#media-resource id=loading-the-media-resource:media-resource-12>media resource</a>, its dimensions, and other
     metadata<dd>

      <p>This indicates that the resource is usable. The user agent must follow these substeps:</p>

      <ol><li>

        <p><a href=#defineTimeline id=loading-the-media-resource:defineTimeline>Establish the media timeline</a> for the purposes of the <a href=#current-playback-position id=loading-the-media-resource:current-playback-position-2>current playback
        position</a> and the <a href=#earliest-possible-position id=loading-the-media-resource:earliest-possible-position>earliest possible position</a>, based on the <a href=#media-data id=loading-the-media-resource:media-data-9>media data</a>.</p>

       <li>

        <p>Update the <a href=#timeline-offset id=loading-the-media-resource:timeline-offset-2>timeline offset</a> to the date and time that corresponds to the zero
        time in the <a href=#media-timeline id=loading-the-media-resource:media-timeline>media timeline</a> established in the previous step, if any. If no
        explicit time and date is given by the <a href=#media-resource id=loading-the-media-resource:media-resource-13>media resource</a>, the <a href=#timeline-offset id=loading-the-media-resource:timeline-offset-3>timeline
        offset</a> must be set to Not-a-Number (NaN).</p>

       <li><p>Set the <a href=#current-playback-position id=loading-the-media-resource:current-playback-position-3>current playback position</a> and the <a href=#official-playback-position id=loading-the-media-resource:official-playback-position-3>official playback
       position</a> to the <a href=#earliest-possible-position id=loading-the-media-resource:earliest-possible-position-2>earliest possible position</a>.<li>

        <p>Update the <code id=loading-the-media-resource:dom-media-duration-2><a href=#dom-media-duration>duration</a></code> attribute with the time of
        the last frame of the resource, if known, on the <a href=#media-timeline id=loading-the-media-resource:media-timeline-2>media timeline</a> established
        above. If it is not known (e.g. a stream that is in principle infinite), update the <code id=loading-the-media-resource:dom-media-duration-3><a href=#dom-media-duration>duration</a></code> attribute to the value positive Infinity.</p>

        <p class=note>The user agent <a href=#durationChange>will</a> <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-19>queue a task</a>
        to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-13 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-durationchange-2><a href=#event-media-durationchange>durationchange</a></code> at the element at this point.</p>

       <li>

        <p>For <code id=loading-the-media-resource:the-video-element-2><a href=#the-video-element>video</a></code> elements, set the <code id=loading-the-media-resource:dom-video-videowidth><a href=#dom-video-videowidth>videoWidth</a></code> and <code id=loading-the-media-resource:dom-video-videoheight><a href=#dom-video-videoheight>videoHeight</a></code> attributes, and <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-20>queue a task</a>
        to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-14 data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-the-media-resource:event-media-resize><a href=#event-media-resize>resize</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-37>media element</a>.</p>

        <p class=note>Further <code id=loading-the-media-resource:event-media-resize-2><a href=#event-media-resize>resize</a></code> events will be fired
        if the dimensions subsequently change.</p>

       <li>

        <p>Set the <code id=loading-the-media-resource:dom-media-readystate-2><a href=#dom-media-readystate>readyState</a></code> attribute to <code id=loading-the-media-resource:dom-media-have_metadata><a href=#dom-media-have_metadata>HAVE_METADATA</a></code>.</p>

        <p class=note>A <code id=loading-the-media-resource:event-media-loadedmetadata><a href=#event-media-loadedmetadata>loadedmetadata</a></code> DOM event
        <a href=#fire-loadedmetadata>will be fired</a> as part of setting the <code id=loading-the-media-resource:dom-media-readystate-3><a href=#dom-media-readystate>readyState</a></code> attribute to a new value.</p>

       <li><p>Let <var>jumped</var> be false.<li><p>If the <a href=#media-element id=loading-the-media-resource:media-element-38>media element</a>'s <a href=#default-playback-start-position id=loading-the-media-resource:default-playback-start-position>default playback start position</a> is
       greater than zero, then <a href=#dom-media-seek id=loading-the-media-resource:dom-media-seek>seek</a> to that time, and let <var>jumped</var> be true.<li><p>Let the <a href=#media-element id=loading-the-media-resource:media-element-39>media element</a>'s <a href=#default-playback-start-position id=loading-the-media-resource:default-playback-start-position-2>default playback
       start position</a> be zero.<li><p>Let the <var>initial playback position</var> be zero.<li>

        <p>If either the <a href=#media-resource id=loading-the-media-resource:media-resource-14>media resource</a> or the <a id=loading-the-media-resource:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <var>current
        media resource</var> indicate a particular start time, then set the <var>initial playback
        position</var> to that time and, if <var>jumped</var> is still false, <a href=#dom-media-seek id=loading-the-media-resource:dom-media-seek-2>seek</a> to that time.</p>

        <p class=example>For example, with media formats that support <a id=loading-the-media-resource:media-fragment-syntax-3 href=https://www.w3.org/TR/media-frags/#media-fragment-syntax data-x-internal=media-fragment-syntax>media fragment
        syntax</a>, the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=loading-the-media-resource:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> can be used to
        indicate a start position.</p>

       <li><p>If there is no <a href=#dom-audiotrack-enabled id=loading-the-media-resource:dom-audiotrack-enabled-2>enabled</a> audio track, then
       enable an audio track. This <a href=#toggle-audio-track>will cause a <code>change</code> event to be fired</a>.<li><p>If there is no <a href=#dom-videotrack-selected id=loading-the-media-resource:dom-videotrack-selected-2>selected</a> video track,
       then select a video track. This <a href=#toggle-video-track>will cause a <code>change</code> event to be fired</a>.</ol>

      <p>Once the <code id=loading-the-media-resource:dom-media-readystate-4><a href=#dom-media-readystate>readyState</a></code> attribute reaches <code id=loading-the-media-resource:dom-media-have_current_data><a href=#dom-media-have_current_data>HAVE_CURRENT_DATA</a></code>, <a href=#fire-loadeddata>after
      the <code>loadeddata</code> event has been fired</a>, set the
      element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-9>delaying-the-load-event flag</a> to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-9>delaying the load event</a>.</p>

      <p class=note>A user agent that is attempting to reduce network usage while still fetching
      the metadata for each <a href=#media-resource id=loading-the-media-resource:media-resource-15>media resource</a> would also stop buffering at this point,
      following <a href=#resourceSuspend>the rules described previously</a>, which involve the
      <code id=loading-the-media-resource:dom-media-networkstate-13><a href=#dom-media-networkstate>networkState</a></code> attribute switching to the <code id=loading-the-media-resource:dom-media-network_idle-4><a href=#dom-media-network_idle>NETWORK_IDLE</a></code> value and a <code id=loading-the-media-resource:event-media-suspend-4><a href=#event-media-suspend>suspend</a></code> event firing.</p>

      <p class=note>The user agent is <em>required</em> to determine the duration of the
      <a href=#media-resource id=loading-the-media-resource:media-resource-16>media resource</a> and go through this step before playing.</p> 

     <dt>Once the entire <a href=#media-resource id=loading-the-media-resource:media-resource-17>media resource</a> has been fetched (but potentially before any of
     it has been decoded)<dd>

      <p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-15 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-progress-3><a href=#event-media-progress>progress</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-40>media element</a>.</p>

      <p>Set the <code id=loading-the-media-resource:dom-media-networkstate-14><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_idle-5><a href=#dom-media-network_idle>NETWORK_IDLE</a></code> and <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-16 data-x-internal=concept-event-fire>fire an event</a> named
      <code id=loading-the-media-resource:event-media-suspend-5><a href=#event-media-suspend>suspend</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-41>media element</a>.</p>

      <p>If the user agent ever discards any <a href=#media-data id=loading-the-media-resource:media-data-10>media data</a> and then needs to resume the
      network activity to obtain it again, then it must <a href=#queue-a-task id=loading-the-media-resource:queue-a-task-21>queue a task</a> to set the <code id=loading-the-media-resource:dom-media-networkstate-15><a href=#dom-media-networkstate>networkState</a></code> to <code id=loading-the-media-resource:dom-media-network_loading-6><a href=#dom-media-network_loading>NETWORK_LOADING</a></code>.</p>

      <p class=note>If the user agent can keep the <a href=#media-resource id=loading-the-media-resource:media-resource-18>media resource</a> loaded, then the
      algorithm will continue to its <i>final step</i> below, which aborts the algorithm.</p>

     <dt>If the connection is interrupted after some <a href=#media-data id=loading-the-media-resource:media-data-11>media data</a> has been received,
     causing the user agent to give up trying to fetch the resource<dd>

      <p>Fatal network errors that occur after the user agent has established whether the <var>current media resource</var> is usable (i.e. once the <a href=#media-element id=loading-the-media-resource:media-element-42>media element</a>'s
      <code id=loading-the-media-resource:dom-media-readystate-5><a href=#dom-media-readystate>readyState</a></code> attribute is no longer <code id=loading-the-media-resource:dom-media-have_nothing-2><a href=#dom-media-have_nothing>HAVE_NOTHING</a></code>) must cause the user agent to execute the
      following steps:</p>

      <ol><li><p>The user agent should cancel the fetching process.<li><p>Set the <code id=loading-the-media-resource:dom-media-error-3><a href=#dom-media-error>error</a></code> attribute to the result of
       <a href=#creating-a-mediaerror id=loading-the-media-resource:creating-a-mediaerror-2>creating a <code>MediaError</code></a> with <code id=loading-the-media-resource:dom-mediaerror-media_err_network><a href=#dom-mediaerror-media_err_network>MEDIA_ERR_NETWORK</a></code>.<li><p>Set the element's <code id=loading-the-media-resource:dom-media-networkstate-16><a href=#dom-media-networkstate>networkState</a></code> attribute
       to the <code id=loading-the-media-resource:dom-media-network_idle-6><a href=#dom-media-network_idle>NETWORK_IDLE</a></code> value.<li><p>Set the element's <a href=#delaying-the-load-event-flag id=loading-the-media-resource:delaying-the-load-event-flag-10>delaying-the-load-event flag</a> to false. This stops <a href=#delay-the-load-event id=loading-the-media-resource:delay-the-load-event-10>delaying the load event</a>.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-the-media-resource:concept-event-fire-17 data-x-internal=concept-event-fire>Fire an event</a> named <code id=loading-the-media-resource:event-media-error-2><a href=#event-media-error>error</a></code> at the <a href=#media-element id=loading-the-media-resource:media-element-43>media element</a>.<li><p>Abort the overall <a href=#concept-media-load-algorithm id=loading-the-media-resource:concept-media-load-algorithm-4>resource selection

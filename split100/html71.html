        steps</a>.</p>

        <p class=note>Redirects are fatal because they are either indicative of a network problem
        (e.g. a captive portal); or would allow resources to be added to the cache under URLs that
        differ from any URL that the networking model will allow access to, leaving orphan entries;
        or would allow resources to be stored under URLs different than their true URLs. All of
        these situations are bad.</p>

       <dt>If the error was a 404 or 410 HTTP response<dt>If the resource was labeled with the "no-store" cache directive<dd>

        <p>Skip this resource. It is dropped from the cache.</p>

       <dt>Otherwise<dd>

        <p>Copy the resource and its metadata from the <a href=#concept-appcache-newer id=downloading-or-updating-an-application-cache:concept-appcache-newer-5>newest</a> <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-16>application cache</a> in <var>cache group</var> whose <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-4>completeness
        flag</a> is <i>complete</i>, and act as if that was the fetched resource, ignoring the
        resource obtained from the network.</p>

       </dl>

      <p>User agents may warn the user of these errors as an aid to development.</p>

      <p class=note>These rules make errors for resources listed in the manifest fatal, while
      making it possible for other resources to be removed from caches when they are removed from
      the server, without errors, and making non-manifest resources survive server-side errors.</p>

      <p class=note>Except for the "no-store" directive, HTTP caching rules that would cause a
      file to be expired or otherwise not cached are ignored for the purposes of the
      <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-9>application cache download process</a>.</p>

     <li>

      <p>Otherwise, the fetching succeeded. Store the resource in the <var>new
      cache</var>.</p>

      <p>If the user agent is not able to store the resource (e.g. because of quota restrictions),
      the user agent may prompt the user or try to resolve the problem in some other manner (e.g.
      automatically pruning content in other caches). If the problem cannot be resolved, the user
      agent must run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps-4>cache failure steps</a>.</p>

     <li><p>If the URL being processed was flagged as an "explicit entry" in <var>file
     list</var>, then categorize the entry as an <a href=#concept-appcache-explicit id=downloading-or-updating-an-application-cache:concept-appcache-explicit-3>explicit
     entry</a>.<li><p>If the URL being processed was flagged as a "fallback entry" in <var>file
     list</var>, then categorize the entry as a <a href=#concept-appcache-fallback id=downloading-or-updating-an-application-cache:concept-appcache-fallback-3>fallback
     entry</a>.<li><p>If the URL being processed was flagged as an "master entry" in <var>file
     list</var>, then categorize the entry as a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-5>master
     entry</a>.<li><p>As an optimization, if the resource is an HTML or XML file whose <a id=downloading-or-updating-an-application-cache:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document
     element</a> is an <code id=downloading-or-updating-an-application-cache:the-html-element><a href=#the-html-element>html</a></code> element with a <code id=downloading-or-updating-an-application-cache:attr-html-manifest><a href=#attr-html-manifest>manifest</a></code> attribute whose value doesn't match the manifest
     URL of the application cache being processed, then the user agent should mark the entry as
     being <a href=#concept-appcache-foreign id=downloading-or-updating-an-application-cache:concept-appcache-foreign>foreign</a>.</p>

    </ol>

   <li>
    <p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-18>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-17>application cache</a> in
    <var>cache group</var>, <a href=#queue-a-progress-post-load-task id=downloading-or-updating-an-application-cache:queue-a-progress-post-load-task-2>queue a progress post-load task</a> to run these steps:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-11 data-x-internal=concept-event-fire>firing an
     event </a> named <code id=downloading-or-updating-an-application-cache:event-appcache-progress-2><a href=#event-appcache-progress>progress</a></code> at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-12><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-19>cache host</a>, using
     <code id=downloading-or-updating-an-application-cache:progressevent-2><a data-x-internal=progressevent href=https://xhr.spec.whatwg.org/#interface-progressevent>ProgressEvent</a></code>, with the <code id=downloading-or-updating-an-application-cache:dom-event-cancelable-11><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code>
     attribute initialized to true, the <code id=downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable-2><a data-x-internal=dom-progressevent-lengthcomputable href=https://xhr.spec.whatwg.org/#dom-progressevent-lengthcomputable>lengthComputable</a></code> attribute initialized to
     true, and the <code id=downloading-or-updating-an-application-cache:dom-progressevent-total-2><a data-x-internal=dom-progressevent-total href=https://xhr.spec.whatwg.org/#dom-progressevent-total>total</a></code> and <code id=downloading-or-updating-an-application-cache:dom-progressevent-loaded-2><a data-x-internal=dom-progressevent-loaded href=https://xhr.spec.whatwg.org/#dom-progressevent-loaded>loaded</a></code> attributes initialized to the number of files
     in <var>file list</var>. <a href=#refsXHR>[XHR]</a><li><p>If <var>showProgress</var> is true and the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-11>shows caching
     progress</a>, then display some sort of user interface indicating to the user that all the
     files have been downloaded. </ol>
   <li><p>Store the list of <a href=#concept-appcache-fallback-ns id=downloading-or-updating-an-application-cache:concept-appcache-fallback-ns-2>fallback namespaces</a>,
   and the URLs of the <a href=#concept-appcache-fallback id=downloading-or-updating-an-application-cache:concept-appcache-fallback-4>fallback entries</a> that they map
   to, in <var>new cache</var>.<li><p>Store the URLs that form the new <a href=#concept-appcache-onlinesafelist id=downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-2>online
   safelist</a> in <var>new cache</var>.<li><p>Store the value of the new <a href=#concept-appcache-onlinesafelist-wildcard id=downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-wildcard-2>online
   safelist wildcard flag</a> in <var>new cache</var>.<li><p>Store the value of the new <a href=#concept-appcache-mode id=downloading-or-updating-an-application-cache:concept-appcache-mode-2>cache mode flag</a> in
   <var>new cache</var>.<li>

    <p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-6>list of pending master entries</a>, wait for the
    resource for this entry to have either completely downloaded or failed.</p>

    <p>If the download failed (e.g. the server returns a 4xx or 5xx response, or there is a DNS
    error, the connection times out, or the user cancels the download), or if the resource is
    labeled with the "no-store" cache directive, then run these substeps:</p>

    <ol><li><p>Unassociate the <code id=downloading-or-updating-an-application-cache:document-7><a href=#document>Document</a></code> for this entry from <var>new
     cache</var>.<li>
      <p><a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-8>Queue a post-load task</a> to run these steps:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-12 data-x-internal=concept-event-fire>firing
       an event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-error-3><a href=#event-appcache-error>error</a></code> at the
       <code id=downloading-or-updating-an-application-cache:applicationcache-13><a href=#applicationcache>ApplicationCache</a></code> singleton of the <code id=downloading-or-updating-an-application-cache:document-8><a href=#document>Document</a></code> for this entry, if there
       still is one, with the <code id=downloading-or-updating-an-application-cache:dom-event-cancelable-12><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute
       initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-12>shows caching
       progress</a>, then display some sort of user interface indicating to the user that the
       user agent failed to save the application for offline use.</ol>
     <li>

      <p>If this is a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache-2>cache attempt</a> and this entry is
      the last entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-7>list of pending master entries</a>, then run these
      further substeps:</p>

      <ol><li><p>Discard <var>cache group</var> and its only <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-18>application cache</a>,
       <var>new cache</var>.</p>

       <li><p>If appropriate, remove any user interface indicating that an update for this cache is
       in progress.<li><p>Abort the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-10>application cache download process</a>.</ol>

     <li><p>Otherwise, remove this entry from <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-8>list of pending master entries</a>.</ol>

    <p>Otherwise, store the resource for this entry in <var>new cache</var>, if it isn't
    already there, and categorize its entry as a <a href=#concept-appcache-master id=downloading-or-updating-an-application-cache:concept-appcache-master-6>master
    entry</a>.</p>

   <li><p>Let <var>request</var> be a new <a href=https://fetch.spec.whatwg.org/#concept-request id=downloading-or-updating-an-application-cache:concept-request-3 data-x-internal=concept-request>request</a> whose
   <a href=https://fetch.spec.whatwg.org/#concept-request-url id=downloading-or-updating-an-application-cache:concept-request-url-3 data-x-internal=concept-request-url>url</a> is <var>manifest URL</var>, <a href=https://fetch.spec.whatwg.org/#concept-request-client id=downloading-or-updating-an-application-cache:concept-request-client-3 data-x-internal=concept-request-client>client</a> is null, <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=downloading-or-updating-an-application-cache:concept-request-destination-3 data-x-internal=concept-request-destination>destination</a> is the empty string,
   <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=downloading-or-updating-an-application-cache:concept-request-referrer-3 data-x-internal=concept-request-referrer>referrer</a> is "<code>no-referrer</code>",
   <a id=downloading-or-updating-an-application-cache:synchronous-flag-3 href=https://fetch.spec.whatwg.org/#synchronous-flag data-x-internal=synchronous-flag>synchronous flag</a> is set, <a href=https://fetch.spec.whatwg.org/#concept-request-credentials-mode id=downloading-or-updating-an-application-cache:concept-request-credentials-mode-3 data-x-internal=concept-request-credentials-mode>credentials
   mode</a> is "<code>include</code>", and whose <a id=downloading-or-updating-an-application-cache:use-url-credentials-flag-3 href=https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials
   flag</a> is set.<li>

    <p>Let <var>second manifest</var> be the result of <a href=https://fetch.spec.whatwg.org/#concept-fetch id=downloading-or-updating-an-application-cache:concept-fetch-3 data-x-internal=concept-fetch>fetching</a> <var>request</var>. HTTP caching semantics should again
    be honored for this request.</p>

    <p class=note>Since caching can be honored, authors are encouraged to avoid setting the cache
    headers on the manifest in such a way that the user agent would simply not contact the network
    for this second request; otherwise, the user agent would not notice if the cache had changed
    during the cache update process.</p>

   <li>

    <p>If the previous step failed for any reason, or if the fetching attempt involved a redirect,
    or if <var>second manifest</var> and <var>manifest</var> are not byte-for-byte
    identical, then schedule a rerun of the entire algorithm with the same parameters after a short
    delay, and run the <a href=#cache-failure-steps id=downloading-or-updating-an-application-cache:cache-failure-steps-5>cache failure steps</a>.</p>

   <li>

    <p>Otherwise, store <var>manifest</var> in <var>new cache</var>, if it's not
    there already, and categorize its entry as <a href=#concept-appcache-manifest id=downloading-or-updating-an-application-cache:concept-appcache-manifest-4>the
    manifest</a>.</p>

   <li><p>Set the <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-5>completeness flag</a> of <var>new cache</var> to <i>complete</i>.<li><p>Let <var>task list</var> be an empty list of <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-10>tasks</a>.</p>

   <li>

    <p>If this is a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache-3>cache attempt</a>, then for each
    <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-20>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-19>application cache</a> in <var>cache
    group</var>, create a <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-11>task</a> to run these steps and append it
    to <var>task list</var>:

    <ol><li><p>Let <var>showProgress</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-13 data-x-internal=concept-event-fire>firing an
     event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-cached><a href=#event-appcache-cached>cached</a></code> at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-14><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-21>cache host</a>, with the <code id=downloading-or-updating-an-application-cache:dom-event-cancelable-13><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-13>shows caching
     progress</a>, then display some sort of user interface indicating to the user that the
     application has been cached and that they can now use it offline.</ol>

    <p>Otherwise, it is an <a href=#concept-appcache-upgrade id=downloading-or-updating-an-application-cache:concept-appcache-upgrade-4>upgrade attempt</a>. For each
    <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-22>cache host</a> associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-20>application cache</a> in <var>cache
    group</var>, create a <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-12>task</a> to run these steps and append it
    to <var>task list</var>:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-14 data-x-internal=concept-event-fire>firing an
     event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-updateready><a href=#event-appcache-updateready>updateready</a></code> at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-15><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-23>cache host</a>, with the <code id=downloading-or-updating-an-application-cache:dom-event-cancelable-14><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-14>shows caching
     progress</a>, then display some sort of user interface indicating to the user that a new
     version is available and that they can activate it by reloading the page.</ol>

   <li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.<li><p>Set the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-8>update status</a> of <var>cache
   group</var> to <i>idle</i>.<li><p>For each <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-13>task</a> in <var>task list</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-9>queue that task as a post-load task</a>.</ol>

  <p>The <dfn id=cache-failure-steps>cache failure steps</dfn> are as follows:</p>

  <ol><li><p>Let <var>task list</var> be an empty list of <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-14>tasks</a>.</p>

   <li>

    <p>For each entry in <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-9>list of pending master entries</a>, run the
    following further substeps. These steps may be run in parallel for two or more entries at a
    time.</p>

    <ol><li><p>Wait for the resource for this entry to have either completely downloaded or failed.</p>

     <li><p>Unassociate the <code id=downloading-or-updating-an-application-cache:document-9><a href=#document>Document</a></code> for this entry from its <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-21>application
     cache</a>, if it has one.<li>
      <p>Create a <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-15>task</a> to run these steps and append it to
      <var>task list</var>:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-15 data-x-internal=concept-event-fire>firing
       an event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-error-4><a href=#event-appcache-error>error</a></code> at the
       <code id=downloading-or-updating-an-application-cache:applicationcache-16><a href=#applicationcache>ApplicationCache</a></code> singleton of the <code id=downloading-or-updating-an-application-cache:document-10><a href=#document>Document</a></code> for this entry, if there
       still is one, with the <code id=downloading-or-updating-an-application-cache:dom-event-cancelable-15><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute
       initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-15>shows caching
       progress</a>, then display some sort of user interface indicating to the user that the
       user agent failed to save the application for offline use.</ol>
     </ol>

   <li>
    <p>For each <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-24>cache host</a> still associated with an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-22>application cache</a> in
    <var>cache group</var>, create a <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-16>task</a> to run these steps and
    append it to <var>task list</var>:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=downloading-or-updating-an-application-cache:concept-event-fire-16 data-x-internal=concept-event-fire>firing an
     event</a> named <code id=downloading-or-updating-an-application-cache:event-appcache-error-5><a href=#event-appcache-error>error</a></code> at the
     <code id=downloading-or-updating-an-application-cache:applicationcache-17><a href=#applicationcache>ApplicationCache</a></code> singleton of the <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-25>cache host</a>, with the <code id=downloading-or-updating-an-application-cache:dom-event-cancelable-16><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href=#shows-caching-progress id=downloading-or-updating-an-application-cache:shows-caching-progress-16>shows caching
     progress</a>, then display some sort of user interface indicating to the user that the user
     agent failed to save the application for offline use.</ol>
   <li><p>Empty <var>cache group</var>'s <a href=#concept-appcache-pending-masters id=downloading-or-updating-an-application-cache:concept-appcache-pending-masters-10>list of pending master entries</a>.<li><p>If <var>cache group</var> has an <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-23>application cache</a> whose <a href=#concept-appcache-completeness id=downloading-or-updating-an-application-cache:concept-appcache-completeness-6>completeness flag</a> is <i>incomplete</i>, then discard
   that <a href=#application-cache id=downloading-or-updating-an-application-cache:application-cache-24>application cache</a>.</p>

   <li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.<li><p>Let the <a href=#concept-appcache-status id=downloading-or-updating-an-application-cache:concept-appcache-status-9>status</a> of <var>cache
   group</var> be <i>idle</i>.<li><p>If this was a <a href=#concept-appcache-cache id=downloading-or-updating-an-application-cache:concept-appcache-cache-4>cache attempt</a>, discard <var>cache group</var> altogether.</p>

   <li><p>For each <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-17>task</a> in <var>task list</var>, <a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-10>queue that task as a post-load task</a>.<li><p>Abort the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-11>application cache download process</a>.</ol>

  <p>Attempts to fetch resources as part of the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-12>application cache download process</a> may
  be done with cache-defeating semantics, to avoid problems with stale or inconsistent intermediary
  caches.</p>

  <hr>

  <p>User agents may invoke the <a href=#application-cache-download-process id=downloading-or-updating-an-application-cache:application-cache-download-process-13>application cache download process</a>, in the background,
  for any <a href=#application-cache-group id=downloading-or-updating-an-application-cache:application-cache-group-8>application cache group</a>, at any time (with no <a href=#cache-host id=downloading-or-updating-an-application-cache:cache-host-26>cache host</a>). This
  allows user agents to keep caches primed and to update caches even before the user visits a
  site.</p>

  <hr>

  <p>Each <code id=downloading-or-updating-an-application-cache:document-11><a href=#document>Document</a></code> has a list of <dfn id=pending-application-cache-download-process-tasks>pending application cache download process
  tasks</dfn> that is used to delay events fired by the algorithm above until the document's <code id=downloading-or-updating-an-application-cache:event-load-2><a href=#event-load>load</a></code> event has fired. When the <code id=downloading-or-updating-an-application-cache:document-12><a href=#document>Document</a></code> is created, the
  list must be empty.</p>

  <p>When the steps above say to <dfn id=queue-a-post-load-task>queue a post-load task</dfn> <var>task</var>, where
  <var>task</var> is a <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-18>task</a> that dispatches an event on a
  target <code id=downloading-or-updating-an-application-cache:applicationcache-18><a href=#applicationcache>ApplicationCache</a></code> object <var>target</var>, the user agent must run
  the appropriate steps from the following list:</p>

  <dl><dt>If <var>target</var>'s <a id=downloading-or-updating-an-application-cache:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> is
   <a href=#ready-for-post-load-tasks id=downloading-or-updating-an-application-cache:ready-for-post-load-tasks>ready for post-load tasks</a><dd><p><a href=#queue-a-task id=downloading-or-updating-an-application-cache:queue-a-task>Queue</a> the task <var>task</var>.<dt>Otherwise<dd><p>Add <var>task</var> to <var>target</var>'s <a id=downloading-or-updating-an-application-cache:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s list
   of <a href=#pending-application-cache-download-process-tasks id=downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks>pending application cache download process tasks</a>.</dl>

  <p>When the steps above say to <dfn id=queue-a-progress-post-load-task>queue a progress post-load task</dfn> <var>task</var>, where
  <var>task</var> is a <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-19>task</a> that dispatches an event on a
  target <code id=downloading-or-updating-an-application-cache:applicationcache-19><a href=#applicationcache>ApplicationCache</a></code> object <var>target</var>, the user agent must run
  the following steps:</p>

  <ol><li><p>If there is a <var>task</var> in <var>target</var>'s <a id=downloading-or-updating-an-application-cache:node-document-3 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s list
   of <a href=#pending-application-cache-download-process-tasks id=downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks-2>pending application cache download process tasks</a> that is labeled as a
   <i>progress task</i>, then remove that task from the list.<li><p>Label <var>task</var> as a <i>progress task</i>.<li><p><a href=#queue-a-post-load-task id=downloading-or-updating-an-application-cache:queue-a-post-load-task-11>Queue a post-load task</a> <var>task</var>.</ol>

  <p>The <a href=#task-source id=downloading-or-updating-an-application-cache:task-source>task source</a> for these <a href=#concept-task id=downloading-or-updating-an-application-cache:concept-task-20>tasks</a> is the
  <a href=#networking-task-source id=downloading-or-updating-an-application-cache:networking-task-source>networking task source</a>.</p>




  <h4 id=the-application-cache-selection-algorithm>7.9.5 The application cache selection algorithm<a href=#the-application-cache-selection-algorithm class=self-link></a></h4>

  <p>When the <dfn id=concept-appcache-init>application cache selection algorithm</dfn>
  algorithm is invoked with a <code id=the-application-cache-selection-algorithm:document><a href=#document>Document</a></code> <var>document</var> and optionally a
  manifest <a id=the-application-cache-selection-algorithm:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>manifest URL</var>, the user agent must run the first
  applicable set of steps from the following list:</p>

  <dl class=switch><dt>If there is a <var>manifest URL</var>, and <var>document</var> was loaded
   from an <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache>application cache</a>, and the URL of the <a href=#concept-appcache-manifest id=the-application-cache-selection-algorithm:concept-appcache-manifest>manifest</a> of that cache's <a href=#application-cache-group id=the-application-cache-selection-algorithm:application-cache-group>application cache
   group</a> is <em>not</em> the same as <var>manifest URL</var><dd>

    <p>Mark the entry for the resource from which <var>document</var> was taken in the
    <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-2>application cache</a> from which it was loaded as <a href=#concept-appcache-foreign id=the-application-cache-selection-algorithm:concept-appcache-foreign>foreign</a>.</p>

    <p>Restart the current navigation from the top of the <a href=#navigate id=the-application-cache-selection-algorithm:navigate>navigation
    algorithm</a>, undoing any changes that were made as part of the initial load (changes can be
    avoided by ensuring that the step to <a href=#update-the-session-history-with-the-new-page id=the-application-cache-selection-algorithm:update-the-session-history-with-the-new-page>update the session history with the new page</a>
    is only ever completed <em>after</em> this <a href=#concept-appcache-init id=the-application-cache-selection-algorithm:concept-appcache-init>application cache
    selection algorithm</a> is run, though this is not required).</p>

    <p class=note>The navigation will not result in the same resource being loaded, because
    "foreign" entries are never picked during navigation.</p>

    <p>User agents may notify the user of the inconsistency between the cache manifest and the
    document's own metadata, to aid in application development.</p>

   <dt>If <var>document</var> was loaded from an <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-3>application cache</a>, and that
   <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-4>application cache</a> still exists (it is not now <a href=#concept-appcache-obsolete id=the-application-cache-selection-algorithm:concept-appcache-obsolete>obsolete</a>)<dd>

    <p>Associate <var>document</var> with the <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-5>application cache</a> from which it
    was loaded. Invoke, in the background, the <a href=#application-cache-download-process id=the-application-cache-selection-algorithm:application-cache-download-process>application cache download process</a> for
    that <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-6>application cache</a>'s <a href=#application-cache-group id=the-application-cache-selection-algorithm:application-cache-group-2>application cache group</a>, with <var>document</var> as the <a href=#cache-host id=the-application-cache-selection-algorithm:cache-host>cache host</a>.</p>

   <dt>If <var>document</var>  was loaded using `<code>GET</code>`, and, there is a
   <var>manifest URL</var>, and <var>manifest URL</var> has the <a href=#same-origin id=the-application-cache-selection-algorithm:same-origin>same origin</a> as
   <var>document</var><dd>

    <p>Invoke, in the background, the <a href=#application-cache-download-process id=the-application-cache-selection-algorithm:application-cache-download-process-2>application cache download process</a> for <var>manifest URL</var>, with <var>document</var> as the <a href=#cache-host id=the-application-cache-selection-algorithm:cache-host-2>cache host</a>
    and with the resource from which <var>document</var> was parsed as the <a href=#concept-appcache-master id=the-application-cache-selection-algorithm:concept-appcache-master>master</a> resource.</p>

    <p>If there are <a href=#relevant-application-cache id=the-application-cache-selection-algorithm:relevant-application-cache>relevant application caches</a> that
    are identified by a URL with the <a href=#same-origin id=the-application-cache-selection-algorithm:same-origin-2>same origin</a> as the URL of <var>document</var>, and that have this URL as one of their entries, excluding entries
    marked as <a href=#concept-appcache-foreign id=the-application-cache-selection-algorithm:concept-appcache-foreign-2>foreign</a>, then the user agent should use
    the <a href=#concept-appcache-selection id=the-application-cache-selection-algorithm:concept-appcache-selection>most appropriate application cache</a> of those
    that match as an HTTP cache for any subresource loads. User agents may also have other caches in
    place that are also honored.</p>

   <dt>Otherwise<dd>

    <p>The <code id=the-application-cache-selection-algorithm:document-2><a href=#document>Document</a></code> is not associated with any <a href=#application-cache id=the-application-cache-selection-algorithm:application-cache-7>application cache</a>.</p>

    <p>If there was a <var>manifest URL</var>, the user agent may report to the user that
    it was ignored, to aid in application development.</p>

   </dl>



  <h4 id=changesToNetworkingModel>7.9.6 Changes to the networking model<a href=#changesToNetworkingModel class=self-link></a></h4>

  <p class=XXX>If "AppCache" is not removed as a feature this
  section needs to be integrated into the Fetch standard.</p>

  <p>When a <a href=#cache-host id=changesToNetworkingModel:cache-host>cache host</a> is associated with an <a href=#application-cache id=changesToNetworkingModel:application-cache>application cache</a> whose <a href=#concept-appcache-completeness id=changesToNetworkingModel:concept-appcache-completeness>completeness flag</a> is <i>complete</i>, any and all
  loads for resources related to that <a href=#cache-host id=changesToNetworkingModel:cache-host-2>cache host</a> other than those for <a href=#child-browsing-context id=changesToNetworkingModel:child-browsing-context>child browsing contexts</a> must go through the following steps
  instead of immediately invoking the mechanisms appropriate to that resource's scheme:</p>

  <ol><li><p>If the resource is not to be fetched using the GET method, or if applying the <a id=changesToNetworkingModel:url-parser href=https://url.spec.whatwg.org/#concept-url-parser data-x-internal=url-parser>URL
   parser</a> algorithm to both its <a id=changesToNetworkingModel:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> and the <a href=#application-cache id=changesToNetworkingModel:application-cache-2>application cache</a>'s
   <a href=#concept-appcache-manifest id=changesToNetworkingModel:concept-appcache-manifest>manifest</a>'s URL results in two <a href=https://url.spec.whatwg.org/#concept-url id=changesToNetworkingModel:url-record data-x-internal=url-record>URL records</a> with different <a href=https://url.spec.whatwg.org/#concept-url-scheme id=changesToNetworkingModel:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
   components, then fetch the resource normally and abort these steps.<li><p>If the resource's URL is <a href=#concept-appcache-master id=changesToNetworkingModel:concept-appcache-master>a master entry</a>,
   <a href=#concept-appcache-manifest id=changesToNetworkingModel:concept-appcache-manifest-2>the manifest</a>, <a href=#concept-appcache-explicit id=changesToNetworkingModel:concept-appcache-explicit>an explicit entry</a>, or <a href=#concept-appcache-fallback id=changesToNetworkingModel:concept-appcache-fallback>a fallback entry</a> in the <a href=#application-cache id=changesToNetworkingModel:application-cache-3>application cache</a>,
   then get the resource from the cache (instead of fetching it), and abort these steps.<li><p>If there is an entry in the <a href=#application-cache id=changesToNetworkingModel:application-cache-4>application cache</a>'s <a href=#concept-appcache-onlinesafelist id=changesToNetworkingModel:concept-appcache-onlinesafelist>online safelist</a> that has the <a href=#same-origin id=changesToNetworkingModel:same-origin>same
   origin</a> as the resource's URL and that is a <a href=#prefix-match id=changesToNetworkingModel:prefix-match>prefix match</a> for the resource's
   URL, then fetch the resource normally and abort these steps.<li>

    <p>If the resource's URL has the <a href=#same-origin id=changesToNetworkingModel:same-origin-2>same origin</a> as the manifest's URL, and there is a
    <a href=#concept-appcache-fallback-ns id=changesToNetworkingModel:concept-appcache-fallback-ns>fallback namespace</a> <var>f</var> in
    the <a href=#application-cache id=changesToNetworkingModel:application-cache-5>application cache</a> that is a <a href=#prefix-match id=changesToNetworkingModel:prefix-match-2>prefix match</a> for the resource's URL,
    then:</p>

    <p>Fetch the resource normally. If this results in a redirect to a resource with another
    <a href=#concept-origin id=changesToNetworkingModel:concept-origin>origin</a> (indicative of a captive portal), or a 4xx or 5xx status code, or if there
    were network errors (but not if the user canceled the download), then instead get, from the
    cache, the resource of the <a href=#concept-appcache-fallback id=changesToNetworkingModel:concept-appcache-fallback-2>fallback entry</a>
    corresponding to the <a href=#concept-appcache-fallback-ns id=changesToNetworkingModel:concept-appcache-fallback-ns-2>fallback namespace</a>
    <var>f</var>. Abort these steps.</p>

   <li><p>If the <a href=#application-cache id=changesToNetworkingModel:application-cache-6>application cache</a>'s <a href=#concept-appcache-onlinesafelist-wildcard id=changesToNetworkingModel:concept-appcache-onlinesafelist-wildcard>online safelist wildcard flag</a> is
   <i>open</i>, then fetch the resource normally and abort these steps.<li><p>Fail the resource load as if there had been a generic network error.</ol>

  <p class=note>The above algorithm ensures that so long as the <a href=#concept-appcache-onlinesafelist-wildcard id=changesToNetworkingModel:concept-appcache-onlinesafelist-wildcard-2>online safelist wildcard flag</a> is
  <i>blocking</i>, resources that are not present in the <a href=#concept-appcache-manifest id=changesToNetworkingModel:concept-appcache-manifest-3>manifest</a> will always fail to load (at least, after the
  <a href=#application-cache id=changesToNetworkingModel:application-cache-7>application cache</a> has been primed the first time), making the testing of offline
  applications simpler.</p>

  


  

  <h4 id=expiring-application-caches>7.9.7 Expiring application caches<a href=#expiring-application-caches class=self-link></a></h4>

  <p>As a general rule, user agents should not expire application caches, except on request from the
  user, or after having been left unused for an extended period of time.</p>

  <p>Application caches and cookies have similar implications with respect to privacy (e.g. if the
  site can identify the user when providing the cache, it can store data in the cache that can be
  used for cookie resurrection). Implementors are therefore encouraged to expose application caches
  in a manner related to HTTP cookies, allowing caches to be expunged together with cookies and
  other origin-specific data.</p>

  <p class=example>For example, a user agent could have a "delete site-specific data" feature that
  clears all cookies, application caches, local storage, databases, etc, from an origin all at
  once.</p>

  


  

  <h4 id=disk-space>7.9.8 Disk space<a href=#disk-space class=self-link></a></h4>

  <p>User agents should consider applying constraints on disk usage of <a href=#application-cache id=disk-space:application-cache>application caches</a>, and care should be taken to ensure that the restrictions cannot
  be easily worked around using subdomains.</p>

  <p>User agents should allow users to see how much space each domain is using, and may offer the
  user the ability to delete specific <a href=#application-cache id=disk-space:application-cache-2>application caches</a>.</p>

  <p>For predictability, quotas should be based on the uncompressed size of data stored.</p>
  

  <p class=note>How quotas are presented to the user is not defined by this specification. User
  agents are encouraged to provide features such as allowing a user to indicate that certain sites
  are trusted to use more than the default quota, e.g. by presenting a non-modal user interface
  while a cache is being updated, or by having an explicit safelist in the user agent's
  configuration interface.</p>

  



  <h4 id=security-concerns-with-offline-applications-caches>7.9.9 Security concerns with offline applications caches<a href=#security-concerns-with-offline-applications-caches class=self-link></a></h4>

  <p><i>This section is non-normative.</i></p>

  <p>The main risk introduced by offline application caches is that an injection attack can be
  elevated into persistent site-wide page replacement. This attack involves using an injection
  vulnerability to upload two files to the victim site. The first file is an application cache
  manifest consisting of just a fallback entry pointing to the second file, which is an HTML page
  whose manifest is declared as that first file. Once the user has been directed to that second
  file, all subsequent accesses to any file covered by the given fallback namespace while either the
  user or the site is offline will instead show that second file. Targeted denial-of-service
  attacks or cookie bombing attacks (where the client is made to send so many cookies that the
  server refuses to process the request) can be used to ensure that the site appears offline.</p>

  <p>To mitigate this, manifests can only specify fallbacks that are in the same path as the
  manifest itself. This means that a content injection upload vulnerability in a particular
  directory on a server can only be escalated to a take-over of that directory and its
  subdirectories. If there is no way to inject a file into the root directory, the entire site
  cannot be taken over.</p>

  <p>If a site has been attacked in this way, simply removing the offending manifest might eventually
  clear the problem, since the next time the manifest is updated, a 404 error will be seen, and the
  user agent will clear the cache. "Eventually" is the key word here, however; while the attack on
  the user or server is ongoing, such that connections from an affected user to the affected site
  are blocked, the user agent will simply assume that the user is offline and will continue to use
  the hostile manifest. Unfortunately, if a cookie bombing attack has also been used, merely
  removing the manifest is insufficient; in addition, the server has to be configured to return a
  404 or 410 response instead of the 413 "Request Entity Too Large" response.</p>

  <p>TLS does not inherently protect a site from this attack, since the attack relies on content
  being served from the server itself. Not using application caches also does not prevent this
  attack, since the attack relies on an attacker-provided manifest.</p>



  <h4 id=application-cache-api>7.9.10 Application cache API<a href=#application-cache-api class=self-link></a></h4>

  <pre class=idl>[Exposed=(Window,SharedWorker)]
interface <dfn id=applicationcache>ApplicationCache</dfn> : <a id=application-cache-api:eventtarget href=https://dom.spec.whatwg.org/#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {

  // <a href=#concept-appcache-status id=application-cache-api:concept-appcache-status>update status</a>
  const unsigned short <a href=#dom-appcache-uncached id=application-cache-api:dom-appcache-uncached>UNCACHED</a> = 0;
  const unsigned short <a href=#dom-appcache-idle id=application-cache-api:dom-appcache-idle>IDLE</a> = 1;
  const unsigned short <a href=#dom-appcache-checking id=application-cache-api:dom-appcache-checking>CHECKING</a> = 2;
  const unsigned short <a href=#dom-appcache-downloading id=application-cache-api:dom-appcache-downloading>DOWNLOADING</a> = 3;
  const unsigned short <a href=#dom-appcache-updateready id=application-cache-api:dom-appcache-updateready>UPDATEREADY</a> = 4;
  const unsigned short <a href=#dom-appcache-obsolete id=application-cache-api:dom-appcache-obsolete>OBSOLETE</a> = 5;
  readonly attribute unsigned short <a href=#dom-appcache-status id=application-cache-api:dom-appcache-status>status</a>;

  // updates
  void <a href=#dom-appcache-update id=application-cache-api:dom-appcache-update>update</a>();
  void <a href=#dom-appcache-abort id=application-cache-api:dom-appcache-abort>abort</a>();
  void <a href=#dom-appcache-swapcache id=application-cache-api:dom-appcache-swapcache>swapCache</a>();

  // events
  attribute <a href=#eventhandler id=application-cache-api:eventhandler>EventHandler</a> <a href=#handler-appcache-onchecking id=application-cache-api:handler-appcache-onchecking>onchecking</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-2>EventHandler</a> <a href=#handler-appcache-onerror id=application-cache-api:handler-appcache-onerror>onerror</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-3>EventHandler</a> <a href=#handler-appcache-onnoupdate id=application-cache-api:handler-appcache-onnoupdate>onnoupdate</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-4>EventHandler</a> <a href=#handler-appcache-ondownloading id=application-cache-api:handler-appcache-ondownloading>ondownloading</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-5>EventHandler</a> <a href=#handler-appcache-onprogress id=application-cache-api:handler-appcache-onprogress>onprogress</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-6>EventHandler</a> <a href=#handler-appcache-onupdateready id=application-cache-api:handler-appcache-onupdateready>onupdateready</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-7>EventHandler</a> <a href=#handler-appcache-oncached id=application-cache-api:handler-appcache-oncached>oncached</a>;
  attribute <a href=#eventhandler id=application-cache-api:eventhandler-8>EventHandler</a> <a href=#handler-appcache-onobsolete id=application-cache-api:handler-appcache-onobsolete>onobsolete</a>;
};</pre>

  <dl class=domintro><dt><var>cache</var> = <var>window</var> . <code id=application-cache-api:dom-applicationcache><a href=#dom-applicationcache>applicationCache</a></code><dd>

    <p>(In a window.) Returns the <code id=application-cache-api:applicationcache><a href=#applicationcache>ApplicationCache</a></code> object that applies to the
    <a href=#active-document id=application-cache-api:active-document>active document</a> of that <code id=application-cache-api:window><a href=#window>Window</a></code>.</p>

   <dt><var>cache</var> = <var>self</var> . <code id=application-cache-api:dom-applicationcache-2><a href=#dom-applicationcache>applicationCache</a></code><dd>

    <p>(In a shared worker.) Returns the <code id=application-cache-api:applicationcache-2><a href=#applicationcache>ApplicationCache</a></code> object that applies to the
    current shared worker.</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-status-2><a href=#dom-appcache-status>status</a></code><dd>

    <p>Returns the current status of the application cache, as given by the constants defined
    below.</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-update-2><a href=#dom-appcache-update>update</a></code>()<dd>

    <p>Invokes the <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process>application cache download process</a>.</p>

    <p>Throws an <a id=application-cache-api:invalidstateerror href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> if there is
    no application cache to update.</p>

    <p>Calling this method is not usually necessary, as user agents will generally take care of
    updating <a href=#application-cache id=application-cache-api:application-cache>application caches</a> automatically.</p>

    <p>The method can be useful in situations such as long-lived applications. For example, a Web
    mail application might stay open in a browser tab for weeks at a time. Such an application could
    want to test for updates each day.</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-abort-2><a href=#dom-appcache-abort>abort</a></code>()<dd>

    <p>Cancels the <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-2>application cache download process</a>.</p>

    <p>This method is intended to be used by Web application showing their own caching progress UI,
    in case the user wants to stop the update (e.g. because bandwidth is limited).</p>

   <dt><var>cache</var> . <code id=application-cache-api:dom-appcache-swapcache-2><a href=#dom-appcache-swapcache>swapCache</a></code>()<dd>

    <p>Switches to the most recent application cache, if there is a newer one. If there isn't,
    throws an <a id=application-cache-api:invalidstateerror-2 href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

    <p>This does not cause previously-loaded resources to be reloaded; for example, images do not
    suddenly get reloaded and style sheets and scripts do not get reparsed or reevaluated. The only
    change is that subsequent requests for cached resources will obtain the newer copies.</p>

    <p>The <code id=application-cache-api:event-appcache-updateready><a href=#event-appcache-updateready>updateready</a></code> event will fire before this
    method can be called. Once it fires, the Web application can, at its leisure, call this method
    to switch the underlying cache to the one with the more recent updates. To make proper use of
    this, applications have to be able to bring the new features into play; for example, reloading
    scripts to enable new features.</p>

    <p>An easier alternative to <code id=application-cache-api:dom-appcache-swapcache-3><a href=#dom-appcache-swapcache>swapCache()</a></code> is just to
    reload the entire page at a time suitable for the user, using <code id=application-cache-api:dom-location-reload><a href=#dom-location-reload>location.reload()</a></code>.</p>

   </dl>

  

  <p>There is a one-to-one mapping from <a href=#cache-host id=application-cache-api:cache-host>cache hosts</a> to
  <code id=application-cache-api:applicationcache-3><a href=#applicationcache>ApplicationCache</a></code> objects. The <dfn id=dom-applicationcache><code>applicationCache</code></dfn> attribute on <code id=application-cache-api:window-2><a href=#window>Window</a></code>
  objects must return the <code id=application-cache-api:applicationcache-4><a href=#applicationcache>ApplicationCache</a></code> object associated with the
  <code id=application-cache-api:window-3><a href=#window>Window</a></code> object's <a href=#active-document id=application-cache-api:active-document-2>active document</a>. The <dfn id=dom-sharedworkerglobalscope-applicationcache><code>applicationCache</code></dfn> attribute
  on <code id=application-cache-api:sharedworkerglobalscope><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> objects must return the <code id=application-cache-api:applicationcache-5><a href=#applicationcache>ApplicationCache</a></code>
  object associated with the worker.</p>

  <p class=note>A <code id=application-cache-api:window-4><a href=#window>Window</a></code> or <code id=application-cache-api:sharedworkerglobalscope-2><a href=#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object has an
  associated <code id=application-cache-api:applicationcache-6><a href=#applicationcache>ApplicationCache</a></code> object even if that <a href=#cache-host id=application-cache-api:cache-host-2>cache host</a> has no actual
  <a href=#application-cache id=application-cache-api:application-cache-2>application cache</a>.</p>

  <hr>

  <p>The <dfn id=dom-appcache-status><code>status</code></dfn> attribute, on getting, must
  return the current state of the <a href=#application-cache id=application-cache-api:application-cache-3>application cache</a> that the
  <code id=application-cache-api:applicationcache-7><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-3>cache host</a> is associated with, if any. This
  must be the appropriate value from the following list:</p>

  

  <dl><dt><dfn id=dom-appcache-uncached><code>UNCACHED</code></dfn> (numeric value 0)<dd><p>The <code id=application-cache-api:applicationcache-8><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-4>cache host</a> is not associated with
   an <a href=#application-cache id=application-cache-api:application-cache-4>application cache</a> at this time.<dt><dfn id=dom-appcache-idle><code>IDLE</code></dfn> (numeric value 1)<dd><p>The <code id=application-cache-api:applicationcache-9><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-5>cache host</a> is associated with an
   <a href=#application-cache id=application-cache-api:application-cache-5>application cache</a> whose <a href=#application-cache-group id=application-cache-api:application-cache-group>application cache group</a>'s <a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-2>update status</a> is <i>idle</i>, and that <a href=#application-cache id=application-cache-api:application-cache-6>application
   cache</a> is the <a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer>newest</a> cache in its
   <a href=#application-cache-group id=application-cache-api:application-cache-group-2>application cache group</a>, and the <a href=#application-cache-group id=application-cache-api:application-cache-group-3>application cache group</a> is not marked
   as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete>obsolete</a>.<dt><dfn id=dom-appcache-checking><code>CHECKING</code></dfn> (numeric value 2)<dd><p>The <code id=application-cache-api:applicationcache-10><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-6>cache host</a> is associated with an
   <a href=#application-cache id=application-cache-api:application-cache-7>application cache</a> whose <a href=#application-cache-group id=application-cache-api:application-cache-group-4>application cache group</a>'s <a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-3>update status</a> is <i>checking</i>.<dt><dfn id=dom-appcache-downloading><code>DOWNLOADING</code></dfn> (numeric value 3)<dd><p>The <code id=application-cache-api:applicationcache-11><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-7>cache host</a> is associated with an
   <a href=#application-cache id=application-cache-api:application-cache-8>application cache</a> whose <a href=#application-cache-group id=application-cache-api:application-cache-group-5>application cache group</a>'s <a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-4>update status</a> is <i>downloading</i>.<dt><dfn id=dom-appcache-updateready><code>UPDATEREADY</code></dfn> (numeric value 4)<dd><p>The <code id=application-cache-api:applicationcache-12><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-8>cache host</a> is associated with an
   <a href=#application-cache id=application-cache-api:application-cache-9>application cache</a> whose <a href=#application-cache-group id=application-cache-api:application-cache-group-6>application cache group</a>'s <a href=#concept-appcache-status id=application-cache-api:concept-appcache-status-5>update status</a> is <i>idle</i>, and whose <a href=#application-cache-group id=application-cache-api:application-cache-group-7>application
   cache group</a> is not marked as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-2>obsolete</a>, but
   that <a href=#application-cache id=application-cache-api:application-cache-10>application cache</a> is <em>not</em> the <a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer-2>newest</a> cache in its group.<dt><dfn id=dom-appcache-obsolete><code>OBSOLETE</code></dfn> (numeric value 5)<dd><p>The <code id=application-cache-api:applicationcache-13><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-9>cache host</a> is associated with an
   <a href=#application-cache id=application-cache-api:application-cache-11>application cache</a> whose <a href=#application-cache-group id=application-cache-api:application-cache-group-8>application cache group</a> is marked as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-3>obsolete</a>.</dl>

  

  <hr>

  <p>If the <dfn id=dom-appcache-update><code>update()</code></dfn> method is invoked, the user
  agent must invoke the <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-3>application cache download process</a>, in the background, for the
  <a href=#application-cache-group id=application-cache-api:application-cache-group-9>application cache group</a> of the <a href=#application-cache id=application-cache-api:application-cache-12>application cache</a> with which the
  <code id=application-cache-api:applicationcache-14><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-10>cache host</a> is associated, but without giving
  that <a href=#cache-host id=application-cache-api:cache-host-11>cache host</a> to the algorithm. If there is no such <a href=#application-cache id=application-cache-api:application-cache-13>application cache</a>,
  or if its <a href=#application-cache-group id=application-cache-api:application-cache-group-10>application cache group</a> is marked as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-4>obsolete</a>, then the method must throw an
  <a id=application-cache-api:invalidstateerror-3 href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> instead.</p>

  <p>If the <dfn id=dom-appcache-abort><code>abort()</code></dfn> method is invoked, the user
  agent must <dfn id=send-a-signal>send a signal</dfn> to the current <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-4>application cache download process</a>
  for the <a href=#application-cache-group id=application-cache-api:application-cache-group-11>application cache group</a> of the <a href=#application-cache id=application-cache-api:application-cache-14>application cache</a> with which the
  <code id=application-cache-api:applicationcache-15><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-12>cache host</a> is associated, if any. If there is
  no such <a href=#application-cache id=application-cache-api:application-cache-15>application cache</a>, or it does not have a current <a href=#application-cache-download-process id=application-cache-api:application-cache-download-process-5>application cache
  download process</a>, then do nothing.</p>

  <p>If the <dfn id=dom-appcache-swapcache><code>swapCache()</code></dfn> method is invoked,
  the user agent must run the following steps:

  <ol><li><p>Check that <code id=application-cache-api:applicationcache-16><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-13>cache host</a> is associated
   with an <a href=#application-cache id=application-cache-api:application-cache-16>application cache</a>. If it is not, then throw an
   <a id=application-cache-api:invalidstateerror-4 href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=application-cache-api:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these
   steps.<li><p>Let <var>cache</var> be the <a href=#application-cache id=application-cache-api:application-cache-17>application cache</a> with which the
   <code id=application-cache-api:applicationcache-17><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-14>cache host</a> is associated. (By definition,
   this is the same as the one that was found in the previous step.)<li><p>If <var>cache</var>'s <a href=#application-cache-group id=application-cache-api:application-cache-group-12>application cache group</a> is marked as <a href=#concept-appcache-obsolete id=application-cache-api:concept-appcache-obsolete-5>obsolete</a>, then unassociate the
   <code id=application-cache-api:applicationcache-18><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-15>cache host</a> from <var>cache</var> and
   abort these steps. (Resources will now load from the network instead of the cache.)<li><p>Check that there is an application cache in the same <a href=#application-cache-group id=application-cache-api:application-cache-group-13>application cache group</a>
   as <var>cache</var> whose <a href=#concept-appcache-completeness id=application-cache-api:concept-appcache-completeness>completeness
   flag</a> is <i>complete</i> and that is <a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer-3>newer</a> than
   <var>cache</var>. If there is not, then throw an <a id=application-cache-api:invalidstateerror-5 href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a>
   <code id=application-cache-api:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> exception and abort these steps.<li><p>Let <var>new cache</var> be the <a href=#concept-appcache-newer id=application-cache-api:concept-appcache-newer-4>newest</a> <a href=#application-cache id=application-cache-api:application-cache-18>application cache</a> in the same
   <a href=#application-cache-group id=application-cache-api:application-cache-group-14>application cache group</a> as <var>cache</var> whose <a href=#concept-appcache-completeness id=application-cache-api:concept-appcache-completeness-2>completeness flag</a> is <i>complete</i>.<li><p>Unassociate the <code id=application-cache-api:applicationcache-19><a href=#applicationcache>ApplicationCache</a></code> object's <a href=#cache-host id=application-cache-api:cache-host-16>cache host</a> from <var>cache</var> and instead associate it with <var>new cache</var>.</ol>

  <p>The following are the <a href=#event-handlers id=application-cache-api:event-handlers>event handlers</a> (and their corresponding <a href=#event-handler-event-type id=application-cache-api:event-handler-event-type>event handler event types</a>) that must be
  supported, as <a href=#event-handler-idl-attributes id=application-cache-api:event-handler-idl-attributes>event handler IDL attributes</a>, by all objects implementing the
  <code id=application-cache-api:applicationcache-20><a href=#applicationcache>ApplicationCache</a></code> interface:</p>

  <table><thead><tr><th><a href=#event-handlers id=application-cache-api:event-handlers-2>Event handler</a> <th><a href=#event-handler-event-type id=application-cache-api:event-handler-event-type-2>Event handler event type</a>
   <tbody><tr><td><dfn id=handler-appcache-onchecking><code>onchecking</code></dfn> <td> <code id=application-cache-api:event-appcache-checking><a href=#event-appcache-checking>checking</a></code>
    <tr><td><dfn id=handler-appcache-onerror><code>onerror</code></dfn> <td> <code id=application-cache-api:event-appcache-error><a href=#event-appcache-error>error</a></code>
    <tr><td><dfn id=handler-appcache-onnoupdate><code>onnoupdate</code></dfn> <td> <code id=application-cache-api:event-appcache-noupdate><a href=#event-appcache-noupdate>noupdate</a></code>
    <tr><td><dfn id=handler-appcache-ondownloading><code>ondownloading</code></dfn> <td> <code id=application-cache-api:event-appcache-downloading><a href=#event-appcache-downloading>downloading</a></code>
    <tr><td><dfn id=handler-appcache-onprogress><code>onprogress</code></dfn> <td> <code id=application-cache-api:event-appcache-progress><a href=#event-appcache-progress>progress</a></code>
    <tr><td><dfn id=handler-appcache-onupdateready><code>onupdateready</code></dfn> <td> <code id=application-cache-api:event-appcache-updateready-2><a href=#event-appcache-updateready>updateready</a></code>
    <tr><td><dfn id=handler-appcache-oncached><code>oncached</code></dfn> <td> <code id=application-cache-api:event-appcache-cached><a href=#event-appcache-cached>cached</a></code>
    <tr><td><dfn id=handler-appcache-onobsolete><code>onobsolete</code></dfn> <td> <code id=application-cache-api:event-appcache-obsolete><a href=#event-appcache-obsolete>obsolete</a></code>
  </table>

  


  <h4 id=navigator.online>7.9.11 <span id=browser-state>Browser state</span><a href=#navigator.online class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> online-status<span class="and_chr yes"><span>Chrome for Android</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>14+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>4.2+</span></span><span class="and_uc partial"><span>UC Browser for Android (limited)</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>41+</span></span><span class="ie yes"><span>IE</span> <span>9+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.3+</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=online-status">caniuse.com</a></div>

  <pre class=idl>[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id=navigatoronline>NavigatorOnLine</dfn> {
  readonly attribute boolean <a href=#dom-navigator-online id=navigator.online:dom-navigator-online>onLine</a>;
};</pre>

  <dl class=domintro><dt><var>window</var> . <code id=navigator.online:dom-navigator><a href=#dom-navigator>navigator</a></code> . <code id=navigator.online:dom-navigator-online-2><a href=#dom-navigator-online>onLine</a></code><dd>

    <p>Returns false if the user agent is definitely offline (disconnected from the network).
    Returns true if the user agent might be online.</p>

    <p>The events <code id=navigator.online:event-online><a href=#event-online>online</a></code> and <code id=navigator.online:event-offline><a href=#event-offline>offline</a></code> are fired when the value of this attribute changes.</p>

   </dl>

  

  <p>The <dfn id=dom-navigator-online><code>navigator.onLine</code></dfn> attribute must return
  false if the user agent will not contact the network when the user follows links or when a script
  requests a remote page (or knows that such an attempt would fail), and must return true
  otherwise.</p>

  <p>When the value that would be returned by the <code id=navigator.online:dom-navigator-online-3><a href=#dom-navigator-online>navigator.onLine</a></code> attribute of a <code id=navigator.online:window><a href=#window>Window</a></code> or
  <code id=navigator.online:workerglobalscope><a href=#workerglobalscope>WorkerGlobalScope</a></code> changes from true to false, the user agent must <a href=#queue-a-task id=navigator.online:queue-a-task>queue a
  task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=navigator.online:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=navigator.online:event-offline-2><a href=#event-offline>offline</a></code> at the <code id=navigator.online:window-2><a href=#window>Window</a></code> or <code id=navigator.online:workerglobalscope-2><a href=#workerglobalscope>WorkerGlobalScope</a></code>
  object.</p>

  <p>On the other hand, when the value that would be returned by the <code id=navigator.online:dom-navigator-online-4><a href=#dom-navigator-online>navigator.onLine</a></code> attribute of a <code id=navigator.online:window-3><a href=#window>Window</a></code> or
  <code id=navigator.online:workerglobalscope-3><a href=#workerglobalscope>WorkerGlobalScope</a></code> changes from false to true, the user agent must <a href=#queue-a-task id=navigator.online:queue-a-task-2>queue a
  task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=navigator.online:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=navigator.online:event-online-2><a href=#event-online>online</a></code> at the <code id=navigator.online:window-4><a href=#window>Window</a></code> or <code id=navigator.online:workerglobalscope-4><a href=#workerglobalscope>WorkerGlobalScope</a></code>
  object.</p>

  <p>The <a href=#task-source id=navigator.online:task-source>task source</a> for these <a href=#concept-task id=navigator.online:concept-task>tasks</a> is the
  <a href=#networking-task-source id=navigator.online:networking-task-source>networking task source</a>.</p>

  

  <p class=note>This attribute is inherently unreliable. A computer can be connected to a network
  without having Internet access.</p>

  <div class=example>

   <p>In this example, an indicator is updated as the browser goes online and offline.</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
 &lt;head>
  &lt;title>Online status&lt;/title>
  &lt;script>
   function updateIndicator() {
     document.getElementById('indicator').textContent = navigator.onLine ? 'online' : 'offline';
   }
  &lt;/script>
 &lt;/head>
 &lt;body onload="updateIndicator()" ononline="updateIndicator()" onoffline="updateIndicator()">
  &lt;p>The network is: &lt;span id="indicator">(state unknown)&lt;/span>
 &lt;/body>
&lt;/html></pre>

  </div>





  <h2 id=webappapis>8 Web application APIs<a href=#webappapis class=self-link></a></h2>

  <h3 id=scripting>8.1 Scripting<a href=#scripting class=self-link></a></h3>

  <h4 id=introduction-11>8.1.1 Introduction<a href=#introduction-11 class=self-link></a></h4>

  <p>Various mechanisms can cause author-provided executable code to run in the context of a
  document. These mechanisms include, but are probably not limited to:</p>

  <ul><li>Processing of <code id=introduction-11:the-script-element><a href=#the-script-element>script</a></code> elements.<li>Navigating to <a href=#javascript-protocol id=introduction-11:javascript-protocol><code>javascript:</code> URLs</a>.<li>Event handlers, whether registered through the DOM using <code>addEventListener()</code>, by explicit <a href=#event-handler-content-attributes id=introduction-11:event-handler-content-attributes>event handler content attributes</a>, by
   <a href=#event-handler-idl-attributes id=introduction-11:event-handler-idl-attributes>event handler IDL attributes</a>, or otherwise.<li>Processing of technologies like SVG that have their own scripting features.</ul>


  

  <h4 id=enabling-and-disabling-scripting>8.1.2 Enabling and disabling scripting<a href=#enabling-and-disabling-scripting class=self-link></a></h4>

  <p><dfn id=concept-bc-script>Scripting is enabled</dfn> in a <em><a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context>browsing
  context</a></em> when all of the following conditions are true:</p>

  <ul><li>The user agent supports scripting.<li>The user has not disabled scripting for this <a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context-2>browsing context</a> at this time.
   (User agents may provide users with the option to disable scripting globally, or in a
   finer-grained manner, e.g. on a per-origin basis.)
   <a href=#fingerprinting-vector id=enabling-and-disabling-scripting:fingerprinting-vector class=fingerprint title="There is a potential fingerprinting vector here."><img alt="(This is a fingerprinting vector.)" src=/images/fingerprint.png width=46 height=64></a>
   <li id=sandboxScriptBlocked>The <a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context-3>browsing context</a>'s <a href=#active-document id=enabling-and-disabling-scripting:active-document>active document</a>'s
   <a href=#active-sandboxing-flag-set id=enabling-and-disabling-scripting:active-sandboxing-flag-set>active sandboxing flag set</a> does not have its <a href=#sandboxed-scripts-browsing-context-flag id=enabling-and-disabling-scripting:sandboxed-scripts-browsing-context-flag>sandboxed scripts browsing
   context flag</a> set.</ul>

  <p><dfn id=concept-bc-noscript>Scripting is disabled</dfn> in a <a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context-4>browsing context</a>
  when any of the above conditions are false (i.e. when scripting is not <a href=#concept-bc-script id=enabling-and-disabling-scripting:concept-bc-script>enabled</a>).</p>

  <hr>

  <p><dfn id=concept-n-script>Scripting is enabled</dfn> for a <em>node</em> if the node's
  <a id=enabling-and-disabling-scripting:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> has a <a href=#concept-document-bc id=enabling-and-disabling-scripting:concept-document-bc>browsing context</a>, and
  <a href=#concept-bc-script id=enabling-and-disabling-scripting:concept-bc-script-2>scripting is enabled</a> in that <a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context-5>browsing
  context</a>.</p>

  <p><dfn id=concept-n-noscript>Scripting is disabled</dfn> for a node if there is no such
  <a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context-6>browsing context</a>, or if <a href=#concept-bc-noscript id=enabling-and-disabling-scripting:concept-bc-noscript>scripting is
  disabled</a> in that <a href=#browsing-context id=enabling-and-disabling-scripting:browsing-context-7>browsing context</a>.</p>

  


  

  
  <h4 id=scripting-processing-model>8.1.3 <span id=processing-model-7></span>Processing model<a href=#scripting-processing-model class=self-link></a></h4>

  <h5 id=definitions-2>8.1.3.1 Definitions<a href=#definitions-2 class=self-link></a></h5>

  <p>A <dfn id=concept-script data-export="">script</dfn> is one of two possible structures.
  All scripts have:</p>

  <dl><dt>A <dfn data-dfn-for=script id=settings-object data-export="">settings object</dfn><dd>

    <p>An <a href=#environment-settings-object id=definitions-2:environment-settings-object>environment settings object</a>, containing various settings that are shared
    with other <a href=#concept-script id=definitions-2:concept-script>scripts</a> in the same context.</p>

   </dl>


  <p>A <dfn id=classic-script data-export="">classic script</dfn> is a <a href=#concept-script id=definitions-2:concept-script-2>script</a>
  that has the following additional fields:</p>

  <dl><dt><dfn id=concept-classic-script-source-text data-export="">Source text</dfn><dd>

    <p>A string containing a block of executable code to be evaluated as a JavaScript <i id=definitions-2:js-prod-script><a data-x-internal=js-prod-script href=https://tc39.github.io/ecma262/#prod-Script>Script</a></i>.</p>

   <dt>Optionally, a <dfn id=muted-errors>muted errors</dfn> flag<dd>

    <p>A flag which, if set, means that error information will not be provided for errors in this
    script (used to mute errors for cross-origin scripts, since that can leak private
    information).</p>

   </dl>

  <p>A <dfn id=module-script data-export="">module script</dfn> is a <a href=#concept-script id=definitions-2:concept-script-3>script</a>
  that has the following additional fields:</p>

  <dl><dt>A <dfn data-dfn-for="module
   script" id=concept-module-script-module-record data-export="">module record</dfn><dd>

    <p>A <a id=definitions-2:source-text-module-record href=https://tc39.github.io/ecma262/#sec-source-text-module-records data-x-internal=source-text-module-record>Source Text Module Record</a> representing the parsed module, ready to be
    evaluated.</p>

   <dt>A <dfn id=concept-module-script-base-url>base URL</dfn><dd>

    <p>A base URL used for resolving module specifiers when <a href=#resolve-a-module-specifier id=definitions-2:resolve-a-module-specifier>resolving a module specifier</a>. This will either be the URL from which the
    script was obtained, for external module scripts, or the <a href=#document-base-url id=definitions-2:document-base-url>document base URL</a> of the
    containing document, for inline module scripts.</p>

   <dt>An <dfn id=concept-module-script-instantiation-state>instantiation state</dfn><dd>

    <p>One of "<code>uninstantiated</code>", "<code>errored</code>", or "<code>instantiated</code>", used to prevent reinvocation of <a href=https://tc39.github.io/ecma262/#sec-moduledeclarationinstantiation id=definitions-2:js-moduledeclarationinstantiation data-x-internal=js-moduledeclarationinstantiation>ModuleDeclarationInstantiation</a> on modules that
    failed to instantiate previously.</p>

   <dt>An <dfn id=concept-module-script-instantiation-error>instantiation error</dfn><dd>

    <p>A JavaScript value, which has meaning only if the <a href=#concept-module-script-instantiation-state id=definitions-2:concept-module-script-instantiation-state>instantiation state</a> is "<code>errored</code>".</p>

   <dt>A <dfn id=concept-module-script-credentials-mode>credentials mode</dfn><dd>

    <p>A <a href=https://fetch.spec.whatwg.org/#concept-request-credentials-mode id=definitions-2:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials mode</a> used to fetch
    imported modules.</p>

   <dt>A <dfn id=concept-module-script-nonce>cryptographic nonce</dfn><dd>

    <p>A <a href=https://fetch.spec.whatwg.org/#concept-request-nonce-metadata id=definitions-2:concept-request-nonce-metadata data-x-internal=concept-request-nonce-metadata>cryptographic nonce</a> used to fetch
    imported modules.</p>

   <dt>A <dfn id=concept-module-script-parser>parser state</dfn><dd>

    <p>The <a href=https://fetch.spec.whatwg.org/#concept-request-parser-metadata id=definitions-2:concept-request-parser-metadata data-x-internal=concept-request-parser-metadata>parser metadata</a> used to fetch
    imported modules.</p>

   </dl>

  <hr>

  <p>An <dfn id=environment data-export="">environment</dfn> is an object that identifies the settings of a
  current or potential execution environment. An <a href=#environment id=definitions-2:environment>environment</a> has the following
  fields:</p>

  <dl><dt>An <dfn data-dfn-for=environment id=concept-environment-id data-export="">id</dfn><dd><p>An opaque string that uniquely identifies the <a href=#environment id=definitions-2:environment-2>environment</a>.<dt>A <dfn data-dfn-for=environment id=concept-environment-creation-url data-export="">creation URL</dfn><dd>
    <p>An <a id=definitions-2:absolute-url href=https://url.spec.whatwg.org/#syntax-url-absolute data-x-internal=absolute-url>absolute URL</a> that represents the location of the resource with which the
    <a href=#environment id=definitions-2:environment-3>environment</a> is associated.</p>

    <p class=note>In the case of an <a href=#environment-settings-object id=definitions-2:environment-settings-object-2>environment settings object</a>, this URL might be
    distinct from the <a href=#environment-settings-object id=definitions-2:environment-settings-object-3>environment settings object</a>'s <a href=#responsible-document id=definitions-2:responsible-document>responsible
    document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="definitions-2:the-document's-address" data-x-internal="the-document's-address">URL</a>, due to mechanisms such as
    <code id=definitions-2:dom-history-pushstate><a href=#dom-history-pushstate>history.pushState()</a></code>.</p>
   <dt>A <dfn data-dfn-for=environment id=concept-environment-target-browsing-context data-export="">target browsing context</dfn><dd><p>Null or a target <a href=#browsing-context id=definitions-2:browsing-context>browsing context</a> for a <a href=https://fetch.spec.whatwg.org/#navigation-request id=definitions-2:navigation-request data-x-internal=navigation-request>navigation request</a>.<dt>An <dfn data-dfn-for=environment id=concept-environment-active-service-worker data-export="">active service worker</dfn><dd><p>Null or a <a href=https://w3c.github.io/ServiceWorker/#dfn-service-worker id=definitions-2:dfn-service-worker data-x-internal=dfn-service-worker>service worker</a> that <a href=https://w3c.github.io/ServiceWorker/#dfn-control id=definitions-2:dfn-control data-x-internal=dfn-control>controls</a> the <a href=#environment id=definitions-2:environment-4>environment</a>.<dt>An <dfn data-dfn-for=environment id=concept-environment-execution-ready-flag data-export="">execution ready flag</dfn><dd><p>A flag that indicates whether the environment setup is done. It is initially
   unset.</dl>

  <p>An <dfn id=environment-settings-object data-export="">environment settings object</dfn> is an <a href=#environment id=definitions-2:environment-5>environment</a> that
  additionally specifies algorithms for:</p>

  <dl><dt>A <dfn data-dfn-for="environment settings object" id=realm-execution-context data-export="">realm execution
   context</dfn><dd>

    <p>A <a id=definitions-2:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution context</a> shared by all
    <a href=#the-script-element id=definitions-2:the-script-element>scripts</a> that use this settings object, i.e. all scripts in a given
    <a id=definitions-2:javascript-realm href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a>. When we <a href=#run-a-classic-script id=definitions-2:run-a-classic-script>run a classic script</a> or <a href=#run-a-module-script id=definitions-2:run-a-module-script>run a module
    script</a>, this execution context becomes the top of the <a id=definitions-2:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context
    stack</a>, on top of which another execution context specific to the script in question is
    pushed. (This setup ensures <a href=https://tc39.github.io/ecma262/#sec-parse-script id=definitions-2:js-parsescript data-x-internal=js-parsescript>ParseScript</a> and <a href=https://tc39.github.io/ecma262/#sec-moduleevaluation id=definitions-2:js-moduleevaluation data-x-internal=js-moduleevaluation>ModuleEvaluation</a> know which Realm to use.)</p>

   <dt>A <dfn data-dfn-for="environment
   settings object" id=concept-settings-object-module-map data-export="">module map</dfn><dd>

    <p>A <a href=#module-map id=definitions-2:module-map>module map</a> that is used when importing JavaScript modules.</p>

   <dt>A <dfn data-dfn-for="environment settings object" id=responsible-browsing-context data-export="">responsible browsing
   context</dfn><dd>

    <p>A <a href=#browsing-context id=definitions-2:browsing-context-2>browsing context</a> that is assigned responsibility for actions taken by the
    scripts that use this <a href=#environment-settings-object id=definitions-2:environment-settings-object-4>environment settings object</a>.</p>

    <p class=example>When a script creates and <a href=#navigate id=definitions-2:navigate>navigates</a> a new
    <a href=#top-level-browsing-context id=definitions-2:top-level-browsing-context>top-level browsing context</a>, the <code id=definitions-2:dom-opener><a href=#dom-opener>opener</a></code> attribute
    of the new <a href=#browsing-context id=definitions-2:browsing-context-3>browsing context</a>'s <code id=definitions-2:window><a href=#window>Window</a></code> object will be set to the
    <a href=#responsible-browsing-context id=definitions-2:responsible-browsing-context>responsible browsing context</a>'s <code id=definitions-2:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</p>

   <dt>A <dfn data-dfn-for="environment settings object" id=responsible-event-loop data-export="">responsible event
   loop</dfn><dd>

    <p>An <a href=#event-loop id=definitions-2:event-loop>event loop</a> that is used when it would not be immediately clear what event
    loop to use.</p>

   <dt>A <dfn data-dfn-for="environment settings object" id=responsible-document data-export="">responsible document</dfn><dd>

    <p>A <code id=definitions-2:document><a href=#document>Document</a></code> that is assigned responsibility for actions taken by the scripts that
    use this <a href=#environment-settings-object id=definitions-2:environment-settings-object-5>environment settings object</a>.</p>

    <p class=example>For example, the <a href=https://dom.spec.whatwg.org/#concept-document-url id="definitions-2:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the
    <a href=#responsible-document id=definitions-2:responsible-document-2>responsible document</a> is used to set the <a href=https://dom.spec.whatwg.org/#concept-document-url id="definitions-2:the-document's-address-3" data-x-internal="the-document's-address">URL</a> of the <code id=definitions-2:document-2><a href=#document>Document</a></code> after it has been reset
    using <code id=definitions-2:dom-document-open><a href=#dom-document-open>document.open()</a></code>.</p>

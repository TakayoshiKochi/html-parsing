  </div>

  <div class=example>

   <p>This example shows a site's contact details (using the <code id=examples-2:the-address-element><a href=#the-address-element>address</a></code> element)
   containing an address with two street components:</p>

   <pre>&lt;address itemscope itemtype="http://microformats.org/profile/hcard">
 &lt;strong itemprop="fn">&lt;span itemprop="n" itemscope>&lt;span itemprop="given-name">Alfred&lt;/span>
 &lt;span itemprop="family-name">Person&lt;/span>&lt;/span>&lt;/strong> &lt;br>
 &lt;span itemprop="adr" itemscope>
  &lt;span itemprop="street-address">1600 Amphitheatre Parkway&lt;/span> &lt;br>
  &lt;span itemprop="street-address">Building 43, Second Floor&lt;/span> &lt;br>
  &lt;span itemprop="locality">Mountain View&lt;/span>,
   &lt;span itemprop="region">CA&lt;/span> &lt;span itemprop="postal-code">94043&lt;/span>
 &lt;/span>
&lt;/address></pre>

  </div>

  <div class=example>

   <p>The vCard vocabulary can be used to just mark up people's names:</p>

   <pre>&lt;span itemscope itemtype="http://microformats.org/profile/hcard"
>&lt;span itemprop=fn>&lt;span itemprop="n" itemscope>&lt;span itemprop="given-name"
>George&lt;/span> &lt;span itemprop="family-name">Washington&lt;/span>&lt;/span
>&lt;/span>&lt;/span></pre>

   <p>This creates a single item with a two name-value pairs, one with the name "fn" and the value
   "George Washington", and the other with the name "n" and a second item as its value, the second
   item having the two name-value pairs "given-name" and "family-name" with the values "George" and
   "Washington" respectively. This is defined to map to the following vCard:</p>

   <pre>BEGIN:VCARD
PROFILE:VCARD
VERSION:4.0
SOURCE:<var>document's address</var>
FN:George Washington
N:Washington;George;;;
END:VCARD</pre>

  </div>


  <h4 id=vevent>5.3.2 vEvent<a href=#vevent class=self-link></a></h4>

  <p>An item with the <a href=#item-types id=vevent:item-types>item type</a> <dfn id=md-vevent><code>http://microformats.org/profile/hcalendar#vevent</code></dfn> represents
  an event.</p>

  <p>This vocabulary does not <a href=#support-global-identifiers-for-items id=vevent:support-global-identifiers-for-items>support global identifiers for items</a>.</p>

  <p>The following are the type's <a href=#defined-property-name id=vevent:defined-property-name>defined property names</a>.
  They are based on the vocabulary defined in the iCalendar specification, where more information on
  how to interpret the values can be found. <a href=#refsRFC5545>[RFC5545]</a></p>

  <p class=note>Only the parts of the iCalendar vocabulary relating to events are used here; this
  vocabulary cannot express a complete iCalendar instance.</p>

  <dl><dt><dfn id=md-vevent-attach><code>attach</code></dfn><dd>

    <p>Gives the address of an associated document for the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value>value</a> must be an <a id=vevent:absolute-url href=https://url.spec.whatwg.org/#syntax-url-absolute data-x-internal=absolute-url>absolute
    URL</a>.</p>

    <p>Any number of properties with the name <code id=vevent:md-vevent-attach><a href=#md-vevent-attach>attach</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item>item</a> with the type <code id=vevent:md-vevent><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-categories><code>categories</code></dfn><dd>

    <p>Gives the name of a category or tag that the event could be classified as.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-2>value</a> must be text.</p>

    <p>Any number of properties with the name <code id=vevent:md-vevent-categories><a href=#md-vevent-categories>categories</a></code>
    may be present within each <a href=#concept-item id=vevent:concept-item-2>item</a> with the type <code id=vevent:md-vevent-2><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-class><code>class</code></dfn><dd>

    <p>Gives the access classification of the information regarding the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-3>value</a> must be text with one of the following
    values:</p>

    <ul class=brief><li><code>public</code><li><code>private</code><li><code>confidential</code></ul>

    <p class=warning>This is merely advisory and cannot be considered a confidentiality
    measure.</p>

    <p>A single property with the name <code id=vevent:md-vevent-class><a href=#md-vevent-class>class</a></code> may be present
    within each <a href=#concept-item id=vevent:concept-item-3>item</a> with the type <code id=vevent:md-vevent-3><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-comment><code>comment</code></dfn><dd>

    <p>Gives a comment regarding the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-4>value</a> must be text.</p>

    <p>Any number of properties with the name <code id=vevent:md-vevent-comment><a href=#md-vevent-comment>comment</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-4>item</a> with the type <code id=vevent:md-vevent-4><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-description><code>description</code></dfn><dd>

    <p>Gives a detailed description of the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-5>value</a> must be text.</p>

    <p>A single property with the name <code id=vevent:md-vevent-description><a href=#md-vevent-description>description</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-5>item</a> with the type <code id=vevent:md-vevent-5><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-geo><code>geo</code></dfn><dd>

    <p>Gives the geographical position of the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-6>value</a> must be text and must match the
    following syntax:</p>

    <ol><li>Optionally, either a U+002B PLUS SIGN character (+) or a U+002D HYPHEN-MINUS character
     (-).<li>One or more <a href=#ascii-digits id=vevent:ascii-digits>ASCII digits</a>.<li>Optionally*, a U+002E FULL STOP character (.) followed by one or more <a href=#ascii-digits id=vevent:ascii-digits-2>ASCII
     digits</a>.<li>A U+003B SEMICOLON character (;).<li>Optionally, either a U+002B PLUS SIGN character (+) or a U+002D HYPHEN-MINUS character
     (-).<li>One or more <a href=#ascii-digits id=vevent:ascii-digits-3>ASCII digits</a>.<li>Optionally*, a U+002E FULL STOP character (.) followed by one or more <a href=#ascii-digits id=vevent:ascii-digits-4>ASCII
     digits</a>.</ol>

    <p>The optional components marked with an asterisk (*) should be included, and should have six
    digits each.</p> 

    
    <p class=note>The value specifies latitude and longitude, in that order (i.e., "LAT LON"
    ordering), in decimal degrees. The longitude represents the location east and west of the prime
    meridian as a positive or negative real number, respectively. The latitude represents the
    location north and south of the equator as a positive or negative real number, respectively.</p>

    <p>A single property with the name <code id=vevent:md-vevent-geo><a href=#md-vevent-geo>geo</a></code> may be present within
    each <a href=#concept-item id=vevent:concept-item-6>item</a> with the type <code id=vevent:md-vevent-6><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-location><code>location</code></dfn><dd>

    <p>Gives the location of the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-7>value</a> must be text.</p> 

    <p>A single property with the name <code id=vevent:md-vevent-location><a href=#md-vevent-location>location</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-7>item</a> with the type <code id=vevent:md-vevent-7><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-resources><code>resources</code></dfn><dd>

    <p>Gives a resource that will be needed for the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-8>value</a> must be text.</p> 

    <p>Any number of properties with the name <code id=vevent:md-vevent-resources><a href=#md-vevent-resources>resources</a></code> may
    be present within each <a href=#concept-item id=vevent:concept-item-8>item</a> with the type <code id=vevent:md-vevent-8><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-status><code>status</code></dfn><dd>

    <p>Gives the confirmation status of the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-9>value</a> must be text with one of the following
    values:</p>

    <ul class=brief><li><code>tentative</code><li><code>confirmed</code><li><code>cancelled</code></ul>

    <p>A single property with the name <code id=vevent:md-vevent-status><a href=#md-vevent-status>status</a></code> may be present
    within each <a href=#concept-item id=vevent:concept-item-9>item</a> with the type <code id=vevent:md-vevent-9><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-summary><code>summary</code></dfn><dd>

    <p>Gives a short summary of the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-10>value</a> must be text.</p>

    <p>User agents should replace U+000A LINE FEED (LF) characters in the <a href=#concept-property-value id=vevent:concept-property-value-11>value</a> by U+0020 SPACE characters when using the value.</p>

    <p>A single property with the name <code id=vevent:md-vevent-summary><a href=#md-vevent-summary>summary</a></code> may be present
    within each <a href=#concept-item id=vevent:concept-item-10>item</a> with the type <code id=vevent:md-vevent-10><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-dtend><code>dtend</code></dfn><dd>

    <p>Gives the date and time by which the event ends.</p>

    <p>If the property with the name <code id=vevent:md-vevent-dtend><a href=#md-vevent-dtend>dtend</a></code> is present within an
    <a href=#concept-item id=vevent:concept-item-11>item</a> with the type <code id=vevent:md-vevent-11><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code> that has a property
    with the name <code id=vevent:md-vevent-dtstart><a href=#md-vevent-dtstart>dtstart</a></code> whose value is a <a href=#valid-date-string id=vevent:valid-date-string>valid date
    string</a>, then the <a href=#concept-property-value id=vevent:concept-property-value-12>value</a> of the property with
    the name <code id=vevent:md-vevent-dtend-2><a href=#md-vevent-dtend>dtend</a></code> must be text that is a <a href=#valid-date-string id=vevent:valid-date-string-2>valid date
    string</a> also. Otherwise, the <a href=#concept-property-value id=vevent:concept-property-value-13>value</a> of the
    property must be text that is a <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string>valid global date and time string</a>.</p>

    <p>In either case, the <a href=#concept-property-value id=vevent:concept-property-value-14>value</a> be later in time than
    the value of the <code id=vevent:md-vevent-dtstart-2><a href=#md-vevent-dtstart>dtstart</a></code> property of the same <a href=#concept-item id=vevent:concept-item-12>item</a>.</p>

    <p class=note>The time given by the <code id=vevent:md-vevent-dtend-3><a href=#md-vevent-dtend>dtend</a></code> property is not
    inclusive. For day-long events, therefore, the <code id=vevent:md-vevent-dtend-4><a href=#md-vevent-dtend>dtend</a></code>
    property's <a href=#concept-property-value id=vevent:concept-property-value-15>value</a> will be the day <em>after</em> the
    end of the event.</p>

    <p>A single property with the name <code id=vevent:md-vevent-dtend-5><a href=#md-vevent-dtend>dtend</a></code> may be present
    within each <a href=#concept-item id=vevent:concept-item-13>item</a> with the type <code id=vevent:md-vevent-12><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>, so long as that <code id=vevent:md-vevent-13><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code> does not have a
    property with the name <code id=vevent:md-vevent-duration><a href=#md-vevent-duration>duration</a></code>.</p>

   <dt><dfn id=md-vevent-dtstart><code>dtstart</code></dfn><dd>

    <p>Gives the date and time at which the event starts.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-16>value</a> must be text that is either a
    <a href=#valid-date-string id=vevent:valid-date-string-3>valid date string</a> or a <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-2>valid global date and time string</a>.</p>

    <p>Exactly one property with the name <code id=vevent:md-vevent-dtstart-3><a href=#md-vevent-dtstart>dtstart</a></code> must be
    present within each <a href=#concept-item id=vevent:concept-item-14>item</a> with the type <code id=vevent:md-vevent-14><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-duration><code>duration</code></dfn><dd>

    <p>Gives the duration of the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-17>value</a> must be text that is a <a href=#valid-vevent-duration-string id=vevent:valid-vevent-duration-string>valid
    vevent duration string</a>.</p>

    <p>The duration represented is the sum of all the durations represented by integers in the
    value.</p>

    <p>A single property with the name <code id=vevent:md-vevent-duration-2><a href=#md-vevent-duration>duration</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-15>item</a> with the type <code id=vevent:md-vevent-15><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>, so long as that <code id=vevent:md-vevent-16><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code> does not have a
    property with the name <code id=vevent:md-vevent-dtend-6><a href=#md-vevent-dtend>dtend</a></code>.</p>

   <dt><dfn id=md-vevent-transp><code>transp</code></dfn><dd>

    <p>Gives whether the event is to be considered as consuming time on a calendar, for the purpose
    of free-busy time searches.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-18>value</a> must be text with one of the following
    values:</p>

    <ul class=brief><li><code>opaque</code><li><code>transparent</code></ul>

    <p>A single property with the name <code id=vevent:md-vevent-transp><a href=#md-vevent-transp>transp</a></code> may be present
    within each <a href=#concept-item id=vevent:concept-item-16>item</a> with the type <code id=vevent:md-vevent-17><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-contact><code>contact</code></dfn><dd>

    <p>Gives the contact information for the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-19>value</a> must be text.</p> 

    <p>Any number of properties with the name <code id=vevent:md-vevent-contact><a href=#md-vevent-contact>contact</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-17>item</a> with the type <code id=vevent:md-vevent-18><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-url><code>url</code></dfn><dd>

    <p>Gives a <a id=vevent:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> for the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-20>value</a> must be an <a id=vevent:absolute-url-2 href=https://url.spec.whatwg.org/#syntax-url-absolute data-x-internal=absolute-url>absolute
    URL</a>.</p>

    <p>A single property with the name <code id=vevent:md-vevent-url><a href=#md-vevent-url>url</a></code> may be present within
    each <a href=#concept-item id=vevent:concept-item-18>item</a> with the type <code id=vevent:md-vevent-19><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-uid><code>uid</code></dfn><dd>

    <p>Gives a globally unique identifier corresponding to the event.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-21>value</a> must be text.</p>

    <p>A single property with the name <code id=vevent:md-vevent-uid><a href=#md-vevent-uid>uid</a></code> may be present within
    each <a href=#concept-item id=vevent:concept-item-19>item</a> with the type <code id=vevent:md-vevent-20><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-exdate><code>exdate</code></dfn><dd>

    <p>Gives a date and time at which the event does not occur despite the recurrence rules.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-22>value</a> must be text that is either a
    <a href=#valid-date-string id=vevent:valid-date-string-4>valid date string</a> or a <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-3>valid global date and time string</a>.</p>

    <p>Any number of properties with the name <code id=vevent:md-vevent-exdate><a href=#md-vevent-exdate>exdate</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-20>item</a> with the type <code id=vevent:md-vevent-21><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-rdate><code>rdate</code></dfn><dd>

    <p>Gives a date and time at which the event recurs.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-23>value</a> must be text that is one of the
    following:

    <ul><li>A <a href=#valid-date-string id=vevent:valid-date-string-5>valid date string</a>.<li>A <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-4>valid global date and time string</a>.<li>A <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-5>valid global date and time string</a> followed by a U+002F SOLIDUS character (/)
     followed by a second <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-6>valid global date and time string</a> representing a later
     time.<li>A <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-7>valid global date and time string</a> followed by a U+002F SOLIDUS character (/)
     followed by a <a href=#valid-vevent-duration-string id=vevent:valid-vevent-duration-string-2>valid vevent duration string</a>.</ul>

    <p>Any number of properties with the name <code id=vevent:md-vevent-rdate><a href=#md-vevent-rdate>rdate</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-21>item</a> with the type <code id=vevent:md-vevent-22><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-rrule><code>rrule</code></dfn><dd>

    <p>Gives a rule for finding dates and times at which the event occurs.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-24>value</a> must be text that matches the RECUR
    value type defined in the iCalendar specification. <a href=#refsRFC5545>[RFC5545]</a></p>

    <p>A single property with the name <code id=vevent:md-vevent-rrule><a href=#md-vevent-rrule>rrule</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-22>item</a> with the type <code id=vevent:md-vevent-23><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-created><code>created</code></dfn><dd>

    <p>Gives the date and time at which the event information was first created in a calendaring
    system.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-25>value</a> must be text that is a <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-8>valid
    global date and time string</a>.</p>

    <p>A single property with the name <code id=vevent:md-vevent-created><a href=#md-vevent-created>created</a></code> may be present
    within each <a href=#concept-item id=vevent:concept-item-23>item</a> with the type <code id=vevent:md-vevent-24><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-last-modified><code>last-modified</code></dfn><dd>

    <p>Gives the date and time at which the event information was last modified in a calendaring
    system.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-26>value</a> must be text that is a <a href=#valid-global-date-and-time-string id=vevent:valid-global-date-and-time-string-9>valid
    global date and time string</a>.</p>

    <p>A single property with the name <code id=vevent:md-vevent-last-modified><a href=#md-vevent-last-modified>last-modified</a></code>
    may be present within each <a href=#concept-item id=vevent:concept-item-24>item</a> with the type <code id=vevent:md-vevent-25><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   <dt><dfn id=md-vevent-sequence><code>sequence</code></dfn><dd>

    <p>Gives a revision number for the event information.</p>

    <p>The <a href=#concept-property-value id=vevent:concept-property-value-27>value</a> must be text that is a <a href=#valid-non-negative-integer id=vevent:valid-non-negative-integer>valid
    non-negative integer</a>.</p>

    <p>A single property with the name <code id=vevent:md-vevent-sequence><a href=#md-vevent-sequence>sequence</a></code> may be
    present within each <a href=#concept-item id=vevent:concept-item-25>item</a> with the type <code id=vevent:md-vevent-26><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>.</p>

   </dl>

  <p>A string is a <dfn id=valid-vevent-duration-string>valid vevent duration string</dfn> if it matches the following pattern:</p>

  <ol><li>A U+0050 LATIN CAPITAL LETTER P character (P).<li>One of the following:

    <ul><li> A <a href=#valid-non-negative-integer id=vevent:valid-non-negative-integer-2>valid non-negative integer</a> followed by a U+0057 LATIN CAPITAL LETTER W
     character (W). The integer represents a duration of that number of weeks. <li> At least one, and possible both in this order, of the following:

      <ol><li> A <a href=#valid-non-negative-integer id=vevent:valid-non-negative-integer-3>valid non-negative integer</a> followed by a U+0044 LATIN CAPITAL LETTER D
       character (D). The integer represents a duration of that number of days. <li> A U+0054 LATIN CAPITAL LETTER T character (T) followed by any one of the following, or
       the first and second of the following in that order, or the second and third of the following
       in that order, or all three of the following in this order:

        <ol><li> A <a href=#valid-non-negative-integer id=vevent:valid-non-negative-integer-4>valid non-negative integer</a> followed by a U+0048 LATIN CAPITAL LETTER H
         character (H). The integer represents a duration of that number of hours. <li> A <a href=#valid-non-negative-integer id=vevent:valid-non-negative-integer-5>valid non-negative integer</a> followed by a U+004D LATIN CAPITAL LETTER M
         character (M). The integer represents a duration of that number of minutes. <li> A <a href=#valid-non-negative-integer id=vevent:valid-non-negative-integer-6>valid non-negative integer</a> followed by a U+0053 LATIN CAPITAL LETTER S
         character (S). The integer represents a duration of that number of seconds. </ol>

      </ol>

     </ul>

   </ol>


  <h5 id=conversion-to-icalendar>5.3.2.1 Conversion to iCalendar<a href=#conversion-to-icalendar class=self-link></a></h5>

  <p>Given a list of nodes <var>nodes</var> in a <code id=conversion-to-icalendar:document><a href=#document>Document</a></code>, a user agent must
  run the following algorithm to <dfn id=extracting-vevent-data>extract any vEvent data
  represented by those nodes</dfn>:</p>

  <ol><li><p>If none of the nodes in <var>nodes</var> are <a href=#concept-item id=conversion-to-icalendar:concept-item>items</a> with the type <code id=conversion-to-icalendar:md-vevent><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>, then there is no
   vEvent data. Abort the algorithm, returning nothing.<li><p>Let <var>output</var> be an empty string.<li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line>Add an iCalendar line</a> with the type "<code>BEGIN</code>" and the
   value "<code>VCALENDAR</code>" to <var>output</var>.<li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-2>Add an iCalendar line</a> with the type "<code>PRODID</code>" and the
   value equal to a user-agent-specific string representing the user agent to <var>output</var>.<li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-3>Add an iCalendar line</a> with the type "<code>VERSION</code>" and the
   value "<code>2.0</code>" to <var>output</var>.<li>

    <p>For each node <var>node</var> in <var>nodes</var> that is an <a href=#concept-item id=conversion-to-icalendar:concept-item-2>item</a> with the type <code id=conversion-to-icalendar:md-vevent-2><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code>, run the following
    steps:</p>

    <ol><li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-4>Add an iCalendar line</a> with the type "<code>BEGIN</code>" and the
     value "<code>VEVENT</code>" to <var>output</var>.<li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-5>Add an iCalendar line</a> with the type "<code>DTSTAMP</code>" and a
     value consisting of an iCalendar DATE-TIME string representing the current date and time, with
     the annotation "<code>VALUE=DATE-TIME</code>", to <var>output</var>. <a href=#refsRFC5545>[RFC5545]</a><li>

      <p>For each element <var>element</var> that is <a href=#the-properties-of-an-item id=conversion-to-icalendar:the-properties-of-an-item>a property of the item</a> <var>node</var>: for each name <var>name</var> in <var>element</var>'s <a href=#property-names id=conversion-to-icalendar:property-names>property names</a>, run the
      appropriate set of substeps from the following list:</p>

      <dl><dt>If the property's <a href=#concept-property-value id=conversion-to-icalendar:concept-property-value>value</a> is an <a href=#concept-item id=conversion-to-icalendar:concept-item-3>item</a><dd>

        <p>Skip the property.</p>

       <dt>If the property is <code id=conversion-to-icalendar:md-vevent-dtend><a href=#md-vevent-dtend>dtend</a></code><dt>If the property is <code id=conversion-to-icalendar:md-vevent-dtstart><a href=#md-vevent-dtstart>dtstart</a></code><dt>If the property is <code id=conversion-to-icalendar:md-vevent-exdate><a href=#md-vevent-exdate>exdate</a></code><dt>If the property is <code id=conversion-to-icalendar:md-vevent-rdate><a href=#md-vevent-rdate>rdate</a></code><dt>If the property is <code id=conversion-to-icalendar:md-vevent-created><a href=#md-vevent-created>created</a></code><dt>If the property is <code id=conversion-to-icalendar:md-vevent-last-modified><a href=#md-vevent-last-modified>last-modified</a></code><dd>

        <p>Let <var>value</var> be the result of stripping all U+002D HYPHEN-MINUS (-) and
        U+003A COLON (:) characters from the property's <a href=#concept-property-value id=conversion-to-icalendar:concept-property-value-2>value</a>.</p>

        <p>If the property's <a href=#concept-property-value id=conversion-to-icalendar:concept-property-value-3>value</a> is a <a href=#valid-date-string id=conversion-to-icalendar:valid-date-string>valid date
        string</a> then <a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-6>add an iCalendar line</a> with the type <var>name</var>
        and the value <var>value</var> to <var>output</var>, with the annotation
        "<code>VALUE=DATE</code>".</p>

        <p>Otherwise, if the property's <a href=#concept-property-value id=conversion-to-icalendar:concept-property-value-4>value</a> is a
        <a href=#valid-global-date-and-time-string id=conversion-to-icalendar:valid-global-date-and-time-string>valid global date and time string</a> then <a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-7>add an iCalendar line</a> with
        the type <var>name</var> and the value <var>value</var> to <var>output</var>, with the annotation "<code>VALUE=DATE-TIME</code>".</p>

        <p>Otherwise skip the property.</p>

       <dt>Otherwise<dd>

        <p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-8>Add an iCalendar line</a> with the type <var>name</var> and the
        property's <a href=#concept-property-value id=conversion-to-icalendar:concept-property-value-5>value</a> to <var>output</var>.</p>

       </dl>

     <li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-9>Add an iCalendar line</a> with the type "<code>END</code>" and the
     value "<code>VEVENT</code>" to <var>output</var>.</ol>

   <li><p><a href=#add-an-icalendar-line id=conversion-to-icalendar:add-an-icalendar-line-10>Add an iCalendar line</a> with the type "<code>END</code>" and the value
   "<code>VCALENDAR</code>" to <var>output</var>.</ol>

  <p>When the above algorithm says that the user agent is to <dfn id=add-an-icalendar-line>add an iCalendar line</dfn>
  consisting of a type <var>type</var>, a value <var>value</var>, and optionally
  an annotation, to a string <var>output</var>, it must run the following steps:</p>

  <ol><li><p>Let <var>line</var> be an empty string.<li><p>Append <var>type</var>, <a id=conversion-to-icalendar:converted-to-ascii-uppercase href=https://infra.spec.whatwg.org/#ascii-uppercase data-x-internal=converted-to-ascii-uppercase>converted to ASCII uppercase</a>, to <var>line</var>.<li>

    <p>If there is an annotation:</p>

    <ol><li><p>Append a U+003B SEMICOLON character (;) to <var>line</var>.<li><p>Append the annotation to <var>line</var>.</ol>

   <li><p>Append a U+003A COLON character (:) to <var>line</var>.<li><p>Prefix every U+005C REVERSE SOLIDUS character (\) in <var>value</var> with
   another U+005C REVERSE SOLIDUS character (\).<li><p>Prefix every U+002C COMMA character (,) in <var>value</var> with a U+005C REVERSE
   SOLIDUS character (\).<li><p>Prefix every U+003B SEMICOLON character (;) in <var>value</var> with a U+005C
   REVERSE SOLIDUS character (\).<li><p>Replace every U+000D CARRIAGE RETURN U+000A LINE FEED character pair (CRLF) in <var>value</var> with a U+005C REVERSE SOLIDUS character (\) followed by a U+006E LATIN SMALL
   LETTER N character (n).<li><p>Replace every remaining U+000D CARRIAGE RETURN (CR) or U+000A LINE FEED (LF) character in
   <var>value</var> with a U+005C REVERSE SOLIDUS character (\) followed by a U+006E LATIN
   SMALL LETTER N character (n).<li><p>Append <var>value</var> to <var>line</var>.<li><p>Let <var>maximum length</var> be 75.<li>

    <p>If and while <var>line</var> is longer than <var>maximum length</var>
    Unicode code points long, run the following substeps:</p>

    <ol><li><p>Append the first <var>maximum length</var> Unicode code points of <var>line</var> to <var>output</var>.<li><p>Remove the first <var>maximum length</var> Unicode code points from <var>line</var>.<li><p>Append a U+000D CARRIAGE RETURN character (CR) to <var>output</var>.<li><p>Append a U+000A LINE FEED character (LF) to <var>output</var>.<li><p>Append a U+0020 SPACE character to <var>output</var>.<li><p>Let <var>maximum length</var> be 74.</ol>

   <li><p>Append (what remains of) <var>line</var> to <var>output</var>.<li><p>Append a U+000D CARRIAGE RETURN character (CR) to <var>output</var>.<li><p>Append a U+000A LINE FEED character (LF) to <var>output</var>.</ol>

  <p class=note>This algorithm can generate invalid iCalendar output, if the input does not
  conform to the rules described for the <code id=conversion-to-icalendar:md-vevent-3><a href=#md-vevent>http://microformats.org/profile/hcalendar#vevent</a></code> <a href=#item-types id=conversion-to-icalendar:item-types>item type</a> and <a href=#defined-property-name id=conversion-to-icalendar:defined-property-name>defined property names</a>.</p>
  



  <h5 id=examples-3>5.3.2.2 Examples<a href=#examples-3 class=self-link></a></h5>

  <p><i>This section is non-normative.</i></p>



  <div class=example>

   <p>Here is an example of a page that uses the vEvent vocabulary to mark up an event:</p>

   <pre>&lt;body itemscope itemtype="http://microformats.org/profile/hcalendar#vevent">
 ...
 &lt;h1 itemprop="summary">Bluesday Tuesday: Money Road&lt;/h1>
 ...
 &lt;time itemprop="dtstart" datetime="2009-05-05T19:00:00Z">May 5th @ 7pm&lt;/time>
 (until &lt;time itemprop="dtend" datetime="2009-05-05T21:00:00Z">9pm&lt;/time>)
 ...
 &lt;a href="http://livebrum.co.uk/2009/05/05/bluesday-tuesday-money-road"
    rel="bookmark" itemprop="url">Link to this page&lt;/a>
 ...
 &lt;p>Location: &lt;span itemprop="location">The RoadHouse&lt;/span>&lt;/p>
 ...
 &lt;p>&lt;input type=button value="Add to Calendar"
           onclick="location = getCalendar(this)">&lt;/p>
 ...
 &lt;meta itemprop="description" content="via livebrum.co.uk">
&lt;/body></pre>

   <p>The <code>getCalendar()</code> function is left as an exercise for the reader.</p>

   <p>The same page could offer some markup, such as the following,
   for copy-and-pasting into blogs:</p>

   <pre>&lt;div itemscope itemtype="http://microformats.org/profile/hcalendar#vevent">
 &lt;p>I'm going to
 &lt;strong itemprop="summary">Bluesday Tuesday: Money Road&lt;/strong>,
 &lt;time itemprop="dtstart" datetime="2009-05-05T19:00:00Z">May 5th at 7pm&lt;/time>
 to &lt;time itemprop="dtend" datetime="2009-05-05T21:00:00Z">9pm&lt;/time>,
 at &lt;span itemprop="location">The RoadHouse&lt;/span>!&lt;/p>
 &lt;p>&lt;a href="http://livebrum.co.uk/2009/05/05/bluesday-tuesday-money-road"
       itemprop="url">See this event on livebrum.co.uk&lt;/a>.&lt;/p>
 &lt;meta itemprop="description" content="via livebrum.co.uk">
&lt;/div></pre>

  </div>


  <h4 id=licensing-works>5.3.3 Licensing works<a href=#licensing-works class=self-link></a></h4>

  <p>An item with the <a href=#item-types id=licensing-works:item-types>item type</a> <dfn id=md-work><code>http://n.whatwg.org/work</code></dfn> represents a work (e.g. an article, an
  image, a video, a song, etc). This type is primarily intended to allow authors to include
  licensing information for works.</p>

  <p>The following are the type's <a href=#defined-property-name id=licensing-works:defined-property-name>defined property
  names</a>.</p>

  <dl><dt><dfn id=md-work-work><code>work</code></dfn><dd>

    <p>Identifies the work being described.</p>

    <p>The <a href=#concept-property-value id=licensing-works:concept-property-value>value</a> must be an <a id=licensing-works:absolute-url href=https://url.spec.whatwg.org/#syntax-url-absolute data-x-internal=absolute-url>absolute
    URL</a>.</p>

    <p>Exactly one property with the name <code id=licensing-works:md-work-work><a href=#md-work-work>work</a></code> must be present
    within each <a href=#concept-item id=licensing-works:concept-item>item</a> with the type <code id=licensing-works:md-work><a href=#md-work>http://n.whatwg.org/work</a></code>.</p>

   <dt><dfn id=md-work-title><code>title</code></dfn><dd>

    <p>Gives the name of the work.</p>

    <p>A single property with the name <code id=licensing-works:md-work-title><a href=#md-work-title>title</a></code> may be present
    within each <a href=#concept-item id=licensing-works:concept-item-2>item</a> with the type <code id=licensing-works:md-work-2><a href=#md-work>http://n.whatwg.org/work</a></code>.</p>

   <dt><dfn id=md-work-author><code>author</code></dfn><dd>

    <p>Gives the name or contact information of one of the authors or creators of the work.</p>

    <p>The <a href=#concept-property-value id=licensing-works:concept-property-value-2>value</a> must be either an <a href=#concept-item id=licensing-works:concept-item-3>item</a> with the type <code id=licensing-works:md-vcard><a href=#md-vcard>http://microformats.org/profile/hcard</a></code>, or text.</p>

    <p>Any number of properties with the name <code id=licensing-works:md-work-author><a href=#md-work-author>author</a></code> may be
    present within each <a href=#concept-item id=licensing-works:concept-item-4>item</a> with the type <code id=licensing-works:md-work-3><a href=#md-work>http://n.whatwg.org/work</a></code>.</p>

   <dt><dfn id=md-work-license><code>license</code></dfn><dd>

    <p>Identifies one of the licenses under which the work is available.</p>

    <p>The <a href=#concept-property-value id=licensing-works:concept-property-value-3>value</a> must be an <a id=licensing-works:absolute-url-2 href=https://url.spec.whatwg.org/#syntax-url-absolute data-x-internal=absolute-url>absolute
    URL</a>.</p>

    <p>Any number of properties with the name <code id=licensing-works:md-work-license><a href=#md-work-license>license</a></code> may be
    present within each <a href=#concept-item id=licensing-works:concept-item-5>item</a> with the type <code id=licensing-works:md-work-4><a href=#md-work>http://n.whatwg.org/work</a></code>.</p>

   </dl>




  <h5 id=examples-4>5.3.3.1 Examples<a href=#examples-4 class=self-link></a></h5>

  <p><i>This section is non-normative.</i></p>

  <div class=example>

   <p>This example shows an embedded image entitled <cite>My Pond</cite>, licensed under the
   Creative Commons Attribution-Share Alike 4.0 International License and the MIT license
   simultaneously.</p>

   <pre>&lt;figure <strong>itemscope itemtype="http://n.whatwg.org/work"</strong>>
 &lt;img <strong>itemprop="work"</strong> src="mypond.jpeg">
 &lt;figcaption>
  &lt;p>&lt;cite <strong>itemprop="title"</strong>>My Pond&lt;/cite>&lt;/p>
  &lt;p>&lt;small>Licensed under the &lt;a <strong>itemprop="license"</strong>
  href="https://creativecommons.org/licenses/by-sa/4.0/">Creative
  Commons Attribution-Share Alike 4.0 International License&lt;/a>
  and the &lt;a <strong>itemprop="license"</strong>
  href="http://www.opensource.org/licenses/mit-license.php">MIT
  license&lt;/a>.&lt;/small>
 &lt;/figcaption>
&lt;/figure></pre>

  </div>


  

  <h3 id=converting-html-to-other-formats>5.4 Converting HTML to other formats<a href=#converting-html-to-other-formats class=self-link></a></h3>

  <h4 id=json>5.4.1 JSON<a href=#json class=self-link></a></h4>

  <p>Given a list of nodes <var>nodes</var> in a <code id=json:document><a href=#document>Document</a></code>, a user agent must
  run the following algorithm to <dfn id=extracting-json>extract the microdata from those nodes
  into a JSON form</dfn>:</p>

  <ol><li><p>Let <var>result</var> be an empty object.<li><p>Let <var>items</var> be an empty array.<li><p>For each <var>node</var> in <var>nodes</var>, check if the element is a
   <a href=#top-level-microdata-items id=json:top-level-microdata-items>top-level microdata item</a>, and if it is then
   <a href=#get-the-object id=json:get-the-object>get the object</a> for that element and add it to <var>items</var>.<li><p>Add an entry to <var>result</var> called "<code>items</code>" whose
   value is the array <var>items</var>.<li><p>Return the result of serializing <var>result</var> to JSON in the shortest
   possible way (meaning no whitespace between tokens, no unnecessary zero digits in numbers, and
   only using Unicode escapes in strings for characters that do not have a dedicated escape
   sequence), and with a lowercase "<code>e</code>" used, when appropriate, in the
   representation of any numbers. <a href=#refsJSON>[JSON]</a></ol>

  <p class=note>This algorithm returns an object with a single property that is an array, instead
  of just returning an array, so that it is possible to extend the algorithm in the future if
  necessary.</p>

  <p>When the user agent is to <dfn id=get-the-object>get the object</dfn> for an item <var>item</var>,
  optionally with a list of elements <var>memory</var>, it must run the following
  substeps:</p>

  <ol><li><p>Let <var>result</var> be an empty object.<li><p>If no <var>memory</var> was passed to the algorithm, let <var>memory</var> be an empty list.<li><p>Add <var>item</var> to <var>memory</var>.<li><p>If the <var>item</var> has any <a href=#item-types id=json:item-types>item types</a>, add an entry to <var>result</var> called "<code>type</code>" whose value is an array listing the
   <a href=#item-types id=json:item-types-2>item types</a> of <var>item</var>, in the order they were specified on the
   <code id=json:attr-itemtype><a href=#attr-itemtype>itemtype</a></code> attribute.</p>

   <li><p>If the <var>item</var> has a <a href=#global-identifier id=json:global-identifier>global identifier</a>, add an entry to <var>result</var> called "<code>id</code>" whose value is the <a href=#global-identifier id=json:global-identifier-2>global
   identifier</a> of <var>item</var>.<li><p>Let <var>properties</var> be an empty object.<li>

    <p>For each element <var>element</var> that has one or more <a href=#property-names id=json:property-names>property names</a>
    and is one of <a href=#the-properties-of-an-item id=json:the-properties-of-an-item>the properties of the item</a> <var>item</var>, in the order those elements are given by the algorithm that returns
    <a href=#the-properties-of-an-item id=json:the-properties-of-an-item-2>the properties of an item</a>, run the following substeps:</p>

    <ol><li><p>Let <var>value</var> be the <a href=#concept-property-value id=json:concept-property-value>property
     value</a> of <var>element</var>.<li><p>If <var>value</var> is an <a href=#concept-item id=json:concept-item>item</a>, then: If <var>value</var> is in <var>memory</var>, then let <var>value</var> be
     the string "<code>ERROR</code>". Otherwise, <a href=#get-the-object id=json:get-the-object-2>get the object</a> for <var>value</var>, passing a copy of <var>memory</var>, and then replace <var>value</var> with the object returned from those steps.<li>

      <p>For each name <var>name</var> in <var>element</var>'s <a href=#property-names id=json:property-names-2>property
      names</a>, run the following substeps:</p>

      <ol><li><p>If there is no entry named <var>name</var> in <var>properties</var>,
       then add an entry named <var>name</var> to <var>properties</var> whose
       value is an empty array.<li><p>Append <var>value</var> to the entry named <var>name</var> in <var>properties</var>.</ol>

     </ol>

   <li><p>Add an entry to <var>result</var> called "<code>properties</code>" whose
   value is the object <var>properties</var>.<li><p>Return <var>result</var>.</ol>

  <div class=example>

   <p>For example, take this markup:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;html lang="en">
&lt;title>My Blog&lt;/title>
&lt;article itemscope itemtype="http://schema.org/BlogPosting">
 &lt;header>
  &lt;h1 itemprop="headline">Progress report&lt;/h1>
  &lt;p>&lt;time itemprop="datePublished" datetime="2013-08-29">today&lt;/time>&lt;/p>
  &lt;link itemprop="url" href="?comments=0">
 &lt;/header>
 &lt;p>All in all, he's doing well with his swim lessons. The biggest thing was he had trouble
 putting his head in, but we got it down.&lt;/p>
 &lt;section>
  &lt;h1>Comments&lt;/h1>
  &lt;article itemprop="comment" itemscope itemtype="http://schema.org/UserComments" id="c1">
   &lt;link itemprop="url" href="#c1">
   &lt;footer>
    &lt;p>Posted by: &lt;span itemprop="creator" itemscope itemtype="http://schema.org/Person">
     &lt;span itemprop="name">Greg&lt;/span>
    &lt;/span>&lt;/p>
    &lt;p>&lt;time itemprop="commentTime" datetime="2013-08-29">15 minutes ago&lt;/time>&lt;/p>
   &lt;/footer>
   &lt;p>Ha!&lt;/p>
  &lt;/article>
  &lt;article itemprop="comment" itemscope itemtype="http://schema.org/UserComments" id="c2">
   &lt;link itemprop="url" href="#c2">
   &lt;footer>
    &lt;p>Posted by: &lt;span itemprop="creator" itemscope itemtype="http://schema.org/Person">
     &lt;span itemprop="name">Charlotte&lt;/span>
    &lt;/span>&lt;/p>
    &lt;p>&lt;time itemprop="commentTime" datetime="2013-08-29">5 minutes ago&lt;/time>&lt;/p>
   &lt;/footer>
   &lt;p>When you say "we got it down"...&lt;/p>
  &lt;/article>
 &lt;/section>
&lt;/article></pre>

   <p>It would be turned into the following JSON by the algorithm above (supposing that the page's
   URL was <code>https://blog.example.com/progress-report</code>):</p>

   <pre>{
  "items": [
    {
      "type": [ "http://schema.org/BlogPosting" ],
      "properties": {
        "headline": [ "Progress report" ],
        "datePublished": [ "2013-08-29" ],
        "url": [ "https://blog.example.com/progress-report?comments=0" ],
        "comment": [
          {
            "type": [ "http://schema.org/UserComments" ],
            "properties": {
              "url": [ "https://blog.example.com/progress-report#c1" ],
              "creator": [
                {
                  "type": [ "http://schema.org/Person" ],
                  "properties": {
                    "name": [ "Greg" ]
                  }
                }
              ],
              "commentTime": [ "2013-08-29" ]
            }
          },
          {
            "type": [ "http://schema.org/UserComments" ],
            "properties": {
              "url": [ "https://blog.example.com/progress-report#c2" ],
              "creator": [
                {
                  "type": [ "http://schema.org/Person" ],
                  "properties": {
                    "name": [ "Charlotte" ]
                  }
                }
              ],
              "commentTime": [ "2013-08-29" ]
            }
          }
        ]
      }
    }
  ]
}</pre>

  </div>

  





  <h2 id=editing>6 <dfn>User interaction</dfn><a href=#editing class=self-link></a></h2>


  <h3 id=the-hidden-attribute>6.1 The <dfn><code>hidden</code></dfn> attribute<a href=#the-hidden-attribute class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> hidden<span class="and_chr yes"><span>Chrome for Android</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>6+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>5.0+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>4+</span></span><span class="ie yes"><span>IE</span> <span>11+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini yes"><span>Opera Mini</span> <span>all+</span></span><span class="android yes"><span>Android Browser</span> <span>4+</span></span><span class="safari yes"><span>Safari</span> <span>5.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>11.1+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=hidden">caniuse.com</a></div>

  <p>All <a href=#html-elements id=the-hidden-attribute:html-elements>HTML elements</a> may have the <code id=the-hidden-attribute:the-hidden-attribute><a href=#the-hidden-attribute>hidden</a></code> content
  attribute set. The <code id=the-hidden-attribute:the-hidden-attribute-2><a href=#the-hidden-attribute>hidden</a></code> attribute is a <a href=#boolean-attribute id=the-hidden-attribute:boolean-attribute>boolean
  attribute</a>. When specified on an element, it indicates that the element is not yet, or is no
  longer, directly relevant to the page's current state, or that it is being used to declare content
  to be reused by other parts of the page as opposed to being directly accessed by the user. User agents should not render elements that have the <code id=the-hidden-attribute:the-hidden-attribute-3><a href=#the-hidden-attribute>hidden</a></code> attribute specified. This requirement may be implemented
  indirectly through the style layer. For example, an HTML+CSS user agent could implement these
  requirements <a href=#hiddenCSS>using the rules suggested in the Rendering
  section</a>.</p>

  <p class=note>Because this attribute is typically implemented using CSS, it's also possible to
  override it using CSS. For instance, a rule that applies 'display: block' to all elements will
  cancel the effects of the <code id=the-hidden-attribute:the-hidden-attribute-4><a href=#the-hidden-attribute>hidden</a></code> attribute. Authors therefore
  have to take care when writing their style sheets to make sure that the attribute is still styled
  as expected.</p>

  <div class=example>

   <p>In the following skeletal example, the attribute is used to hide the Web game's main screen
   until the user logs in:</p>

   <pre>  &lt;h1>The Example Game&lt;/h1>
  &lt;section id="login">
   &lt;h2>Login&lt;/h2>
   &lt;form>
    ...
    &lt;!-- calls login() once the user's credentials have been checked -->
   &lt;/form>
   &lt;script>
    function login() {
      // switch screens
      document.getElementById('login').hidden = true;
      document.getElementById('game').hidden = false;
    }
   &lt;/script>
  &lt;/section>
  &lt;section id="game" hidden>
   ...
  &lt;/section></pre>

  </div>

  <p>The <code id=the-hidden-attribute:the-hidden-attribute-5><a href=#the-hidden-attribute>hidden</a></code> attribute must not be used to hide content that
  could legitimately be shown in another presentation. For example, it is incorrect to use <code id=the-hidden-attribute:the-hidden-attribute-6><a href=#the-hidden-attribute>hidden</a></code> to hide panels in a tabbed dialog, because the tabbed interface
  is merely a kind of overflow presentation — one could equally well just show all the form
  controls in one big page with a scrollbar. It is similarly incorrect to use this attribute to hide
  content just from one presentation — if something is marked <code id=the-hidden-attribute:the-hidden-attribute-7><a href=#the-hidden-attribute>hidden</a></code>, it is hidden from all presentations, including, for instance,
  screen readers.</p>

  
  

  <p>Elements that are not themselves <code id=the-hidden-attribute:the-hidden-attribute-8><a href=#the-hidden-attribute>hidden</a></code> must not
  <a href=#hyperlink id=the-hidden-attribute:hyperlink>hyperlink</a> to elements that are <code id=the-hidden-attribute:the-hidden-attribute-9><a href=#the-hidden-attribute>hidden</a></code>. The <code>for</code> attributes of <code id=the-hidden-attribute:the-label-element><a href=#the-label-element>label</a></code> and <code id=the-hidden-attribute:the-output-element><a href=#the-output-element>output</a></code> elements that are not
  themselves <code id=the-hidden-attribute:the-hidden-attribute-10><a href=#the-hidden-attribute>hidden</a></code> must similarly not refer to elements that are
  <code id=the-hidden-attribute:the-hidden-attribute-11><a href=#the-hidden-attribute>hidden</a></code>. In both cases, such references would cause user
  confusion.</p>

  <p>Elements and scripts may, however, refer to elements that are <code id=the-hidden-attribute:the-hidden-attribute-12><a href=#the-hidden-attribute>hidden</a></code> in other contexts.</p>

  <div class=example>

   <p>For example, it would be incorrect to use the <code id=the-hidden-attribute:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code>
   attribute to link to a section marked with the <code id=the-hidden-attribute:the-hidden-attribute-13><a href=#the-hidden-attribute>hidden</a></code> attribute.
   If the content is not applicable or relevant, then there is no reason to link to it.</p>

   <p>It would be fine, however, to use the ARIA <code id=the-hidden-attribute:attr-aria-describedby><a data-x-internal=attr-aria-describedby href=https://w3c.github.io/aria/aria/aria.html#aria-describedby>aria-describedby</a></code> attribute to refer to descriptions that are
   themselves <code id=the-hidden-attribute:the-hidden-attribute-14><a href=#the-hidden-attribute>hidden</a></code>. While hiding the descriptions implies that
   they are not useful alone, they could be written in such a way that they are useful in the
   specific context of being referenced from the images that they describe.</p>

   <p>Similarly, a <code id=the-hidden-attribute:the-canvas-element><a href=#the-canvas-element>canvas</a></code> element with the <code id=the-hidden-attribute:the-hidden-attribute-15><a href=#the-hidden-attribute>hidden</a></code>
   attribute could be used by a scripted graphics engine as an off-screen buffer, and a form control
   could refer to a hidden <code id=the-hidden-attribute:the-form-element><a href=#the-form-element>form</a></code> element using its <code id=the-hidden-attribute:attr-fae-form><a href=#attr-fae-form>form</a></code> attribute.</p>

  </div>

  <p>Elements in a section hidden by the <code id=the-hidden-attribute:the-hidden-attribute-16><a href=#the-hidden-attribute>hidden</a></code> attribute are still
  active, e.g. scripts and form controls in such sections still execute and submit respectively.
  Only their presentation to the user changes.</p>

  

  <p>The <dfn id=dom-hidden><code>hidden</code></dfn> IDL attribute must <a href=#reflect id=the-hidden-attribute:reflect>reflect</a>
  the content attribute of the same name.</p>

  



  <h3 id=inert-subtrees>6.2 Inert subtrees<a href=#inert-subtrees class=self-link></a></h3>

  <p class=note>This section <strong>does not</strong> define or create any content attribute
  named "inert". This section merely defines an abstract <em>concept</em> of
  <a href=#inert id=inert-subtrees:inert>inertness</a>.</p>

  <p>A node (in particular elements and text nodes) can be marked as <dfn id=inert>inert</dfn>. When a node
  is <a href=#inert id=inert-subtrees:inert-2>inert</a>, then the user agent must act as if the node was absent for the purposes of
  targeting user interaction events, may ignore the node for the purposes of text search user
  interfaces (commonly known as "find in page"), and may prevent the user from selecting text in
  that node. User agents should allow the user to override the restrictions on search and text
  selection, however.</p>

  <p class=example>For example, consider a page that consists of just a single <a href=#inert id=inert-subtrees:inert-3>inert</a>
  paragraph positioned in the middle of a <code id=inert-subtrees:the-body-element><a href=#the-body-element>body</a></code>. If a user moves their pointing device
  from the <code id=inert-subtrees:the-body-element-2><a href=#the-body-element>body</a></code> over to the <a href=#inert id=inert-subtrees:inert-4>inert</a> paragraph and clicks on the paragraph,
  no <code id=inert-subtrees:event-mouseover><a data-x-internal=event-mouseover href=https://w3c.github.io/uievents/#event-type-mouseover>mouseover</a></code> event would be fired, and the <code id=inert-subtrees:event-mousemove><a data-x-internal=event-mousemove href=https://w3c.github.io/uievents/#event-type-mousemove>mousemove</a></code> and <code id=inert-subtrees:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> events would
  be fired on the <code id=inert-subtrees:the-body-element-3><a href=#the-body-element>body</a></code> element rather than the paragraph.</p>

  <p class=note>When a node is inert, it generally cannot be focused. Inert nodes that are <a href=#concept-command id=inert-subtrees:concept-command>commands</a> will also get disabled.</p>

  <p>While a <a href=#browsing-context-container id=inert-subtrees:browsing-context-container>browsing context container</a> is marked as <a href=#inert id=inert-subtrees:inert-5>inert</a>, its
  <a href=#nested-browsing-context id=inert-subtrees:nested-browsing-context>nested browsing context</a>'s <a href=#active-document id=inert-subtrees:active-document>active document</a>, and all nodes in that
  <code id=inert-subtrees:document><a href=#document>Document</a></code>, must be marked as <a href=#inert id=inert-subtrees:inert-6>inert</a>.</p>

  <p>An entire <code id=inert-subtrees:document-2><a href=#document>Document</a></code> can be marked as <dfn id=blocked-by-a-modal-dialog>blocked by a modal dialog</dfn>
  <var>subject</var>. While a <code id=inert-subtrees:document-3><a href=#document>Document</a></code> is so marked, every node that is <a href=https://dom.spec.whatwg.org/#in-a-document id=inert-subtrees:in-a-document data-x-internal=in-a-document>in the <code>Document</code></a>, with the exception of the
  <var>subject</var> element and its descendants, must be marked <a href=#inert id=inert-subtrees:inert-7>inert</a>. (The elements
  excepted by this paragraph can additionally be marked <a href=#inert id=inert-subtrees:inert-8>inert</a> through other means;
  being part of a modal dialog does not "protect" a node from being marked <a href=#inert id=inert-subtrees:inert-9>inert</a>.)</p>

  <p>Only one element at a time can mark a <code id=inert-subtrees:document-4><a href=#document>Document</a></code> as being <a href=#blocked-by-a-modal-dialog id=inert-subtrees:blocked-by-a-modal-dialog>blocked by a modal
  dialog</a>. When a new <code id=inert-subtrees:the-dialog-element><a href=#the-dialog-element>dialog</a></code> is made to <a href=#blocked-by-a-modal-dialog id=inert-subtrees:blocked-by-a-modal-dialog-2>block</a> a <code id=inert-subtrees:document-5><a href=#document>Document</a></code>, the previous element, if any, stops blocking the
  <code id=inert-subtrees:document-6><a href=#document>Document</a></code>.</p>

  <p class=note>The <code id=inert-subtrees:the-dialog-element-2><a href=#the-dialog-element>dialog</a></code> element's <code id=inert-subtrees:dom-dialog-showmodal><a href=#dom-dialog-showmodal>showModal()</a></code> method makes use of this mechanism.</p>




  <h3 id=activation>6.3 Activation<a href=#activation class=self-link></a></h3>

  <p>Certain elements in HTML have an <a id=activation:activation-behaviour href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a>, which means that the user
  can activate them. This is always caused by a <code id=activation:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event.</p>

  

  <p>The user agent should allow the user to manually trigger elements that have an <a id=activation:activation-behaviour-2 href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation
  behavior</a>, for instance using keyboard or voice input, or through mouse clicks. When the
  user triggers an element with a defined <a id=activation:activation-behaviour-3 href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a> in a manner other than
  clicking it, the default action of the interaction event must be to <a href=#fire-a-click-event id=activation:fire-a-click-event>fire a <code>click</code> event</a> at the element.</p>
  

  <p id=allowed-to-show-a-popup>An algorithm is <dfn id=triggered-by-user-activation data-export="">triggered by user
  activation</dfn> if any of the following conditions is true:</p>

  <ul><li><p>The <a href=#concept-task id=activation:concept-task>task</a> in which the algorithm is running is currently
   processing an <a id=activation:activation-behaviour-4 href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a> whose <code id=activation:event-click-2><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code>
   event's <code id=activation:dom-event-istrusted><a data-x-internal=dom-event-istrusted href=https://dom.spec.whatwg.org/#dom-event-istrusted>isTrusted</a></code> attribute is true.<li>
    <p>The <a href=#concept-task id=activation:concept-task-2>task</a> in which the algorithm is running is currently
    running the event listener for an event whose <code id=activation:dom-event-istrusted-2><a data-x-internal=dom-event-istrusted href=https://dom.spec.whatwg.org/#dom-event-istrusted>isTrusted</a></code> attribute is true and whose <code id=activation:dom-event-type><a data-x-internal=dom-event-type href=https://dom.spec.whatwg.org/#dom-event-type>type</a></code> is one of:</p>

    <ul class=brief><li><code id=activation:event-change><a href=#event-change>change</a></code><li><code id=activation:event-click-3><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code><li><code id=activation:event-dblclick><a data-x-internal=event-dblclick href=https://w3c.github.io/uievents/#event-type-dblclick>dblclick</a></code><li><code id=activation:event-mouseup><a data-x-internal=event-mouseup href=https://w3c.github.io/uievents/#event-type-mouseup>mouseup</a></code><li><code id=activation:event-pointerup><a data-x-internal=event-pointerup href=https://w3c.github.io/pointerevents/#the-pointerup-event>pointerup</a></code><li><code id=activation:event-reset><a href=#event-reset>reset</a></code><li><code id=activation:event-submit><a href=#event-submit>submit</a></code><li><code id=activation:event-touchend><a data-x-internal=event-touchend href=https://w3c.github.io/touch-events/#event-touchend>touchend</a></code></ul>

   <li>
    <p>The <a href=#concept-task id=activation:concept-task-3>task</a> in which the algorithm is running was <a href=#queue-a-task id=activation:queue-a-task>queued</a> by an algorithm that was <a href=#triggered-by-user-activation id=activation:triggered-by-user-activation>triggered by user
    activation</a>, and the chain of such algorithms started within a user-agent defined
    timeframe.</p>

    <p class=example>For example, if a user clicked a button, it might be acceptable for a popup
    to result from that after 4 seconds, but it would likely not be acceptable for a popup to result
    from that after 4 hours.</p>
   </ul>

  



  

  <dl class=domintro><dt><var>element</var> . <code id=activation:dom-click><a href=#dom-click>click</a></code>()<dd>

    <p>Acts as if the element was clicked.</p>

   </dl>

  

  <p>Each element has an associated <dfn id=click-in-progress-flag>click in progress flag</dfn>, which is initially unset.</p>

  <p>The <dfn id=dom-click><code>click()</code></dfn> method must run the following steps:</p>

  <ol><li><p>If this element is a form control that is <a href=#concept-fe-disabled id=activation:concept-fe-disabled>disabled</a>, then abort these steps.<li><p>If this element's <a href=#click-in-progress-flag id=activation:click-in-progress-flag>click in progress flag</a> is set, then abort these
   steps.<li><p>Set this element's <a href=#click-in-progress-flag id=activation:click-in-progress-flag-2>click in progress flag</a>.<li><p><a href=#fire-a-synthetic-mouse-event id=activation:fire-a-synthetic-mouse-event>Fire a synthetic mouse event</a> at this element, with the <var>not trusted
   flag</var> set.<li><p>Unset this element's <a href=#click-in-progress-flag id=activation:click-in-progress-flag-3>click in progress flag</a>.</ol>

  




  <h3 id=focus>6.4 Focus<a href=#focus class=self-link></a></h3>

  
  
  
  

  

  <h4 id=introduction-8>6.4.1 Introduction<a href=#introduction-8 class=self-link></a></h4>

  <p><i>This section is non-normative.</i></p>

  <p>An HTML user interface typically consists of multiple interactive widgets, such as form
  controls, scrollable regions, links, dialog boxes, browser tabs, and so forth. These widgets form
  a hierarchy, with some (e.g. browser tabs, dialog boxes) containing others (e.g. links, form
  controls).</p>

  <p>When interacting with an interface using a keyboard, key input is channeled from the system,
  through the hierarchy of interactive widgets, to an active widget, which is said to be
  <a href=#focused id=introduction-8:focused>focused</a>.</p>

  <div class=example>

   <p>Consider an HTML application running in a browser tab running in a graphical environment.
   Suppose this application had a page with some text controls and links, and was currently showing
   a modal dialog, which itself had a text control and a button.</p>

   <p>The hierarchy of focusable widgets, in this scenario, would include the browser window, which
   would have, amongst its children, the browser tab containing the HTML application. The tab itself
   would have as its children the various links and text controls, as well as the dialog. The dialog
   itself would have as its children the text control and the button.</p>

   <p><img width=800 src=/images/focus-tree.png height=450 alt=""> 

   <p>If the widget with <a href=#focused id=introduction-8:focused-2>focus</a> in this example was the text control in
   the dialog box, then key input would be channeled from the graphical system to ① the Web
   browser, then to ② the tab, then to ③ the dialog, and finally to ④ the text
   control.</p>

  </div>

  <p>Keyboard <em>events</em> are always targeted at this <a href=#focused id=introduction-8:focused-3>focused</a> element.</p>


  <h4 id=data-model>6.4.2 Data model<a href=#data-model class=self-link></a></h4>

  <p>The term <dfn id=focusable-area>focusable area</dfn> is used to refer to regions of the interface that can become
  the target of keyboard input. Focusable areas can be elements, parts of elements, or other regions
  managed by the user agent.</p>

  <p>Each <a href=#focusable-area id=data-model:focusable-area>focusable area</a> has a <dfn id=dom-anchor>DOM anchor</dfn>, which is a <code id=data-model:node><a data-x-internal=node href=https://dom.spec.whatwg.org/#interface-node>Node</a></code> object
  that represents the position of the <a href=#focusable-area id=data-model:focusable-area-2>focusable area</a> in the DOM. (When the <a href=#focusable-area id=data-model:focusable-area-3>focusable
  area</a> is itself a <code id=data-model:node-2><a data-x-internal=node href=https://dom.spec.whatwg.org/#interface-node>Node</a></code>, it is its own <a href=#dom-anchor id=data-model:dom-anchor>DOM anchor</a>.) The <a href=#dom-anchor id=data-model:dom-anchor-2>DOM anchor</a> is
  used in some APIs as a substitute for the <a href=#focusable-area id=data-model:focusable-area-4>focusable area</a> when there is no other DOM object
  to represent the <a href=#focusable-area id=data-model:focusable-area-5>focusable area</a>.</p>

  <p>The following table describes what objects can be <a href=#focusable-area id=data-model:focusable-area-6>focusable
  areas</a>. The cells in the left column describe objects that can be <a href=#focusable-area id=data-model:focusable-area-7>focusable areas</a>; the cells in the right column describe the <a href=#dom-anchor id=data-model:dom-anchor-3>DOM
  anchors</a> for those elements. (The cells that span both columns are non-normative examples.)</p>

  <table id=table-fa><thead><tr><th id=th-fa-area><a href=#focusable-area id=data-model:focusable-area-8>Focusable area</a>
     <th id=th-fa-dom-rep><a href=#dom-anchor id=data-model:dom-anchor-4>DOM anchor</a>
    <tr><th colspan=2 id=th-fa-examples>Examples

   <tbody><tr><th headers=th-fa-area id=td-fa-1 class=data-header>
     Elements that have their <a href=#specially-focusable id=data-model:specially-focusable>tabindex focus flag</a> set, that are not <a href=#concept-element-disabled id=data-model:concept-element-disabled>actually disabled</a>, that are not <a href=#expressly-inert id=data-model:expressly-inert>expressly
     inert</a>, and that are either <a href=#being-rendered id=data-model:being-rendered>being rendered</a> or <a href=#being-used-as-relevant-canvas-fallback-content id=data-model:being-used-as-relevant-canvas-fallback-content>being used as relevant
     canvas fallback content</a>. 
     <td headers="td-fa-1 th-fa-dom-rep">
     The element itself.
    <tr><td colspan=2 headers="td-fa-1 th-fa-examples">
     <p class=example><code id=data-model:the-iframe-element><a href=#the-iframe-element>iframe</a></code>, <code id="data-model:text-(type=text)-state-and-search-state-(type=search)"><a href="#text-(type=text)-state-and-search-state-(type=search)">&lt;input
     type=text></a></code>, sometimes <code id=data-model:the-a-element><a href=#the-a-element>&lt;a href=""></a></code> (depending on platform
     conventions).

   <tbody><tr><th headers=th-fa-area id=td-fa-2 class=data-header>
     The shapes of <code id=data-model:the-area-element><a href=#the-area-element>area</a></code> elements in an <a href=#image-map id=data-model:image-map>image map</a> associated with an
     <code id=data-model:the-img-element><a href=#the-img-element>img</a></code> element that is <a href=#being-rendered id=data-model:being-rendered-2>being rendered</a> and is not <a href=#expressly-inert id=data-model:expressly-inert-2>expressly
     inert</a>.
     <td headers="td-fa-2 th-fa-dom-rep">
     The <code id=data-model:the-img-element-2><a href=#the-img-element>img</a></code> element.
    <tr><td colspan=2 headers="td-fa-2 th-fa-examples">
     <div class=example>
      <p>In the following example, the <code id=data-model:the-area-element-2><a href=#the-area-element>area</a></code> element creates two shapes, one on each
      image. The <a href=#dom-anchor id=data-model:dom-anchor-5>DOM anchor</a> of the first shape is the first <code id=data-model:the-img-element-3><a href=#the-img-element>img</a></code> element, and the
      <a href=#dom-anchor id=data-model:dom-anchor-6>DOM anchor</a> of the second shape is the second <code id=data-model:the-img-element-4><a href=#the-img-element>img</a></code> element.</p>
      <pre>&lt;map id=wallmap>&lt;area alt="Enter Door" coords="10,10,100,200" href="door.html">&lt;/map>
...
&lt;img src="images/innerwall.jpeg" alt="There is a white wall here, with a door." usemap="#wallmap">
...
&lt;img src="images/outerwall.jpeg" alt="There is a red wall here, with a door." usemap="#wallmap"></pre>
     </div>

   <tbody><tr><th headers=th-fa-area id=td-fa-3 class=data-header>
     The user-agent provided subwidgets of elements that are <a href=#being-rendered id=data-model:being-rendered-3>being rendered</a> and are not
     <a href=#concept-element-disabled id=data-model:concept-element-disabled-2>actually disabled</a> or <a href=#expressly-inert id=data-model:expressly-inert-3>expressly
     inert</a>.
     <td headers="td-fa-3 th-fa-dom-rep">
     The element for which the <a href=#focusable-area id=data-model:focusable-area-9>focusable area</a> is a subwidget.
    <tr><td colspan=2 headers="td-fa-3 th-fa-examples">
     <p class=example>The <a href=#expose-a-user-interface-to-the-user id=data-model:expose-a-user-interface-to-the-user>controls in the user
     interface that is exposed to the user</a> for a <code id=data-model:the-video-element><a href=#the-video-element>video</a></code> element, the up and down
     buttons in a spin-control version of <code id="data-model:number-state-(type=number)"><a href="#number-state-(type=number)">&lt;input
     type=number></a></code>, the two range control widgets in a <code id="data-model:range-state-(type=range)"><a href="#range-state-(type=range)">&lt;input type=range multiple></a></code>, the part of a
     <code id=data-model:the-details-element><a href=#the-details-element>details</a></code> element's rendering that enabled the element to be opened or closed using
     keyboard input.</p>

   <tbody><tr><th headers=th-fa-area id=td-fa-4 class=data-header>
     The scrollable regions of elements that are <a href=#being-rendered id=data-model:being-rendered-4>being rendered</a> and are not
     <a href=#expressly-inert id=data-model:expressly-inert-4>expressly inert</a>. 
     <td headers="td-fa-4 th-fa-dom-rep">
     The element for which the box that the scrollable region scrolls was created.
    <tr><td colspan=2 headers="td-fa-4 th-fa-examples">
     <p class=example>The CSS <a id="data-model:'overflow'" href=https://drafts.csswg.org/css-overflow/#propdef-overflow data-x-internal="'overflow'">'overflow'</a> property's 'scroll' value typically creates
     a scrollable region.</p>

   <tbody><tr><th headers=th-fa-area id=td-fa-5 class=data-header>
     The <a id=data-model:viewport href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> of a <code id=data-model:document><a href=#document>Document</a></code> that has a <a href=#concept-document-bc id=data-model:concept-document-bc>browsing context</a> and is not <a href=#inert id=data-model:inert>inert</a>.
     <td headers="td-fa-5 th-fa-dom-rep">
     The <code id=data-model:document-2><a href=#document>Document</a></code> for which the <a id=data-model:viewport-2 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> was created.
    <tr><td colspan=2 headers="td-fa-5 th-fa-examples">
     <p class=example>The contents of an <code id=data-model:the-iframe-element-2><a href=#the-iframe-element>iframe</a></code>.</p>

   <tbody><tr><th headers=th-fa-area id=td-fa-6 class=data-header>
     Any other element or part of an element, especially to aid with accessibility or to better
     match platform conventions.
     <td headers="td-fa-6 th-fa-dom-rep">
     The element.
    <tr><td colspan=2 headers="td-fa-6 th-fa-examples">
     <p class=example>A user agent could make all list item bullets focusable, so that a user can
     more easily navigate lists.</p>
     <p class=example>Similarly, a user agent could make all elements with <code id=data-model:attr-title><a href=#attr-title>title</a></code> attributes focusable, so that their advisory information can
     be accessed.</p>

  </table>

  <p id=bc-focus-ergo-bcc-focus class=note>A <a href=#browsing-context-container id=data-model:browsing-context-container>browsing context container</a> (e.g. an
  <code id=data-model:the-iframe-element-3><a href=#the-iframe-element>iframe</a></code>) is a <a href=#focusable-area id=data-model:focusable-area-10>focusable area</a>, but key events routed to a <a href=#browsing-context-container id=data-model:browsing-context-container-2>browsing context
  container</a> get immediately routed to the <a href=#nested-browsing-context id=data-model:nested-browsing-context>nested browsing context</a>'s <a href=#active-document id=data-model:active-document>active
  document</a>. Similarly, in sequential focus navigation a <a href=#browsing-context-container id=data-model:browsing-context-container-3>browsing context
  container</a> essentially acts merely as a placeholder for its <a href=#nested-browsing-context id=data-model:nested-browsing-context-2>nested browsing
  context</a>'s <a href=#active-document id=data-model:active-document-2>active document</a>.</p>

  <hr>

  <p>The following create <dfn id=control-group>control groups</dfn>:

  <ul class=brief><li><code id=data-model:document-3><a href=#document>Document</a></code> object that have <a href=#concept-document-bc id=data-model:concept-document-bc-2>browsing
   contexts</a>.<li><code id=data-model:the-dialog-element><a href=#the-dialog-element>dialog</a></code> elements that have an <code id=data-model:attr-dialog-open><a href=#attr-dialog-open>open</a></code>
   attribute specified and that are <a href=#being-rendered id=data-model:being-rendered-5>being rendered</a>.</ul>

  <p>The corresponding <code id=data-model:document-4><a href=#document>Document</a></code> object or <code id=data-model:the-dialog-element-2><a href=#the-dialog-element>dialog</a></code> element is the created
  <a href=#control-group id=data-model:control-group>control group</a>'s <dfn id=control-group-owner-object>owner object</dfn>. (There
  is always a 1-to-1 mapping of <a href=#control-group id=data-model:control-group-2>control groups</a> to <a href=#control-group-owner-object id=data-model:control-group-owner-object>control group owner objects</a>.)</p>

  <p>Each <a href=#focusable-area id=data-model:focusable-area-11>focusable area</a> belongs to a single <a href=#control-group id=data-model:control-group-3>control group</a> as follows. If
  the <a href=#dom-anchor id=data-model:dom-anchor-7>DOM anchor</a> of a <a href=#focusable-area id=data-model:focusable-area-12>focusable area</a> is a <a href=#control-group-owner-object id=data-model:control-group-owner-object-2>control group
  owner object</a>, then that <a href=#focusable-area id=data-model:focusable-area-13>focusable area</a> belongs to that <a href=#control-group-owner-object id=data-model:control-group-owner-object-3>control group
  owner object</a>'s <a href=#control-group id=data-model:control-group-4>control group</a>. Otherwise, the <a href=#focusable-area id=data-model:focusable-area-14>focusable area</a>
  belongs to its <a href=#dom-anchor id=data-model:dom-anchor-8>DOM anchor</a>'s nearest ancestor <a href=#control-group-owner-object id=data-model:control-group-owner-object-4>control group owner
  object</a>'s <a href=#control-group id=data-model:control-group-5>control group</a>.</p>

  <div class=example>
   <p>Thus:</p>

   <ul><li><p>A <a id=data-model:viewport-3 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> always belongs to the <a href=#control-group id=data-model:control-group-6>control group</a> of the
    <code id=data-model:document-5><a href=#document>Document</a></code> for which the <a id=data-model:viewport-4 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> was created.<li><p>An <code id=data-model:the-input-element><a href=#the-input-element>input</a></code> control belongs to the <a href=#control-group id=data-model:control-group-7>control group</a> of its nearest
    ancestor <code id=data-model:the-dialog-element-3><a href=#the-dialog-element>dialog</a></code> or <code id=data-model:document-6><a href=#document>Document</a></code>.<li><p>An image map's shapes belong to the nearest ancestor <code id=data-model:the-dialog-element-4><a href=#the-dialog-element>dialog</a></code> or
    <code id=data-model:document-7><a href=#document>Document</a></code> of the <code id=data-model:the-img-element-5><a href=#the-img-element>img</a></code> elements (not the <code id=data-model:the-area-element-3><a href=#the-area-element>area</a></code> elements
    — this means one <code id=data-model:the-area-element-4><a href=#the-area-element>area</a></code> element might create multiple shapes in different
    <a href=#control-group id=data-model:control-group-8>control groups</a>).</ul>
  </div>

  <p class=note>It is possible for a <a href=#control-group id=data-model:control-group-9>control group</a> to be empty, i.e. for it to have
  no <a href=#focusable-area id=data-model:focusable-area-15>focusable areas</a>.</p>

  <hr>

  <p><span id=expressly-inert-control></span><span id=expressly-inert-dialog></span>An element
  is <dfn id=expressly-inert>expressly inert</dfn> if it is <a href=#inert id=data-model:inert-2>inert</a> and its nearest ancestor <a href=#control-group-owner-object id=data-model:control-group-owner-object-5>control
  group owner object</a> is not <a href=#inert id=data-model:inert-3>inert</a>.</p>

  <div class=example>
   <p>In a page with no <code id=data-model:the-dialog-element-5><a href=#the-dialog-element>dialog</a></code> elements, all elements that are <a href=#inert id=data-model:inert-4>inert</a> are
   <a href=#expressly-inert id=data-model:expressly-inert-5>expressly inert</a>, and vice-versa.</p>

   <p>Inside an <a href=#inert id=data-model:inert-5>inert</a> <code id=data-model:the-dialog-element-6><a href=#the-dialog-element>dialog</a></code> element, all descendant elements are not
   <a href=#expressly-inert id=data-model:expressly-inert-6>expressly inert</a>, even if they are <a href=#inert id=data-model:inert-6>inert</a>.</p>

   <p>A <code id=data-model:the-dialog-element-7><a href=#the-dialog-element>dialog</a></code> element is <a href=#expressly-inert id=data-model:expressly-inert-7>expressly inert</a> if it is <a href=#inert id=data-model:inert-7>inert</a> and
   not nested inside another <a href=#inert id=data-model:inert-8>inert</a> dialog.</p>
  </div>

  <hr>

  <p>Each <a href=#control-group-owner-object id=data-model:control-group-owner-object-6>control group owner object</a> can also act as the <dfn id=dialog-group-manager>manager</dfn> of a <dfn id=dialog-group>dialog group</dfn>.</p>

  <p>Each <code id=data-model:the-dialog-element-8><a href=#the-dialog-element>dialog</a></code> element that has an <code id=data-model:attr-dialog-open-2><a href=#attr-dialog-open>open</a></code>
  attribute specified and that is <a href=#being-rendered id=data-model:being-rendered-6>being rendered</a> (i.e. that is a <a href=#control-group-owner-object id=data-model:control-group-owner-object-7>control group
  owner object</a>) and is not <a href=#expressly-inert id=data-model:expressly-inert-8>expressly inert</a>
  belongs to the <a href=#dialog-group id=data-model:dialog-group>dialog group</a> whose <a href=#dialog-group-manager id=data-model:dialog-group-manager>manager</a> is
  the <code id=data-model:the-dialog-element-9><a href=#the-dialog-element>dialog</a></code> element's nearest ancestor <a href=#control-group-owner-object id=data-model:control-group-owner-object-8>control group owner object</a>.</p>

  <p>If no <code id=data-model:the-dialog-element-10><a href=#the-dialog-element>dialog</a></code> element has a particular <a href=#control-group-owner-object id=data-model:control-group-owner-object-9>control group owner object</a> as
  its nearest ancestor <a href=#control-group-owner-object id=data-model:control-group-owner-object-10>control group owner object</a>, then that <a href=#control-group-owner-object id=data-model:control-group-owner-object-11>control group owner
  object</a> has no <a href=#dialog-group id=data-model:dialog-group-2>dialog group</a>.</p>

  <p>Each <a href=#dialog-group id=data-model:dialog-group-3>dialog group</a> can have a <code id=data-model:the-dialog-element-11><a href=#the-dialog-element>dialog</a></code> designated as the <dfn id=focused-dialog-of-the-dialog-group>focused
  dialog of the dialog group</dfn>. Which <code id=data-model:the-dialog-element-12><a href=#the-dialog-element>dialog</a></code> is so designated changes over time,
  based on algorithms in this specification.</p>

  <p>Elements in <a href=#dialog-group id=data-model:dialog-group-4>dialog groups</a> are ordered in <a id=data-model:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree
  order</a>.</p>

  <hr>

  <p>One <a href=#focusable-area id=data-model:focusable-area-16>focusable area</a> in each non-empty <a href=#control-group id=data-model:control-group-10>control group</a> is designated the
  <dfn id=focused-area-of-the-control-group>focused area of the control group</dfn>. Which control is so designated changes over time,
  based on algorithms in this specification. If a <a href=#control-group id=data-model:control-group-11>control group</a> is empty, it has no <a href=#focused-area-of-the-control-group id=data-model:focused-area-of-the-control-group>focused area</a>.</p>

  <p><a href=#focusable-area id=data-model:focusable-area-17>Focusable areas</a> in <a href=#control-group id=data-model:control-group-12>control groups</a>
  are ordered relative to the <a id=data-model:tree-order-2 href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> of their <a href=#dom-anchor id=data-model:dom-anchor-9>DOM
  anchors</a>. <a href=#focusable-area id=data-model:focusable-area-18>Focusable areas</a> with the same <a href=#dom-anchor id=data-model:dom-anchor-10>DOM anchor</a> in a
  <a href=#control-group id=data-model:control-group-13>control group</a> are ordered relative to their CSS box's relative positions in a pre-order,
  depth-first traversal of the box tree. <a href=#refsCSS>[CSS]</a></p>

  <hr>

  <p>The <dfn id=currently-focused-area-of-a-top-level-browsing-context>currently focused area of a top-level browsing context</dfn> at any particular time is
  the <a href=#focusable-area id=data-model:focusable-area-19>focusable area</a> or <code id=data-model:the-dialog-element-13><a href=#the-dialog-element>dialog</a></code> returned by this algorithm:</p>

  <ol><li><p>Let <var>candidate</var> be the <code id=data-model:document-8><a href=#document>Document</a></code> of the <a href=#top-level-browsing-context id=data-model:top-level-browsing-context>top-level
   browsing context</a>.<li>

    <p>If <var>candidate</var> has a <a href=#dialog-group id=data-model:dialog-group-5>dialog group</a> with a designated
    <a href=#focused-dialog-of-the-dialog-group id=data-model:focused-dialog-of-the-dialog-group>focused dialog of the dialog group</a>, then let <var>candidate</var> be the
    designated <a href=#focused-dialog-of-the-dialog-group id=data-model:focused-dialog-of-the-dialog-group-2>focused dialog of the dialog group</a>, and redo this step.</p>

    <p>Otherwise, if <var>candidate</var> has a non-empty <a href=#control-group id=data-model:control-group-14>control group</a>, and the
    designated <a href=#focused-area-of-the-control-group id=data-model:focused-area-of-the-control-group-2>focused area of the control group</a> is a <a href=#browsing-context-container id=data-model:browsing-context-container-4>browsing context
    container</a> with a non-null <a href=#nested-browsing-context id=data-model:nested-browsing-context-3>nested browsing context</a>, then let
    <var>candidate</var> be the <a href=#active-document id=data-model:active-document-3>active document</a> of that <a href=#browsing-context-container id=data-model:browsing-context-container-5>browsing context
    container</a>'s <a href=#nested-browsing-context id=data-model:nested-browsing-context-4>nested browsing context</a>, and redo this step.</p>

    <p>Otherwise, if <var>candidate</var> has a non-empty <a href=#control-group id=data-model:control-group-15>control group</a>, let
    <var>candidate</var> be the designated <a href=#focused-area-of-the-control-group id=data-model:focused-area-of-the-control-group-3>focused area of the control
    group</a>.</p>

   <li><p>Return <var>candidate</var>.</ol>

  <p>An element that is the <a href=#dom-anchor id=data-model:dom-anchor-11>DOM anchor</a> of a <a href=#focusable-area id=data-model:focusable-area-20>focusable area</a> is said to <dfn id=gains-focus>gain focus</dfn> when that <a href=#focusable-area id=data-model:focusable-area-21>focusable area</a> becomes the <a href=#currently-focused-area-of-a-top-level-browsing-context id=data-model:currently-focused-area-of-a-top-level-browsing-context>currently
  focused area of a top-level browsing context</a>. When an element is the <a href=#dom-anchor id=data-model:dom-anchor-12>DOM anchor</a> of a
  <a href=#focusable-area id=data-model:focusable-area-22>focusable area</a> of the <a href=#currently-focused-area-of-a-top-level-browsing-context id=data-model:currently-focused-area-of-a-top-level-browsing-context-2>currently focused area of a top-level browsing context</a>,
  it is <dfn id=focused>focused</dfn>.</p>

  

  <p>The <dfn id=focus-chain>focus chain</dfn> of a <a href=#focusable-area id=data-model:focusable-area-23>focusable area</a> or <a href=#control-group-owner-object id=data-model:control-group-owner-object-12>control group owner
  object</a> <var>subject</var> is the ordered list constructed as follows:</p>

  <ol><li><p>Let <var>current object</var> be <var>subject</var>.<li><p>Let <var>output</var> be an empty list.<li><p><i>Loop</i>: Append <var>current object</var> to <var>output</var>.<li>

    <p>If <var>current object</var> is an <code id=data-model:the-area-element-5><a href=#the-area-element>area</a></code> element's shape, append
    that <code id=data-model:the-area-element-6><a href=#the-area-element>area</a></code> element to <var>output</var>.</p>

    <p>Otherwise, if <var>current object</var> is a <a href=#focusable-area id=data-model:focusable-area-24>focusable area</a> whose <a href=#dom-anchor id=data-model:dom-anchor-13>DOM
    anchor</a> is an element that is not <var>current object</var> itself, append that
    <a href=#dom-anchor id=data-model:dom-anchor-14>DOM anchor</a> element to <var>output</var>.</p>

   <li>

    <p>If <var>current object</var> is a <code id=data-model:the-dialog-element-14><a href=#the-dialog-element>dialog</a></code> object in a <a href=#dialog-group id=data-model:dialog-group-6>dialog group</a>,
    let <var>current object</var> be that <a href=#dialog-group id=data-model:dialog-group-7>dialog group</a>'s <a href=#dialog-group-manager id=data-model:dialog-group-manager-2>manager</a>, and return to the step labeled <i>loop</i>.</p>

    <p>Otherwise, if <var>current object</var> is a <a href=#focusable-area id=data-model:focusable-area-25>focusable area</a>, let <var>current
    object</var> be that <a href=#focusable-area id=data-model:focusable-area-26>focusable area</a>'s <a href=#control-group id=data-model:control-group-16>control group</a>'s <a href=#control-group-owner-object id=data-model:control-group-owner-object-13>owner object</a>, and return to the step labeled
    <i>loop</i>.</p>

    <p>Otherwise, if <var>current object</var> is a <code id=data-model:document-9><a href=#document>Document</a></code> in a <a href=#nested-browsing-context id=data-model:nested-browsing-context-5>nested browsing
    context</a>, let <var>current object</var> be its <a href=#browsing-context-container id=data-model:browsing-context-container-6>browsing context container</a>,
    and return to the step labeled <i>loop</i>.</p>

   <li>

    <p>Return <var>output</var>.</p>

    <p class=note>The chain starts with <var>subject</var> and (if <var>subject</var> is or can be the <a href=#currently-focused-area-of-a-top-level-browsing-context id=data-model:currently-focused-area-of-a-top-level-browsing-context-3>currently focused area of a top-level browsing
    context</a>) continues up the focus hierarchy up to the <code id=data-model:document-10><a href=#document>Document</a></code> of the
    <a href=#top-level-browsing-context id=data-model:top-level-browsing-context-2>top-level browsing context</a>.</p>

   </ol>

  


  <h4 id=the-tabindex-attribute>6.4.3 The <code id=the-tabindex-attribute:attr-tabindex><a href=#attr-tabindex>tabindex</a></code> attribute<a href=#the-tabindex-attribute class=self-link></a></h4>

  <p>The <dfn id=attr-tabindex><code>tabindex</code></dfn> content attribute allows authors to
  indicate that an element is supposed to be <a href=#focusable-area id=the-tabindex-attribute:focusable-area>focusable</a>, and
  whether it is supposed to be reachable using <a href=#sequential-focus-navigation id=the-tabindex-attribute:sequential-focus-navigation>sequential focus navigation</a> and, if so,
  what is to be the relative order of the element for the purposes of sequential focus navigation.
  The name "tab index" comes from the common use of the "tab" key to navigate through the focusable
  elements. The term "tabbing" refers to moving forward through the focusable elements that can be
  reached using sequential focus navigation.<div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> tabindex-attr<span class="chrome yes"><span>Chrome</span> <span>15+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="firefox yes"><span>Firefox</span> <span>4+</span></span><span class="ie yes"><span>IE</span> <span>7+</span></span><span class="safari yes"><span>Safari</span> <span>5.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>9.5+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=tabindex-attr">caniuse.com</a></div>

  <p>When the attribute is omitted, the user agent applies defaults. (There is no way to make an
  element that is <a href=#being-rendered id=the-tabindex-attribute:being-rendered>being rendered</a> be not focusable at all without <a href=#concept-element-disabled id=the-tabindex-attribute:concept-element-disabled>disabling</a> it or making it <a href=#inert id=the-tabindex-attribute:inert>inert</a>.)</p>

  <p>The <code id=the-tabindex-attribute:attr-tabindex-2><a href=#attr-tabindex>tabindex</a></code> attribute, if specified, must have a value
  that is a <a href=#valid-integer id=the-tabindex-attribute:valid-integer>valid integer</a>. Positive numbers specify the relative position of the
  element's <a href=#focusable-area id=the-tabindex-attribute:focusable-area-2>focusable areas</a> in the <a href=#sequential-focus-navigation-order id=the-tabindex-attribute:sequential-focus-navigation-order>sequential focus
  navigation order</a>, and negative numbers indicate that the control is to be unreachable by
  <a href=#sequential-focus-navigation id=the-tabindex-attribute:sequential-focus-navigation-2>sequential focus navigation</a>.</p>

  <p>Developers should use caution when using values other than 0 or −1 for their <code id=the-tabindex-attribute:attr-tabindex-3><a href=#attr-tabindex>tabindex</a></code> attributes as this is complicated to do correctly.</p>

  

  <p>Each element can have a <dfn id=specially-focusable>tabindex focus flag</dfn> set, as defined
  below. This flag is a factor that contributes towards determining whether an element is a
  <a href=#focusable-area id=the-tabindex-attribute:focusable-area-3>focusable area</a>, as described in the previous section.</p>

  <p>If the <code id=the-tabindex-attribute:attr-tabindex-4><a href=#attr-tabindex>tabindex</a></code> attribute is specified on an element, it
  must be parsed using the <a href=#rules-for-parsing-integers id=the-tabindex-attribute:rules-for-parsing-integers>rules for parsing integers</a>. The attribute's values, or lack
  thereof, must be interpreted as follows:</p>

  <dl><dt>If the attribute is omitted or parsing the value returns an error<dd>

    <p>The user agent should follow platform conventions to determine if the element's
    <a href=#specially-focusable id=the-tabindex-attribute:specially-focusable>tabindex focus flag</a> is set and, if so, whether the element and any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-4>focusable areas</a> that have the element as their <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor>DOM anchor</a> can
    be reached using <a href=#sequential-focus-navigation id=the-tabindex-attribute:sequential-focus-navigation-3>sequential focus navigation</a>, and if so, what their relative
    position in the <a href=#sequential-focus-navigation-order id=the-tabindex-attribute:sequential-focus-navigation-order-2>sequential focus navigation order</a> is to be.</p>

    <p>Modulo platform conventions, it is suggested that for the following elements, the
    <a href=#specially-focusable id=the-tabindex-attribute:specially-focusable-2>tabindex focus flag</a> be set:</p>

    <ul><li><code id=the-tabindex-attribute:the-a-element><a href=#the-a-element>a</a></code> elements that have an <code id=the-tabindex-attribute:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code>
     attribute<li><code id=the-tabindex-attribute:the-link-element><a href=#the-link-element>link</a></code> elements that have an <code id=the-tabindex-attribute:attr-link-href><a href=#attr-link-href>href</a></code> attribute<li><code id=the-tabindex-attribute:the-button-element><a href=#the-button-element>button</a></code> elements<li><code id=the-tabindex-attribute:the-input-element><a href=#the-input-element>input</a></code> elements whose <code id=the-tabindex-attribute:attr-input-type><a href=#attr-input-type>type</a></code> attribute are
     not in the <a href="#hidden-state-(type=hidden)" id="the-tabindex-attribute:hidden-state-(type=hidden)">Hidden</a> state<li><code id=the-tabindex-attribute:the-select-element><a href=#the-select-element>select</a></code> elements<li><code id=the-tabindex-attribute:the-textarea-element><a href=#the-textarea-element>textarea</a></code> elements<li><code id=the-tabindex-attribute:the-menuitem-element><a href=#the-menuitem-element>menuitem</a></code> elements<li><code id=the-tabindex-attribute:the-summary-element><a href=#the-summary-element>summary</a></code> elements that are the first child <code id=the-tabindex-attribute:the-summary-element-2><a href=#the-summary-element>summary</a></code> element of a
     <code id=the-tabindex-attribute:the-details-element><a href=#the-details-element>details</a></code> element<li>Elements with a <code id=the-tabindex-attribute:the-draggable-attribute><a href=#the-draggable-attribute>draggable</a></code> attribute set, if that would
     enable the user agent to allow the user to begin a drag operations for those elements without
     the use of a pointing device<li><a href=https://w3c.github.io/editing/execCommand.html#editing-host id=the-tabindex-attribute:editing-host data-x-internal=editing-host>Editing hosts</a><li><a href=#browsing-context-container id=the-tabindex-attribute:browsing-context-container>Browsing context containers</a></ul>

   <dt id=negative-tabindex>If the value is a negative integer<dd>

    <p>The user agent must set the element's <a href=#specially-focusable id=the-tabindex-attribute:specially-focusable-3>tabindex focus flag</a>, but should omit the
    element from the <a href=#sequential-focus-navigation-order id=the-tabindex-attribute:sequential-focus-navigation-order-3>sequential focus navigation order</a>.</p>

    <p class=note>One valid reason to ignore the requirement that sequential focus navigation not
    allow the author to lead to the element would be if the user's only mechanism for moving the
    focus is sequential focus navigation. For instance, a keyboard-only user would be unable to
    click on a text control with a negative <code id=the-tabindex-attribute:attr-tabindex-5><a href=#attr-tabindex>tabindex</a></code>, so that
    user's user agent would be well justified in allowing the user to tab to the control
    regardless.</p>

   <dt>If the value is a zero<dd>

    <p>The user agent must set the element's <a href=#specially-focusable id=the-tabindex-attribute:specially-focusable-4>tabindex focus flag</a>, should allow the
    element and any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-5>focusable areas</a> that have the element as their
    <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-2>DOM anchor</a> to be reached using <a href=#sequential-focus-navigation id=the-tabindex-attribute:sequential-focus-navigation-4>sequential focus navigation</a>, following
    platform conventions to determine the element's relative position in the <a href=#sequential-focus-navigation-order id=the-tabindex-attribute:sequential-focus-navigation-order-4>sequential focus
    navigation order</a>.</p>

   <dt>If the value is greater than zero<dd>

    <p>The user agent must set the element's <a href=#specially-focusable id=the-tabindex-attribute:specially-focusable-5>tabindex focus flag</a>, should allow the
    element and any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-6>focusable areas</a> that have the element as their
    <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-3>DOM anchor</a> to be reached using sequential focus navigation, and should place the element
    — referenced as <var>candidate</var> below — and the aforementioned <a href=#focusable-area id=the-tabindex-attribute:focusable-area-7>focusable areas</a> in the <a href=#sequential-focus-navigation id=the-tabindex-attribute:sequential-focus-navigation-5>sequential focus navigation</a>
    order so that, relative to other <a href=#focusable-area id=the-tabindex-attribute:focusable-area-8>focusable areas</a> in the
    <a href=#sequential-focus-navigation-order id=the-tabindex-attribute:sequential-focus-navigation-order-5>sequential focus navigation order</a>, they are:</p>

    <ul><li>before any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-9>focusable area</a> whose <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-4>DOM anchor</a> is an element whose <code id=the-tabindex-attribute:attr-tabindex-6><a href=#attr-tabindex>tabindex</a></code> attribute has been omitted or whose value, when parsed,
     returns an error,<li>before any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-10>focusable area</a> whose <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-5>DOM anchor</a> is an element whose <code id=the-tabindex-attribute:attr-tabindex-7><a href=#attr-tabindex>tabindex</a></code> attribute has a value equal to or less than zero,<li>after any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-11>focusable area</a> whose <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-6>DOM anchor</a> is an element whose <code id=the-tabindex-attribute:attr-tabindex-8><a href=#attr-tabindex>tabindex</a></code> attribute has a value greater than zero but less than
     the value of the <code id=the-tabindex-attribute:attr-tabindex-9><a href=#attr-tabindex>tabindex</a></code> attribute on <var>candidate</var>,<li>after any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-12>focusable area</a> whose <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-7>DOM anchor</a> is an element whose <code id=the-tabindex-attribute:attr-tabindex-10><a href=#attr-tabindex>tabindex</a></code> attribute has a value equal to the value of the <code id=the-tabindex-attribute:attr-tabindex-11><a href=#attr-tabindex>tabindex</a></code> attribute on <var>candidate</var> but that is
     earlier in the document in <a id=the-tabindex-attribute:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> than <var>candidate</var>,<li>before any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-13>focusable area</a> whose <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-8>DOM anchor</a> is an element whose <code id=the-tabindex-attribute:attr-tabindex-12><a href=#attr-tabindex>tabindex</a></code> attribute has a value equal to the value of the <code id=the-tabindex-attribute:attr-tabindex-13><a href=#attr-tabindex>tabindex</a></code> attribute on <var>candidate</var> but that is
     later in the document in <a id=the-tabindex-attribute:tree-order-2 href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> than <var>candidate</var>, and<li>before any <a href=#focusable-area id=the-tabindex-attribute:focusable-area-14>focusable area</a> whose <a href=#dom-anchor id=the-tabindex-attribute:dom-anchor-9>DOM anchor</a> is an element whose <code id=the-tabindex-attribute:attr-tabindex-14><a href=#attr-tabindex>tabindex</a></code> attribute has a value greater than the value of the
     <code id=the-tabindex-attribute:attr-tabindex-15><a href=#attr-tabindex>tabindex</a></code> attribute on <var>candidate</var>.</ul>

   </dl>

  <p>An element with the <code id=the-tabindex-attribute:attr-tabindex-16><a href=#attr-tabindex>tabindex</a></code> attribute specified is
  <a href=#interactive-content-2 id=the-tabindex-attribute:interactive-content-2>interactive content</a>.</p>

  <p>The <dfn id=dom-tabindex><code>tabIndex</code></dfn> IDL attribute must
  <a href=#reflect id=the-tabindex-attribute:reflect>reflect</a> the value of the <code id=the-tabindex-attribute:attr-tabindex-17><a href=#attr-tabindex>tabindex</a></code> content
  attribute. Its default value is 0 for elements that are focusable and −1 for elements that
  are not focusable.</p>

  


  

  <h4 id=focus-processing-model>6.4.4 <span id=processing-model-5></span>Processing model<a href=#focus-processing-model class=self-link></a></h4>

  <p>The <dfn id=focusing-steps data-export="">focusing steps</dfn> for an object <var>new focus target</var> that is
  either a <a href=#focusable-area id=focus-processing-model:focusable-area>focusable area</a>, or an element that is not a <a href=#focusable-area id=focus-processing-model:focusable-area-2>focusable area</a>, or
  a <a href=#browsing-context id=focus-processing-model:browsing-context>browsing context</a>, are as follows. They can optionally be run with a <i>fallback
  target</i>.</p>

  <ol><li>

    <p>If <var>new focus target</var> is neither a <code id=focus-processing-model:the-dialog-element><a href=#the-dialog-element>dialog</a></code> element that has an
    <code id=focus-processing-model:attr-dialog-open><a href=#attr-dialog-open>open</a></code> attribute specified and that is <a href=#being-rendered id=focus-processing-model:being-rendered>being
    rendered</a> (i.e. that is a <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object>control group owner object</a>), nor a <a href=#focusable-area id=focus-processing-model:focusable-area-3>focusable
    area</a>, then run the first matching set of steps from the following list:</p>

    <dl class=switch><dt>If <var>new focus target</var> is an <code id=focus-processing-model:the-area-element><a href=#the-area-element>area</a></code> element with one or more
     shapes that are <a href=#focusable-area id=focus-processing-model:focusable-area-4>focusable areas</a><dd>

      <p>Let <var>new focus target</var> be the shape corresponding to the first
      <code id=focus-processing-model:the-img-element><a href=#the-img-element>img</a></code> element in <a id=focus-processing-model:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> that uses the image map to which the <code id=focus-processing-model:the-area-element-2><a href=#the-area-element>area</a></code>
      element belongs.</p>

     <dt>If <var>new focus target</var> is an element with one or more scrollable regions
     that are <a href=#focusable-area id=focus-processing-model:focusable-area-5>focusable areas</a><dd>

      <p>Let <var>new focus target</var> be the element's first scrollable region,
      according to a pre-order, depth-first traversal of the box tree. <a href=#refsCSS>[CSS]</a></p>

     <dt>If <var>new focus target</var> is the <a id=focus-processing-model:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> of its
     <code id=focus-processing-model:document><a href=#document>Document</a></code><dd>

      <p>Let <var>new focus target</var> be the <code id=focus-processing-model:document-2><a href=#document>Document</a></code>'s <a id=focus-processing-model:viewport href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>.</p>

     <dt>If <var>new focus target</var> is a <a href=#browsing-context id=focus-processing-model:browsing-context-2>browsing context</a><dd>

      <p>Let <var>new focus target</var> be the <a href=#browsing-context id=focus-processing-model:browsing-context-3>browsing context</a>'s
      <a href=#active-document id=focus-processing-model:active-document>active document</a>.</p>

     <dt>If <var>new focus target</var> is a <a href=#browsing-context-container id=focus-processing-model:browsing-context-container>browsing context container</a> with a non-null
     <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context>nested browsing context</a><dd>

      <p>Let <var>new focus target</var> be the <a href=#browsing-context-container id=focus-processing-model:browsing-context-container-2>browsing context container</a>'s <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-2>nested browsing context</a>'s
      <a href=#active-document id=focus-processing-model:active-document-2>active document</a>.</p>

     <dt>Otherwise<dd>

      <p>If no <i>fallback target</i> was specified, abort the <a href=#focusing-steps id=focus-processing-model:focusing-steps>focusing steps</a>.</p>

      <p>Otherwise, let <var>new focus target</var> be the <i>fallback target</i>.</p>

     </dl>

   <li>

    <p>If <var>new focus target</var> is a <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object-2>control group owner object</a> that is
    not a <a href=#focusable-area id=focus-processing-model:focusable-area-6>focusable area</a>, but does have a <a href=#dialog-group id=focus-processing-model:dialog-group>dialog group</a>, and that <a href=#dialog-group id=focus-processing-model:dialog-group-2>dialog group</a>
    has a designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group>focused dialog</a>, then
    let <var>new focus target</var> be the <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-2>focused dialog of the dialog
    group</a>, and redo this step.</p>

    <p>Otherwise, if <var>new focus target</var> is a <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object-3>control group owner
    object</a> that is not a <a href=#focusable-area id=focus-processing-model:focusable-area-7>focusable area</a>, and its <a href=#control-group id=focus-processing-model:control-group>control group</a> is not empty,
    then designate <var>new focus target</var> as the <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group>focused area of the control
    group</a>, and redo this step.</p>

    
    <p>Otherwise, if <var>new focus target</var> is a <a href=#browsing-context-container id=focus-processing-model:browsing-context-container-3>browsing context container</a> with
    non-null <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-3>nested browsing context</a>, then let <var>new focus target</var> be the
    <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-4>nested browsing context</a>'s <a href=#active-document id=focus-processing-model:active-document-3>active document</a>, and redo this step.</p>

    <p class=note>A <code id=focus-processing-model:the-dialog-element-2><a href=#the-dialog-element>dialog</a></code> element can be both a <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object-4>control group owner
    object</a> and a <a href=#focusable-area id=focus-processing-model:focusable-area-8>focusable area</a>, if it has both an <code id=focus-processing-model:attr-dialog-open-2><a href=#attr-dialog-open>open</a></code> attribute specified and a <code id=focus-processing-model:attr-tabindex><a href=#attr-tabindex>tabindex</a></code> attribute specified and is <a href=#being-rendered id=focus-processing-model:being-rendered-2>being
    rendered</a>.</p>

   <li><p>If <var>new focus target</var> is a <a href=#focusable-area id=focus-processing-model:focusable-area-9>focusable area</a> and its <a href=#dom-anchor id=focus-processing-model:dom-anchor>DOM
   anchor</a> is <a href=#inert id=focus-processing-model:inert>inert</a>, then abort these steps.<li><p>If <var>new focus target</var> is the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context>currently focused area of a
   top-level browsing context</a>, then abort these steps.<li><p>Let <var>old chain</var> be the <a href=#focus-chain id=focus-processing-model:focus-chain>focus chain</a> of the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-2>currently focused area of the
   top-level browsing context</a> in which <var>new focus target</var> finds
   itself.<li><p>Let <var>new chain</var> be the <a href=#focus-chain id=focus-processing-model:focus-chain-2>focus chain</a> of <var>new
   focus target</var>.<li><p>Run the <a href=#focus-update-steps id=focus-processing-model:focus-update-steps>focus update steps</a> with <var>old chain</var>, <var>new chain</var>, and <var>new focus target</var> respectively.</ol>

  <p>User agents must <a href=#immediately id=focus-processing-model:immediately>immediately</a> run the <a href=#focusing-steps id=focus-processing-model:focusing-steps-2>focusing steps</a> for a <a href=#focusable-area id=focus-processing-model:focusable-area-10>focusable area</a>,
  <code id=focus-processing-model:the-dialog-element-3><a href=#the-dialog-element>dialog</a></code>, or <a href=#browsing-context id=focus-processing-model:browsing-context-4>browsing context</a> <var>candidate</var> whenever the
  user attempts to move the focus to <var>candidate</var>.</p>

  <p>The <dfn id=unfocusing-steps>unfocusing steps</dfn> for an object <var>old focus target</var> that is
  either a <a href=#focusable-area id=focus-processing-model:focusable-area-11>focusable area</a> or an element that is not a <a href=#focusable-area id=focus-processing-model:focusable-area-12>focusable area</a> are as
  follows:</p>

  <ol><li><p>If <var>old focus target</var> is <a href=#inert id=focus-processing-model:inert-2>inert</a>, then abort these
   steps.<li>

    <p>If <var>old focus target</var> is an <code id=focus-processing-model:the-area-element-3><a href=#the-area-element>area</a></code> element and one of its shapes is the
    <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-3>currently focused area of a top-level browsing context</a>, or, if <var>old focus
    target</var> is an element with one or more scrollable regions, and one of them is the
    <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-4>currently focused area of a top-level browsing context</a>, then let <var>old focus
    target</var> be that <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-5>currently focused area of a top-level browsing context</a>.</p>

   <li><p>Let <var>old chain</var> be the <a href=#focus-chain id=focus-processing-model:focus-chain-3>focus chain</a> of the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-6>currently
   focused area of a top-level browsing context</a>.<li><p>If <var>old focus target</var> is not one of the entries in <var>old
   chain</var>, then abort these steps.<li>

    <p>If <var>old focus target</var> is a <code id=focus-processing-model:the-dialog-element-4><a href=#the-dialog-element>dialog</a></code> in a <a href=#dialog-group id=focus-processing-model:dialog-group-3>dialog group</a>, and
    the <a href=#dialog-group-manager id=focus-processing-model:dialog-group-manager>dialog group manager</a> has a non-empty <a href=#control-group id=focus-processing-model:control-group-2>control group</a>, then let
    <var>new focus target</var> be the designated <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-2>focused area of that focus group</a>.</p>

    <p>Otherwise, if <var>old focus target</var> is a <a href=#focusable-area id=focus-processing-model:focusable-area-13>focusable area</a>, then let <var>new
    focus target</var> be the first <a href=#focusable-area id=focus-processing-model:focusable-area-14>focusable area</a> of its <a href=#control-group id=focus-processing-model:control-group-3>control group</a>
    (if the <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object-5>control group owner object</a> is a <code id=focus-processing-model:document-3><a href=#document>Document</a></code>, this will always be
    a <a id=focus-processing-model:viewport-2 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>).</p>

    <p>Otherwise, let <var>new focus target</var> be null.</p>

   <li><p>If <var>new focus target</var> is not null, then run the <a href=#focusing-steps id=focus-processing-model:focusing-steps-3>focusing
   steps</a> for <var>new focus target</var>.</ol>

  <p>When the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-7>currently focused area of a top-level browsing context</a> is somehow
  unfocused without another element being explicitly focused in its stead, the user agent must
  <a href=#immediately id=focus-processing-model:immediately-2>immediately</a> run the <a href=#unfocusing-steps id=focus-processing-model:unfocusing-steps>unfocusing steps</a> for that object.</p>

  <p class=note>The <a href=#unfocusing-steps id=focus-processing-model:unfocusing-steps-2>unfocusing steps</a> do not always result in the focus changing, even
  when applied to the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-8>currently focused area of a top-level browsing context</a>. For
  example, if the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-9>currently focused area of a top-level browsing context</a> is a
  <a id=focus-processing-model:viewport-3 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>, then it will usually keep its focus regardless until another
  <a href=#focusable-area id=focus-processing-model:focusable-area-15>focusable area</a> is explicitly focused with the <a href=#focusing-steps id=focus-processing-model:focusing-steps-4>focusing steps</a>.</p>

  <hr>

  <p>When a <a href=#focusable-area id=focus-processing-model:focusable-area-16>focusable area</a> is added to an empty <a href=#control-group id=focus-processing-model:control-group-4>control group</a>, it must be designated
  the <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-3>focused area of the control group</a>.</p>

  <p>When a <a href=#dialog-group id=focus-processing-model:dialog-group-4>dialog group</a> is formed, if the <a href=#dialog-group-manager id=focus-processing-model:dialog-group-manager-2>dialog group manager</a> has an empty
  <a href=#control-group id=focus-processing-model:control-group-5>control group</a>, the first non-<a href=#inert id=focus-processing-model:inert-3>inert</a> <code id=focus-processing-model:the-dialog-element-5><a href=#the-dialog-element>dialog</a></code> in the <a href=#dialog-group id=focus-processing-model:dialog-group-5>dialog
  group</a>, if any, or else the first <code id=focus-processing-model:the-dialog-element-6><a href=#the-dialog-element>dialog</a></code> in the <a href=#dialog-group id=focus-processing-model:dialog-group-6>dialog group</a> regardless of
  <a href=#inert id=focus-processing-model:inert-4>inertness</a>, must be designated the <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-3>focused dialog of the dialog
  group</a>.</p>

  <p><dfn id=focus-fixup-rule-one>Focus fixup rule one</dfn>: When the designated <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-4>focused area of a control group</a> is removed from that <a href=#control-group id=focus-processing-model:control-group-6>control group</a> in
  some way (e.g. it stops being a <a href=#focusable-area id=focus-processing-model:focusable-area-17>focusable area</a>, it is removed from the DOM, it
  becomes <a href=#expressly-inert id=focus-processing-model:expressly-inert>expressly inert</a>, etc), and the <a href=#control-group id=focus-processing-model:control-group-7>control group</a> is still not
  empty: designate the first non-<a href=#inert id=focus-processing-model:inert-5>inert</a> <a href=#focusable-area id=focus-processing-model:focusable-area-18>focusable area</a> in that
  <a href=#control-group id=focus-processing-model:control-group-8>control group</a> to be the new <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-5>focused area of the control group</a>, if any;
  if they are all <a href=#inert id=focus-processing-model:inert-6>inert</a>, then designate the first <a href=#focusable-area id=focus-processing-model:focusable-area-19>focusable area</a> in that
  <a href=#control-group id=focus-processing-model:control-group-9>control group</a> to be the new <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-6>focused area of the control group</a> regardless
  of <a href=#inert id=focus-processing-model:inert-7>inertness</a>. If such a removal instead results in the <a href=#control-group id=focus-processing-model:control-group-10>control
  group</a> being empty, then there is simply no longer a <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-7>focused area of the control
  group</a>.</p>

  <p class=example>For example, this might happen because an element is removed from its
  <code id=focus-processing-model:document-4><a href=#document>Document</a></code>, or has a <code id=focus-processing-model:the-hidden-attribute><a href=#the-hidden-attribute>hidden</a></code> attribute added. It might
  also happen to an <code id=focus-processing-model:the-input-element><a href=#the-input-element>input</a></code> element when the element gets <a href=#concept-fe-disabled id=focus-processing-model:concept-fe-disabled>disabled</a>.</p>

  <p class=example>In a <code id=focus-processing-model:document-5><a href=#document>Document</a></code> without <code id=focus-processing-model:the-dialog-element-7><a href=#the-dialog-element>dialog</a></code> elements, whose <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-8>focused area</a> is a <code id=focus-processing-model:the-button-element><a href=#the-button-element>button</a></code> element,
  removing, disabling, or hiding that button would cause the page's new <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-9>focused area</a> to be the <a id=focus-processing-model:viewport-4 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> of the
  <code id=focus-processing-model:document-6><a href=#document>Document</a></code>. This would, in turn, be reflected through the <code id=focus-processing-model:dom-document-activeelement><a href=#dom-document-activeelement>activeElement</a></code> API as <a href=#the-body-element-2 id=focus-processing-model:the-body-element-2>the body
  element</a>.</p>

  <p><dfn id=focus-fixup-rule-two>Focus fixup rule two</dfn>: When a <a href=#dialog-group id=focus-processing-model:dialog-group-7>dialog group</a> has no designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-4>focused
  dialog of the dialog group</a>, and its <a href=#dialog-group-manager id=focus-processing-model:dialog-group-manager-3>dialog group manager</a>'s <a href=#control-group id=focus-processing-model:control-group-11>control
  group</a> changes from being non-empty to being empty, the first non-<a href=#inert id=focus-processing-model:inert-8>inert</a>
  <code id=focus-processing-model:the-dialog-element-8><a href=#the-dialog-element>dialog</a></code> in the <a href=#dialog-group id=focus-processing-model:dialog-group-8>dialog group</a>, if any, or else the first <code id=focus-processing-model:the-dialog-element-9><a href=#the-dialog-element>dialog</a></code> in
  the <a href=#dialog-group id=focus-processing-model:dialog-group-9>dialog group</a> regardless of <a href=#inert id=focus-processing-model:inert-9>inertness</a>, must be designated
  the <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-5>focused dialog of the dialog group</a>.</p>

  <p><dfn id=focus-fixup-rule-three>Focus fixup rule three</dfn>: When the designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-6>focused dialog of a dialog group</a> is removed from that <a href=#dialog-group id=focus-processing-model:dialog-group-10>dialog
  group</a> in some way (e.g. it stops <a href=#being-rendered id=focus-processing-model:being-rendered-3>being rendered</a>, it loses its <code id=focus-processing-model:attr-dialog-open-3><a href=#attr-dialog-open>open</a></code> attribute, it becomes <a href=#expressly-inert id=focus-processing-model:expressly-inert-2>expressly inert</a>, etc),
  and there is still a <a href=#dialog-group id=focus-processing-model:dialog-group-11>dialog group</a> (because the <code id=focus-processing-model:the-dialog-element-10><a href=#the-dialog-element>dialog</a></code> in question was
  not the last <code id=focus-processing-model:the-dialog-element-11><a href=#the-dialog-element>dialog</a></code> in that <a href=#dialog-group id=focus-processing-model:dialog-group-12>dialog group</a>): if the <a href=#dialog-group id=focus-processing-model:dialog-group-13>dialog
  group</a>'s <a href=#dialog-group-manager id=focus-processing-model:dialog-group-manager-4>manager</a>'s <a href=#control-group id=focus-processing-model:control-group-12>control group</a> is
  non-empty, let there be no designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-7>focused dialog of the dialog group</a> any more;
  otherwise (in the case that the <a href=#control-group id=focus-processing-model:control-group-13>control group</a> is empty), designate the first
  non-<a href=#inert id=focus-processing-model:inert-10>inert</a> <code id=focus-processing-model:the-dialog-element-12><a href=#the-dialog-element>dialog</a></code> in the <a href=#dialog-group id=focus-processing-model:dialog-group-14>dialog group</a> to be the
  <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-8>focused dialog of the dialog group</a>, or, if they are all <a href=#inert id=focus-processing-model:inert-11>inert</a>, designate
  the first <code id=focus-processing-model:the-dialog-element-13><a href=#the-dialog-element>dialog</a></code> in the <a href=#dialog-group id=focus-processing-model:dialog-group-15>dialog group</a> to be the <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-9>focused dialog of
  the dialog group</a> regardless of <a href=#inert id=focus-processing-model:inert-12>inertness</a>.</p>

  <p>When the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-10>currently focused area of a top-level browsing context</a> was a <a href=#focusable-area id=focus-processing-model:focusable-area-20>focusable
  area</a> but stops being a <a href=#focusable-area id=focus-processing-model:focusable-area-21>focusable area</a>, or when it was a <code id=focus-processing-model:the-dialog-element-14><a href=#the-dialog-element>dialog</a></code> in a
  <a href=#dialog-group id=focus-processing-model:dialog-group-16>dialog group</a> and stops being part of that <a href=#dialog-group id=focus-processing-model:dialog-group-17>dialog group</a>, or when it
  starts being <a href=#inert id=focus-processing-model:inert-13>inert</a>, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>old focus target</var> be whatever the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-11>currently focused area of the top-level browsing
   context</a> was immediately before this algorithm became applicable (e.g. before the element
   was disabled, or the dialog was closed, or whatever caused this algorithm to run).<li><p>Let <var>old chain</var> be the <a href=#focus-chain id=focus-processing-model:focus-chain-4>focus chain</a> of the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-12>currently focused area of the
   top-level browsing context</a> at the same time.<li><p>Make sure that the changes implied by the focus fixup rules <a href=#focus-fixup-rule-one id=focus-processing-model:focus-fixup-rule-one>one</a>, <a href=#focus-fixup-rule-two id=focus-processing-model:focus-fixup-rule-two>two</a>, and <a href=#focus-fixup-rule-three id=focus-processing-model:focus-fixup-rule-three>three</a> above are applied.<li><p>Let <var>new focus target</var> be the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-13>currently focused area of a
   top-level browsing context</a>.<li><p>If <var>old focus target</var> and <var>new focus target</var> are the
   same, abort these steps.<li><p>Let <var>new chain</var> be the <a href=#focus-chain id=focus-processing-model:focus-chain-5>focus chain</a> of <var>new
   focus target</var>.<li><p>Run the <a href=#focus-update-steps id=focus-processing-model:focus-update-steps-2>focus update steps</a> with <var>old chain</var>, <var>new chain</var>, and <var>new focus target</var> respectively.</ol>

  <hr>

  <p>The <dfn id=focus-update-steps>focus update steps</dfn>, given an <var>old chain</var>, a <var>new chain</var>, and a <var>new focus target</var> respectively, are as
  follows:</p>

  <ol><li><p>If the last entry in <var>old chain</var> and the last entry in <var>new chain</var> are the same, pop the last entry from <var>old chain</var>
   and the last entry from <var>new chain</var> and redo this step.<li>

    <p>For each entry <var>entry</var> in <var>old chain</var>, in order, run
    these substeps:</p>

    <ol><li id=unfocus-causes-change-event><p>If <var>entry</var> is an <code id=focus-processing-model:the-input-element-2><a href=#the-input-element>input</a></code>
     element, and the <code id=focus-processing-model:event-change><a href=#event-change>change</a></code> event <a href=#concept-input-apply id=focus-processing-model:concept-input-apply>applies</a> to the element, and the element does not have a
     defined <a id=focus-processing-model:activation-behaviour href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a>, and the user has changed the element's <a href=#concept-fe-value id=focus-processing-model:concept-fe-value>value</a> or its list of <a href=#concept-input-type-file-selected id=focus-processing-model:concept-input-type-file-selected>selected files</a> while the control was focused
     without committing that change (such that it is different to what it was when the control was
     first focused), then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=focus-processing-model:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=focus-processing-model:event-change-2><a href=#event-change>change</a></code> at the element, with the <code id=focus-processing-model:dom-event-bubbles><a data-x-internal=dom-event-bubbles href=https://dom.spec.whatwg.org/#dom-event-bubbles>bubbles</a></code> attribute initialized to true.</p>

     <li>

      <p>If <var>entry</var> is an element, let <var>blur event target</var> be
      <var>entry</var>.</p>

      <p>If <var>entry</var> is a <code id=focus-processing-model:document-7><a href=#document>Document</a></code> object, let <var>blur
      event target</var> be that <code id=focus-processing-model:document-8><a href=#document>Document</a></code> object's <code id=focus-processing-model:window><a href=#window>Window</a></code> object.</p>

      <p>Otherwise, let <var>blur event target</var> be null.</p>

     <li><p>If <var>entry</var> is the last entry in <var>old chain</var>, and
     <var>entry</var> is an <code id=focus-processing-model:element><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code>, and the last entry in <var>new
     chain</var> is also an <code id=focus-processing-model:element-2><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code>, then let <var>related blur target</var>
     be the last entry in <var>new chain</var>. Otherwise, let <var>related blur
     target</var> be null.<li>

      <p>If <var>blur event target</var> is not null, <a href=#fire-a-focus-event id=focus-processing-model:fire-a-focus-event>fire a focus event</a>
      named <code id=focus-processing-model:event-blur><a href=#event-blur>blur</a></code> at <var>blur event target</var>, with
      <var>related blur target</var> as the related target.</p>

      <p class=note>In some cases, e.g. if <var>entry</var> is an <code id=focus-processing-model:the-area-element-4><a href=#the-area-element>area</a></code>
      element's shape, a scrollable region, or a <a id=focus-processing-model:viewport-5 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>, no event is fired.</p>

     </ol>

   <li><p>Apply any relevant platform-specific conventions for focusing <var>new focus
   target</var>. (For example, some platforms select the contents of a text control when that
   control is focused.)<li>

    <p>For each entry <var>entry</var> in <var>new chain</var>, in reverse
    order, run these substeps:</p>

    <ol><li><p>If <var>entry</var> is a <code id=focus-processing-model:the-dialog-element-15><a href=#the-dialog-element>dialog</a></code> element: Let <var>entry</var> be the designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-10>focused dialog of its dialog group</a>.<li>

      <p>If <var>entry</var> is a <a href=#focusable-area id=focus-processing-model:focusable-area-22>focusable area</a>: Designate <var>entry</var> as the
      <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-10>focused area of the control group</a>. If its <a href=#control-group id=focus-processing-model:control-group-14>control group</a>'s <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object-6>owner object</a> is also a <a href=#dialog-group-manager id=focus-processing-model:dialog-group-manager-5>dialog group
      manager</a>, then let there be no designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-11>focused dialog</a> in that <a href=#dialog-group id=focus-processing-model:dialog-group-18>dialog group</a>.</p>

      <p class=note>It is possible for <var>entry</var> to be both a <code id=focus-processing-model:the-dialog-element-16><a href=#the-dialog-element>dialog</a></code>
      element and a <a href=#focusable-area id=focus-processing-model:focusable-area-23>focusable area</a>, in which case it is its own <a href=#control-group-owner-object id=focus-processing-model:control-group-owner-object-7>control group
      owner object</a>.</p>

     <li>

      <p>If <var>entry</var> is an element, let <var>focus event target</var> be
      <var>entry</var>.</p>

      <p>If <var>entry</var> is a <code id=focus-processing-model:document-9><a href=#document>Document</a></code> object, let <var>focus
      event target</var> be that <code id=focus-processing-model:document-10><a href=#document>Document</a></code> object's <code id=focus-processing-model:window-2><a href=#window>Window</a></code> object.</p>

      <p>Otherwise, let <var>focus event target</var> be null.</p>

     <li><p>If <var>entry</var> is the last entry in <var>new chain</var>, and
     <var>entry</var> is an <code id=focus-processing-model:element-3><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code>, and the last entry in <var>old
     chain</var> is also an <code id=focus-processing-model:element-4><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code>, then let <var>related focus target</var>
     be the last entry in <var>old chain</var>. Otherwise, let <var>related
     focus target</var> be null.<li>

      <p>If <var>focus event target</var> is not null, <a href=#fire-a-focus-event id=focus-processing-model:fire-a-focus-event-2>fire a focus event</a>
      named <code id=focus-processing-model:event-focus><a href=#event-focus>focus</a></code> at <var>focus event target</var>, with
      <var>related focus target</var> as the related target.</p>

      <p class=note>In some cases, e.g. if <var>entry</var> is an <code id=focus-processing-model:the-area-element-5><a href=#the-area-element>area</a></code>
      element's shape, a scrollable region, or a <a id=focus-processing-model:viewport-6 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>, no event is fired.</p>

     </ol>

   </ol>

  <p>To <dfn id=fire-a-focus-event>fire a focus event</dfn> named <var>e</var> at an element <var>t</var> and with a given
  related target <var>r</var>, <a href=https://dom.spec.whatwg.org/#concept-event-fire id=focus-processing-model:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named
  <var>e</var> at <var>t</var>, using <code id=focus-processing-model:focusevent><a data-x-internal=focusevent href=https://w3c.github.io/uievents/#interface-FocusEvent>FocusEvent</a></code>, with the <code id=focus-processing-model:dom-focusevent-relatedtarget><a data-x-internal=dom-focusevent-relatedtarget href=https://w3c.github.io/uievents/#widl-FocusEvent-relatedTarget>relatedTarget</a></code> attribute initialized to <var>r</var>
  and the <code id=focus-processing-model:dom-uievent-view><a data-x-internal=dom-uievent-view href=https://w3c.github.io/uievents/#widl-UIEvent-view>view</a></code> attribute initialized to <var>t</var>'s
  <a id=focus-processing-model:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <code id=focus-processing-model:window-3><a href=#window>Window</a></code> object.</p>

  <hr>

  <p>When a key event is to be routed in a <a href=#top-level-browsing-context id=focus-processing-model:top-level-browsing-context>top-level browsing context</a>, the user agent
  must run the following steps:</p>

  

  <ol><li><p>Let <var>target area</var> be the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-14>currently focused area of the top-level browsing
   context</a>.<li><p>If <var>target area</var> is a <a href=#focusable-area id=focus-processing-model:focusable-area-24>focusable area</a>, let <var>target
   node</var> be <var>target area</var>'s <a href=#dom-anchor id=focus-processing-model:dom-anchor-2>DOM anchor</a>. Otherwise, <var>target area</var> is a <code id=focus-processing-model:the-dialog-element-17><a href=#the-dialog-element>dialog</a></code>; let <var>target node</var> be
   <var>target area</var>.<li>

    <p>If <var>target node</var> is a <code id=focus-processing-model:document-11><a href=#document>Document</a></code> that has a <a href=#the-body-element-2 id=focus-processing-model:the-body-element-2-2>body element</a>, then let <var>target node</var> be <a href=#the-body-element-2 id=focus-processing-model:the-body-element-2-3>the body
    element</a> of that <code id=focus-processing-model:document-12><a href=#document>Document</a></code>.</p>

    <p>Otherwise, if <var>target node</var> is a <code id=focus-processing-model:document-13><a href=#document>Document</a></code> object that has a non-null
    <a id=focus-processing-model:document-element-2 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a>, then let <var>target node</var> be that <a id=focus-processing-model:document-element-3 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document
    element</a>.</p>

   <li>

    <p>If <var>target node</var> is not <a href=#inert id=focus-processing-model:inert-14>inert</a>, then:</p>

    <p class=note>It is possible for the <a href=#currently-focused-area-of-a-top-level-browsing-context id=focus-processing-model:currently-focused-area-of-a-top-level-browsing-context-15>currently focused area of a top-level browsing
    context</a> to be <a href=#inert id=focus-processing-model:inert-15>inert</a>, for example if a <a href=#dom-dialog-showmodal id=focus-processing-model:dom-dialog-showmodal>modal dialog is shown</a>, and then that <code id=focus-processing-model:the-dialog-element-18><a href=#the-dialog-element>dialog</a></code>
    element is made <a href=#inert id=focus-processing-model:inert-16>inert</a>. It is likely to be the result of a logic error in the
    application, though.</p>

    <ol><li><p>Let <var>canHandle</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=focus-processing-model:concept-event-dispatch data-x-internal=concept-event-dispatch>dispatching</a> the key event at <var>target
     node</var>.<li><p>If <var>canHandle</var> is true, then let <var>target area</var> handle the key event.
     This might include <a href=#fire-a-click-event id=focus-processing-model:fire-a-click-event>firing a <code>click</code> event</a> at <var>target node</var>.</ol>

   </ol>

  <hr>

  <p>The <dfn id=has-focus-steps data-export="">has focus steps</dfn>, given a <code id=focus-processing-model:document-14><a href=#document>Document</a></code> object
  <var>target</var>, are as follows:</p>

  <ol><li><p>Let <var>candidate</var> be the <code id=focus-processing-model:document-15><a href=#document>Document</a></code> of the <a href=#top-level-browsing-context id=focus-processing-model:top-level-browsing-context-2>top-level browsing
   context</a>.<li><p>If <var>candidate</var> is <var>target</var>, return true and abort these steps.<li>

    <p>If <var>candidate</var> has a <a href=#dialog-group id=focus-processing-model:dialog-group-19>dialog group</a> with a designated <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-12>focused
    dialog of the dialog group</a>, then let <var>candidate</var> be the designated
    <a href=#focused-dialog-of-the-dialog-group id=focus-processing-model:focused-dialog-of-the-dialog-group-13>focused dialog of the dialog group</a>, and redo this step.</p>

    <p>Otherwise, if <var>candidate</var> has a non-empty <a href=#control-group id=focus-processing-model:control-group-15>control group</a>, and the
    designated <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-11>focused area of the control group</a> is a <a href=#browsing-context-container id=focus-processing-model:browsing-context-container-4>browsing context
    container</a> with a non-null <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-5>nested browsing context</a>, and the <a href=#active-document id=focus-processing-model:active-document-4>active
    document</a> of that <a href=#browsing-context-container id=focus-processing-model:browsing-context-container-5>browsing context container</a>'s <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-6>nested browsing
    context</a> is <var>target</var>, then return true and abort these steps.</p>

    <p>Otherwise, if <var>candidate</var> has a non-empty <a href=#control-group id=focus-processing-model:control-group-16>control group</a>, and the
    designated <a href=#focused-area-of-the-control-group id=focus-processing-model:focused-area-of-the-control-group-12>focused area of the control group</a> is a <a href=#browsing-context-container id=focus-processing-model:browsing-context-container-6>browsing context
    container</a> with a non-null <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-7>nested browsing context</a>, then let
    <var>candidate</var> be the <a href=#active-document id=focus-processing-model:active-document-5>active document</a> of that <a href=#browsing-context-container id=focus-processing-model:browsing-context-container-7>browsing context
    container</a>'s <a href=#nested-browsing-context id=focus-processing-model:nested-browsing-context-8>nested browsing context</a>, and redo this step.</p>

    <p>Otherwise, return false and abort these steps.</p>

   </ol>



  <h4 id=sequential-focus-navigation>6.4.5 <dfn>Sequential focus navigation</dfn><a href=#sequential-focus-navigation class=self-link></a></h4>

  <p>Each <a href=#control-group id=sequential-focus-navigation:control-group>control group</a> has a <dfn id=sequential-focus-navigation-order>sequential focus navigation order</dfn>, which orders some
  or all of the <a href=#focusable-area id=sequential-focus-navigation:focusable-area>focusable areas</a> in the <a href=#control-group id=sequential-focus-navigation:control-group-2>control group</a>
  relative to each other. The order in the <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order>sequential focus navigation order</a> does not
  have to be related to the order in the <a href=#control-group id=sequential-focus-navigation:control-group-3>control group</a> itself. If a <a href=#focusable-area id=sequential-focus-navigation:focusable-area-2>focusable area</a> is
  omitted from the <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-2>sequential focus navigation order</a> of its <a href=#control-group id=sequential-focus-navigation:control-group-4>control group</a>, then
  it is unreachable via <a href=#sequential-focus-navigation id=sequential-focus-navigation:sequential-focus-navigation>sequential focus navigation</a>.</p>

  <p>There can also be a <dfn id=sequential-focus-navigation-starting-point>sequential focus navigation starting point</dfn>. It is initially
  unset. The user agent may set it when the user indicates that it should be moved.</p>

  <p class=example>For example, the user agent could set it to the position of the user's click if
  the user clicks on the document contents.</p>

  <p>When the user requests that focus move from the <a href=#currently-focused-area-of-a-top-level-browsing-context id=sequential-focus-navigation:currently-focused-area-of-a-top-level-browsing-context>currently focused area of a top-level
  browsing context</a> to the next or previous <a href=#focusable-area id=sequential-focus-navigation:focusable-area-3>focusable area</a> (e.g. as the default action
  of pressing the <kbd>tab</kbd> key), or when the user requests that focus sequentially move to a
  <a href=#top-level-browsing-context id=sequential-focus-navigation:top-level-browsing-context>top-level browsing context</a> in the first place (e.g. from the browser's location bar),
  the user agent must use the following algorithm:</p>

  <ol><li><p>Let <var>starting point</var> be the <a href=#currently-focused-area-of-a-top-level-browsing-context id=sequential-focus-navigation:currently-focused-area-of-a-top-level-browsing-context-2>currently focused area of a top-level
   browsing context</a>, if the user requested to move focus sequentially from there, or else the
   <a href=#top-level-browsing-context id=sequential-focus-navigation:top-level-browsing-context-2>top-level browsing context</a> itself, if the user instead requested to move focus from
   outside the <a href=#top-level-browsing-context id=sequential-focus-navigation:top-level-browsing-context-3>top-level browsing context</a>.<li><p>If there is a <a href=#sequential-focus-navigation-starting-point id=sequential-focus-navigation:sequential-focus-navigation-starting-point>sequential focus navigation starting point</a> defined and it is
   inside <var>starting point</var>, then let <var>starting point</var> be the <a href=#sequential-focus-navigation-starting-point id=sequential-focus-navigation:sequential-focus-navigation-starting-point-2>sequential
   focus navigation starting point</a> instead.<li>

    <p>Let <var>direction</var> be <i>forward</i> if the user requested the <em>next</em>
    control, and <i>backward</i> if the user requested the previous control.</p>

    <p class=note>Typically, pressing <kbd>tab</kbd> requests the next control, and pressing
    <kbd><kbd>shift</kbd>+<kbd>tab</kbd></kbd> requests the previous control.</p>

   <li>

    <p><i>Loop</i>: Let <var>selection mechanism</var> be <i>sequential</i> if the <var>starting
    point</var> is a <a href=#browsing-context id=sequential-focus-navigation:browsing-context>browsing context</a> or if <var>starting point</var> is in its
    <a href=#control-group id=sequential-focus-navigation:control-group-5>control group</a>'s <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-3>sequential focus navigation order</a>.</p>

    <p>Otherwise, <var>starting point</var> is not in its <a href=#control-group id=sequential-focus-navigation:control-group-6>control group</a>'s
    <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-4>sequential focus navigation order</a>; let <var>selection mechanism</var> be
    <i>DOM</i>.</p>

   <li><p>Let <var>candidate</var> be the result of running the <a href=#sequential-navigation-search-algorithm id=sequential-focus-navigation:sequential-navigation-search-algorithm>sequential navigation search
   algorithm</a> with <var>starting point</var>, <var>direction</var>, and <var>selection
   mechanism</var> as the arguments.<li><p>If <var>candidate</var> is not null, then run the <a href=#focusing-steps id=sequential-focus-navigation:focusing-steps>focusing steps</a> for
   <var>candidate</var> and abort these steps.<li><p>Otherwise, unset the <a href=#sequential-focus-navigation-starting-point id=sequential-focus-navigation:sequential-focus-navigation-starting-point-3>sequential focus navigation starting point</a>.<li>

    <p>If <var>starting point</var> is the <a href=#top-level-browsing-context id=sequential-focus-navigation:top-level-browsing-context-4>top-level browsing context</a>, or a
    <a href=#focusable-area id=sequential-focus-navigation:focusable-area-4>focusable area</a> in the <a href=#top-level-browsing-context id=sequential-focus-navigation:top-level-browsing-context-5>top-level browsing context</a>, the user agent
    should transfer focus to its own controls appropriately (if any), honouring
    <var>direction</var>, and then abort these steps.</p>

    <p class=example>For example, if <var>direction</var> is <i>backward</i>, then the last
    focusable control before the browser's rendering area would be the control to focus.</p>

    <p>If the user agent has no focusable controls — a kiosk-mode browser, for instance
    — 
    then the user agent may instead restart these steps with the <var>starting point</var> being the
    <a href=#top-level-browsing-context id=sequential-focus-navigation:top-level-browsing-context-6>top-level browsing context</a> itself.</p>

    

   <li><p>Otherwise, <var>starting point</var> is a <a href=#focusable-area id=sequential-focus-navigation:focusable-area-5>focusable area</a> in a
   <a href=#nested-browsing-context id=sequential-focus-navigation:nested-browsing-context>nested browsing context</a>. Let <var>starting point</var> be that
   <a href=#nested-browsing-context id=sequential-focus-navigation:nested-browsing-context-2>nested browsing context</a>'s <a href=#browsing-context-container id=sequential-focus-navigation:browsing-context-container>browsing context container</a>, and return to the
   step labeled <i>loop</i>.</p>
    
   </ol>


  <p>The <dfn id=sequential-navigation-search-algorithm>sequential navigation search algorithm</dfn> consists of the following steps. This
  algorithm takes three arguments: <var>starting point</var>, <var>direction</var>,
  and <var>selection mechanism</var>.</p>

  <ol><li>

    <p>Pick the appropriate cell from the following table, and follow the instructions in that
    cell.</p>

    <p>The appropriate cell is the one that is from the column whose header describes <var>direction</var> and from the first row whose header describes <var>starting point</var> and <var>selection mechanism</var>.</p>

    <table><thead><tr><th>
       <th> <var>direction</var> is <i>forward</i>
       <th> <var>direction</var> is <i>backward</i>
     <tbody><tr><th><var>starting point</var> is a <a href=#browsing-context id=sequential-focus-navigation:browsing-context-2>browsing context</a>
       <td>Let <var>candidate</var> be the first <a href=#suitable-sequentially-focusable-area id=sequential-focus-navigation:suitable-sequentially-focusable-area>suitable sequentially focusable area</a> in <var>starting point</var>'s <a href=#active-document id=sequential-focus-navigation:active-document>active document</a>'s <a href=#primary-control-group id=sequential-focus-navigation:primary-control-group>primary control group</a>, if any; or else null
       <td>Let <var>candidate</var> be the last <a href=#suitable-sequentially-focusable-area id=sequential-focus-navigation:suitable-sequentially-focusable-area-2>suitable sequentially focusable area</a> in <var>starting point</var>'s <a href=#active-document id=sequential-focus-navigation:active-document-2>active document</a>'s <a href=#primary-control-group id=sequential-focus-navigation:primary-control-group-2>primary control group</a>, if any; or else null
      <tr><th><var>selection mechanism</var> is <i>DOM</i>
       <td>Let <var>candidate</var> be the first <a href=#suitable-sequentially-focusable-area id=sequential-focus-navigation:suitable-sequentially-focusable-area-3>suitable sequentially focusable area</a> in the <a href=#home-control-group id=sequential-focus-navigation:home-control-group>home control group</a> following <var>starting point</var>, if any; or else null
       <td>Let <var>candidate</var> be the last <a href=#suitable-sequentially-focusable-area id=sequential-focus-navigation:suitable-sequentially-focusable-area-4>suitable sequentially focusable area</a> in the <a href=#home-control-group id=sequential-focus-navigation:home-control-group-2>home control group</a> preceding <var>starting point</var>, if any; or else null
      <tr><th><var>selection mechanism</var> is <i>sequential</i>
       <td>Let <var>candidate</var> be the first <a href=#suitable-sequentially-focusable-area id=sequential-focus-navigation:suitable-sequentially-focusable-area-5>suitable sequentially focusable area</a> in the <a href=#home-sequential-focus-navigation-order id=sequential-focus-navigation:home-sequential-focus-navigation-order>home sequential focus navigation order</a> following <var>starting point</var>, if any; or else null
       <td>Let <var>candidate</var> be the last <a href=#suitable-sequentially-focusable-area id=sequential-focus-navigation:suitable-sequentially-focusable-area-6>suitable sequentially focusable area</a> in the <a href=#home-sequential-focus-navigation-order id=sequential-focus-navigation:home-sequential-focus-navigation-order-2>home sequential focus navigation order</a> preceding <var>starting point</var>, if any; or else null

    </table>

    <p>A <dfn id=suitable-sequentially-focusable-area>suitable sequentially focusable area</dfn> is a <a href=#focusable-area id=sequential-focus-navigation:focusable-area-6>focusable area</a> whose <a href=#dom-anchor id=sequential-focus-navigation:dom-anchor>DOM
    anchor</a> is not <a href=#inert id=sequential-focus-navigation:inert>inert</a> and that is in its <a href=#control-group id=sequential-focus-navigation:control-group-7>control group</a>'s <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-5>sequential
    focus navigation order</a>.</p>

    <p>The <dfn id=primary-control-group>primary control group</dfn> of a <a href=#control-group-owner-object id=sequential-focus-navigation:control-group-owner-object>control group owner object</a> <var>X</var> is the <a href=#control-group id=sequential-focus-navigation:control-group-8>control group</a> of <var>X</var> if <var>X</var> has no <a href=#dialog-group id=sequential-focus-navigation:dialog-group>dialog group</a> or if its <a href=#dialog-group id=sequential-focus-navigation:dialog-group-2>dialog group</a> has no
    designated <a href=#focused-dialog-of-the-dialog-group id=sequential-focus-navigation:focused-dialog-of-the-dialog-group>focused dialog of the dialog group</a>, otherwise, it is the <a href=#primary-control-group id=sequential-focus-navigation:primary-control-group-3>primary
    control group</a> of <var>X</var>'s <a href=#dialog-group id=sequential-focus-navigation:dialog-group-3>dialog group</a>'s designated
    <a href=#focused-dialog-of-the-dialog-group id=sequential-focus-navigation:focused-dialog-of-the-dialog-group-2>focused dialog of the dialog group</a>.</p>

    <p>The <dfn id=home-control-group>home control group</dfn> is the <a href=#control-group id=sequential-focus-navigation:control-group-9>control group</a> to which <var>starting point</var> belongs.</p>

    <p>The <dfn id=home-sequential-focus-navigation-order>home sequential focus navigation order</dfn> is the <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-6>sequential focus
    navigation order</a> to which <var>starting point</var> belongs.</p>

    <p class=note>The <a href=#home-sequential-focus-navigation-order id=sequential-focus-navigation:home-sequential-focus-navigation-order-3>home sequential focus navigation order</a> is the <a href=#home-control-group id=sequential-focus-navigation:home-control-group-3>home
    control group</a>'s <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-7>sequential focus navigation order</a>, but is only used when the
    <var>starting point</var> is in that <a href=#sequential-focus-navigation-order id=sequential-focus-navigation:sequential-focus-navigation-order-8>sequential focus navigation order</a>
    (when it's not, <var>selection mechanism</var> will be <i>DOM</i>).</p>

   <li>

    <p>If <var>candidate</var> is a <a href=#browsing-context-container id=sequential-focus-navigation:browsing-context-container-2>browsing context container</a> with a non-null
    <a href=#nested-browsing-context id=sequential-focus-navigation:nested-browsing-context-3>nested browsing context</a>, then let <var>new candidate</var> be the result of running
    the <a href=#sequential-navigation-search-algorithm id=sequential-focus-navigation:sequential-navigation-search-algorithm-2>sequential navigation search algorithm</a> with <var>candidate</var>'s <a href=#nested-browsing-context id=sequential-focus-navigation:nested-browsing-context-4>nested
    browsing context</a> as the first argument, <var>direction</var> as the second, and
    <i>sequential</i>  as the third.</p>

    <p>If <var>new candidate</var> is null, then let <var>starting point</var>
    be <var>candidate</var>, and return to the top of this algorithm. Otherwise, let
    <var>candidate</var> be <var>new candidate</var>.</p>

   <li><p>Return <var>candidate</var>.</ol>

  



  <h4 id=focus-management-apis>6.4.6 Focus management APIs<a href=#focus-management-apis class=self-link></a></h4>

  <dl class=domintro><dt><var>document</var> . <code id=focus-management-apis:dom-document-activeelement><a href=#dom-document-activeelement>activeElement</a></code><dd>

    <p>Returns the deepest element in the document through which or to which key events are being
    routed. This is, roughly speaking, the focused element in the document.</p>

    <p>For the purposes of this API, when a <a href=#child-browsing-context id=focus-management-apis:child-browsing-context>child browsing context</a> is focused, its
    <a href=#browsing-context-container id=focus-management-apis:browsing-context-container>browsing context container</a> is <a href=#bc-focus-ergo-bcc-focus>focused</a> in the
    <a href=#parent-browsing-context id=focus-management-apis:parent-browsing-context>parent browsing context</a>. For example, if the user moves the focus to a text control
    in an <code id=focus-management-apis:the-iframe-element><a href=#the-iframe-element>iframe</a></code>, the <code id=focus-management-apis:the-iframe-element-2><a href=#the-iframe-element>iframe</a></code> is the element returned by the <code id=focus-management-apis:dom-document-activeelement-2><a href=#dom-document-activeelement>activeElement</a></code> API in the <code id=focus-management-apis:the-iframe-element-3><a href=#the-iframe-element>iframe</a></code>'s
    <a id=focus-management-apis:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.</p>

   <dt><var>document</var> . <code id=focus-management-apis:dom-document-hasfocus><a href=#dom-document-hasfocus>hasFocus</a></code>()<dd>

    <p>Returns true if key events are being routed through or to the document; otherwise, returns
    false. Roughly speaking, this corresponds to the document, or a document nested inside this
    one, being focused.</p>

   <dt><var>window</var> . <code id=focus-management-apis:dom-window-focus><a href=#dom-window-focus>focus</a></code>()<dd>

    

    <p>Moves the focus to the window's <a href=#browsing-context id=focus-management-apis:browsing-context>browsing context</a>, if any.</p>

   <dt><var>element</var> . <code id=focus-management-apis:dom-focus><a href=#dom-focus>focus</a></code>()<dd>

    <p>Moves the focus to the element.</p>

    <p>If the element is a <a href=#browsing-context-container id=focus-management-apis:browsing-context-container-2>browsing context container</a>, moves the focus to the <a href=#nested-browsing-context id=focus-management-apis:nested-browsing-context>nested browsing context</a> instead.</p>

   <dt><var>element</var> . <code id=focus-management-apis:dom-blur><a href=#dom-blur>blur</a></code>()<dd>

    <p>Moves the focus to the <a id=focus-management-apis:viewport href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>. Use of this method is discouraged; if you want
    to focus the <a id=focus-management-apis:viewport-2 href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>, call the <code id=focus-management-apis:dom-focus-2><a href=#dom-focus>focus()</a></code> method on
    the <code id=focus-management-apis:document><a href=#document>Document</a></code>'s <a id=focus-management-apis:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a>.</p>

    <p>Do not use this method to hide the focus ring if you find the focus ring unsightly. Instead,
    use a CSS rule to override the <a id="focus-management-apis:'outline'" href=https://drafts.csswg.org/css-ui/#outline data-x-internal="'outline'">'outline'</a> property, and provide a different way to
    show what element is focused. Be aware that if an alternative focusing style isn't made
    available, the page will be significantly less usable for people who primarily navigate pages
    using a keyboard, or those with reduced vision who use focus outlines to help them navigate the
    page.</p>

    

    <div class=example>

     <p>For example, to hide the outline from links and instead use a yellow background to indicate
     focus, you could use:</p>

     <pre>:link:focus, :visited:focus { outline: none; background: yellow; color: black; }</pre>

    </div>

   </dl>

  

  <p>The <dfn id=dom-document-activeelement><code>activeElement</code></dfn> attribute on
  <code id=focus-management-apis:document-2><a href=#document>Document</a></code> objects must return the value returned by the following steps:</p>

  <ol><li><p>Let <var>candidate</var> be the <code id=focus-management-apis:document-3><a href=#document>Document</a></code> on which the method was
   invoked.<li><p>If <var>candidate</var> has a <a href=#dialog-group id=focus-management-apis:dialog-group>dialog group</a> with a designated
   <a href=#focused-dialog-of-the-dialog-group id=focus-management-apis:focused-dialog-of-the-dialog-group>focused dialog of the dialog group</a>, then let <var>candidate</var> be the
   designated <a href=#focused-dialog-of-the-dialog-group id=focus-management-apis:focused-dialog-of-the-dialog-group-2>focused dialog of the dialog group</a>, and redo this step.<li><p>If <var>candidate</var> has a non-empty <a href=#control-group id=focus-management-apis:control-group>control group</a>, let <var>candidate</var> be the designated <a href=#focused-area-of-the-control-group id=focus-management-apis:focused-area-of-the-control-group>focused area of the control
   group</a>.</p>

   <li><p>If <var>candidate</var> is a <a href=#focusable-area id=focus-management-apis:focusable-area>focusable area</a>, let <var>candidate</var> be <var>candidate</var>'s <a href=#dom-anchor id=focus-management-apis:dom-anchor>DOM anchor</a>.<li>

    <p>If <var>candidate</var> is a <code id=focus-management-apis:document-4><a href=#document>Document</a></code> that has a <a href=#the-body-element-2 id=focus-management-apis:the-body-element-2>body element</a>, then let <var>candidate</var> be <a href=#the-body-element-2 id=focus-management-apis:the-body-element-2-2>the body
    element</a> of that <code id=focus-management-apis:document-5><a href=#document>Document</a></code>.</p>

    <p>Otherwise, if <var>candidate</var> is a <code id=focus-management-apis:document-6><a href=#document>Document</a></code> with a non-null <a id=focus-management-apis:document-element-2 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document
    element</a>, then let <var>candidate</var> be that <a id=focus-management-apis:document-element-3 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a>.</p>

    <p>Otherwise, if <var>candidate</var> is a <code id=focus-management-apis:document-7><a href=#document>Document</a></code>, then let <var>candidate</var> be null.</p>

   <li><p>Return <var>candidate</var>.</ol>

  <p>The <dfn id=dom-document-hasfocus><code>hasFocus()</code></dfn> method on the
  <code id=focus-management-apis:document-8><a href=#document>Document</a></code> object, when invoked, must return the result of running the <a href=#has-focus-steps id=focus-management-apis:has-focus-steps>has focus
  steps</a> with the <code id=focus-management-apis:document-9><a href=#document>Document</a></code> object as the argument.</p>

  <p>The <dfn id=dom-window-focus><code>focus()</code></dfn> method on the <code id=focus-management-apis:window><a href=#window>Window</a></code>
  object, when invoked, must run the <a href=#focusing-steps id=focus-management-apis:focusing-steps>focusing steps</a> with the <code id=focus-management-apis:window-2><a href=#window>Window</a></code>
  object's <a href=#browsing-context id=focus-management-apis:browsing-context-2>browsing context</a>. Additionally, if this <a href=#browsing-context id=focus-management-apis:browsing-context-3>browsing context</a> is a
  <a href=#top-level-browsing-context id=focus-management-apis:top-level-browsing-context>top-level browsing context</a>, user agents are encouraged to trigger some sort of
  notification to indicate to the user that the page is attempting to gain focus.</p>

  <p>The <dfn id=dom-window-blur><code>blur()</code></dfn> method on the <code id=focus-management-apis:window-3><a href=#window>Window</a></code>
  object, when invoked, provides a hint to the user agent that the script believes the user probably
  is not currently interested in the contents of the <a href=#browsing-context id=focus-management-apis:browsing-context-4>browsing context</a> of the
  <code id=focus-management-apis:window-4><a href=#window>Window</a></code> object on which the method was invoked, but that the contents might become
  interesting again in the future.</p>

  <p>User agents are encouraged to ignore calls to this <code id=focus-management-apis:dom-window-blur><a href=#dom-window-blur>blur()</a></code>
  method entirely.</p>

  <p class=note>Historically, the <code id=focus-management-apis:dom-window-blur-2><a href=#dom-window-blur>focus()</a></code> and <code id=focus-management-apis:dom-window-blur-3><a href=#dom-window-blur>blur()</a></code> methods actually affected the system-level focus of the
  system widget (e.g. tab or window) that contained the <a href=#browsing-context id=focus-management-apis:browsing-context-5>browsing context</a>, but hostile
  sites widely abuse this behavior to the user's detriment.</p>

  <p>The <dfn id=dom-focus><code>focus()</code></dfn> method on elements, when invoked, must
  run the following algorithm:</p>

  <ol><li><p>If the element is marked as <i id=focus-management-apis:locked-for-focus><a href=#locked-for-focus>locked for focus</a></i>, then abort these steps.<li><p>Mark the element as <dfn id=locked-for-focus>locked for focus</dfn>.<li><p>Run the <a href=#focusing-steps id=focus-management-apis:focusing-steps-2>focusing steps</a> for the element.<li><p>Unmark the element as <i id=focus-management-apis:locked-for-focus-2><a href=#locked-for-focus>locked for focus</a></i>.</ol>

  <p>The <dfn id=dom-blur><code>blur()</code></dfn> method, when invoked, should run the
  <a href=#unfocusing-steps id=focus-management-apis:unfocusing-steps>unfocusing steps</a> for the element on which the method was called. User agents may
  selectively or uniformly ignore calls to this method for usability reasons.</p>

  <p class=example>For example, if the <code id=focus-management-apis:dom-blur-2><a href=#dom-blur>blur()</a></code> method is unwisely
  being used to remove the focus ring for aesthetics reasons, the page would become unusable by
  keyboard users. Ignoring calls to this method would thus allow keyboard users to interact with the
  page.</p>

  





  <h3 id=assigning-keyboard-shortcuts>6.5 Assigning keyboard shortcuts<a href=#assigning-keyboard-shortcuts class=self-link></a></h3>

  <h4 id=introduction-9>6.5.1 Introduction<a href=#introduction-9 class=self-link></a></h4>

  <p><i>This section is non-normative.</i></p>

  <p>Each element that can be activated or focused can be assigned a single key combination to
  activate it, using the <code id=introduction-9:the-accesskey-attribute><a href=#the-accesskey-attribute>accesskey</a></code> attribute.</p>

  <p>The exact shortcut is determined by the user agent, based on information about the user's
  keyboard, what keyboard shortcuts already exist on the platform, and what other shortcuts have
  been specified on the page, using the information provided in the <code id=introduction-9:the-accesskey-attribute-2><a href=#the-accesskey-attribute>accesskey</a></code> attribute as a guide.</p>

  <p>In order to ensure that a relevant keyboard shortcut is available on a wide variety of input
  devices, the author can provide a number of alternatives in the <code id=introduction-9:the-accesskey-attribute-3><a href=#the-accesskey-attribute>accesskey</a></code> attribute.</p>

  <p>Each alternative consists of a single character, such as a letter or digit.</p>

  <p>User agents can provide users with a list of the keyboard shortcuts, but authors are encouraged
  to do so also. The <code id=introduction-9:dom-accesskeylabel><a href=#dom-accesskeylabel>accessKeyLabel</a></code> IDL attribute returns a
  string representing the actual key combination assigned by the user agent.</p>

  <div class=example>

   <p>In this example, an author has provided a button that can be invoked using a shortcut key. To
   support full keyboards, the author has provided "C" as a possible key. To support devices
   equipped only with numeric keypads, the author has provided "1" as another possibly key.</p>

   <pre>&lt;input type=button value=Collect onclick="collect()"
       <strong>accesskey="C 1"</strong> id=c></pre>

  </div>

  <div class=example>

   <p>To tell the user what the shortcut key is, the author has this script here opted to explicitly
   add the key combination to the button's label:</p>

   <pre>function addShortcutKeyLabel(button) {
<strong>  if (button.accessKeyLabel != '')
    button.value += ' (' + button.accessKeyLabel + ')';</strong>
}
addShortcutKeyLabel(document.getElementById('c'));</pre>

   <p>Browsers on different platforms will show different labels, even for the same key combination,
   based on the convention prevalent on that platform. For example, if the key combination is the
   Control key, the Shift key, and the letter C, a Windows browser might display
   "<samp>Ctrl+Shift+C</samp>", whereas a Mac browser might display "<samp>^⇧C</samp>", while
   an Emacs browser might just display "<samp>C-C</samp>". Similarly, if the key combination is the
   Alt key and the Escape key, Windows might use "<samp>Alt+Esc</samp>", Mac might use
   "<samp>⌥⎋</samp>", and an Emacs browser might use "<samp>M-ESC</samp>" or
   "<samp>ESC ESC</samp>".</p>

   <p>In general, therefore, it is unwise to attempt to parse the value returned from the <code id=introduction-9:dom-accesskeylabel-2><a href=#dom-accesskeylabel>accessKeyLabel</a></code> IDL attribute.</p>

  </div>


  <h4 id=the-accesskey-attribute>6.5.2 The <dfn><code>accesskey</code></dfn> attribute<a href=#the-accesskey-attribute class=self-link></a></h4>

  <p>All <a href=#html-elements id=the-accesskey-attribute:html-elements>HTML elements</a> may have the <code id=the-accesskey-attribute:the-accesskey-attribute><a href=#the-accesskey-attribute>accesskey</a></code>
  content attribute set. The <code id=the-accesskey-attribute:the-accesskey-attribute-2><a href=#the-accesskey-attribute>accesskey</a></code> attribute's value is used
  by the user agent as a guide for creating a keyboard shortcut that activates or focuses the
  element.</p>

  <p>If specified, the value must be an <a href=#ordered-set-of-unique-space-separated-tokens id=the-accesskey-attribute:ordered-set-of-unique-space-separated-tokens>ordered set of unique space-separated tokens</a>
  that are <a href=#case-sensitive id=the-accesskey-attribute:case-sensitive>case-sensitive</a>, each of which must be exactly one Unicode code point in
  length.</p>

  <div class=example>

   <p>In the following example, a variety of links are given with access keys so that keyboard users
   familiar with the site can more quickly navigate to the relevant pages:</p>

   <pre>&lt;nav>
 &lt;p>
  &lt;a title="Consortium Activities" accesskey="A" href="/Consortium/activities">Activities&lt;/a> |
  &lt;a title="Technical Reports and Recommendations" accesskey="T" href="/TR/">Technical Reports&lt;/a> |
  &lt;a title="Alphabetical Site Index" accesskey="S" href="/Consortium/siteindex">Site Index&lt;/a> |
  &lt;a title="About This Site" accesskey="B" href="/Consortium/">About Consortium&lt;/a> |
  &lt;a title="Contact Consortium" accesskey="C" href="/Consortium/contact">Contact&lt;/a>
 &lt;/p>
&lt;/nav></pre>

  </div>

  <div class=example>

   <p>In the following example, the search field is given two possible access keys, "s" and "0" (in
   that order). A user agent on a device with a full keyboard might pick <kbd><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>S</kbd></kbd> as the shortcut key,
   while a user agent on a small device with just a numeric keypad might pick just the plain
   unadorned key <kbd><kbd>0</kbd></kbd>:</p>

   <pre>&lt;form action="/search">
 &lt;label>Search: &lt;input type="search" name="q" accesskey="s 0">&lt;/label>
 &lt;input type="submit">
&lt;/form></pre>

  </div>

  <div class=example>

   <p>In the following example, a button has possible access keys described. A script then tries to
   update the button's label to advertise the key combination the user agent selected.</p>

   <pre>&lt;input type=submit accesskey="N @ 1" value="Compose">
...
&lt;script>
 function labelButton(button) {
   if (button.accessKeyLabel)
     button.value += ' (' + button.accessKeyLabel + ')';
 }
 var inputs = document.getElementsByTagName('input');
 for (var i = 0; i &lt; inputs.length; i += 1) {
   if (inputs[i].type == "submit")
     labelButton(inputs[i]);
 }
&lt;/script></pre>

   <p>On one user agent, the button's label might become "<samp>Compose (⌘N)</samp>". On
   another, it might become "<samp>Compose (Alt+⇧+1)</samp>". If the user agent doesn't
   assign a key, it will be just "<samp>Compose</samp>". The exact string depends on what the
   <a href=#assigned-access-key id=the-accesskey-attribute:assigned-access-key>assigned access key</a> is, and on how the user agent represents that key
   combination.</p>

  </div>


  

  <h4 id=keyboard-shortcuts-processing-model>6.5.3 <span id=processing-model-6></span>Processing
  model<a href=#keyboard-shortcuts-processing-model class=self-link></a></h4>

  <p>An element's <dfn id=assigned-access-key>assigned access key</dfn> is a key combination derived from the element's
  <code id=keyboard-shortcuts-processing-model:the-accesskey-attribute><a href=#the-accesskey-attribute>accesskey</a></code> content attribute. Initially, an element must not
  have an <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key>assigned access key</a>.</p>

  <p>Whenever an element's <code id=keyboard-shortcuts-processing-model:the-accesskey-attribute-2><a href=#the-accesskey-attribute>accesskey</a></code> attribute is set, changed,
  or removed, the user agent must update the element's <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-2>assigned access key</a> by running
  the following steps:</p>

  <ol><li><p>If the element has no <code id=keyboard-shortcuts-processing-model:the-accesskey-attribute-3><a href=#the-accesskey-attribute>accesskey</a></code> attribute, then skip
   to the <i>fallback</i> step below.<li><p>Otherwise, <a href=#split-a-string-on-spaces id=keyboard-shortcuts-processing-model:split-a-string-on-spaces>split the attribute's value on
   spaces</a>, and let <var>keys</var> be the resulting tokens.<li>

    <p>For each value in <var>keys</var> in turn, in the order the tokens appeared in the
    attribute's value, run the following substeps:</p>

    <ol><li><p>If the value is not a string exactly one Unicode code point in length, then skip the
     remainder of these steps for this value.<li><p>If the value does not correspond to a key on the system's keyboard, then skip the
     remainder of these steps for this value.<li><p>If the user agent can find a mix of zero or more modifier keys that, combined with the
     key that corresponds to the value given in the attribute, can be used as the access key, then
     the user agent may assign that combination of keys as the element's <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-3>assigned access
     key</a> and abort these steps.
     <a href=#fingerprinting-vector id=keyboard-shortcuts-processing-model:fingerprinting-vector class=fingerprint title="There is a potential fingerprinting vector here."><img alt="(This is a fingerprinting vector.)" src=/images/fingerprint.png width=46 height=64></a>
     </ol>

   <li><p><i>Fallback</i>: Optionally, the user agent may assign a key combination of its choosing
   as the element's <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-4>assigned access key</a> and then abort these steps.<li><p>If this step is reached, the element has no <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-5>assigned access key</a>.</ol>

  <p>Once a user agent has selected and assigned an access key for an element, the user agent should
  not change the element's <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-6>assigned access key</a> unless the <code id=keyboard-shortcuts-processing-model:the-accesskey-attribute-4><a href=#the-accesskey-attribute>accesskey</a></code> content attribute is changed or the element is moved to
  another <code id=keyboard-shortcuts-processing-model:document><a href=#document>Document</a></code>.</p>

  <p>When the user presses the key combination corresponding to the <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-7>assigned access key</a>
  for an element, if the element <a href=#concept-command id=keyboard-shortcuts-processing-model:concept-command>defines a command</a>, the
  command's <a href=#command-facet-hiddenstate id=keyboard-shortcuts-processing-model:command-facet-hiddenstate>Hidden State</a> facet is false (visible),
  the command's <a href=#command-facet-disabledstate id=keyboard-shortcuts-processing-model:command-facet-disabledstate>Disabled State</a> facet is also false
  (enabled), the element is <a id=keyboard-shortcuts-processing-model:in-a-document href=https://dom.spec.whatwg.org/#in-a-document data-x-internal=in-a-document>in a document</a> that has a <a href=#concept-document-bc id=keyboard-shortcuts-processing-model:concept-document-bc>browsing context</a>, and neither the element nor any of its
  ancestors has a <code id=keyboard-shortcuts-processing-model:the-hidden-attribute><a href=#the-hidden-attribute>hidden</a></code> attribute specified, then the user agent
  must trigger the <a href=#command-facet-action id=keyboard-shortcuts-processing-model:command-facet-action>Action</a> of the command.</p>

  <p class=note>User agents <a href=#expose-commands-in-ui>might expose</a> elements that have
  an <code id=keyboard-shortcuts-processing-model:the-accesskey-attribute-5><a href=#the-accesskey-attribute>accesskey</a></code> attribute in other ways as well, e.g. in a menu
  displayed in response to a specific key combination.</p> 

  <hr>

  <p>The <dfn id=dom-accesskey><code>accessKey</code></dfn> IDL attribute must
  <a href=#reflect id=keyboard-shortcuts-processing-model:reflect>reflect</a> the <code id=keyboard-shortcuts-processing-model:the-accesskey-attribute-6><a href=#the-accesskey-attribute>accesskey</a></code> content attribute.</p>

  <p>The <dfn id=dom-accesskeylabel><code>accessKeyLabel</code></dfn> IDL attribute must return
  a string that represents the element's <a href=#assigned-access-key id=keyboard-shortcuts-processing-model:assigned-access-key-8>assigned access key</a>, if any. If the element
  does not have one, then the IDL attribute must return the empty string.</p>

  



  <h3 id=editing-2>6.6 Editing<a href=#editing-2 class=self-link></a></h3>

  <h4 id=contenteditable>6.6.1 Making document regions editable: The <code id=contenteditable:attr-contenteditable><a href=#attr-contenteditable>contenteditable</a></code> content attribute<a href=#contenteditable class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> contenteditable<span class="and_chr yes"><span>Chrome for Android</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>5.0+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="ie yes"><span>IE</span> <span>5.5+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>3+</span></span><span class="safari yes"><span>Safari</span> <span>3.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>9+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=contenteditable">caniuse.com</a></div>

  <pre class=idl>[NoInterfaceObject]
interface <dfn id=elementcontenteditable>ElementContentEditable</dfn> {
  [<a href=#cereactions id=contenteditable:cereactions>CEReactions</a>] attribute DOMString <a href=#dom-contenteditable id=contenteditable:dom-contenteditable>contentEditable</a>;
  readonly attribute boolean <a href=#dom-iscontenteditable id=contenteditable:dom-iscontenteditable>isContentEditable</a>;
};</pre>

  <p>The <dfn id=attr-contenteditable><code>contenteditable</code></dfn> content attribute is an
  <a href=#enumerated-attribute id=contenteditable:enumerated-attribute>enumerated attribute</a> whose keywords are the empty string, <code>true</code>,
  and <code>false</code>. The empty string and the <code>true</code> keyword map
  to the <i>true</i> state. The <code>false</code> keyword maps to the <i>false</i> state.
  In addition, there is a third state, the <i>inherit</i> state, which is the <i id=contenteditable:missing-value-default><a href=#missing-value-default>missing value default</a></i> (and the <i id=contenteditable:invalid-value-default><a href=#invalid-value-default>invalid value default</a></i>).</p>

  <p>The <i>true</i> state indicates that the element is editable. The <i>inherit</i> state
  indicates that the element is editable if its parent is. The <i>false</i> state indicates that the
  element is not editable.</p>

  <div class=example>
   <p>For example, consider a page that has a <code id=contenteditable:the-form-element><a href=#the-form-element>form</a></code> and a <code id=contenteditable:the-textarea-element><a href=#the-textarea-element>textarea</a></code> to
   publish a new article, where the user is expected to write the article using HTML:</p>

   <pre>&lt;form method=POST>
 &lt;fieldset>
  &lt;legend>New article&lt;/legend>
  &lt;textarea name=article>&amp;lt;p>Hello world.&amp;lt;/p>&lt;/textarea>
 &lt;/fieldset>
 &lt;p>&lt;button>Publish&lt;/button>&lt;/p>
&lt;/form></pre>

   <p>When scripting is enabled, the <code id=contenteditable:the-textarea-element-2><a href=#the-textarea-element>textarea</a></code> element could be replaced with a rich
   text control instead, using the <code id=contenteditable:attr-contenteditable-2><a href=#attr-contenteditable>contenteditable</a></code>
   attribute:</p>

   <pre>&lt;form method=POST>
 &lt;fieldset>
  &lt;legend>New article&lt;/legend>
  &lt;textarea id=textarea name=article>&amp;lt;p>Hello world.&amp;lt;/p>&lt;/textarea>
  &lt;div id=div style="white-space: pre-wrap" hidden>&lt;p>Hello world.&lt;/p>&lt;/div>
  &lt;script>
   let textarea = document.getElementById("textarea");
   let div = document.getElementById("div");
   textarea.hidden = true;
   div.hidden = false;
   div.contentEditable = "true";
   div.oninput = (e) => {
     textarea.value = div.innerHTML;
   };
  &lt;/script>
 &lt;/fieldset>
 &lt;p>&lt;button>Publish&lt;/button>&lt;/p>
&lt;/form></pre>

   <p>Features to enable, e.g., inserting links, can be implemented using the <code id=contenteditable:execCommand><a data-x-internal=execCommand href=https://w3c.github.io/editing/execCommand.html#execcommand%28%29>document.execCommand()</a></code> API, or using
   <code id=contenteditable:selection><a data-x-internal=selection href=https://w3c.github.io/selection-api/#selection-interface>Selection</a></code> APIs and other DOM APIs. <a href=#refsEXECCOMMAND>[EXECCOMMAND]</a> <a href=#refsSELECTION>[SELECTION]</a> <a href=#refsDOM>[DOM]</a></p>
  </div>

  <div class=example>
   <p>The <code id=contenteditable:attr-contenteditable-3><a href=#attr-contenteditable>contenteditable</a></code> attribute can also be used to
   great effect:</p>

   <pre>&lt;!doctype html>
&lt;html lang=en>
&lt;title>Live CSS editing!&lt;/title>
&lt;style style=white-space:pre contenteditable>
html { margin:.2em; font-size:2em; color:lime; background:purple }
head, title, style { display:block }
body { display:none }
&lt;/style></pre>
  </div>

  <dl class=domintro><dt><var>element</var> . <code id=contenteditable:dom-contenteditable-2><a href=#dom-contenteditable>contentEditable</a></code> [ = <var>value</var> ]<dd>

    <p>Returns "<code>true</code>", "<code>false</code>", or "<code>inherit</code>", based on the state of the <code id=contenteditable:attr-contenteditable-4><a href=#attr-contenteditable>contenteditable</a></code> attribute.</p>

    <p>Can be set, to change that state.</p>

    <p>Throws a <a id=contenteditable:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=contenteditable:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> if the new value
    isn't one of those strings.</p>

   <dt><var>element</var> . <code id=contenteditable:dom-iscontenteditable-2><a href=#dom-iscontenteditable>isContentEditable</a></code><dd>

    <p>Returns true if the element is editable; otherwise, returns false.</p>

   </dl>

  

  <p>The <dfn id=dom-contenteditable><code>contentEditable</code></dfn> IDL attribute, on
  getting, must return the string "<code>true</code>" if the content attribute is set to
  the true state, "<code>false</code>" if the content attribute is set to the false state,
  and "<code>inherit</code>" otherwise. On setting, if the new value is an <a id=contenteditable:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII
  case-insensitive</a> match for the string "<code>inherit</code>" then the content
  attribute must be removed, if the new value is an <a id=contenteditable:ascii-case-insensitive-2 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for
  the string "<code>true</code>" then the content attribute must be set to the string
  "<code>true</code>", if the new value is an <a id=contenteditable:ascii-case-insensitive-3 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for
  the string "<code>false</code>" then the content attribute must be set to the string
  "<code>false</code>", and otherwise the attribute setter must throw a
  <a id=contenteditable:syntaxerror-2 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=contenteditable:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>The <dfn id=dom-iscontenteditable><code>isContentEditable</code></dfn> IDL attribute, on
  getting, must return true if the element is either an <a id=contenteditable:editing-host href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing host</a> or
  <a id=contenteditable:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a>, and false otherwise.</p>

  



  <h4 id=making-entire-documents-editable:-the-designmode-idl-attribute>6.6.2 Making entire documents editable: The <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode><a href=#designMode>designMode</a></code> IDL attribute<a href=#making-entire-documents-editable:-the-designmode-idl-attribute class=self-link></a></h4>

  

  <p>Documents have a <dfn id=designMode><code>designMode</code></dfn>, which can be either enabled or
  disabled.</p>

  

  <dl class=domintro><dt><var>document</var> . <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-2><a href=#designMode>designMode</a></code> [ = <var>value</var> ]<dd>

    <p>Returns "<code>on</code>" if the document is editable, and "<code>off</code>" if it isn't.</p>

    <p>Can be set, to change the document's current state. This focuses the document and resets the
    selection in that document.</p>

   </dl>

  

  <p>The <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-3><a href=#designMode>designMode</a></code> IDL attribute on the
  <code id=making-entire-documents-editable:-the-designmode-idl-attribute:document><a href=#document>Document</a></code> object takes two values, "<code>on</code>" and "<code>off</code>". On setting, the new value must be compared in an <a id=making-entire-documents-editable:-the-designmode-idl-attribute:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII
  case-insensitive</a> manner to these two values; if it matches the "<code>on</code>"
  value, then <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-4><a href=#designMode>designMode</a></code> must be enabled, and if it
  matches the "<code>off</code>" value, then <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-5><a href=#designMode>designMode</a></code> must be disabled. Other values must be
  ignored.</p>

  <p>On getting, if <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-6><a href=#designMode>designMode</a></code> is enabled, the IDL
  attribute must return the value "<code>on</code>"; otherwise it is disabled, and the
  attribute must return the value "<code>off</code>".</p>

  <p>The last state set must persist until the document is destroyed or the state is changed.
  Initially, documents must have their <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-7><a href=#designMode>designMode</a></code>
  disabled.</p>

  <p>When the <code id=making-entire-documents-editable:-the-designmode-idl-attribute:designMode-8><a href=#designMode>designMode</a></code> changes from being disabled to
  being enabled, the user agent must <a href=#immediately id=making-entire-documents-editable:-the-designmode-idl-attribute:immediately>immediately</a> reset the document's <a id=making-entire-documents-editable:-the-designmode-idl-attribute:active-range href=https://w3c.github.io/editing/execCommand.html#active-range data-x-internal=active-range>active range</a>'s
  start and end boundary points to be at the start of the <code id=making-entire-documents-editable:-the-designmode-idl-attribute:document-2><a href=#document>Document</a></code> and then run the
  <a href=#focusing-steps id=making-entire-documents-editable:-the-designmode-idl-attribute:focusing-steps>focusing steps</a> for the <a id=making-entire-documents-editable:-the-designmode-idl-attribute:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> of the <code id=making-entire-documents-editable:-the-designmode-idl-attribute:document-3><a href=#document>Document</a></code>, if
  non-null.</p>

  


  <h4 id=best-practices-for-in-page-editors>6.6.3 Best practices for in-page editors<a href=#best-practices-for-in-page-editors class=self-link></a></h4>

  <p>Authors are encouraged to set the <a id="best-practices-for-in-page-editors:'white-space'" href=https://drafts.csswg.org/css-text/#white-space-property data-x-internal="'white-space'">'white-space'</a> property on <a href=https://w3c.github.io/editing/execCommand.html#editing-host id=best-practices-for-in-page-editors:editing-host data-x-internal=editing-host>editing hosts</a> and on markup that was originally created through these editing
  mechanisms to the value 'pre-wrap'. Default HTML whitespace handling is not well suited to WYSIWYG
  editing, and line wrapping will not work correctly in some corner cases if
  <a id="best-practices-for-in-page-editors:'white-space'-2" href=https://drafts.csswg.org/css-text/#white-space-property data-x-internal="'white-space'">'white-space'</a> is left at its default value.</p>

  <div class=example>

   <p>As an example of problems that occur if the default 'normal' value is used instead, consider
   the case of the user typing "<kbd>yellow␣␣ball</kbd>", with two spaces (here
   represented by "␣") between the words. With the editing rules in place for the default
   value of <a id="best-practices-for-in-page-editors:'white-space'-3" href=https://drafts.csswg.org/css-text/#white-space-property data-x-internal="'white-space'">'white-space'</a> ('normal'), the resulting markup will either consist of
   "<samp>yellow&amp;nbsp; ball</samp>" or "<samp>yellow &amp;nbsp;ball</samp>"; i.e.,
   there will be a non-breaking space between the two words in addition to the regular space. This
   is necessary because the 'normal' value for <a id="best-practices-for-in-page-editors:'white-space'-4" href=https://drafts.csswg.org/css-text/#white-space-property data-x-internal="'white-space'">'white-space'</a> requires adjacent regular
   spaces to be collapsed together.</p>

   <p>In the former case, "<samp>yellow⍽</samp>" might wrap to the next line ("⍽"
   being used here to represent a non-breaking space) even though "<samp>yellow</samp>" alone might
   fit at the end of the line; in the latter case, "<samp>⍽ball</samp>", if wrapped to the
   start of the line, would have visible indentation from the non-breaking space.</p>

   <p>When <a id="best-practices-for-in-page-editors:'white-space'-5" href=https://drafts.csswg.org/css-text/#white-space-property data-x-internal="'white-space'">'white-space'</a> is set to 'pre-wrap', however, the editing rules will instead
   simply put two regular spaces between the words, and should the two words be split at the end of
   a line, the spaces would be neatly removed from the rendering.</p>

  </div>



  <h4 id=editing-apis>6.6.4 Editing APIs<a href=#editing-apis class=self-link></a></h4>

  <p>The definition of the terms
  <dfn id=active-range><a href=https://w3c.github.io/editing/execCommand.html#active-range>active range</a></dfn>,
  <dfn id=editing-host><a href=https://w3c.github.io/editing/execCommand.html#editing-host>editing host</a></dfn>,
  and <dfn id=editable><a href=https://w3c.github.io/editing/execCommand.html#editable>editable</a></dfn>, the
  user interface requirements of elements that are <a href=https://w3c.github.io/editing/execCommand.html#editing-host id=editing-apis:editing-host data-x-internal=editing-host>editing hosts</a>
  or <a id=editing-apis:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a>, the

  <dfn id=execCommand><a href=https://w3c.github.io/editing/execCommand.html#execcommand%28%29><code>execCommand()</code></a></dfn>,
  <dfn id=dom-document-querycommandenabled><a href=https://w3c.github.io/editing/execCommand.html#querycommandenabled%28%29><code>queryCommandEnabled()</code></a></dfn>,
  <dfn id=dom-document-querycommandindeterm><a href=https://w3c.github.io/editing/execCommand.html#querycommandindeterm%28%29><code>queryCommandIndeterm()</code></a></dfn>,
  <dfn id=dom-document-querycommandstate><a href=https://w3c.github.io/editing/execCommand.html#querycommandstate%28%29><code>queryCommandState()</code></a></dfn>,
  <dfn id=dom-document-querycommandsupported><a href=https://w3c.github.io/editing/execCommand.html#querycommandsupported%28%29><code>queryCommandSupported()</code></a></dfn>, and
  <dfn id=dom-document-querycommandvalue><a href=https://w3c.github.io/editing/execCommand.html#querycommandvalue%28%29><code>queryCommandValue()</code></a></dfn>

  methods, text selections, and the <dfn id=delete-the-selection><a href=https://w3c.github.io/editing/execCommand.html#delete-the-selection>delete the
  selection</a></dfn> algorithm are defined in <cite>execCommand</cite>. <a href=#refsEXECCOMMAND>[EXECCOMMAND]</a></p>



  <h4 id=spelling-and-grammar-checking>6.6.5 Spelling and grammar checking<a href=#spelling-and-grammar-checking class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> spellcheck-attribute<span class="and_chr partial"><span>Chrome for Android (limited)</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>9+</span></span><span class="ios_saf partial"><span>iOS Safari (limited)</span> <span>3.2+</span></span><span class="and_uc partial"><span>UC Browser for Android (limited)</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>2+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="samsung partial"><span>Samsung Internet (limited)</span> <span>4+</span></span><span class="op_mini partial"><span>Opera Mini (limited)</span> <span>all+</span></span><span class="android partial"><span>Android Browser (limited)</span> <span>2.1+</span></span><span class="safari yes"><span>Safari</span> <span>5.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>10.5+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=spellcheck-attribute">caniuse.com</a></div>

  

  <p>User agents can support the checking of spelling and grammar of editable text, either in form
  controls (such as the value of <code id=spelling-and-grammar-checking:the-textarea-element><a href=#the-textarea-element>textarea</a></code> elements), or in elements in an <a id=spelling-and-grammar-checking:editing-host href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing
  host</a> (e.g. using <code id=spelling-and-grammar-checking:attr-contenteditable><a href=#attr-contenteditable>contenteditable</a></code>).</p>

  <p>For each element, user agents must establish a <dfn id=concept-spellcheck-default>default
  behavior</dfn>, either through defaults or through preferences expressed by the user. There are
  three possible default behaviors for each element:</p>

  <dl><dt><dfn id=concept-spellcheck-default-true>true-by-default</dfn>

   <dd>The element will be checked for spelling and grammar if its contents are editable and
   spellchecking is not explicitly disabled through the <code id=spelling-and-grammar-checking:attr-spellcheck><a href=#attr-spellcheck>spellcheck</a></code> attribute.

   <dt><dfn id=concept-spellcheck-default-false>false-by-default</dfn>

   <dd>The element will never be checked for spelling and grammar unless spellchecking is
   explicitly enabled through the <code id=spelling-and-grammar-checking:attr-spellcheck-2><a href=#attr-spellcheck>spellcheck</a></code> attribute.

   <dt><dfn id=concept-spellcheck-default-inherit>inherit-by-default</dfn>

   <dd>The element's default behavior is the same as its parent element's. Elements that have no
   parent element cannot have this as their default behavior.

  </dl>

  <hr>

  

  <p>The <dfn id=attr-spellcheck><code>spellcheck</code></dfn> attribute is an <a href=#enumerated-attribute id=spelling-and-grammar-checking:enumerated-attribute>enumerated
  attribute</a> whose keywords are the empty string, <code>true</code> and <code>false</code>. The empty string and the <code>true</code> keyword map to the
  <i>true</i> state. The <code>false</code> keyword maps to the <i>false</i> state. In
  addition, there is a third state, the <i>default</i> state, which is the <i id=spelling-and-grammar-checking:missing-value-default><a href=#missing-value-default>missing value default</a></i> (and the <i id=spelling-and-grammar-checking:invalid-value-default><a href=#invalid-value-default>invalid value default</a></i>).</p>

  <p class=note>The <i>true</i> state indicates that the element is to have its spelling and
  grammar checked. The <i>default</i> state indicates that the element is to act according to a
  default behavior, possibly based on the parent element's own <code id=spelling-and-grammar-checking:attr-spellcheck-3><a href=#attr-spellcheck>spellcheck</a></code> state, as defined below. The <i>false</i> state
  indicates that the element is not to be checked.</p>

  

  <hr>

  

  <dl class=domintro><dt><var>element</var> . <code id=spelling-and-grammar-checking:dom-spellcheck><a href=#dom-spellcheck>spellcheck</a></code> [ = <var>value</var> ]<dd>

    <p>Returns true if the element is to have its spelling and grammar checked; otherwise, returns
    false.</p>

    <p>Can be set, to override the default and set the <code id=spelling-and-grammar-checking:attr-spellcheck-4><a href=#attr-spellcheck>spellcheck</a></code> content attribute.</p>

   <dt><var>element</var> . <code id=spelling-and-grammar-checking:dom-forcespellcheck><a href=#dom-forcespellcheck>forceSpellCheck</a></code>()<dd>

    <p>Forces the user agent to report spelling and grammar errors on the element (if checking is
    enabled), even if the user has never focused the element. (If the method is not invoked, user
    agents can hide errors in text that wasn't just entered by the user.)</p>

   </dl>

  

  <p>The <dfn id=dom-spellcheck><code>spellcheck</code></dfn> IDL attribute, on getting, must
  return true if the element's <code id=spelling-and-grammar-checking:attr-spellcheck-5><a href=#attr-spellcheck>spellcheck</a></code> content attribute is
  in the <i>true</i> state, or if the element's <code id=spelling-and-grammar-checking:attr-spellcheck-6><a href=#attr-spellcheck>spellcheck</a></code>
  content attribute is in the <i>default</i> state and the element's <a href=#concept-spellcheck-default id=spelling-and-grammar-checking:concept-spellcheck-default>default behavior</a> is <a href=#concept-spellcheck-default-true id=spelling-and-grammar-checking:concept-spellcheck-default-true>true-by-default</a>, or if the element's <code id=spelling-and-grammar-checking:attr-spellcheck-7><a href=#attr-spellcheck>spellcheck</a></code> content attribute is in the <i>default</i> state and the
  element's <a href=#concept-spellcheck-default id=spelling-and-grammar-checking:concept-spellcheck-default-2>default behavior</a> is <a href=#concept-spellcheck-default-inherit id=spelling-and-grammar-checking:concept-spellcheck-default-inherit>inherit-by-default</a> and the element's parent
  element's <code id=spelling-and-grammar-checking:dom-spellcheck-2><a href=#dom-spellcheck>spellcheck</a></code> IDL attribute would return true;
  otherwise, if none of those conditions applies, then the attribute must instead return false.</p>

  <p class=note>The <code id=spelling-and-grammar-checking:dom-spellcheck-3><a href=#dom-spellcheck>spellcheck</a></code> IDL attribute is not affected
  by user preferences that override the <code id=spelling-and-grammar-checking:attr-spellcheck-8><a href=#attr-spellcheck>spellcheck</a></code> content
  attribute, and therefore might not reflect the actual spellchecking state.</p>

  <p>On setting, if the new value is true, then the element's <code id=spelling-and-grammar-checking:attr-spellcheck-9><a href=#attr-spellcheck>spellcheck</a></code> content attribute must be set to the literal string
  "<code>true</code>", otherwise it must be set to the literal string "<code>false</code>".

  <hr>

  <p>User agents must only consider the following pieces of text as checkable for the purposes of
  this feature:</p>

  <ul><li>The <a href=#concept-fe-value id=spelling-and-grammar-checking:concept-fe-value>value</a> of <code id=spelling-and-grammar-checking:the-input-element><a href=#the-input-element>input</a></code> elements whose <code id=spelling-and-grammar-checking:attr-input-type><a href=#attr-input-type>type</a></code> attributes are in the <a href="#text-(type=text)-state-and-search-state-(type=search)" id="spelling-and-grammar-checking:text-(type=text)-state-and-search-state-(type=search)">Text</a>, <a href="#text-(type=text)-state-and-search-state-(type=search)" id="spelling-and-grammar-checking:text-(type=text)-state-and-search-state-(type=search)-2">Search</a>,
   <a href="#url-state-(type=url)" id="spelling-and-grammar-checking:url-state-(type=url)">URL</a>, or <a href="#e-mail-state-(type=email)" id="spelling-and-grammar-checking:e-mail-state-(type=email)">E-mail</a> states and that are <i id=spelling-and-grammar-checking:concept-fe-mutable><a href=#concept-fe-mutable>mutable</a></i> (i.e. that do not have the <code id=spelling-and-grammar-checking:attr-input-readonly><a href=#attr-input-readonly>readonly</a></code> attribute specified and that are not <a href=#concept-fe-disabled id=spelling-and-grammar-checking:concept-fe-disabled>disabled</a>).<li>The <a href=#concept-fe-value id=spelling-and-grammar-checking:concept-fe-value-2>value</a> of <code id=spelling-and-grammar-checking:the-textarea-element-2><a href=#the-textarea-element>textarea</a></code> elements that do not
   have a <code id=spelling-and-grammar-checking:attr-textarea-readonly><a href=#attr-textarea-readonly>readonly</a></code> attribute and that are not <a href=#concept-fe-disabled id=spelling-and-grammar-checking:concept-fe-disabled-2>disabled</a>.<li>Text in <code id=spelling-and-grammar-checking:text><a data-x-internal=text href=https://dom.spec.whatwg.org/#interface-text>Text</a></code> nodes that are children of <a href=https://w3c.github.io/editing/execCommand.html#editing-host id=spelling-and-grammar-checking:editing-host-2 data-x-internal=editing-host>editing
   hosts</a> or <a id=spelling-and-grammar-checking:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a> elements.<li>Text in attributes of <a id=spelling-and-grammar-checking:editable-2 href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a> elements.</ul>

  <p>For text that is part of a <code id=spelling-and-grammar-checking:text-2><a data-x-internal=text href=https://dom.spec.whatwg.org/#interface-text>Text</a></code> node, the element with which the text is
  associated is the element that is the immediate parent of the first character of the word,
  sentence, or other piece of text. For text in attributes, it is the attribute's element. For the
  values of <code id=spelling-and-grammar-checking:the-input-element-2><a href=#the-input-element>input</a></code> and <code id=spelling-and-grammar-checking:the-textarea-element-3><a href=#the-textarea-element>textarea</a></code> elements, it is the element itself.</p>

  <p>To determine if a word, sentence, or other piece of text in an applicable element (as defined
  above) is to have spelling- and grammar-checking enabled, the UA must use the following
  algorithm:</p>

  <ol><li>If the user has disabled the checking for this text, then the checking is disabled.<li>Otherwise, if the user has forced the checking for this text to always be enabled, then the
   checking is enabled.<li>Otherwise, if the element with which the text is associated has a <code id=spelling-and-grammar-checking:attr-spellcheck-10><a href=#attr-spellcheck>spellcheck</a></code> content attribute, then: if that attribute is in the
   <i>true</i> state, then checking is enabled; otherwise, if that attribute is in the <i>false</i>
   state, then checking is disabled.<li>Otherwise, if there is an ancestor element with a <code id=spelling-and-grammar-checking:attr-spellcheck-11><a href=#attr-spellcheck>spellcheck</a></code> content attribute that is not in the <i>default</i>
   state, then: if the nearest such ancestor's <code id=spelling-and-grammar-checking:attr-spellcheck-12><a href=#attr-spellcheck>spellcheck</a></code>
   content attribute is in the <i>true</i> state, then checking is enabled; otherwise, checking is
   disabled.<li>Otherwise, if the element's <a href=#concept-spellcheck-default id=spelling-and-grammar-checking:concept-spellcheck-default-3>default behavior</a>
   is <a href=#concept-spellcheck-default-true id=spelling-and-grammar-checking:concept-spellcheck-default-true-2>true-by-default</a>, then checking is
   enabled.<li>Otherwise, if the element's <a href=#concept-spellcheck-default id=spelling-and-grammar-checking:concept-spellcheck-default-4>default behavior</a>
   is <a href=#concept-spellcheck-default-false id=spelling-and-grammar-checking:concept-spellcheck-default-false>false-by-default</a>, then checking is
   disabled.<li>Otherwise, if the element's parent element has <em>its</em> checking enabled, then checking
   is enabled.<li>Otherwise, checking is disabled.</ol>

  <p>If the checking is enabled for a word/sentence/text, the user agent should indicate spelling
  and grammar errors in that text. User agents should take into account the other semantics given in
  the document when suggesting spelling and grammar corrections. User agents may use the language of
  the element to determine what spelling and grammar rules to use, or may use the user's preferred
  language settings. UAs should use <code id=spelling-and-grammar-checking:the-input-element-3><a href=#the-input-element>input</a></code> element attributes such as <code id=spelling-and-grammar-checking:attr-input-pattern><a href=#attr-input-pattern>pattern</a></code> to ensure that the resulting value is valid, where
  possible.</p>

  <p>If checking is disabled, the user agent should not indicate spelling or grammar errors for that
  text.</p>

  <p>Even when checking is enabled, user agents may opt to not report spelling or grammar errors in
  text that the user agent deems the user has no interest in having checked (e.g. text that was
  already present when the page was loaded, or that the user did not type, or text in controls that
  the user has not focused, or in parts of e-mail addresses that the user agent is not confident
  were misspelt). The <dfn id=dom-forcespellcheck><code>forceSpellCheck()</code></dfn> method,
  when invoked on an element, must override this behavior, forcing the user agent to consider all
  spelling and grammar errors in text in that element for which checking is enabled to be of
  interest to the user.</p>

  <div class=example>

   <p>The element with ID "a" in the following example would be the one used to determine if the
   word "Hello" is checked for spelling errors. In this example, it would not be.</p>

   <pre>&lt;div contenteditable="true">
 &lt;span spellcheck="false" id="a">Hell&lt;/span>&lt;em>o!&lt;/em>
&lt;/div></pre>

   <p>The element with ID "b" in the following example would have checking enabled (the leading
   space character in the attribute's value on the <code id=spelling-and-grammar-checking:the-input-element-4><a href=#the-input-element>input</a></code> element causes the attribute
   to be ignored, so the ancestor's value is used instead, regardless of the default).</p>

   <pre class=bad>&lt;p spellcheck="true">
 &lt;label>Name: &lt;input spellcheck=" false" id="b">&lt;/label>
&lt;/p></pre>

  </div>

  

  <p class=note>This specification does not define the user interface for spelling and grammar
  checkers. A user agent could offer on-demand checking, could perform continuous checking while the
  checking is enabled, or could use other interfaces.</p>


  <h3 id=dnd>6.7 <dfn>Drag and drop</dfn><a href=#dnd class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> dragndrop<span class="and_chr no"><span>Chrome for Android</span> <span>None</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="ios_saf no"><span>iOS Safari</span> <span>None</span></span><span class="and_uc no"><span>UC Browser for Android</span> <span>None</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="ie partial"><span>IE (limited)</span> <span>5.5+</span></span><span class="samsung no"><span>Samsung Internet</span> <span>None</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android no"><span>Android Browser</span> <span>None</span></span><span class="safari yes"><span>Safari</span> <span>3.1+</span></span><span class="edge partial"><span>Edge (limited)</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>12+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=dragndrop">caniuse.com</a></div>



  <p>This section defines an event-based drag-and-drop mechanism.</p>

  <p>This specification does not define exactly what a <em>drag-and-drop operation</em> actually
  is.</p>

  <p>On a visual medium with a pointing device, a drag operation could be the default action of a
  <code id=dnd:event-mousedown><a data-x-internal=event-mousedown href=https://w3c.github.io/uievents/#event-type-mousedown>mousedown</a></code> event that is followed by a series of <code id=dnd:event-mousemove><a data-x-internal=event-mousemove href=https://w3c.github.io/uievents/#event-type-mousemove>mousemove</a></code> events, and the drop could be triggered by the mouse
  being released.</p>

  <p>When using an input modality other than a pointing device, users would probably have to
  explicitly indicate their intention to perform a drag-and-drop operation, stating what they wish
  to drag and where they wish to drop it, respectively.</p>

  

  <p>However it is implemented, drag-and-drop operations must have a starting point (e.g. where the
  mouse was clicked, or the start of the selection or element that was selected for the drag), may
  have any number of intermediate steps (elements that the mouse moves over during a drag, or
  elements that the user picks as possible drop points as they cycle through possibilities), and must
  either have an end point (the element above which the mouse button was released, or the element
  that was finally selected), or be canceled. The end point must be the last element selected as a
  possible drop point before the drop occurs (so if the operation is not canceled, there must be at
  least one element in the middle step).</p>

  


  <h4 id=event-drag>6.7.1 Introduction<a href=#event-drag class=self-link></a></h4>

  <p><i>This section is non-normative.</i></p>

  <p>To make an element draggable is simple: give the element a <code id=event-drag:the-draggable-attribute><a href=#the-draggable-attribute>draggable</a></code> attribute, and set an event listener for <code id=event-drag:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code> that stores the data being dragged.</p>

  <p>The event handler typically needs to check that it's not a text selection that is being
  dragged, and then needs to store data into the <code id=event-drag:datatransfer><a href=#datatransfer>DataTransfer</a></code> object and set the
  allowed effects (copy, move, link, or some combination).</p>

  <p>For example:</p>

  <pre>&lt;p>What fruits do you like?&lt;/p>
&lt;ol ondragstart="dragStartHandler(event)">
 &lt;li draggable="true" data-value="fruit-apple">Apples&lt;/li>
 &lt;li draggable="true" data-value="fruit-orange">Oranges&lt;/li>
 &lt;li draggable="true" data-value="fruit-pear">Pears&lt;/li>
&lt;/ol>
&lt;script>
  var internalDNDType = 'text/x-example'; // set this to something specific to your site
  function dragStartHandler(event) {
    if (event.target instanceof HTMLLIElement) {
      // use the element's data-value="" attribute as the value to be moving:
      event.dataTransfer.setData(internalDNDType, event.target.dataset.value);
      event.dataTransfer.effectAllowed = 'move'; // only allow moves
    } else {
      event.preventDefault(); // don't allow selection to be dragged
    }
  }
&lt;/script></pre>

  <hr>

  <p>To accept a drop, the drop target has to have a <code id=event-drag:the-dropzone-attribute><a href=#the-dropzone-attribute>dropzone</a></code>
  attribute and listen to the <code id=event-drag:event-dnd-drop><a href=#event-dnd-drop>drop</a></code> event.</p>

  <p>The value of the <code id=event-drag:the-dropzone-attribute-2><a href=#the-dropzone-attribute>dropzone</a></code> attribute specifies what kind of
  data to accept (e.g. "<code>string:text/plain</code>" to accept any text strings, or
  "<code>file:image/png</code>" to accept a PNG image file) and what kind of feedback to
  give (e.g. "<code>move</code>" to indicate that the data will be moved).</p>

  <p class=note>Instead of using the <code id=event-drag:the-dropzone-attribute-3><a href=#the-dropzone-attribute>dropzone</a></code> attribute, a drop
  target can handle the <code id=event-drag:event-dnd-dragenter><a href=#event-dnd-dragenter>dragenter</a></code> event (to report whether or
  not the drop target is to accept the drop) and the <code id=event-drag:event-dnd-dragover><a href=#event-dnd-dragover>dragover</a></code>
  event (to specify what feedback is to be shown to the user).</p>

  <p>The <code id=event-drag:event-dnd-drop-2><a href=#event-dnd-drop>drop</a></code> event allows the actual drop to be performed. This
  event needs to be canceled, so that the <code id=event-drag:dom-datatransfer-dropeffect><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> attribute's value can be used by the source
  (otherwise it's reset).</p>

  <p>For example:</p>

  <pre>&lt;p>Drop your favorite fruits below:&lt;/p>
&lt;ol dropzone="move string:text/x-example" ondrop="dropHandler(event)">
 &lt;!-- don't forget to change the "text/x-example" type to something
 specific to your site -->
&lt;/ol>
&lt;script>
  var internalDNDType = 'text/x-example'; // set this to something specific to your site
  function dropHandler(event) {
    var li = document.createElement('li');
    var data = event.dataTransfer.getData(internalDNDType);
    if (data == 'fruit-apple') {
      li.textContent = 'Apples';
    } else if (data == 'fruit-orange') {
      li.textContent = 'Oranges';
    } else if (data == 'fruit-pear') {
      li.textContent = 'Pears';
    } else {
      li.textContent = 'Unknown Fruit';
    }
    event.target.appendChild(li);
  }
&lt;/script></pre>

  <hr>

  <p>To remove the original element (the one that was dragged) from the display, the <code id=event-drag:event-dnd-dragend><a href=#event-dnd-dragend>dragend</a></code> event can be used.</p>

  <p>For our example here, that means updating the original markup to handle that event:</p>

  <pre>&lt;p>What fruits do you like?&lt;/p>
&lt;ol ondragstart="dragStartHandler(event)" ondragend="dragEndHandler(event)">
 <em>...as before...</em>
&lt;/ol>
&lt;script>
  function dragStartHandler(event) {
    // <em>...as before...</em>
  }
  function dragEndHandler(event) {
    if (event.dataTransfer.dropEffect == 'move') {
      // remove the dragged element
      event.target.parentNode.removeChild(event.target);
    }
  }
&lt;/script></pre>



  <h4 id=the-drag-data-store>6.7.2 The drag data store<a href=#the-drag-data-store class=self-link></a></h4>

  <p>The data that underlies a drag-and-drop operation, known as the <dfn id=drag-data-store>drag data store</dfn>,
  consists of the following information:</p>

  <ul><li><p>A <dfn id=drag-data-store-item-list>drag data store item list</dfn>, which is a list of items representing the dragged
   data, each consisting of the following information:</p>

    <dl><dt><dfn id=the-drag-data-item-kind>The drag data item kind</dfn><dd>

      <p>The kind of data:</p>

      <dl><dt><i>Plain Unicode string</i><dd>
        <p>Text.</p>
       <dt><i>File</i><dd>
        <p>Binary data with a file name.</p>
       </dl>

     <dt><dfn id=the-drag-data-item-type-string>The drag data item type string</dfn><dd>

      <p>A Unicode string giving the type or format of the data, generally given by a <a id=the-drag-data-store:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME
      type</a>. Some values that are not <a href=https://mimesniff.spec.whatwg.org/#mime-type id=the-drag-data-store:mime-type-2 data-x-internal=mime-type>MIME types</a> are
      special-cased for legacy reasons. The API does not enforce the use of <a href=https://mimesniff.spec.whatwg.org/#mime-type id=the-drag-data-store:mime-type-3 data-x-internal=mime-type>MIME types</a>; other values can be used as well. In all cases, however, the values
      are all <a id=the-drag-data-store:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a> by the API.</p>

      <p class=note>Strings that contain <a href=#space-character id=the-drag-data-store:space-character>space characters</a>
      cannot be used with the <code id=the-drag-data-store:the-dropzone-attribute><a href=#the-dropzone-attribute>dropzone</a></code> attribute, so authors are
      encouraged to use only <a href=https://mimesniff.spec.whatwg.org/#mime-type id=the-drag-data-store:mime-type-4 data-x-internal=mime-type>MIME types</a> or custom strings (without
      spaces).</p>

      <p>There is a limit of one <i>Plain Unicode string</i> item per <a href=#the-drag-data-item-type-string id=the-drag-data-store:the-drag-data-item-type-string>item type string</a>.</p> 

     <dt>The actual data<dd><p>A Unicode or binary string, in some cases with a file name (itself a Unicode string),
      as per <a href=#the-drag-data-item-kind id=the-drag-data-store:the-drag-data-item-kind>the drag data item kind</a>.</dl>

    <p>The <a href=#drag-data-store-item-list id=the-drag-data-store:drag-data-store-item-list>drag data store item list</a> is ordered in the order that the items were added
    to the list; most recently added last.</p>

   <li>

    <p>The following information, used to generate the UI feedback during the drag:</p>

    <ul><li>User-agent-defined default feedback information, known as the <dfn id=drag-data-store-default-feedback>drag data store default
     feedback</dfn>.<li>Optionally, a bitmap image and the coordinate of a point within that image, known as the
     <dfn id=drag-data-store-bitmap>drag data store bitmap</dfn> and <dfn id=drag-data-store-hot-spot-coordinate>drag data store hot spot coordinate</dfn>.</ul>

   <li>

    <p>A <dfn id=drag-data-store-mode>drag data store mode</dfn>, which is one of the following:</p>

    <dl><dt><dfn id=concept-dnd-rw>Read/write mode</dfn><dd>

      <p>For the <code id=the-drag-data-store:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code> event. New data can be added to the
      <a href=#drag-data-store id=the-drag-data-store:drag-data-store>drag data store</a>.</p>

     <dt><dfn id=concept-dnd-ro>Read-only mode</dfn><dd>

      <p>For the <code id=the-drag-data-store:event-dnd-drop><a href=#event-dnd-drop>drop</a></code> event. The list of items representing dragged
      data can be read, including the data. No new data can be added.</p>

     <dt><dfn id=concept-dnd-p>Protected mode</dfn><dd>

      <p>For all other events. The formats and kinds in the <a href=#drag-data-store id=the-drag-data-store:drag-data-store-2>drag data store</a> list of
      items representing dragged data can be enumerated, but the data itself is unavailable and no
      new data can be added.</p>

     </dl>

   <li>

    <p>A <dfn id=drag-data-store-allowed-effects-state>drag data store allowed effects state</dfn>, which is a string.</p>

   </ul>

  <p>When a <a href=#drag-data-store id=the-drag-data-store:drag-data-store-3>drag data store</a> is <dfn id=create-a-drag-data-store>created</dfn>, it
  must be initialized such that its <a href=#drag-data-store-item-list id=the-drag-data-store:drag-data-store-item-list-2>drag data store item list</a> is empty, it has no
  <a href=#drag-data-store-default-feedback id=the-drag-data-store:drag-data-store-default-feedback>drag data store default feedback</a>, it has no <a href=#drag-data-store-bitmap id=the-drag-data-store:drag-data-store-bitmap>drag data store bitmap</a> and
  <a href=#drag-data-store-hot-spot-coordinate id=the-drag-data-store:drag-data-store-hot-spot-coordinate>drag data store hot spot coordinate</a>, its <a href=#drag-data-store-mode id=the-drag-data-store:drag-data-store-mode>drag data store mode</a> is <a href=#concept-dnd-p id=the-drag-data-store:concept-dnd-p>protected mode</a>, and its <a href=#drag-data-store-allowed-effects-state id=the-drag-data-store:drag-data-store-allowed-effects-state>drag data store allowed effects
  state</a> is the string "<code id=the-drag-data-store:dom-datatransfer-effectallowed-uninitialized><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>".</p>


  <h4 id=the-datatransfer-interface>6.7.3 The <code id=the-datatransfer-interface:datatransfer><a href=#datatransfer>DataTransfer</a></code> interface<a href=#the-datatransfer-interface class=self-link></a></h4>

  <p><code id=the-datatransfer-interface:datatransfer-2><a href=#datatransfer>DataTransfer</a></code> objects are used to expose the <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store>drag data store</a> that
  underlies a drag-and-drop operation.</p>

  <pre class=idl>interface <dfn id=datatransfer>DataTransfer</dfn> {
  attribute DOMString <a href=#dom-datatransfer-dropeffect id=the-datatransfer-interface:dom-datatransfer-dropeffect>dropEffect</a>;
  attribute DOMString <a href=#dom-datatransfer-effectallowed id=the-datatransfer-interface:dom-datatransfer-effectallowed>effectAllowed</a>;

  [SameObject] readonly attribute <a href=#datatransferitemlist id=the-datatransfer-interface:datatransferitemlist>DataTransferItemList</a> <a href=#dom-datatransfer-items id=the-datatransfer-interface:dom-datatransfer-items>items</a>;

  void <a href=#dom-datatransfer-setdragimage id=the-datatransfer-interface:dom-datatransfer-setdragimage>setDragImage</a>(Element image, long x, long y);

  /* old interface */
  readonly attribute FrozenArray&lt;DOMString> <a href=#dom-datatransfer-types id=the-datatransfer-interface:dom-datatransfer-types>types</a>;
  DOMString <a href=#dom-datatransfer-getdata id=the-datatransfer-interface:dom-datatransfer-getdata>getData</a>(DOMString format);
  void <a href=#dom-datatransfer-setdata id=the-datatransfer-interface:dom-datatransfer-setdata>setData</a>(DOMString format, DOMString data);
  void <a href=#dom-datatransfer-cleardata id=the-datatransfer-interface:dom-datatransfer-cleardata>clearData</a>(optional DOMString format);
  [SameObject] readonly attribute <a id=the-datatransfer-interface:filelist href=https://w3c.github.io/FileAPI/#filelist-section data-x-internal=filelist>FileList</a> <a href=#dom-datatransfer-files id=the-datatransfer-interface:dom-datatransfer-files>files</a>;
};</pre>

  <dl class=domintro><dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-dropeffect-2><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the kind of operation that is currently selected. If the kind of operation isn't one
    of those that is allowed by the <code id=the-datatransfer-interface:dom-datatransfer-effectallowed-2><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> attribute, then the operation will
    fail.</p>

    <p>Can be set, to change the selected operation.</p>

    <p>The possible values are "<code id=the-datatransfer-interface:dom-datatransfer-dropeffect-none><a href=#dom-datatransfer-dropeffect-none>none</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-dropeffect-copy><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-dropeffect-link><a href=#dom-datatransfer-dropeffect-link>link</a></code>", and "<code id=the-datatransfer-interface:dom-datatransfer-dropeffect-move><a href=#dom-datatransfer-dropeffect-move>move</a></code>".</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-effectallowed-3><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the kinds of operations that are to be allowed.</p>

    <p>Can be set (during the <code id=the-datatransfer-interface:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code> event), to change
    the allowed operations.</p>

    <p>The possible values are "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-none><a href=#dom-datatransfer-effectallowed-none>none</a></code>",
    "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-copy><a href=#dom-datatransfer-effectallowed-copy>copy</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-copylink><a href=#dom-datatransfer-effectallowed-copylink>copyLink</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-copymove><a href=#dom-datatransfer-effectallowed-copymove>copyMove</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-link><a href=#dom-datatransfer-effectallowed-link>link</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-linkmove><a href=#dom-datatransfer-effectallowed-linkmove>linkMove</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-move><a href=#dom-datatransfer-effectallowed-move>move</a></code>", "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-all><a href=#dom-datatransfer-effectallowed-all>all</a></code>", and "<code id=the-datatransfer-interface:dom-datatransfer-effectallowed-uninitialized><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>",</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-items-2><a href=#dom-datatransfer-items>items</a></code><dd>

    <p>Returns a <code id=the-datatransfer-interface:datatransferitemlist-2><a href=#datatransferitemlist>DataTransferItemList</a></code> object, with the drag data.</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-setdragimage-2><a href=#dom-datatransfer-setdragimage>setDragImage</a></code>(<var>element</var>, <var>x</var>, <var>y</var>)<dd>

    <p>Uses the given element to update the drag feedback, replacing any previously specified
    feedback.</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-types-2><a href=#dom-datatransfer-types>types</a></code><dd>

    <p>Returns a <a id=the-datatransfer-interface:frozen-array href=https://heycam.github.io/webidl/#dfn-frozen-array-type data-x-internal=frozen-array>frozen array</a> listing the formats that were set in the <code id=the-datatransfer-interface:event-dnd-dragstart-2><a href=#event-dnd-dragstart>dragstart</a></code> event. In addition, if any files are being
    dragged, then one of the types will be the string "<code>Files</code>".</p>

   <dt><var>data</var> = <var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-getdata-2><a href=#dom-datatransfer-getdata>getData</a></code>(<var>format</var>)<dd>

    <p>Returns the specified data. If there is no such data, returns the empty string.</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-setdata-2><a href=#dom-datatransfer-setdata>setData</a></code>(<var>format</var>, <var>data</var>)<dd>

    <p>Adds the specified data.</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-cleardata-2><a href=#dom-datatransfer-cleardata>clearData</a></code>( [ <var>format</var> ] )<dd>

    <p>Removes the data of the specified formats. Removes all data if the argument is omitted.</p>

   <dt><var>dataTransfer</var> . <code id=the-datatransfer-interface:dom-datatransfer-files-2><a href=#dom-datatransfer-files>files</a></code><dd>

    <p>Returns a <code id=the-datatransfer-interface:filelist-2><a data-x-internal=filelist href=https://w3c.github.io/FileAPI/#filelist-section>FileList</a></code> of the files being dragged, if any.</p>

   </dl>

  <p><code id=the-datatransfer-interface:datatransfer-3><a href=#datatransfer>DataTransfer</a></code> objects are used during the <a href=#dndevents>drag-and-drop
  events</a>, and are only valid while those events are being fired.</p>

  

  <p>A <code id=the-datatransfer-interface:datatransfer-4><a href=#datatransfer>DataTransfer</a></code> object is associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-2>drag data store</a> while it
  is valid.</p>

  <p>A <code id=the-datatransfer-interface:datatransfer-5><a href=#datatransfer>DataTransfer</a></code> object has an associated <dfn id=concept-datatransfer-types>types array</dfn>, which is a
  <code id=the-datatransfer-interface:frozen-array-2><a data-x-internal=frozen-array href=https://heycam.github.io/webidl/#dfn-frozen-array-type>FrozenArray&lt;DOMString></a></code>, initially empty. When the contents
  of the <code id=the-datatransfer-interface:datatransfer-6><a href=#datatransfer>DataTransfer</a></code> object's <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list>drag data store item list</a> change, or when
  the <code id=the-datatransfer-interface:datatransfer-7><a href=#datatransfer>DataTransfer</a></code> object becomes no longer associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-3>drag data
  store</a>, run the following steps:</p>

  <ol><li><p>Let <var>L</var> be an empty sequence.<li>
    <p>If the <code id=the-datatransfer-interface:datatransfer-8><a href=#datatransfer>DataTransfer</a></code> object is still associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-4>drag data
    store</a>, then:</p>

    <ol><li><p>For each item in the <code id=the-datatransfer-interface:datatransfer-9><a href=#datatransfer>DataTransfer</a></code> object's <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-2>drag data store item
     list</a>  whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind>kind</a>
     is <i>Plain Unicode string</i>, add an entry to <var>L</var> consisting of the item's <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string>type string</a>.<li><p>If there are any items in the <code id=the-datatransfer-interface:datatransfer-10><a href=#datatransfer>DataTransfer</a></code> object's <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-3>drag data store
     item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-2>kind</a> is <i>File</i>, then
     add an entry to <var>L</var> consisting of the string "<code>Files</code>". (This
     value can be distinguished from the other values because it is not lowercase.)</ol>
   <li><p>Set the <code id=the-datatransfer-interface:datatransfer-11><a href=#datatransfer>DataTransfer</a></code> object's <a href=#concept-datatransfer-types id=the-datatransfer-interface:concept-datatransfer-types>types
   array</a> to the result of <a id=the-datatransfer-interface:creating-a-frozen-array href=https://heycam.github.io/webidl/#dfn-create-frozen-array data-x-internal=creating-a-frozen-array>creating a frozen array</a> from <var>L</var>.</ol>

  <p>The <dfn id=dom-datatransfer-dropeffect><code>dropEffect</code></dfn> attribute controls
  the drag-and-drop feedback that the user is given during a drag-and-drop operation. When the
  <code id=the-datatransfer-interface:datatransfer-12><a href=#datatransfer>DataTransfer</a></code> object is created, the <code id=the-datatransfer-interface:dom-datatransfer-dropeffect-3><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> attribute is set to a string value. On
  getting, it must return its current value. On setting, if the new value is one of "<dfn id=dom-datatransfer-dropeffect-none><code>none</code></dfn>", "<dfn id=dom-datatransfer-dropeffect-copy><code>copy</code></dfn>", "<dfn id=dom-datatransfer-dropeffect-link><code>link</code></dfn>", or "<dfn id=dom-datatransfer-dropeffect-move><code>move</code></dfn>", then the attribute's current value must be
  set to the new value. Other values must be ignored.</p>

  <p>The <dfn id=dom-datatransfer-effectallowed><code>effectAllowed</code></dfn> attribute is
  used in the drag-and-drop processing model to initialize the <code id=the-datatransfer-interface:dom-datatransfer-dropeffect-4><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> attribute during the <code id=the-datatransfer-interface:event-dnd-dragenter><a href=#event-dnd-dragenter>dragenter</a></code> and <code id=the-datatransfer-interface:event-dnd-dragover><a href=#event-dnd-dragover>dragover</a></code> events. When the <code id=the-datatransfer-interface:datatransfer-13><a href=#datatransfer>DataTransfer</a></code> object is
  created, the <code id=the-datatransfer-interface:dom-datatransfer-effectallowed-4><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> attribute is set
  to a string value. On getting, it must return its current value. On setting, if <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-5>drag data
  store</a>'s <a href=#drag-data-store-mode id=the-datatransfer-interface:drag-data-store-mode>mode</a> is the <a href=#concept-dnd-rw id=the-datatransfer-interface:concept-dnd-rw>read/write mode</a> and the new value is one of "<dfn id=dom-datatransfer-effectallowed-none><code>none</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-copy><code>copy</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-copylink><code>copyLink</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-copymove><code>copyMove</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-link><code>link</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-linkmove><code>linkMove</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-move><code>move</code></dfn>", "<dfn id=dom-datatransfer-effectallowed-all><code>all</code></dfn>", or "<dfn id=dom-datatransfer-effectallowed-uninitialized><code>uninitialized</code></dfn>", then the attribute's
  current value must be set to the new value. Otherwise it must be left unchanged.</p>

  <p>The <dfn id=dom-datatransfer-items><code>items</code></dfn> attribute must return a
  <code id=the-datatransfer-interface:datatransferitemlist-3><a href=#datatransferitemlist>DataTransferItemList</a></code> object associated with the <code id=the-datatransfer-interface:datatransfer-14><a href=#datatransfer>DataTransfer</a></code> object.</p>

  <p>The <dfn id=dom-datatransfer-setdragimage><code>setDragImage(<var>element</var>,
  <var>x</var>, <var>y</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the <code id=the-datatransfer-interface:datatransfer-15><a href=#datatransfer>DataTransfer</a></code> object is no longer associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-6>drag data
   store</a>, abort these steps. Nothing happens.<li><p>If the <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-7>drag data store</a>'s <a href=#drag-data-store-mode id=the-datatransfer-interface:drag-data-store-mode-2>mode</a> is
   not the <a href=#concept-dnd-rw id=the-datatransfer-interface:concept-dnd-rw-2>read/write mode</a>, abort these steps. Nothing
   happens.<li><p>If <var>element</var> is an <code id=the-datatransfer-interface:the-img-element><a href=#the-img-element>img</a></code> element, then set the <a href=#drag-data-store-bitmap id=the-datatransfer-interface:drag-data-store-bitmap>drag data store
   bitmap</a> to the element's image (at its <a href=https://drafts.csswg.org/css2/conform.html#intrinsic id=the-datatransfer-interface:intrinsic-dimensions data-x-internal=intrinsic-dimensions>intrinsic
   size</a>); otherwise, set the <a href=#drag-data-store-bitmap id=the-datatransfer-interface:drag-data-store-bitmap-2>drag data store bitmap</a> to an image generated from
   the given element (the exact mechanism for doing so is not currently specified).<li><p>Set the <a href=#drag-data-store-hot-spot-coordinate id=the-datatransfer-interface:drag-data-store-hot-spot-coordinate>drag data store hot spot coordinate</a> to the given <var>x</var>,
   <var>y</var> coordinate.</ol>

  <p>The <dfn id=dom-datatransfer-types><code>types</code></dfn> attribute must return this
  <code id=the-datatransfer-interface:datatransfer-16><a href=#datatransfer>DataTransfer</a></code> object's <a href=#concept-datatransfer-types id=the-datatransfer-interface:concept-datatransfer-types-2>types
  array</a>.</p>

  <p>The <dfn id=dom-datatransfer-getdata><code>getData(<var>format</var>)</code></dfn> method
  must run the following steps:</p>

  <ol><li><p>If the <code id=the-datatransfer-interface:datatransfer-17><a href=#datatransfer>DataTransfer</a></code> object is no longer associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-8>drag data
   store</a>, return the empty string and abort these steps.<li><p>If the <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-9>drag data store</a>'s <a href=#drag-data-store-mode id=the-datatransfer-interface:drag-data-store-mode-3>mode</a> is
   the <a href=#concept-dnd-p id=the-datatransfer-interface:concept-dnd-p>protected mode</a>, return the empty string and abort these
   steps.<li><p>Let <var>format</var> be the first argument, <a id=the-datatransfer-interface:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII
   lowercase</a>.<li><p>Let <var>convert-to-URL</var> be false.<li><p>If <var>format</var> equals "<code>text</code>", change it to "<code>text/plain</code>".<li><p>If <var>format</var> equals "<code>url</code>", change it to "<code>text/uri-list</code>" and set <var>convert-to-URL</var> to true.<li><p>If there is no item in the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-4>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-3>kind</a> is <i>Plain Unicode string</i> and whose <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string-2>type string</a> is equal to <var>format</var>, return the empty string
   and abort these steps.<li><p>Let <var>result</var> be the data of the item in the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-5>drag data store item
   list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-4>kind</a> is <i>Plain Unicode
   string</i> and whose <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string-3>type string</a> is equal to
   <var>format</var>.<li><p>If <var>convert-to-URL</var> is true, then parse <var>result</var> as appropriate for
   <code>text/uri-list</code> data, and then set <var>result</var> to the first URL from
   the list, if any, or the empty string otherwise. <a href=#refsRFC2483>[RFC2483]</a><li><p>Return <var>result</var>.</ol>

  <p>The <dfn id=dom-datatransfer-setdata><code>setData(<var>format</var>,
  <var>data</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the <code id=the-datatransfer-interface:datatransfer-18><a href=#datatransfer>DataTransfer</a></code> object is no longer associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-10>drag data
   store</a>, abort these steps. Nothing happens.<li><p>If the <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-11>drag data store</a>'s <a href=#drag-data-store-mode id=the-datatransfer-interface:drag-data-store-mode-4>mode</a> is
   not the <a href=#concept-dnd-rw id=the-datatransfer-interface:concept-dnd-rw-3>read/write mode</a>, abort these steps. Nothing
   happens.<li><p>Let <var>format</var> be the first argument, <a id=the-datatransfer-interface:converted-to-ascii-lowercase-2 href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII
   lowercase</a>.<li>

    <p>If <var>format</var> equals "<code>text</code>", change it to "<code>text/plain</code>".</p>

    <p>If <var>format</var> equals "<code>url</code>", change it to "<code>text/uri-list</code>".</p>

   <li><p>Remove the item in the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-6>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-5>kind</a> is <i>Plain Unicode string</i> and whose <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string-4>type string</a> is equal to <var>format</var>, if there is
   one.<li><p>Add an item to the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-7>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-6>kind</a> is <i>Plain Unicode string</i>, whose <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string-5>type string</a> is equal to <var>format</var>, and whose data is the string
   given by the method's second argument.</ol>

  <p>The <dfn id=dom-datatransfer-cleardata><code>clearData()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the <code id=the-datatransfer-interface:datatransfer-19><a href=#datatransfer>DataTransfer</a></code> object is no longer associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-12>drag data
   store</a>, abort these steps. Nothing happens.<li><p>If the <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-13>drag data store</a>'s <a href=#drag-data-store-mode id=the-datatransfer-interface:drag-data-store-mode-5>mode</a> is
   not the <a href=#concept-dnd-rw id=the-datatransfer-interface:concept-dnd-rw-4>read/write mode</a>, abort these steps. Nothing
   happens.<li><p>If the method was called with no arguments, remove each item in the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-8>drag data store
   item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-7>kind</a> is <i>Plain Unicode
   string</i>, and abort these steps.<li><p>Let <var>format</var> be the first argument, <a id=the-datatransfer-interface:converted-to-ascii-lowercase-3 href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII
   lowercase</a>.<li>

    <p>If <var>format</var> equals "<code>text</code>", change it to "<code>text/plain</code>".</p>

    <p>If <var>format</var> equals "<code>url</code>", change it to "<code>text/uri-list</code>".</p>

   <li><p>Remove the item in the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-9>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-8>kind</a> is <i>Plain Unicode string</i> and whose <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string-6>type string</a> is equal to <var>format</var>, if there is
   one.</ol>

  <p class=note>The <code id=the-datatransfer-interface:dom-datatransfer-cleardata-3><a href=#dom-datatransfer-cleardata>clearData()</a></code> method does not
  affect whether any files were included in the drag, so the <code id=the-datatransfer-interface:dom-datatransfer-types-3><a href=#dom-datatransfer-types>types</a></code> attribute's list might still not be empty after
  calling <code id=the-datatransfer-interface:dom-datatransfer-cleardata-4><a href=#dom-datatransfer-cleardata>clearData()</a></code> (it would still contain the
  "<code>Files</code>" string if any files were included in the drag).</p>

  <p>The <dfn id=dom-datatransfer-files><code>files</code></dfn> attribute must return a
  <a href=#live id=the-datatransfer-interface:live>live</a> <code id=the-datatransfer-interface:filelist-3><a data-x-internal=filelist href=https://w3c.github.io/FileAPI/#filelist-section>FileList</a></code> sequence consisting of <code id=the-datatransfer-interface:file><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code> objects
  representing the files found by the following steps.
  Furthermore, for a given <code id=the-datatransfer-interface:filelist-4><a data-x-internal=filelist href=https://w3c.github.io/FileAPI/#filelist-section>FileList</a></code> object and a given underlying file, the same
  <code id=the-datatransfer-interface:file-2><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code> object must be used each time.</p>

  <ol><li><p>Start with an empty list <var>L</var>.<li><p>If the <code id=the-datatransfer-interface:datatransfer-20><a href=#datatransfer>DataTransfer</a></code> object is no longer associated with a <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-14>drag data
   store</a>, the <code id=the-datatransfer-interface:filelist-5><a data-x-internal=filelist href=https://w3c.github.io/FileAPI/#filelist-section>FileList</a></code> is empty. Abort these steps; return the empty list <var>L</var>.<li><p>If the <a href=#drag-data-store id=the-datatransfer-interface:drag-data-store-15>drag data store</a>'s <a href=#drag-data-store-mode id=the-datatransfer-interface:drag-data-store-mode-6>mode</a> is
   the <a href=#concept-dnd-p id=the-datatransfer-interface:concept-dnd-p-2>protected mode</a>, abort these steps; return the empty list
   <var>L</var>.<li><p>For each item in the <a href=#drag-data-store-item-list id=the-datatransfer-interface:drag-data-store-item-list-10>drag data store item list</a> 
   whose <a href=#the-drag-data-item-kind id=the-datatransfer-interface:the-drag-data-item-kind-9>kind</a> is <i>File</i> , add the item's data (the file, in particular its name and contents, as well as
   its <a href=#the-drag-data-item-type-string id=the-datatransfer-interface:the-drag-data-item-type-string-7>type</a>) to the list <var>L</var>.<li><p>The files found by these steps are those in the list <var>L</var>.</ol>

  <p class=note>This version of the API does not expose the types of the files during the
  drag.</p>

  


  <h5 id=the-datatransferitemlist-interface>6.7.3.1 The <code id=the-datatransferitemlist-interface:datatransferitemlist><a href=#datatransferitemlist>DataTransferItemList</a></code> interface<a href=#the-datatransferitemlist-interface class=self-link></a></h5>

  <p>Each <code id=the-datatransferitemlist-interface:datatransfer><a href=#datatransfer>DataTransfer</a></code> object is associated with a <code id=the-datatransferitemlist-interface:datatransferitemlist-2><a href=#datatransferitemlist>DataTransferItemList</a></code>
  object.</p>

  <pre class=idl>interface <dfn id=datatransferitemlist>DataTransferItemList</dfn> {
  readonly attribute unsigned long <a href=#dom-datatransferitemlist-length id=the-datatransferitemlist-interface:dom-datatransferitemlist-length>length</a>;
  <a href=#dom-datatransferitemlist-item>getter</a> <a href=#datatransferitem id=the-datatransferitemlist-interface:datatransferitem>DataTransferItem</a> (unsigned long index);
  <a href=#datatransferitem id=the-datatransferitemlist-interface:datatransferitem-2>DataTransferItem</a>? <a href=#dom-datatransferitemlist-add id=the-datatransferitemlist-interface:dom-datatransferitemlist-add>add</a>(DOMString data, DOMString type);
  <a href=#datatransferitem id=the-datatransferitemlist-interface:datatransferitem-3>DataTransferItem</a>? <a href=#dom-datatransferitemlist-add id=the-datatransferitemlist-interface:dom-datatransferitemlist-add-2>add</a>(<a id=the-datatransferitemlist-interface:file href=https://w3c.github.io/FileAPI/#file data-x-internal=file>File</a> data);
  void <a href=#dom-datatransferitemlist-remove id=the-datatransferitemlist-interface:dom-datatransferitemlist-remove>remove</a>(unsigned long index);
  void <a href=#dom-datatransferitemlist-clear id=the-datatransferitemlist-interface:dom-datatransferitemlist-clear>clear</a>();
};</pre>

  <dl class=domintro><dt><var>items</var> . <code id=the-datatransferitemlist-interface:dom-datatransferitemlist-length-2><a href=#dom-datatransferitemlist-length>length</a></code><dd><p>Returns the number of items in the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store>drag data store</a>.<dt><var>items</var>[<var>index</var>]<dd>

    <p>Returns the <code id=the-datatransferitemlist-interface:datatransferitem-4><a href=#datatransferitem>DataTransferItem</a></code> object representing the <var>index</var>th
    entry in the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-2>drag data store</a>.</p>

   <dt><var>items</var> . <code id=the-datatransferitemlist-interface:dom-datatransferitemlist-remove-2><a href=#dom-datatransferitemlist-remove>remove</a></code>(<var>index</var>)<dd>

    <p>Removes the <var>index</var>th entry in the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-3>drag data store</a>.</p>

   <dt><var>items</var> . <code id=the-datatransferitemlist-interface:dom-datatransferitemlist-clear-2><a href=#dom-datatransferitemlist-clear>clear</a></code>()<dd>

    <p>Removes all the entries in the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-4>drag data store</a>.</p>

   <dt><var>items</var> . <code id=the-datatransferitemlist-interface:dom-datatransferitemlist-add-3><a href=#dom-datatransferitemlist-add>add</a></code>(<var>data</var>)<dt><var>items</var> . <code id=the-datatransferitemlist-interface:dom-datatransferitemlist-add-4><a href=#dom-datatransferitemlist-add>add</a></code>(<var>data</var>, <var>type</var>)<dd>

    <p>Adds a new entry for the given data to the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-5>drag data store</a>. If the data is plain
    text  then a <var>type</var> string has to be provided
    also.</p>

   </dl>

  

  <p>While the <code id=the-datatransferitemlist-interface:datatransferitemlist-3><a href=#datatransferitemlist>DataTransferItemList</a></code> object's <code id=the-datatransferitemlist-interface:datatransfer-2><a href=#datatransfer>DataTransfer</a></code> object is
  associated with a <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-6>drag data store</a>, the <code id=the-datatransferitemlist-interface:datatransferitemlist-4><a href=#datatransferitemlist>DataTransferItemList</a></code> object's
  <i>mode</i> is the same as the <a href=#drag-data-store-mode id=the-datatransferitemlist-interface:drag-data-store-mode>drag data store mode</a>. When the
  <code id=the-datatransferitemlist-interface:datatransferitemlist-5><a href=#datatransferitemlist>DataTransferItemList</a></code> object's <code id=the-datatransferitemlist-interface:datatransfer-3><a href=#datatransfer>DataTransfer</a></code> object is <em>not</em>
  associated with a <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-7>drag data store</a>, the <code id=the-datatransferitemlist-interface:datatransferitemlist-6><a href=#datatransferitemlist>DataTransferItemList</a></code> object's
  <i>mode</i> is the <i>disabled mode</i>. The <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-8>drag data store</a> referenced in this
  section (which is used only when the <code id=the-datatransferitemlist-interface:datatransferitemlist-7><a href=#datatransferitemlist>DataTransferItemList</a></code> object is not in the
  <i>disabled mode</i>) is the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-9>drag data store</a> with which the
  <code id=the-datatransferitemlist-interface:datatransferitemlist-8><a href=#datatransferitemlist>DataTransferItemList</a></code> object's <code id=the-datatransferitemlist-interface:datatransfer-4><a href=#datatransfer>DataTransfer</a></code> object is associated.</p>

  <p>The <dfn id=dom-datatransferitemlist-length><code>length</code></dfn> attribute must
  return zero if the object is in the <i>disabled mode</i>; otherwise it must return the number of
  items in the <a href=#drag-data-store-item-list id=the-datatransferitemlist-interface:drag-data-store-item-list>drag data store item list</a>.</p>

  <p>When a <code id=the-datatransferitemlist-interface:datatransferitemlist-9><a href=#datatransferitemlist>DataTransferItemList</a></code> object is not in the <i>disabled mode</i>, its
  <a id=the-datatransferitemlist-interface:supported-property-indices href=https://heycam.github.io/webidl/#dfn-supported-property-indices data-x-internal=supported-property-indices>supported property indices</a> are the numbers in the range

    <span>0 .. <var>n</var>-1</span>,

  where <var>n</var> is the number of items in the <a href=#drag-data-store-item-list id=the-datatransferitemlist-interface:drag-data-store-item-list-2>drag data store item
  list</a>.</p>

  <p id=dom-datatransferitemlist-item>To <a id=the-datatransferitemlist-interface:determine-the-value-of-an-indexed-property href=https://heycam.github.io/webidl/#dfn-determine-the-value-of-an-indexed-property data-x-internal=determine-the-value-of-an-indexed-property>determine the value of an indexed property</a>
  <var>i</var> of a <code id=the-datatransferitemlist-interface:datatransferitemlist-10><a href=#datatransferitemlist>DataTransferItemList</a></code> object, the user agent must return a
  <code id=the-datatransferitemlist-interface:datatransferitem-5><a href=#datatransferitem>DataTransferItem</a></code> object representing the <var>i</var>th item in the
  <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-10>drag data store</a>. The same object must be returned each time a particular item is
  obtained from this <code id=the-datatransferitemlist-interface:datatransferitemlist-11><a href=#datatransferitemlist>DataTransferItemList</a></code> object. The <code id=the-datatransferitemlist-interface:datatransferitem-6><a href=#datatransferitem>DataTransferItem</a></code>
  object must be associated with the same <code id=the-datatransferitemlist-interface:datatransfer-5><a href=#datatransfer>DataTransfer</a></code> object as the
  <code id=the-datatransferitemlist-interface:datatransferitemlist-12><a href=#datatransferitemlist>DataTransferItemList</a></code> object when it is first created.</p>

  <p>The <dfn id=dom-datatransferitemlist-add><code>add()</code></dfn> method must run the
  following steps:</p>

  <ol><li><p>If the <code id=the-datatransferitemlist-interface:datatransferitemlist-13><a href=#datatransferitemlist>DataTransferItemList</a></code> object is not in the <i id=the-datatransferitemlist-interface:concept-dnd-rw><a href=#concept-dnd-rw>read/write mode</a></i>, return null and abort these steps.<li>

    <p>Jump to the appropriate set of steps from the following list:</p>

    <dl class=switch><dt>If the first argument to the method is a string<dd>

      <p>If there is already an item in the <a href=#drag-data-store-item-list id=the-datatransferitemlist-interface:drag-data-store-item-list-3>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransferitemlist-interface:the-drag-data-item-kind>kind</a> is <i>Plain Unicode string</i> and whose <a href=#the-drag-data-item-type-string id=the-datatransferitemlist-interface:the-drag-data-item-type-string>type string</a> is equal to the value of the
      method's second argument, <a id=the-datatransferitemlist-interface:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>, then throw a
      <a id=the-datatransferitemlist-interface:notsupportederror href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=the-datatransferitemlist-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these
      steps.</p>

      <p>Otherwise, add an item to the <a href=#drag-data-store-item-list id=the-datatransferitemlist-interface:drag-data-store-item-list-4>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransferitemlist-interface:the-drag-data-item-kind-2>kind</a> is <i>Plain Unicode string</i>, whose <a href=#the-drag-data-item-type-string id=the-datatransferitemlist-interface:the-drag-data-item-type-string-2>type string</a> is equal to the value of the method's second
      argument, <a id=the-datatransferitemlist-interface:converted-to-ascii-lowercase-2 href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>, and whose data is the string given by the
      method's first argument.</p>

     <dt>If the first argument to the method is a <code id=the-datatransferitemlist-interface:file-2><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code><dd>

      <p>Add an item to the <a href=#drag-data-store-item-list id=the-datatransferitemlist-interface:drag-data-store-item-list-5>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-datatransferitemlist-interface:the-drag-data-item-kind-3>kind</a> is <i>File</i>, whose <a href=#the-drag-data-item-type-string id=the-datatransferitemlist-interface:the-drag-data-item-type-string-3>type
      string</a> is the <code id=the-datatransferitemlist-interface:dom-blob-type><a data-x-internal=dom-blob-type href=https://w3c.github.io/FileAPI/#dfn-type>type</a></code> of the <code id=the-datatransferitemlist-interface:file-3><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code>,
      <a id=the-datatransferitemlist-interface:converted-to-ascii-lowercase-3 href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>, and whose data is the same as the
      <code id=the-datatransferitemlist-interface:file-4><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code>'s data.</p>

     </dl>

   <li><p><a href=#dom-datatransferitemlist-item>Determine the value of the indexed property</a>
   corresponding to the newly added item, and return that value (a newly created
   <code id=the-datatransferitemlist-interface:datatransferitem-7><a href=#datatransferitem>DataTransferItem</a></code> object).</ol>

  <p>The <dfn id=dom-datatransferitemlist-remove><code>remove()</code></dfn> method, when
  invoked with the argument <var>i</var>, must run these steps:</p>

  <ol><li><p>If the <code id=the-datatransferitemlist-interface:datatransferitemlist-14><a href=#datatransferitemlist>DataTransferItemList</a></code> object is not in the <i id=the-datatransferitemlist-interface:concept-dnd-rw-2><a href=#concept-dnd-rw>read/write mode</a></i>, throw an
   <a id=the-datatransferitemlist-interface:invalidstateerror href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=the-datatransferitemlist-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these
   steps.<li><p>Remove the <var>i</var>th item from the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-11>drag data store</a>.</ol>

  <p>The <dfn id=dom-datatransferitemlist-clear><code>clear()</code></dfn> method, if the
  <code id=the-datatransferitemlist-interface:datatransferitemlist-15><a href=#datatransferitemlist>DataTransferItemList</a></code> object is in the <i id=the-datatransferitemlist-interface:concept-dnd-rw-3><a href=#concept-dnd-rw>read/write mode</a></i>,
  must remove all the items from the <a href=#drag-data-store id=the-datatransferitemlist-interface:drag-data-store-12>drag data store</a>. Otherwise, it must do
  nothing.</p>

  


  <h5 id=the-datatransferitem-interface>6.7.3.2 The <code id=the-datatransferitem-interface:datatransferitem><a href=#datatransferitem>DataTransferItem</a></code> interface<a href=#the-datatransferitem-interface class=self-link></a></h5>

  <p>Each <code id=the-datatransferitem-interface:datatransferitem-2><a href=#datatransferitem>DataTransferItem</a></code> object is associated with a <code id=the-datatransferitem-interface:datatransfer><a href=#datatransfer>DataTransfer</a></code>
  object.</p>

  <pre class=idl>interface <dfn id=datatransferitem>DataTransferItem</dfn> {
  readonly attribute DOMString <a href=#dom-datatransferitem-kind id=the-datatransferitem-interface:dom-datatransferitem-kind>kind</a>;
  readonly attribute DOMString <a href=#dom-datatransferitem-type id=the-datatransferitem-interface:dom-datatransferitem-type>type</a>;
  void <a href=#dom-datatransferitem-getasstring id=the-datatransferitem-interface:dom-datatransferitem-getasstring>getAsString</a>(<a href=#functionstringcallback id=the-datatransferitem-interface:functionstringcallback>FunctionStringCallback</a>? _callback);
  <a id=the-datatransferitem-interface:file href=https://w3c.github.io/FileAPI/#file data-x-internal=file>File</a>? <a href=#dom-datatransferitem-getasfile id=the-datatransferitem-interface:dom-datatransferitem-getasfile>getAsFile</a>();
};

callback <dfn id=functionstringcallback>FunctionStringCallback</dfn> = void (DOMString data);</pre>

  <dl class=domintro><dt><var>item</var> . <code id=the-datatransferitem-interface:dom-datatransferitem-kind-2><a href=#dom-datatransferitem-kind>kind</a></code><dd>

    <p>Returns <a href=#the-drag-data-item-kind id=the-datatransferitem-interface:the-drag-data-item-kind>the drag data item kind</a>, one of: "string",
     "file".</p>

   <dt><var>item</var> . <code id=the-datatransferitem-interface:dom-datatransferitem-type-2><a href=#dom-datatransferitem-type>type</a></code><dd>

    <p>Returns <a href=#the-drag-data-item-type-string id=the-datatransferitem-interface:the-drag-data-item-type-string>the drag data item type string</a>.</p>

   <dt><var>item</var> . <code id=the-datatransferitem-interface:dom-datatransferitem-getasstring-2><a href=#dom-datatransferitem-getasstring>getAsString</a></code>(<var>callback</var>)<dd>

    <p>Invokes the callback with the string data as the argument, if <a href=#the-drag-data-item-kind id=the-datatransferitem-interface:the-drag-data-item-kind-2>the drag data item
    kind</a> is <i>Plain Unicode string</i>.</p>

   <dt><var>file</var> = <var>item</var> . <code id=the-datatransferitem-interface:dom-datatransferitem-getasfile-2><a href=#dom-datatransferitem-getasfile>getAsFile</a></code>()<dd>

    <p>Returns a <code id=the-datatransferitem-interface:file-2><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code> object, if <a href=#the-drag-data-item-kind id=the-datatransferitem-interface:the-drag-data-item-kind-3>the drag data item kind</a> is <i>File</i>.</p>

   </dl>

  

  <p>While the <code id=the-datatransferitem-interface:datatransferitem-3><a href=#datatransferitem>DataTransferItem</a></code> object's <code id=the-datatransferitem-interface:datatransfer-2><a href=#datatransfer>DataTransfer</a></code> object is associated
  with a <a href=#drag-data-store id=the-datatransferitem-interface:drag-data-store>drag data store</a> and that <a href=#drag-data-store id=the-datatransferitem-interface:drag-data-store-2>drag data store</a>'s <a href=#drag-data-store-item-list id=the-datatransferitem-interface:drag-data-store-item-list>drag data store
  item list</a> still contains the item that the <code id=the-datatransferitem-interface:datatransferitem-4><a href=#datatransferitem>DataTransferItem</a></code> object represents,
  the <code id=the-datatransferitem-interface:datatransferitem-5><a href=#datatransferitem>DataTransferItem</a></code> object's <i>mode</i> is the same as the <a href=#drag-data-store-mode id=the-datatransferitem-interface:drag-data-store-mode>drag data store
  mode</a>. When the <code id=the-datatransferitem-interface:datatransferitem-6><a href=#datatransferitem>DataTransferItem</a></code> object's <code id=the-datatransferitem-interface:datatransfer-3><a href=#datatransfer>DataTransfer</a></code> object is
  <em>not</em> associated with a <a href=#drag-data-store id=the-datatransferitem-interface:drag-data-store-3>drag data store</a>, or if the item that the
  <code id=the-datatransferitem-interface:datatransferitem-7><a href=#datatransferitem>DataTransferItem</a></code> object represents has been removed from the relevant <a href=#drag-data-store-item-list id=the-datatransferitem-interface:drag-data-store-item-list-2>drag data
  store item list</a>, the <code id=the-datatransferitem-interface:datatransferitem-8><a href=#datatransferitem>DataTransferItem</a></code> object's <i>mode</i> is the <i>disabled
  mode</i>. The <a href=#drag-data-store id=the-datatransferitem-interface:drag-data-store-4>drag data store</a> referenced in this section (which is used only when the
  <code id=the-datatransferitem-interface:datatransferitem-9><a href=#datatransferitem>DataTransferItem</a></code> object is not in the <i>disabled mode</i>) is the <a href=#drag-data-store id=the-datatransferitem-interface:drag-data-store-5>drag data
  store</a> with which the <code id=the-datatransferitem-interface:datatransferitem-10><a href=#datatransferitem>DataTransferItem</a></code> object's <code id=the-datatransferitem-interface:datatransfer-4><a href=#datatransfer>DataTransfer</a></code>
  object is associated.</p>

  <p>The <dfn id=dom-datatransferitem-kind><code>kind</code></dfn> attribute must return the
  empty string if the <code id=the-datatransferitem-interface:datatransferitem-11><a href=#datatransferitem>DataTransferItem</a></code> object is in the <i>disabled mode</i>; otherwise
  it must return the string given in the cell from the second column of the following table from the
  row whose cell in the first column contains <a href=#the-drag-data-item-kind id=the-datatransferitem-interface:the-drag-data-item-kind-4>the drag data item kind</a> of the item
  represented by the <code id=the-datatransferitem-interface:datatransferitem-12><a href=#datatransferitem>DataTransferItem</a></code> object:</p>

  <table><thead><tr><th> Kind <th> String
   <tbody><tr><td> <i>Plain Unicode string</i> <td> "<code>string</code>"

    <tr><td> <i>File</i> <td> "<code>file</code>"

  </table>

  <p>The <dfn id=dom-datatransferitem-type><code>type</code></dfn> attribute must return the
  empty string if the <code id=the-datatransferitem-interface:datatransferitem-13><a href=#datatransferitem>DataTransferItem</a></code> object is in the <i>disabled mode</i>; otherwise
  it must return <a href=#the-drag-data-item-type-string id=the-datatransferitem-interface:the-drag-data-item-type-string-2>the drag data item type string</a> of the item represented by the
  <code id=the-datatransferitem-interface:datatransferitem-14><a href=#datatransferitem>DataTransferItem</a></code> object.</p>

  <p>The <dfn id=dom-datatransferitem-getasstring><code>getAsString(<var>callback</var>)</code></dfn> method must run the following steps:</p>

  <ol><li><p>If the <var>callback</var> is null, abort these steps.<li><p>If the <code id=the-datatransferitem-interface:datatransferitem-15><a href=#datatransferitem>DataTransferItem</a></code> object is not in the <i id=the-datatransferitem-interface:concept-dnd-rw><a href=#concept-dnd-rw>read/write mode</a></i> or the <i id=the-datatransferitem-interface:concept-dnd-ro><a href=#concept-dnd-ro>read-only mode</a></i>,
   abort these steps. The callback is never invoked.<li><p>If <a href=#the-drag-data-item-kind id=the-datatransferitem-interface:the-drag-data-item-kind-5>the drag data item kind</a> is not <i>Plain Unicode string</i>, abort these
   steps. The callback is never invoked.<li><p>Otherwise, <a href=#queue-a-task id=the-datatransferitem-interface:queue-a-task>queue a task</a> to invoke <var>callback</var>, passing the
   actual data of the item represented by the <code id=the-datatransferitem-interface:datatransferitem-16><a href=#datatransferitem>DataTransferItem</a></code> object as the
   argument.</ol>



  <p>The <dfn id=dom-datatransferitem-getasfile><code>getAsFile()</code></dfn>
  method must run the following steps:</p>

  <ol><li><p>If the <code id=the-datatransferitem-interface:datatransferitem-17><a href=#datatransferitem>DataTransferItem</a></code> object is not in the <i id=the-datatransferitem-interface:concept-dnd-rw-2><a href=#concept-dnd-rw>read/write mode</a></i> or the <i id=the-datatransferitem-interface:concept-dnd-ro-2><a href=#concept-dnd-ro>read-only mode</a></i>,
   return null and abort these steps.<li><p>If <a href=#the-drag-data-item-kind id=the-datatransferitem-interface:the-drag-data-item-kind-6>the drag data item kind</a> is not <i>File</i>, then return null and abort
   these steps.<li><p>Return a new <code id=the-datatransferitem-interface:file-3><a data-x-internal=file href=https://w3c.github.io/FileAPI/#file>File</a></code> object representing the actual data of the item represented
   by the <code id=the-datatransferitem-interface:datatransferitem-18><a href=#datatransferitem>DataTransferItem</a></code> object.</p>

  </ol>



  



  <h4 id=the-dragevent-interface>6.7.4 The <code id=the-dragevent-interface:dragevent><a href=#dragevent>DragEvent</a></code> interface<a href=#the-dragevent-interface class=self-link></a></h4>

  <p>The drag-and-drop processing model involves several events. They all use the
  <code id=the-dragevent-interface:dragevent-2><a href=#dragevent>DragEvent</a></code> interface.</p>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#drageventinit id=the-dragevent-interface:drageventinit>DragEventInit</a> eventInitDict)]
interface <dfn id=dragevent>DragEvent</dfn> : <a id=the-dragevent-interface:mouseevent href=https://w3c.github.io/uievents/#interface-MouseEvent data-x-internal=mouseevent>MouseEvent</a> {
  readonly attribute <a href=#datatransfer id=the-dragevent-interface:datatransfer>DataTransfer</a>? <a href=#dom-dragevent-datatransfer id=the-dragevent-interface:dom-dragevent-datatransfer>dataTransfer</a>;
};

dictionary <dfn id=drageventinit>DragEventInit</dfn> : <a id=the-dragevent-interface:mouseeventinit href=https://w3c.github.io/uievents/#idl-def-MouseEventInit data-x-internal=mouseeventinit>MouseEventInit</a> {
  <a href=#datatransfer id=the-dragevent-interface:datatransfer-2>DataTransfer</a>? dataTransfer = null;
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-dragevent-interface:dom-dragevent-datatransfer-2><a href=#dom-dragevent-datatransfer>dataTransfer</a></code><dd>

    <p>Returns the <code id=the-dragevent-interface:datatransfer-3><a href=#datatransfer>DataTransfer</a></code> object for the event.</p>

   </dl>

  <p class=note>Although, for consistency with other event interfaces, the <code id=the-dragevent-interface:dragevent-3><a href=#dragevent>DragEvent</a></code>
  interface has a constructor, it is not particularly useful. In particular, there's no way to
  create a useful <code id=the-dragevent-interface:datatransfer-4><a href=#datatransfer>DataTransfer</a></code> object from script, as <code id=the-dragevent-interface:datatransfer-5><a href=#datatransfer>DataTransfer</a></code> objects
  have a processing and security model that is coordinated by the browser during drag-and-drops.</p>

  

  <p>The <dfn id=dom-dragevent-datatransfer><code>dataTransfer</code></dfn> attribute of the
  <code id=the-dragevent-interface:dragevent-4><a href=#dragevent>DragEvent</a></code> interface must return the value it was initialized to. It represents the
  context information for the event.</p>

  

  

  <p>When a user agent is required to <dfn id=fire-a-dnd-event>fire a DND event</dfn> named <var>e</var> at an element,
  using a particular <a href=#drag-data-store id=the-dragevent-interface:drag-data-store>drag data store</a>, and optionally with a specific <var>related
  target</var>, the user agent must run the following steps:</p>

  <ol><li><p>If no specific <var>related target</var> was provided, set <var>related target</var> to
   null.<li><p>Let <var>window</var> be the <code id=the-dragevent-interface:window><a href=#window>Window</a></code> object of the <code id=the-dragevent-interface:document><a href=#document>Document</a></code>
   object of the specified target element.<li>

    <p>If <var>e</var> is <code id=the-dragevent-interface:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code>, set the <a href=#drag-data-store-mode id=the-dragevent-interface:drag-data-store-mode>drag
    data store mode</a> to the <a href=#concept-dnd-rw id=the-dragevent-interface:concept-dnd-rw>read/write mode</a>.</p>

    <p>If <var>e</var> is <code id=the-dragevent-interface:event-dnd-drop><a href=#event-dnd-drop>drop</a></code>, set the <a href=#drag-data-store-mode id=the-dragevent-interface:drag-data-store-mode-2>drag data store
    mode</a> to the <a href=#concept-dnd-ro id=the-dragevent-interface:concept-dnd-ro>read-only mode</a>.</p>

   <li><p>Let <var>dataTransfer</var> be a newly created <code id=the-dragevent-interface:datatransfer-6><a href=#datatransfer>DataTransfer</a></code> object
   associated with the given <a href=#drag-data-store id=the-dragevent-interface:drag-data-store-2>drag data store</a>.<li><p id=effectAllowed-initialisation>Set the <code id=the-dragevent-interface:dom-datatransfer-effectallowed><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> attribute to the <a href=#drag-data-store id=the-dragevent-interface:drag-data-store-3>drag data
   store</a>'s <a href=#drag-data-store-allowed-effects-state id=the-dragevent-interface:drag-data-store-allowed-effects-state>drag data store allowed effects state</a>.<li>

    <p id=dropEffect-initialisation>Set the <code id=the-dragevent-interface:dom-datatransfer-dropeffect><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> attribute to "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-none><a href=#dom-datatransfer-dropeffect-none>none</a></code>" if <var>e</var> is <code id=the-dragevent-interface:event-dnd-dragstart-2><a href=#event-dnd-dragstart>dragstart</a></code>, <code id=the-dragevent-interface:event-dnd-drag><a href=#event-dnd-drag>drag</a></code>, <code id=the-dragevent-interface:event-dnd-dragexit><a href=#event-dnd-dragexit>dragexit</a></code>, or <code id=the-dragevent-interface:event-dnd-dragleave><a href=#event-dnd-dragleave>dragleave</a></code>; to the value corresponding to the <a href=#current-drag-operation id=the-dragevent-interface:current-drag-operation>current
    drag operation</a> if <var>e</var> is <code id=the-dragevent-interface:event-dnd-drop-2><a href=#event-dnd-drop>drop</a></code> or
    <code id=the-dragevent-interface:event-dnd-dragend><a href=#event-dnd-dragend>dragend</a></code>; and to a value based on the <code id=the-dragevent-interface:dom-datatransfer-effectallowed-2><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> attribute's value and the
    drag-and-drop source, as given by the following table, otherwise (i.e. if <var>e</var>
    is <code id=the-dragevent-interface:event-dnd-dragenter><a href=#event-dnd-dragenter>dragenter</a></code> or <code id=the-dragevent-interface:event-dnd-dragover><a href=#event-dnd-dragover>dragover</a></code>):</p>

    <table><thead><tr><th><code id=the-dragevent-interface:dom-datatransfer-effectallowed-3><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code><th><code id=the-dragevent-interface:dom-datatransfer-dropeffect-2><a href=#dom-datatransfer-dropeffect>dropEffect</a></code><tbody><tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-none><a href=#dom-datatransfer-effectallowed-none>none</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-none-2><a href=#dom-datatransfer-dropeffect-none>none</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-copy><a href=#dom-datatransfer-effectallowed-copy>copy</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-copylink><a href=#dom-datatransfer-effectallowed-copylink>copyLink</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-2><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override>if appropriate</a>, "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link><a href=#dom-datatransfer-dropeffect-link>link</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-copymove><a href=#dom-datatransfer-effectallowed-copymove>copyMove</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-3><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-2>if appropriate</a>, "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-all><a href=#dom-datatransfer-effectallowed-all>all</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-4><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-3>if appropriate</a>, either "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-2><a href=#dom-datatransfer-dropeffect-link>link</a></code>" or "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-2><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-link><a href=#dom-datatransfer-effectallowed-link>link</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-3><a href=#dom-datatransfer-dropeffect-link>link</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-linkmove><a href=#dom-datatransfer-effectallowed-linkmove>linkMove</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-4><a href=#dom-datatransfer-dropeffect-link>link</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-4>if appropriate</a>, "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-3><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-move><a href=#dom-datatransfer-effectallowed-move>move</a></code>"<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-4><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-uninitialized><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>" when what is being dragged is a selection from a text control<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-5><a href=#dom-datatransfer-dropeffect-move>move</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-5>if appropriate</a>, either "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-5><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>" or "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-5><a href=#dom-datatransfer-dropeffect-link>link</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-uninitialized-2><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>" when what is being dragged is a selection<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-6><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-6>if appropriate</a>, either "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-6><a href=#dom-datatransfer-dropeffect-link>link</a></code>" or "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-6><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<tr><td>"<code id=the-dragevent-interface:dom-datatransfer-effectallowed-uninitialized-3><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>" when what is being dragged is an <code id=the-dragevent-interface:the-a-element><a href=#the-a-element>a</a></code> element with an <code id=the-dragevent-interface:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code> attribute<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-7><a href=#dom-datatransfer-dropeffect-link>link</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-7>if appropriate</a>, either "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-7><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>" or "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-7><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<tr><td>Any other case<td>"<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-8><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>", or, <a href=#concept-platform-dropeffect-override id=the-dragevent-interface:concept-platform-dropeffect-override-8>if appropriate</a>, either "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-8><a href=#dom-datatransfer-dropeffect-link>link</a></code>" or "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-8><a href=#dom-datatransfer-dropeffect-move>move</a></code>"</table>

    <p>Where the table above provides <dfn id=concept-platform-dropeffect-override>possibly
    appropriate alternatives</dfn>, user agents may instead use the listed alternative values if
    platform conventions dictate that the user has requested those alternate effects.</p>

    <p class=example>For example, Windows platform conventions are such that dragging while
    holding the "alt" key indicates a preference for linking the data, rather than moving or copying
    it. Therefore, on a Windows system, if "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-link-9><a href=#dom-datatransfer-dropeffect-link>link</a></code>" is an option according to
    the table above while the "alt" key is depressed, the user agent could select that instead of
    "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-copy-9><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>" or "<code id=the-dragevent-interface:dom-datatransfer-dropeffect-move-9><a href=#dom-datatransfer-dropeffect-move>move</a></code>".</p>

   <li><p>Let <var>event</var> be the result of <a id=the-dragevent-interface:creating-an-event href=https://dom.spec.whatwg.org/#concept-event-create data-x-internal=creating-an-event>creating an event</a> using
   <code id=the-dragevent-interface:dragevent-5><a href=#dragevent>DragEvent</a></code>.<li><p>Initialize <var>event</var>'s <code id=the-dragevent-interface:dom-event-type><a data-x-internal=dom-event-type href=https://dom.spec.whatwg.org/#dom-event-type>type</a></code> attribute to
   <var>e</var>, its <code id=the-dragevent-interface:dom-event-bubbles><a data-x-internal=dom-event-bubbles href=https://dom.spec.whatwg.org/#dom-event-bubbles>bubbles</a></code> attribute to true, its <code id=the-dragevent-interface:dom-uievent-view><a data-x-internal=dom-uievent-view href=https://w3c.github.io/uievents/#widl-UIEvent-view>view</a></code> attribute to <var>window</var>, its <code id=the-dragevent-interface:dom-mouseevent-relatedtarget><a data-x-internal=dom-mouseevent-relatedtarget href=https://w3c.github.io/uievents/#widl-MouseEvent-relatedTarget>relatedTarget</a></code> attribute to <var>related
   target</var>, and its <code id=the-dragevent-interface:dom-dragevent-datatransfer-3><a href=#dom-dragevent-datatransfer>dataTransfer</a></code> attribute to
   <var>dataTransfer</var>.<li><p>If <var>e</var> is not <code id=the-dragevent-interface:event-dnd-dragexit-2><a href=#event-dnd-dragexit>dragexit</a></code>, <code id=the-dragevent-interface:event-dnd-dragleave-2><a href=#event-dnd-dragleave>dragleave</a></code>, or <code id=the-dragevent-interface:event-dnd-dragend-2><a href=#event-dnd-dragend>dragend</a></code>, then initialize <var>event</var>'s <code id=the-dragevent-interface:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute to true.<li>
    <p>Initialize <var>event</var>'s mouse and key attributes initialized according to the state of
    the input devices as they would be for user interaction events.</p>

    

    <p>If there is no relevant pointing device, then initialize <var>event</var>'s <code>screenX</code>, <code>screenY</code>, <code>clientX</code>, <code>clientY</code>, and <code>button</code> attributes to 0.</p>
   <li><p><a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=the-dragevent-interface:concept-event-dispatch data-x-internal=concept-event-dispatch>Dispatch</a> <var>event</var> at the specified
   target element.<li><p>Set the <a href=#drag-data-store-allowed-effects-state id=the-dragevent-interface:drag-data-store-allowed-effects-state-2>drag data store allowed effects state</a> to the current value of
   <var>dataTransfer</var>'s <code id=the-dragevent-interface:dom-datatransfer-effectallowed-4><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code>
   attribute. (It can only have changed value if <var>e</var> is <code id=the-dragevent-interface:event-dnd-dragstart-3><a href=#event-dnd-dragstart>dragstart</a></code>.)<li><p>Set the <a href=#drag-data-store-mode id=the-dragevent-interface:drag-data-store-mode-3>drag data store mode</a> back to the <a href=#concept-dnd-p id=the-dragevent-interface:concept-dnd-p>protected mode</a> if it was changed in the first step.<li><p>Break the association between <var>dataTransfer</var> and the <a href=#drag-data-store id=the-dragevent-interface:drag-data-store-4>drag data
   store</a>.</ol>

  


  

  <h4 id=drag-and-drop-processing-model>6.7.5 Processing model<a href=#drag-and-drop-processing-model class=self-link></a></h4>

  <p>When the user attempts to begin a drag operation, the user agent must run the following steps.
  User agents must act as if these steps were run even if the drag actually started in another
  document or application and the user agent was not aware that the drag was occurring until it
  intersected with a document under the user agent's purview.</p>

  <ol><li>

    <p>Determine what is being dragged, as follows:</p>

    <p>If the drag operation was invoked on a selection, then it is the selection that is being
    dragged.</p>

    <p>Otherwise, if the drag operation was invoked on a <code id=drag-and-drop-processing-model:document><a href=#document>Document</a></code>, it is the first
    element, going up the ancestor chain, starting at the node that the user tried to drag, that has
    the IDL attribute <code id=drag-and-drop-processing-model:dom-draggable><a href=#dom-draggable>draggable</a></code> set to true. If there is no such
    element, then nothing is being dragged; abort these steps, the drag-and-drop operation is never
    started.</p>

    <p>Otherwise, the drag operation was invoked outside the user agent's purview. What is being
    dragged is defined by the document or application where the drag was started.</p>

    <p class=note><code id=drag-and-drop-processing-model:the-img-element><a href=#the-img-element>img</a></code> elements and <code id=drag-and-drop-processing-model:the-a-element><a href=#the-a-element>a</a></code> elements with an <code id=drag-and-drop-processing-model:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code> attribute have their <code id=drag-and-drop-processing-model:dom-draggable-2><a href=#dom-draggable>draggable</a></code> attribute set to true by default.</p>

   <li><p><a href=#create-a-drag-data-store id=drag-and-drop-processing-model:create-a-drag-data-store>Create a drag data store</a>. All the DND events fired subsequently by the steps
   in this section must use this <a href=#drag-data-store id=drag-and-drop-processing-model:drag-data-store>drag data store</a>.<li>

    <p>Establish which DOM node is the <dfn id=source-node>source node</dfn>, as follows:</p>

    <p>If it is a selection that is being dragged, then the <a href=#source-node id=drag-and-drop-processing-model:source-node>source node</a> is the
    <code id=drag-and-drop-processing-model:text><a data-x-internal=text href=https://dom.spec.whatwg.org/#interface-text>Text</a></code> node that the user started the drag on (typically the <code id=drag-and-drop-processing-model:text-2><a data-x-internal=text href=https://dom.spec.whatwg.org/#interface-text>Text</a></code> node
    that the user originally clicked). If the user did not specify a particular node, for example if
    the user just told the user agent to begin a drag of "the selection", then the <a href=#source-node id=drag-and-drop-processing-model:source-node-2>source
    node</a> is the first <code id=drag-and-drop-processing-model:text-3><a data-x-internal=text href=https://dom.spec.whatwg.org/#interface-text>Text</a></code> node containing a part of the selection.</p>

    <p>Otherwise, if it is an element that is being dragged, then the <a href=#source-node id=drag-and-drop-processing-model:source-node-3>source node</a> is
    the element that is being dragged.</p>

    <p>Otherwise, the <a href=#source-node id=drag-and-drop-processing-model:source-node-4>source node</a> is part of another document or application. When this
    specification requires that an event be dispatched at the <a href=#source-node id=drag-and-drop-processing-model:source-node-5>source node</a> in this case,
    the user agent must instead follow the platform-specific conventions relevant to that
    situation.</p>

    <p class=note>Multiple events are fired on the <a href=#source-node id=drag-and-drop-processing-model:source-node-6>source node</a> during the course of
    the drag-and-drop operation.</p>

   <li>

    <p>Determine the <dfn id=list-of-dragged-nodes>list of dragged nodes</dfn>, as follows:</p>

    <p>If it is a selection that is being dragged, then the <a href=#list-of-dragged-nodes id=drag-and-drop-processing-model:list-of-dragged-nodes>list of dragged nodes</a>
    contains, in <a id=drag-and-drop-processing-model:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a>, every node that is partially or completely included in the
    selection (including all their ancestors).</p>

    <p>Otherwise, the <a href=#list-of-dragged-nodes id=drag-and-drop-processing-model:list-of-dragged-nodes-2>list of dragged nodes</a> contains only the <a href=#source-node id=drag-and-drop-processing-model:source-node-7>source node</a>,
    if any.</p>

   <li>

    <p>If it is a selection that is being dragged, then add an item to the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list>drag data store
    item list</a>, with its properties set as follows:</p>

    <dl><dt><a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string>The drag data item type string</a>
     <dd>"<code id=drag-and-drop-processing-model:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>"<dt><a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind>The drag data item kind</a>
     <dd><i>Plain Unicode string</i><dt>The actual data<dd>The text of the selection</dl>

    <p>Otherwise, if any files are being dragged, then add one item per file to the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-2>drag data
    store item list</a>, with their properties set as follows:</p>

    <dl><dt><a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-2>The drag data item type string</a>
     <dd>The MIME type of the file, if known, or "<code id=drag-and-drop-processing-model:application/octet-stream><a data-x-internal=application/octet-stream href=https://tools.ietf.org/html/rfc2046#section-4.5.1>application/octet-stream</a></code>" otherwise.<dt><a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-2>The drag data item kind</a>
     <dd><i>File</i><dt>The actual data<dd>The file's contents and name.</dl>

    <p class=note>Dragging files can currently only happen from outside a <a href=#browsing-context id=drag-and-drop-processing-model:browsing-context>browsing
    context</a>, for example from a file system manager application.</p>

    <p>If the drag initiated outside of the application, the user agent must add items to the
    <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-3>drag data store item list</a> as appropriate for the data being dragged, honoring
    platform conventions where appropriate; however, if the platform conventions do not use <a href=https://mimesniff.spec.whatwg.org/#mime-type id=drag-and-drop-processing-model:mime-type data-x-internal=mime-type>MIME types</a> to label dragged data, the user agent must make a
    best-effort attempt to map the types to MIME types, and, in any case, all the <a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-3>drag data item type strings</a> must be <a id=drag-and-drop-processing-model:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII
    lowercase</a>.</p>

    <p>User agents may also add one or more items representing the selection or dragged element(s)
    in other forms, e.g. as HTML.</p>

   <li>

    <p>If the <a href=#list-of-dragged-nodes id=drag-and-drop-processing-model:list-of-dragged-nodes-3>list of dragged nodes</a> is not empty, then <a href=#extracting-json id=drag-and-drop-processing-model:extracting-json>extract the microdata from those nodes into a JSON form</a>, and add one item to the
    <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-4>drag data store item list</a>, with its properties set as follows:</p>

    <dl><dt><a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-4>The drag data item type string</a>
     <dd><code id=drag-and-drop-processing-model:application/microdata+json><a href=#application/microdata+json>application/microdata+json</a></code><dt><a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-3>The drag data item kind</a>
     <dd><i>Plain Unicode string</i><dt>The actual data<dd>The resulting JSON string.</dl>

   <li>

    <p>Run the following substeps:</p>

    <ol><li><p>Let <var>urls</var> be an empty list of <a href=https://url.spec.whatwg.org/#syntax-url-absolute id=drag-and-drop-processing-model:absolute-url data-x-internal=absolute-url>absolute
     URLs</a>.<li>

      <p>For each <var>node</var> in the <a href=#list-of-dragged-nodes id=drag-and-drop-processing-model:list-of-dragged-nodes-4>list of dragged nodes</a>:</p>

      <dl><dt>If the node is an <code id=drag-and-drop-processing-model:the-a-element-2><a href=#the-a-element>a</a></code> element with an <code id=drag-and-drop-processing-model:attr-hyperlink-href-2><a href=#attr-hyperlink-href>href</a></code> attribute<dd>Add to <var>urls</var> the result of <a href=#parse-a-url id=drag-and-drop-processing-model:parse-a-url>parsing</a> the
       element's <code id=drag-and-drop-processing-model:attr-hyperlink-href-3><a href=#attr-hyperlink-href>href</a></code> content attribute relative to the
       element's <a id=drag-and-drop-processing-model:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.<dt>If the node is an <code id=drag-and-drop-processing-model:the-img-element-2><a href=#the-img-element>img</a></code> element with a <code id=drag-and-drop-processing-model:attr-img-src><a href=#attr-img-src>src</a></code>
       attribute<dd>Add to <var>urls</var> the result of <a href=#parse-a-url id=drag-and-drop-processing-model:parse-a-url-2>parsing</a> the
       element's <code id=drag-and-drop-processing-model:attr-img-src-2><a href=#attr-img-src>src</a></code> content attribute relative to the
       element's <a id=drag-and-drop-processing-model:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.</dl>

     <li><p>If <var>urls</var> is still empty, abort these substeps.<li><p>Let <var>url string</var> be the result of concatenating the strings in <var>urls</var>,
     in the order they were added, separated by a U+000D CARRIAGE RETURN U+000A LINE FEED character
     pair (CRLF).<li><p>Add one item to the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-5>drag data store item list</a>, with its properties set as
     follows:</p>

      <dl><dt><a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-5>The drag data item type string</a>
       <dd><code id=drag-and-drop-processing-model:text/uri-list><a href=#text/uri-list>text/uri-list</a></code><dt><a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-4>The drag data item kind</a>
       <dd><i>Plain Unicode string</i><dt>The actual data<dd><var>url string</var></dl>

     </ol>

   <li>

    <p>Update the <a href=#drag-data-store-default-feedback id=drag-and-drop-processing-model:drag-data-store-default-feedback>drag data store default feedback</a> as appropriate for the user agent
    (if the user is dragging the selection, then the selection would likely be the basis for this
    feedback; if the user is dragging an element, then that element's rendering would be used; if
    the drag began outside the user agent, then the platform conventions for determining the drag
    feedback should be used).</p>

   <li>

    <p><a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event>Fire a DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code> at the
    <a href=#source-node id=drag-and-drop-processing-model:source-node-8>source node</a>.</p>

    <p>If the event is canceled, then the drag-and-drop operation should not occur; abort these
    steps.</p> 

    <p class=note>Since events with no event listeners registered are, almost by definition, never
    canceled, drag-and-drop is always available to the user if the author does not specifically
    prevent it.</p>

   <li>

    <p><a href=#initiate-the-drag-and-drop-operation id=drag-and-drop-processing-model:initiate-the-drag-and-drop-operation>Initiate the drag-and-drop operation</a> in a manner consistent with platform
    conventions, and as described below.</p>

    <p id=base-dnd-feedback>The drag-and-drop feedback must be generated from the first of the
    following sources that is available:</p>

    <ol><li>The <a href=#drag-data-store-bitmap id=drag-and-drop-processing-model:drag-data-store-bitmap>drag data store bitmap</a>, if any. In this case, the <a href=#drag-data-store-hot-spot-coordinate id=drag-and-drop-processing-model:drag-data-store-hot-spot-coordinate>drag data store
     hot spot coordinate</a> should be used as hints for where to put the cursor relative to the
     resulting image. The values are expressed as distances in <a href=https://drafts.csswg.org/css-values/#px id="drag-and-drop-processing-model:'px'" data-x-internal="'px'">CSS pixels</a>
     from the left side and from the top side of the image respectively. <a href=#refsCSS>[CSS]</a><li>The <a href=#drag-data-store-default-feedback id=drag-and-drop-processing-model:drag-data-store-default-feedback-2>drag data store default feedback</a>.</ol>

   </ol>

  <p>From the moment that the user agent is to <dfn id=initiate-the-drag-and-drop-operation>initiate the drag-and-drop operation</dfn>,
  until the end of the drag-and-drop operation, device input events (e.g. mouse and keyboard events)
  must be suppressed.</p>

  <p>During the drag operation, the element directly indicated by the user as the drop target is
  called the <dfn id=immediate-user-selection>immediate user selection</dfn>. (Only elements can be selected by the user; other
  nodes must not be made available as drop targets.) However, the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection>immediate user
  selection</a> is not necessarily the <dfn id=current-target-element>current target element</dfn>, which is the element
  currently selected for the drop part of the drag-and-drop operation.</p>

  <p>The <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-2>immediate user selection</a> changes as the user selects different elements
  (either by pointing at them with a pointing device, or by selecting them in some other way). The
  <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element>current target element</a> changes when the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-3>immediate user selection</a>
  changes, based on the results of event listeners in the document, as described below.</p>

  <p>Both the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-2>current target element</a> and the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-4>immediate user selection</a> can
  be null, which means no target element is selected. They can also both be elements in other
  (DOM-based) documents, or other (non-Web) programs altogether. (For example, a user could drag
  text to a word-processor.) The <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-3>current target element</a> is initially null.</p>

  <p>In addition, there is also a <dfn id=current-drag-operation>current drag operation</dfn>, which can take on the values
  "<dfn id=concept-current-drag-operation-none><code>none</code></dfn>", "<dfn id=concept-current-drag-operation-copy><code>copy</code></dfn>", "<dfn id=concept-current-drag-operation-link><code>link</code></dfn>", and "<dfn id=concept-current-drag-operation-move><code>move</code></dfn>". Initially, it has the value
  "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none><a href=#concept-current-drag-operation-none>none</a></code>". It is updated by the user agent
  as described in the steps below.</p>

  <p>User agents must, as soon as the drag operation is <a href=#initiate-the-drag-and-drop-operation id=drag-and-drop-processing-model:initiate-the-drag-and-drop-operation-2>initiated</a> and every 350ms (±200ms) thereafter for as long as the drag
  operation is ongoing, <a href=#queue-a-task id=drag-and-drop-processing-model:queue-a-task>queue a task</a> to perform the following steps in sequence:</p>

  <ol><li>

    <p>If the user agent is still performing the previous iteration of the sequence (if any) when
    the next iteration becomes due, abort these steps for this iteration (effectively "skipping
    missed frames" of the drag-and-drop operation).</p>

   <li>

    <p><a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-2>Fire a DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-drag><a href=#event-dnd-drag>drag</a></code> at the
    <a href=#source-node id=drag-and-drop-processing-model:source-node-9>source node</a>. If this event is canceled, the user agent must set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation>current
    drag operation</a> to "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-2><a href=#concept-current-drag-operation-none>none</a></code>" (no
    drag operation).</p>

   <li>

    <p>If the <code id=drag-and-drop-processing-model:event-dnd-drag-2><a href=#event-dnd-drag>drag</a></code> event was not canceled and the user has not
    ended the drag-and-drop operation, check the state of the drag-and-drop operation, as
    follows:</p>

    <ol><li>

      <p>If the user is indicating a different <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-5>immediate user selection</a> than during the
      last iteration (or if this is the first iteration), and if this <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-6>immediate user
      selection</a> is not the same as the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-4>current target element</a>, then <a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-3>fire a
      DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragexit><a href=#event-dnd-dragexit>dragexit</a></code> at the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-5>current
      target element</a>, and then update the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-6>current target element</a> as follows:</p>

      <dl class=switch><dt>If the new <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-7>immediate user selection</a> is null<dd><p>Set the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-7>current target element</a> to null also.<dt>If the new <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-8>immediate user selection</a> is in a non-DOM document or
       application<dd><p>Set the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-8>current target element</a> to the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-9>immediate user
       selection</a>.<dt>Otherwise<dd>

        <p><a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-4>Fire a DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragenter><a href=#event-dnd-dragenter>dragenter</a></code>
        at the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-10>immediate user selection</a>.</p>

        <p>If the event is canceled, then set the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-9>current target element</a> to the
        <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-11>immediate user selection</a>.</p>

        <p>Otherwise, run the appropriate step from the following list:</p>

        <dl class=switch><dt>If the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-12>immediate user selection</a> is a text control (e.g.,
         <code id=drag-and-drop-processing-model:the-textarea-element><a href=#the-textarea-element>textarea</a></code>, or an <code id=drag-and-drop-processing-model:the-input-element><a href=#the-input-element>input</a></code> element whose <code id=drag-and-drop-processing-model:attr-input-type><a href=#attr-input-type>type</a></code> attribute is in the <a href="#text-(type=text)-state-and-search-state-(type=search)" id="drag-and-drop-processing-model:text-(type=text)-state-and-search-state-(type=search)">Text</a> state) or an <a id=drag-and-drop-processing-model:editing-host href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing host</a> or
         <a id=drag-and-drop-processing-model:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a> element, and the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-6>drag data store item list</a> has an item
         with <a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-6>the drag data item type string</a> "<code id=drag-and-drop-processing-model:text/plain-2><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>" and <a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-5>the
         drag data item kind</a> <i>Plain Unicode string</i><dd><p>Set the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-10>current target element</a> to the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-13>immediate user
         selection</a> anyway.<dt>If the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-14>immediate user selection</a> is an element with a <code id=drag-and-drop-processing-model:the-dropzone-attribute><a href=#the-dropzone-attribute>dropzone</a></code> attribute that <a href=#concept-dropzone-match id=drag-and-drop-processing-model:concept-dropzone-match>matches</a> the <a href=#drag-data-store id=drag-and-drop-processing-model:drag-data-store-2>drag data store</a><dd><p>Set the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-11>current target element</a> to the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-15>immediate user
         selection</a> anyway.<dt>If the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-16>immediate user selection</a> is an element that itself has an ancestor
         element with a <code id=drag-and-drop-processing-model:the-dropzone-attribute-2><a href=#the-dropzone-attribute>dropzone</a></code> attribute that <a href=#concept-dropzone-match id=drag-and-drop-processing-model:concept-dropzone-match-2>matches</a> the <a href=#drag-data-store id=drag-and-drop-processing-model:drag-data-store-3>drag data store</a><dd>

          <p>Let <var>new target</var> be the nearest (deepest) such ancestor element.</p>

          <p>If the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-17>immediate user selection</a> is <var>new target</var>, then leave the
          <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-12>current target element</a> unchanged.</p>

          <p>Otherwise, <a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-5>fire a DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragenter-2><a href=#event-dnd-dragenter>dragenter</a></code> at <var>new target</var>, with the current
          <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-13>current target element</a> as the specific <var>related target</var>. Then, set
          the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-14>current target element</a> to <var>new target</var>, regardless of whether
          that event was canceled or not.</p>

         <dt>If the <a href=#immediate-user-selection id=drag-and-drop-processing-model:immediate-user-selection-18>immediate user selection</a> is <a href=#the-body-element-2 id=drag-and-drop-processing-model:the-body-element-2>the body element</a><dd><p>Leave the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-15>current target element</a> unchanged.<dt>Otherwise<dd>

          <p><a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-6>Fire a DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragenter-3><a href=#event-dnd-dragenter>dragenter</a></code>
          at <a href=#the-body-element-2 id=drag-and-drop-processing-model:the-body-element-2-2>the body element</a>, if there is one, or at the <code id=drag-and-drop-processing-model:document-2><a href=#document>Document</a></code> object,
          if not. Then, set the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-16>current target element</a> to <a href=#the-body-element-2 id=drag-and-drop-processing-model:the-body-element-2-3>the body
          element</a>, regardless of whether that event was canceled or not.</p>

         </dl>

       </dl>

     <li>

      <p>If the previous step caused the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-17>current target element</a> to change, and if the
      previous target element was not null or a part of a non-DOM document, then <a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-7>fire a DND
      event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragleave><a href=#event-dnd-dragleave>dragleave</a></code> at the previous target
      element, with the new <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-18>current target element</a> as the specific <var>related
      target</var>.</p>

     <li>

      <p>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-19>current target element</a> is a DOM element, then <a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-8>fire a DND
      event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragover><a href=#event-dnd-dragover>dragover</a></code> at this <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-20>current
      target element</a>.</p>

      <p>If the <code id=drag-and-drop-processing-model:event-dnd-dragover-2><a href=#event-dnd-dragover>dragover</a></code> event is not canceled, run the
      appropriate step from the following list:</p>

      <dl class=switch><dt>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-21>current target element</a> is a text control (e.g.,
       <code id=drag-and-drop-processing-model:the-textarea-element-2><a href=#the-textarea-element>textarea</a></code>, or an <code id=drag-and-drop-processing-model:the-input-element-2><a href=#the-input-element>input</a></code> element whose <code id=drag-and-drop-processing-model:attr-input-type-2><a href=#attr-input-type>type</a></code> attribute is in the <a href="#text-(type=text)-state-and-search-state-(type=search)" id="drag-and-drop-processing-model:text-(type=text)-state-and-search-state-(type=search)-2">Text</a> state) or an <a id=drag-and-drop-processing-model:editing-host-2 href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing host</a> or
       <a id=drag-and-drop-processing-model:editable-2 href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a> element, and the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-7>drag data store item list</a> has an item
       with <a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-7>the drag data item type string</a> "<code id=drag-and-drop-processing-model:text/plain-3><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>" and <a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-6>the drag
       data item kind</a> <i>Plain Unicode string</i><dd><p>Set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-2>current drag operation</a> to either "<code id=drag-and-drop-processing-model:concept-current-drag-operation-copy><a href=#concept-current-drag-operation-copy>copy</a></code>" or "<code id=drag-and-drop-processing-model:concept-current-drag-operation-move><a href=#concept-current-drag-operation-move>move</a></code>", as appropriate given the platform
       conventions.<dt>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-22>current target element</a> is an element with a <code id=drag-and-drop-processing-model:the-dropzone-attribute-3><a href=#the-dropzone-attribute>dropzone</a></code> attribute that <a href=#concept-dropzone-match id=drag-and-drop-processing-model:concept-dropzone-match-3>matches</a> the <a href=#drag-data-store id=drag-and-drop-processing-model:drag-data-store-4>drag data store</a> and <a href=#concept-dropzone-operation id=drag-and-drop-processing-model:concept-dropzone-operation>specifies an operation</a><dd><p>Set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-3>current drag operation</a> to the operation <a href=#concept-dropzone-operation id=drag-and-drop-processing-model:concept-dropzone-operation-2>specified</a> by the <code id=drag-and-drop-processing-model:the-dropzone-attribute-4><a href=#the-dropzone-attribute>dropzone</a></code> attribute of the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-23>current target
       element</a>.</p>


       <dt>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-24>current target element</a> is an element with a <code id=drag-and-drop-processing-model:the-dropzone-attribute-5><a href=#the-dropzone-attribute>dropzone</a></code> attribute that <a href=#concept-dropzone-match id=drag-and-drop-processing-model:concept-dropzone-match-4>matches</a> the <a href=#drag-data-store id=drag-and-drop-processing-model:drag-data-store-5>drag data store</a> and does not
       <a href=#concept-dropzone-operation id=drag-and-drop-processing-model:concept-dropzone-operation-3>specify an operation</a><dd><p>Set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-4>current drag operation</a> to "<code id=drag-and-drop-processing-model:concept-current-drag-operation-copy-2><a href=#concept-current-drag-operation-copy>copy</a></code>".</p>


       <dt>Otherwise<dd><p>Reset the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-5>current drag operation</a> to "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-3><a href=#concept-current-drag-operation-none>none</a></code>".</dl>

      <p>Otherwise (if the <code id=drag-and-drop-processing-model:event-dnd-dragover-3><a href=#event-dnd-dragover>dragover</a></code> event <em>is</em>
      canceled), set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-6>current drag operation</a> based on the values of the <code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> and <code id=drag-and-drop-processing-model:dom-datatransfer-dropeffect><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> attributes of the
      <code id=drag-and-drop-processing-model:dragevent><a href=#dragevent>DragEvent</a></code> object's <code id=drag-and-drop-processing-model:dom-dragevent-datatransfer><a href=#dom-dragevent-datatransfer>dataTransfer</a></code>
      object as they stood after the event <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=drag-and-drop-processing-model:concept-event-dispatch data-x-internal=concept-event-dispatch>dispatch</a>
      finished, as per the following table:</p>

      <table><thead><tr><th><code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-2><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code><th><code id=drag-and-drop-processing-model:dom-datatransfer-dropeffect-2><a href=#dom-datatransfer-dropeffect>dropEffect</a></code><th>Drag operation<tbody><tr><td>"<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-uninitialized><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-copy><a href=#dom-datatransfer-effectallowed-copy>copy</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-copylink><a href=#dom-datatransfer-effectallowed-copylink>copyLink</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-copymove><a href=#dom-datatransfer-effectallowed-copymove>copyMove</a></code>", or "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-all><a href=#dom-datatransfer-effectallowed-all>all</a></code>"<td>"<code id=drag-and-drop-processing-model:dom-datatransfer-dropeffect-copy><a href=#dom-datatransfer-dropeffect-copy>copy</a></code>"<td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-copy-3><a href=#concept-current-drag-operation-copy>copy</a></code>"<tr><td>"<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-uninitialized-2><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-link><a href=#dom-datatransfer-effectallowed-link>link</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-copylink-2><a href=#dom-datatransfer-effectallowed-copylink>copyLink</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-linkmove><a href=#dom-datatransfer-effectallowed-linkmove>linkMove</a></code>", or "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-all-2><a href=#dom-datatransfer-effectallowed-all>all</a></code>"<td>"<code id=drag-and-drop-processing-model:dom-datatransfer-dropeffect-link><a href=#dom-datatransfer-dropeffect-link>link</a></code>"<td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-link><a href=#concept-current-drag-operation-link>link</a></code>"<tr><td>"<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-uninitialized-3><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-move><a href=#dom-datatransfer-effectallowed-move>move</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-copymove-2><a href=#dom-datatransfer-effectallowed-copymove>copyMove</a></code>", "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-linkmove-2><a href=#dom-datatransfer-effectallowed-linkmove>linkMove</a></code>", or "<code id=drag-and-drop-processing-model:dom-datatransfer-effectallowed-all-3><a href=#dom-datatransfer-effectallowed-all>all</a></code>"<td>"<code id=drag-and-drop-processing-model:dom-datatransfer-dropeffect-move><a href=#dom-datatransfer-dropeffect-move>move</a></code>"<td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-move-2><a href=#concept-current-drag-operation-move>move</a></code>"<tr><td colspan=2>Any other case<td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-4><a href=#concept-current-drag-operation-none>none</a></code>"</table>

     <li>

      <p>Otherwise, if the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-25>current target element</a> is not a DOM element, use
      platform-specific mechanisms to determine what drag operation is being performed (none, copy,
      link, or move), and set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-7>current drag operation</a> accordingly.</p>

     <li>

      <p>Update the drag feedback (e.g. the mouse cursor) to match the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-8>current drag
      operation</a>, as follows:</p>

      <table><thead><tr><th>Drag operation<th>Feedback<tbody><tr><td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-copy-4><a href=#concept-current-drag-operation-copy>copy</a></code>"<td>Data will be copied if dropped here.<tr><td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-link-2><a href=#concept-current-drag-operation-link>link</a></code>"<td>Data will be linked if dropped here.<tr><td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-move-3><a href=#concept-current-drag-operation-move>move</a></code>"<td>Data will be moved if dropped here.<tr><td>"<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-5><a href=#concept-current-drag-operation-none>none</a></code>"<td>No operation allowed, dropping here will cancel the drag-and-drop operation.</table>

     </ol>

   <li>

    <p>Otherwise, if the user ended the drag-and-drop operation (e.g. by releasing the mouse button
    in a mouse-driven drag-and-drop interface), or if the <code id=drag-and-drop-processing-model:event-dnd-drag-3><a href=#event-dnd-drag>drag</a></code>
    event was canceled, then this will be the last iteration. Run the following steps, then stop the
    drag-and-drop operation:</p>

    <ol><li>

      <p>If the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-9>current drag operation</a> is "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-6><a href=#concept-current-drag-operation-none>none</a></code>" (no drag operation), or, if the user
      ended the drag-and-drop operation by canceling it (e.g. by hitting the <kbd>Escape</kbd> key),
      or if the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-26>current target element</a> is null, then the drag operation failed. Run
      these substeps:</p>

      <ol><li><p>Let <var>dropped</var> be false.<li><p>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-27>current target element</a> is a DOM element, <a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-9>fire a DND
       event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragleave-2><a href=#event-dnd-dragleave>dragleave</a></code> at it; otherwise, if
       it is not null, use platform-specific conventions for drag cancelation.<li><p>Set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-10>current drag operation</a> to "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-7><a href=#concept-current-drag-operation-none>none</a></code>".</ol>

      <p>Otherwise, the drag operation might be a success; run these substeps:</p>

      <ol><li><p>Let <var>dropped</var> be true.<li><p>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-28>current target element</a> is a DOM element, <a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-10>fire a DND
       event</a> named <code id=drag-and-drop-processing-model:event-dnd-drop><a href=#event-dnd-drop>drop</a></code> at it; otherwise, use
       platform-specific conventions for indicating a drop.<li>

        <p>If the event is canceled, set the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-11>current drag operation</a> to the value of the
        <code id=drag-and-drop-processing-model:dom-datatransfer-dropeffect-3><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> attribute of the
        <code id=drag-and-drop-processing-model:dragevent-2><a href=#dragevent>DragEvent</a></code> object's <code id=drag-and-drop-processing-model:dom-dragevent-datatransfer-2><a href=#dom-dragevent-datatransfer>dataTransfer</a></code>
        object as it stood after the event <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=drag-and-drop-processing-model:concept-event-dispatch-2 data-x-internal=concept-event-dispatch>dispatch</a>
        finished.</p>

        <p>Otherwise, the event is not canceled; perform the event's default action, which depends
        on the exact target as follows:</p>

        <dl class=switch><dt>If the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-29>current target element</a> is a text control (e.g.,
         <code id=drag-and-drop-processing-model:the-textarea-element-3><a href=#the-textarea-element>textarea</a></code>, or an <code id=drag-and-drop-processing-model:the-input-element-3><a href=#the-input-element>input</a></code> element whose <code id=drag-and-drop-processing-model:attr-input-type-3><a href=#attr-input-type>type</a></code> attribute is in the <a href="#text-(type=text)-state-and-search-state-(type=search)" id="drag-and-drop-processing-model:text-(type=text)-state-and-search-state-(type=search)-3">Text</a> state) or an <a id=drag-and-drop-processing-model:editing-host-3 href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing host</a> or
         <a id=drag-and-drop-processing-model:editable-3 href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a> element, and the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-8>drag data store item list</a> has an item
         with <a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-8>the drag data item type string</a> "<code id=drag-and-drop-processing-model:text/plain-4><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>" and <a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-7>the
         drag data item kind</a> <i>Plain Unicode string</i><dd><p>Insert the actual data of the first item in the <a href=#drag-data-store-item-list id=drag-and-drop-processing-model:drag-data-store-item-list-9>drag data store item
         list</a> to have <a href=#the-drag-data-item-type-string id=drag-and-drop-processing-model:the-drag-data-item-type-string-9>a drag data item type
         string</a> of "<code id=drag-and-drop-processing-model:text/plain-5><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>" and <a href=#the-drag-data-item-kind id=drag-and-drop-processing-model:the-drag-data-item-kind-8>a drag
         data item kind</a> that is <i>Plain Unicode string</i> into the text control or
         <a id=drag-and-drop-processing-model:editing-host-4 href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing host</a> or <a id=drag-and-drop-processing-model:editable-4 href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a> element in a manner consistent with
         platform-specific conventions (e.g. inserting it at the current mouse cursor position, or
         inserting it at the end of the field).<dt>Otherwise<dd><p>Reset the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-12>current drag operation</a> to "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-8><a href=#concept-current-drag-operation-none>none</a></code>".</dl>

       </ol>

     <li>

      <p><a href=#fire-a-dnd-event id=drag-and-drop-processing-model:fire-a-dnd-event-11>Fire a DND event</a> named <code id=drag-and-drop-processing-model:event-dnd-dragend><a href=#event-dnd-dragend>dragend</a></code> at the
      <a href=#source-node id=drag-and-drop-processing-model:source-node-10>source node</a>.</p>

     <li>

      <p>Run the appropriate steps from the following list as the default action of the <code id=drag-and-drop-processing-model:event-dnd-dragend-2><a href=#event-dnd-dragend>dragend</a></code> event:</p>

      <dl class=switch><dt>If <var>dropped</var> is true, the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-30>current target element</a> is a <i>text
       control</i> (see below), the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-13>current drag operation</a> is "<code id=drag-and-drop-processing-model:concept-current-drag-operation-move-4><a href=#concept-current-drag-operation-move>move</a></code>", and the source of the
       drag-and-drop operation is a selection in the DOM that is entirely contained within an
       <a id=drag-and-drop-processing-model:editing-host-5 href=https://w3c.github.io/editing/execCommand.html#editing-host data-x-internal=editing-host>editing host</a><dd><p><a id=drag-and-drop-processing-model:delete-the-selection href=https://w3c.github.io/editing/execCommand.html#delete-the-selection data-x-internal=delete-the-selection>Delete the selection</a>.<dt>If <var>dropped</var> is true, the <a href=#current-target-element id=drag-and-drop-processing-model:current-target-element-31>current target element</a> is a <i>text
       control</i> (see below), the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-14>current drag operation</a> is "<code id=drag-and-drop-processing-model:concept-current-drag-operation-move-5><a href=#concept-current-drag-operation-move>move</a></code>", and the source of the
       drag-and-drop operation is a selection in a text control<dd><p>The user agent should delete the dragged selection from the relevant text
       control.<dt>If <var>dropped</var> is false or if the <a href=#current-drag-operation id=drag-and-drop-processing-model:current-drag-operation-15>current drag operation</a> is "<code id=drag-and-drop-processing-model:concept-current-drag-operation-none-9><a href=#concept-current-drag-operation-none>none</a></code>"<dd><p>The drag was canceled. If the platform conventions dictate that this be represented to
       the user (e.g. by animating the dragged selection going back to the source of the
       drag-and-drop operation), then do so.<dt>Otherwise<dd><p>The event has no default action.</dl>

      <p>For the purposes of this step, a <i>text control</i> is a <code id=drag-and-drop-processing-model:the-textarea-element-4><a href=#the-textarea-element>textarea</a></code> element or
      an <code id=drag-and-drop-processing-model:the-input-element-4><a href=#the-input-element>input</a></code> element whose <code id=drag-and-drop-processing-model:attr-input-type-4><a href=#attr-input-type>type</a></code> attribute is in
      one of the
      <a href="#text-(type=text)-state-and-search-state-(type=search)" id="drag-and-drop-processing-model:text-(type=text)-state-and-search-state-(type=search)-4">Text</a>,
      <a href="#text-(type=text)-state-and-search-state-(type=search)" id="drag-and-drop-processing-model:text-(type=text)-state-and-search-state-(type=search)-5">Search</a>,
      <a href="#telephone-state-(type=tel)" id="drag-and-drop-processing-model:telephone-state-(type=tel)">Tel</a>,
      <a href="#url-state-(type=url)" id="drag-and-drop-processing-model:url-state-(type=url)">URL</a>,
      <a href="#e-mail-state-(type=email)" id="drag-and-drop-processing-model:e-mail-state-(type=email)">E-mail</a>,
      <a href="#password-state-(type=password)" id="drag-and-drop-processing-model:password-state-(type=password)">Password</a>, or
      <a href="#number-state-(type=number)" id="drag-and-drop-processing-model:number-state-(type=number)">Number</a>
      states.</p>


     </ol>

   </ol>

  <p class=note>User agents are encouraged to consider how to react to drags near the edge of
  scrollable regions. For example, if a user drags a link to the bottom of the <a id=drag-and-drop-processing-model:viewport href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a>
  on a long page, it might make sense to scroll the page so that the user can drop the link lower on
  the page.</p>

  <p class=note>This model is independent of which <code id=drag-and-drop-processing-model:document-3><a href=#document>Document</a></code> object the nodes involved
  are from; the events are fired as described above and the rest of the processing model runs as
  described above, irrespective of how many documents are involved in the operation.</p>

  


  <h4 id=dndevents>6.7.6 Events summary<a href=#dndevents class=self-link></a></h4>

  <p><i>This section is non-normative.</i></p>

  <p>The following events are involved in the drag-and-drop
  model.</p>

  <table><thead><tr><th> Event Name <th> Target <th> Cancelable? <th> <a href=#drag-data-store-mode id=dndevents:drag-data-store-mode>Drag data store mode</a> <th> <code id=dndevents:dom-datatransfer-dropeffect><a href=#dom-datatransfer-dropeffect>dropEffect</a></code> <th> Default Action <tbody><tr><td><dfn id=event-dnd-dragstart><code>dragstart</code></dfn><td><a href=#source-node id=dndevents:source-node>Source node</a><td>✓ Cancelable<td><a href=#concept-dnd-rw id=dndevents:concept-dnd-rw>Read/write mode</a>
     
     <td>"<code id=dndevents:dom-datatransfer-dropeffect-none><a href=#dom-datatransfer-dropeffect-none>none</a></code>"<td>Initiate the drag-and-drop operation<tr><td><dfn id=event-dnd-drag><code>drag</code></dfn><td><a href=#source-node id=dndevents:source-node-2>Source node</a><td>✓ Cancelable<td><a href=#concept-dnd-p id=dndevents:concept-dnd-p>Protected mode</a>
     
     <td>"<code id=dndevents:dom-datatransfer-dropeffect-none-2><a href=#dom-datatransfer-dropeffect-none>none</a></code>"<td>Continue the drag-and-drop operation<tr><td><dfn id=event-dnd-dragenter><code>dragenter</code></dfn><td><a href=#immediate-user-selection id=dndevents:immediate-user-selection>Immediate user selection</a> or <a href=#the-body-element-2 id=dndevents:the-body-element-2>the body element</a><td>✓ Cancelable<td><a href=#concept-dnd-p id=dndevents:concept-dnd-p-2>Protected mode</a>
     
     <td><a href=#dropEffect-initialisation>Based on <code>effectAllowed</code> value</a><td>Reject <a href=#immediate-user-selection id=dndevents:immediate-user-selection-2>immediate user selection</a> as potential <a href=#current-target-element id=dndevents:current-target-element>target element</a><tr><td><dfn id=event-dnd-dragexit><code>dragexit</code></dfn><td><a href=#current-target-element id=dndevents:current-target-element-2>Previous target element</a><td>—<td><a href=#concept-dnd-p id=dndevents:concept-dnd-p-3>Protected mode</a>
     
     <td>"<code id=dndevents:dom-datatransfer-dropeffect-none-3><a href=#dom-datatransfer-dropeffect-none>none</a></code>"<td>None<tr><td><dfn id=event-dnd-dragleave><code>dragleave</code></dfn><td><a href=#current-target-element id=dndevents:current-target-element-3>Previous target element</a><td>—<td><a href=#concept-dnd-p id=dndevents:concept-dnd-p-4>Protected mode</a>
     
     <td>"<code id=dndevents:dom-datatransfer-dropeffect-none-4><a href=#dom-datatransfer-dropeffect-none>none</a></code>"<td>None<tr><td><dfn id=event-dnd-dragover><code>dragover</code></dfn><td><a href=#current-target-element id=dndevents:current-target-element-4>Current target element</a><td>✓ Cancelable<td><a href=#concept-dnd-p id=dndevents:concept-dnd-p-5>Protected mode</a>
     
     <td><a href=#dropEffect-initialisation>Based on <code>effectAllowed</code> value</a><td>Reset the <a href=#current-drag-operation id=dndevents:current-drag-operation>current drag operation</a> to "none"<tr><td><dfn id=event-dnd-drop><code>drop</code></dfn><td><a href=#current-target-element id=dndevents:current-target-element-5>Current target element</a><td>✓ Cancelable<td><a href=#concept-dnd-ro id=dndevents:concept-dnd-ro>Read-only mode</a>
     
     <td><a href=#current-drag-operation id=dndevents:current-drag-operation-2>Current drag operation</a><td>Varies<tr><td><dfn id=event-dnd-dragend><code>dragend</code></dfn><td><a href=#source-node id=dndevents:source-node-3>Source node</a><td>—<td><a href=#concept-dnd-p id=dndevents:concept-dnd-p-6>Protected mode</a>
     
     <td><a href=#current-drag-operation id=dndevents:current-drag-operation-3>Current drag operation</a><td>Varies</table>

  <p>Not shown in the above table: all these events bubble, are composed, and the <code id=dndevents:dom-datatransfer-effectallowed><a href=#dom-datatransfer-effectallowed>effectAllowed</a></code> attribute always has the value it had
  after the <code id=dndevents:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code> event, defaulting to "<code id=dndevents:dom-datatransfer-effectallowed-uninitialized><a href=#dom-datatransfer-effectallowed-uninitialized>uninitialized</a></code>" in the <code id=dndevents:event-dnd-dragstart-2><a href=#event-dnd-dragstart>dragstart</a></code> event.</p>



  <h4 id=the-draggable-attribute>6.7.7 The <dfn><code>draggable</code></dfn> attribute<a href=#the-draggable-attribute class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=26024" title="Drag and drop <img> should give the rendered image's URL">26024</a></div>

  <p>All <a href=#html-elements id=the-draggable-attribute:html-elements>HTML elements</a> may have the <code id=the-draggable-attribute:the-draggable-attribute><a href=#the-draggable-attribute>draggable</a></code>
  content attribute set. The <code id=the-draggable-attribute:the-draggable-attribute-2><a href=#the-draggable-attribute>draggable</a></code> attribute is an
  <a href=#enumerated-attribute id=the-draggable-attribute:enumerated-attribute>enumerated attribute</a>. It has three states. The first state is <i>true</i> and it has
  the keyword <code>true</code>. The second state is <i>false</i> and it has the keyword
  <code>false</code>. The third state is <i>auto</i>; it has no keywords but it is the
  <i id=the-draggable-attribute:missing-value-default><a href=#missing-value-default>missing value default</a></i>.</p>

  <p>The <i>true</i> state means the element is draggable; the <i>false</i> state means that it is
  not. The <i>auto</i> state uses the default behavior of the user agent.</p>

  <p>An element with a <code id=the-draggable-attribute:the-draggable-attribute-3><a href=#the-draggable-attribute>draggable</a></code> attribute should also have a
  <code id=the-draggable-attribute:attr-title><a href=#attr-title>title</a></code> attribute that names the element for the purpose of
  non-visual interactions. </p>

  <dl class=domintro><dt><var>element</var> . <code id=the-draggable-attribute:dom-draggable><a href=#dom-draggable>draggable</a></code> [ = <var>value</var> ]<dd>

    <p>Returns true if the element is draggable; otherwise, returns false.</p>

    <p>Can be set, to override the default and set the <code id=the-draggable-attribute:the-draggable-attribute-4><a href=#the-draggable-attribute>draggable</a></code>
    content attribute.</p>

   </dl>

  

  <p>The <dfn id=dom-draggable><code>draggable</code></dfn> IDL attribute, whose value depends
  on the content attribute's in the way described below, controls whether or not the element is
  draggable. Generally, only text selections are draggable, but elements whose <code id=the-draggable-attribute:dom-draggable-2><a href=#dom-draggable>draggable</a></code> IDL attribute is true become draggable as well.</p>

  <p>If an element's <code id=the-draggable-attribute:the-draggable-attribute-5><a href=#the-draggable-attribute>draggable</a></code> content attribute has the state
  <i>true</i>, the <code id=the-draggable-attribute:dom-draggable-3><a href=#dom-draggable>draggable</a></code> IDL attribute must return true.</p>

  <p>Otherwise, if the element's <code id=the-draggable-attribute:the-draggable-attribute-6><a href=#the-draggable-attribute>draggable</a></code> content attribute has
  the state <i>false</i>, the <code id=the-draggable-attribute:dom-draggable-4><a href=#dom-draggable>draggable</a></code> IDL attribute must return
  false.</p>

  <p>Otherwise, the element's <code id=the-draggable-attribute:the-draggable-attribute-7><a href=#the-draggable-attribute>draggable</a></code> content attribute has
  the state <i>auto</i>. If the element is an <code id=the-draggable-attribute:the-img-element><a href=#the-img-element>img</a></code> element, an <code id=the-draggable-attribute:the-object-element><a href=#the-object-element>object</a></code>
  element that <a href=#represents id=the-draggable-attribute:represents>represents</a> an image, or an <code id=the-draggable-attribute:the-a-element><a href=#the-a-element>a</a></code> element with an <code id=the-draggable-attribute:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code> content attribute, the <code id=the-draggable-attribute:dom-draggable-5><a href=#dom-draggable>draggable</a></code> IDL attribute must return true; otherwise, the <code id=the-draggable-attribute:dom-draggable-6><a href=#dom-draggable>draggable</a></code> IDL attribute must return false.</p>

  <p>If the <code id=the-draggable-attribute:dom-draggable-7><a href=#dom-draggable>draggable</a></code> IDL attribute is set to the value false,
  the <code id=the-draggable-attribute:the-draggable-attribute-8><a href=#the-draggable-attribute>draggable</a></code> content attribute must be set to the literal
  value "<code>false</code>". If the <code id=the-draggable-attribute:dom-draggable-8><a href=#dom-draggable>draggable</a></code> IDL
  attribute is set to the value true, the <code id=the-draggable-attribute:the-draggable-attribute-9><a href=#the-draggable-attribute>draggable</a></code> content
  attribute must be set to the literal value "<code>true</code>".</p>

  


  <h4 id=the-dropzone-attribute>6.7.8 The <dfn><code>dropzone</code></dfn> attribute<a href=#the-dropzone-attribute class=self-link></a></h4>

  <p>All <a href=#html-elements id=the-dropzone-attribute:html-elements>HTML elements</a> may have the <code id=the-dropzone-attribute:the-dropzone-attribute><a href=#the-dropzone-attribute>dropzone</a></code> content
  attribute set. When specified, its value must be an <a href=#unordered-set-of-unique-space-separated-tokens id=the-dropzone-attribute:unordered-set-of-unique-space-separated-tokens>unordered set of unique space-separated
  tokens</a> that are <a id=the-dropzone-attribute:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a>. The allowed values are the
  following:</p>

  <dl><dt><dfn id=attr-dropzone-copy><code>copy</code></dfn><dd><p>Indicates that dropping an accepted item on the element will result in a copy of the
   dragged data.</p>


   <dt><dfn id=attr-dropzone-move><code>move</code></dfn><dd><p>Indicates that dropping an accepted item on the element will result in the dragged data
   being moved to the new location.</p>


   <dt><dfn id=attr-dropzone-link><code>link</code></dfn><dd><p>Indicates that dropping an accepted item on the element will result in a link to the
   original data.</p>


   <dt>Any keyword with eight characters or more, beginning with an <a id=the-dropzone-attribute:ascii-case-insensitive-2 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII
   case-insensitive</a> match for the string "<code>string:</code>"<dd><p>Indicates that items with <a href=#the-drag-data-item-kind id=the-dropzone-attribute:the-drag-data-item-kind>the drag data item kind</a> <i>Plain Unicode string</i>
   and <a href=#the-drag-data-item-type-string id=the-dropzone-attribute:the-drag-data-item-type-string>the drag data item type string</a> set to a value that matches the remainder of the
   keyword are accepted.<dt>Any keyword with six characters or more, beginning with an <a id=the-dropzone-attribute:ascii-case-insensitive-3 href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII
   case-insensitive</a> match for the string "<code>file:</code>"<dd><p>Indicates that items with <a href=#the-drag-data-item-kind id=the-dropzone-attribute:the-drag-data-item-kind-2>the drag data item kind</a> <i>File</i> and <a href=#the-drag-data-item-type-string id=the-dropzone-attribute:the-drag-data-item-type-string-2>the
   drag data item type string</a> set to a value that matches the remainder of the keyword are
   accepted.</dl>

  <p>The <code id=the-dropzone-attribute:the-dropzone-attribute-2><a href=#the-dropzone-attribute>dropzone</a></code> content attribute's values must not have more
  than one of the three feedback values (<code id=the-dropzone-attribute:attr-dropzone-copy><a href=#attr-dropzone-copy>copy</a></code>, <code id=the-dropzone-attribute:attr-dropzone-move><a href=#attr-dropzone-move>move</a></code>, and <code id=the-dropzone-attribute:attr-dropzone-link><a href=#attr-dropzone-link>link</a></code>)
  specified. If none are specified, the <code id=the-dropzone-attribute:attr-dropzone-copy-2><a href=#attr-dropzone-copy>copy</a></code> value is
  implied.</p>

  <p>An element with a <code id=the-dropzone-attribute:the-dropzone-attribute-3><a href=#the-dropzone-attribute>dropzone</a></code> attribute should also have a
  <code id=the-dropzone-attribute:attr-title><a href=#attr-title>title</a></code> attribute that names the element for the purpose of
  non-visual interactions. </p>

  

  <p>A <code id=the-dropzone-attribute:the-dropzone-attribute-4><a href=#the-dropzone-attribute>dropzone</a></code> attribute <dfn id=concept-dropzone-match>matches a drag data store</dfn> if the <a href=#dropzone-processing-steps id=the-dropzone-attribute:dropzone-processing-steps><code>dropzone</code> processing steps</a> result in a match.</p>

  <p>A <code id=the-dropzone-attribute:the-dropzone-attribute-5><a href=#the-dropzone-attribute>dropzone</a></code> attribute <dfn id=concept-dropzone-operation>specifies an operation</dfn> if the <a href=#dropzone-processing-steps id=the-dropzone-attribute:dropzone-processing-steps-2><code>dropzone</code> processing steps</a> result in a specified operation. The
  specified operation is as given by those steps.</p>

  <p>The <dfn id=dropzone-processing-steps><code>dropzone</code> processing steps</dfn> are as follows.
  They either result in a match or not, and separate from this result either in a specified
  operation or not, as defined below.</p>

  <ol><li><p>Let <var>value</var> be the value of the <code id=the-dropzone-attribute:the-dropzone-attribute-6><a href=#the-dropzone-attribute>dropzone</a></code> attribute.<li><p>Let <var>keywords</var> be the result of <a href=#split-a-string-on-spaces id=the-dropzone-attribute:split-a-string-on-spaces>splitting <var>value</var> on spaces</a>.<li><p>Let <var>matched</var> be false.<li><p>Let <var>operation</var> be unspecified.<li>

    <p>For each value in <var>keywords</var>, if any, in the order that they were found in
    <var>value</var>, run the following steps.</p>

    <ol><li><p>Let <var>keyword</var> be the keyword.<li>

      <p>If <var>keyword</var> is one of "<code id=the-dropzone-attribute:attr-dropzone-copy-3><a href=#attr-dropzone-copy>copy</a></code>",
      "<code id=the-dropzone-attribute:attr-dropzone-move-2><a href=#attr-dropzone-move>move</a></code>", or "<code id=the-dropzone-attribute:attr-dropzone-link-2><a href=#attr-dropzone-link>link</a></code>", then: run the following substeps:</p>

      <ol><li><p>If <var>operation</var> is still unspecified, then let <var>operation</var> be the string given by <var>keyword</var>.<li><p>Skip to the step labeled <i>end of keyword</i> below.</ol>

     <li><p>If <var>keyword</var> does not contain a U+003A COLON character (:), or if the
     first such character in <var>keyword</var> is either the first character or the last
     character in the string, then skip to the step labeled <i>end of keyword</i> below.<li><p>Let <var>kind code</var> be the substring of <var>keyword</var> from
     the first character in the string to the last character in the string that is before the first
     U+003A COLON character (:) in the string, <a id=the-dropzone-attribute:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>.</p>

     <li>

      <p>Jump to the appropriate step from the list below, based on the value of <var>kind
      code</var>:</p>

      <dl class=switch><dt>If <var>kind code</var> is the string "<code>string</code>"<dd>

        <p>Let <var>kind</var> be <i>Plain Unicode string</i>.</p>

       <dt>If <var>kind code</var> is the string "<code>file</code>"<dd>

        <p>Let <var>kind</var> be <i>File</i>.</p>

       <dt>Otherwise<dd>

        <p>Skip to the step labeled <i>end of keyword</i> below.</p>

       </dl>

     <li><p>Let <var>type</var> be the substring of <var>keyword</var> from the
     first character after the first U+003A COLON character (:) in the string, to the last character
     in the string, <a id=the-dropzone-attribute:converted-to-ascii-lowercase-2 href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>.<li><p>If there exist any items in the <a href=#drag-data-store-item-list id=the-dropzone-attribute:drag-data-store-item-list>drag data store item list</a> whose <a href=#the-drag-data-item-kind id=the-dropzone-attribute:the-drag-data-item-kind-3>drag data item kind</a> is  the
     kind given in <var>kind</var> and
     whose <a href=#the-drag-data-item-type-string id=the-dropzone-attribute:the-drag-data-item-type-string-3>drag data item type string</a> is <var>type</var>, then let <var>matched</var> be true.<li><p><i>End of keyword</i>: Go on to the next keyword, if any, or the next step in the
     overall algorithm, if there are no more.</ol>

   <li>

    <p>The algorithm results in a match if <var>matched</var> is true, and does not
    otherwise.</p>

    <p>The algorithm results in a specified operation if <var>operation</var> is not
    unspecified. The specified operation, if one is specified, is the one given by <var>operation</var>.</p>

   </ol>

  <p>The <dfn id=dom-dropzone><code>dropzone</code></dfn> IDL attribute must
  <a href=#reflect id=the-dropzone-attribute:reflect>reflect</a> the content attribute of the same name.</p>

  <p>The <a href=https://dom.spec.whatwg.org/#concept-supported-tokens id=the-dropzone-attribute:concept-supported-tokens data-x-internal=concept-supported-tokens>supported tokens</a> for
  <code id=the-dropzone-attribute:the-dropzone-attribute-7><a href=#the-dropzone-attribute>dropzone</a></code> are the allowed values defined for the
  <code id=the-dropzone-attribute:the-dropzone-attribute-8><a href=#the-dropzone-attribute>dropzone</a></code> attribute that are supported by the user agent.</p>

  

  <div class=example>

   <p>In this example, a <code id=the-dropzone-attribute:the-div-element><a href=#the-div-element>div</a></code> element is made into a drop target for image files using
   the <code id=the-dropzone-attribute:the-dropzone-attribute-9><a href=#the-dropzone-attribute>dropzone</a></code> attribute. Images dropped into the target are
   then displayed.</p>

   <pre>&lt;div dropzone="copy file:image/png file:image/gif file:image/jpeg" ondrop="receive(event, this)">
 &lt;p>Drop an image here to have it displayed.&lt;/p>
&lt;/div>
&lt;script>
 function receive(event, element) {
   var data = event.dataTransfer.items;
   for (var i = 0; i &lt; data.length; i += 1) {
     if ((data[i].kind == 'file') &amp;&amp; (data[i].type.match('^image/'))) {
       var img = new Image();
       img.src = window.createObjectURL(data[i].getAsFile());
       element.appendChild(img);
     }
   }
 }
&lt;/script></pre>

  </div>






  

  <h4 id=security-risks-in-the-drag-and-drop-model>6.7.9 Security risks in the drag-and-drop model<a href=#security-risks-in-the-drag-and-drop-model class=self-link></a></h4>

  <p>User agents must not make the data added to the <code id=security-risks-in-the-drag-and-drop-model:datatransfer><a href=#datatransfer>DataTransfer</a></code> object during the
  <code id=security-risks-in-the-drag-and-drop-model:event-dnd-dragstart><a href=#event-dnd-dragstart>dragstart</a></code> event available to scripts until the <code id=security-risks-in-the-drag-and-drop-model:event-dnd-drop><a href=#event-dnd-drop>drop</a></code> event, because otherwise, if a user were to drag sensitive
  information from one document to a second document, crossing a hostile third document in the
  process, the hostile document could intercept the data.</p>

  <p>For the same reason, user agents must consider a drop to be successful only if the user
  specifically ended the drag operation — if any scripts end the drag operation, it must be
  considered unsuccessful (canceled) and the <code id=security-risks-in-the-drag-and-drop-model:event-dnd-drop-2><a href=#event-dnd-drop>drop</a></code> event must not be
  fired.</p>

  <p>User agents should take care to not start drag-and-drop operations in response to script
  actions. For example, in a mouse-and-window environment, if a script moves a window while the user
  has their mouse button depressed, the UA would not consider that to start a drag. This is important
  because otherwise UAs could cause data to be dragged from sensitive sources and dropped into
  hostile documents without the user's consent.</p>

  <p>User agents should filter potentially active (scripted) content (e.g. HTML) when it is dragged
  and when it is dropped, using a safelist of known-safe features. Similarly, <a href=https://url.spec.whatwg.org/#syntax-url-relative id=security-risks-in-the-drag-and-drop-model:relative-url data-x-internal=relative-url>relative URLs</a> should be turned into absolute URLs to avoid references changing in
  unexpected ways. This specification does not specify how this is performed.</p>

  <div class=example>

   <p>Consider a hostile page providing some content and getting the user to select and drag and
   drop (or indeed, copy and paste) that content to a victim page's <code id=security-risks-in-the-drag-and-drop-model:attr-contenteditable><a href=#attr-contenteditable>contenteditable</a></code> region. If the browser does not ensure that
   only safe content is dragged, potentially unsafe content such as scripts and event handlers in
   the selection, once dropped (or pasted) into the victim site, get the privileges of the victim
   site. This would thus enable a cross-site scripting attack.</p>

  </div>

  




  <h2 id=browsers>7 Loading Web pages<a href=#browsers class=self-link></a></h2>

  

  <p>This section describes features that apply most directly to Web browsers. Having said that,
  except where specified otherwise, the requirements defined in this section <em>do</em> apply to
  all user agents, whether they are Web browsers or not.</p>

  



  <h3 id=windows>7.1 Browsing contexts<a href=#windows class=self-link></a></h3>

  <p>A <dfn id=browsing-context data-export="">browsing context</dfn> is an environment in which <code id=windows:document><a href=#document>Document</a></code>
  objects are presented to the user.</p>

  <p class=note>A tab or window in a Web browser typically contains a <a href=#browsing-context id=windows:browsing-context>browsing
  context</a>, as does an <code id=windows:the-iframe-element><a href=#the-iframe-element>iframe</a></code> or <code id=windows:frame><a href=#frame>frame</a></code>s in a
  <code id=windows:frameset><a href=#frameset>frameset</a></code>.</p>

  <p>A <a href=#browsing-context id=windows:browsing-context-2>browsing context</a> has a corresponding <code id=windows:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <p>A <a href=#browsing-context id=windows:browsing-context-3>browsing context</a> has a <a href=#session-history id=windows:session-history>session history</a>, which lists the
  <code id=windows:document-2><a href=#document>Document</a></code> objects that the <a href=#browsing-context id=windows:browsing-context-4>browsing context</a> has presented, is presenting,
  or will present. At any time, one <code id=windows:document-3><a href=#document>Document</a></code> in each <a href=#browsing-context id=windows:browsing-context-5>browsing context</a> is
  designated the <dfn id=active-document data-export="">active document</dfn>.
  A <dfn data-dfn-for=Document id=concept-document-bc data-lt="browsing context" data-export=""><code>Document</code>'s browsing context</dfn> is the <a href=#browsing-context id=windows:browsing-context-6>browsing context</a>
  whose <a href=#session-history id=windows:session-history-2>session history</a> contains the <code id=windows:document-4><a href=#document>Document</a></code>, if any such browsing
  context exists and has not been <a href=#a-browsing-context-is-discarded id=windows:a-browsing-context-is-discarded>discarded</a>.</p>

  <p class=note>In general, there is a 1-to-1 mapping from the <code id=windows:window><a href=#window>Window</a></code> object to the
  <code id=windows:document-5><a href=#document>Document</a></code> object, as long as the <code id=windows:document-6><a href=#document>Document</a></code> object has a <a href=#concept-document-bc id=windows:concept-document-bc>browsing context</a>. There are two exceptions. First, a
  <code id=windows:window-2><a href=#window>Window</a></code> can be reused for the presentation of a second <code id=windows:document-7><a href=#document>Document</a></code> in the
  same <a href=#browsing-context id=windows:browsing-context-7>browsing context</a>, such that the mapping is then 1-to-2. This occurs when a
  <a href=#browsing-context id=windows:browsing-context-8>browsing context</a> is <a href=#navigate id=windows:navigate>navigated</a> from the initial
  <code id=windows:about:blank><a href=#about:blank>about:blank</a></code> <code id=windows:document-8><a href=#document>Document</a></code> to another, with <a href=#replacement-enabled id=windows:replacement-enabled>replacement enabled</a>.
  Second, a <code id=windows:document-9><a href=#document>Document</a></code> can end up being reused for several <code id=windows:window-3><a href=#window>Window</a></code> objects
  when the <code id=windows:dom-document-open><a href=#dom-document-open>document.open()</a></code> method is used, such that the
  mapping is then many-to-1.</p>

  <p class=note>A <code id=windows:document-10><a href=#document>Document</a></code> does not necessarily have a <a href=#concept-document-bc id=windows:concept-document-bc-2>browsing context</a> associated with it. In particular, data
  mining tools are likely to never instantiate browsing contexts. A <code id=windows:document-11><a href=#document>Document</a></code> created
  using an API such as <code id=windows:dom-domimplementation-createdocument><a data-x-internal=dom-domimplementation-createdocument href=https://dom.spec.whatwg.org/#dom-domimplementation-createdocument>createDocument()</a></code>
  never has a <a href=#concept-document-bc id=windows:concept-document-bc-3>browsing context</a>. And the
  <code id=windows:document-12><a href=#document>Document</a></code> originally created for an <code id=windows:the-iframe-element-2><a href=#the-iframe-element>iframe</a></code> element, which has since been
  <a href=#remove-an-element-from-a-document id=windows:remove-an-element-from-a-document>removed from the document</a>, has no associated
  browsing context, since that browsing context was <a href=#a-browsing-context-is-discarded id=windows:a-browsing-context-is-discarded-2>discarded</a>.</p>

  <hr>

  <p>A <a href=#browsing-context id=windows:browsing-context-9>browsing context</a> can have a <dfn id=creator-browsing-context data-export="">creator browsing context</dfn>,
  the <a href=#browsing-context id=windows:browsing-context-10>browsing context</a> that was responsible for its creation. If a <a href=#browsing-context id=windows:browsing-context-11>browsing
  context</a> has a <a href=#parent-browsing-context id=windows:parent-browsing-context>parent browsing context</a>, then that is its <a href=#creator-browsing-context id=windows:creator-browsing-context>creator browsing
  context</a>. Otherwise, if the <a href=#browsing-context id=windows:browsing-context-12>browsing context</a> has an <a href=#opener-browsing-context id=windows:opener-browsing-context>opener browsing
  context</a>, then <em>that</em> is its <a href=#creator-browsing-context id=windows:creator-browsing-context-2>creator browsing context</a>. Otherwise, the
  <a href=#browsing-context id=windows:browsing-context-13>browsing context</a> has no <a href=#creator-browsing-context id=windows:creator-browsing-context-3>creator browsing context</a>.</p>

  <p>If a <a href=#browsing-context id=windows:browsing-context-14>browsing context</a> <var>context</var> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-4>creator browsing
  context</a> <var>creator</var>, it also has the following properties. In what follows, let
  <var>creator document</var> be <var>creator</var>'s <a href=#active-document id=windows:active-document>active document</a> at the time
  <var>context</var> is created:</p>

  <dl><dt><dfn id=creator-origin>creator origin</dfn><dd><var>creator document</var>'s <a href=#concept-origin id=windows:concept-origin>origin</a><dt><dfn id=creator-url>creator URL</dfn><dd><var>creator document</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="windows:the-document's-address" data-x-internal="the-document's-address">URL</a><dt><dfn id=creator-base-url>creator base URL</dfn><dd><var>creator document</var>'s <a href=#document-base-url id=windows:document-base-url>base URL</a><dt><dfn id=creator-referrer-policy>creator referrer policy</dfn><dd><var>creator document</var>'s <a href=#concept-document-referrer-policy id=windows:concept-document-referrer-policy>referrer
   policy</a><dt><dfn id=creator-context-security>creator context security</dfn><dd>The result of executing <a id=windows:is-environment-settings-object-a-secure-context href=https://w3c.github.io/webappsec-secure-contexts/#settings-object data-x-internal=is-environment-settings-object-a-secure-context>Is environment settings object a secure context?</a> on
   <var>creator document</var>'s <a href=#relevant-settings-object id=windows:relevant-settings-object>relevant settings object</a></dl>

  

  <p>To <dfn id=creating-a-new-browsing-context>create a new browsing context</dfn>:</p>

  <ol><li><p>Let <var>browsingContext</var> be a new <a href=#browsing-context id=windows:browsing-context-15>browsing context</a>.<li>
    <p>Call the JavaScript <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=windows:js-initializehostdefinedrealm data-x-internal=js-initializehostdefinedrealm>InitializeHostDefinedRealm()</a> abstract operation
    with the following customizations:</p>

    <ul><li><p>For the global object, create a new <code id=windows:window-4><a href=#window>Window</a></code> object
     <var>window</var>.<li><p>For the global <b>this</b> value, use <var>browsingContext</var>'s
     <code id=windows:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object.<li><p>Let <var>realm execution context</var> be the created <a id=windows:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
     context</a>.</ul>
   <li><p><a href=#set-up-a-browsing-context-environment-settings-object id=windows:set-up-a-browsing-context-environment-settings-object>Set up a browsing context environment settings object</a> with <var>realm
   execution context</var>, and let <var>settingsObject</var> be the result.<li><p>Let <var>document</var> be a new <code id=windows:document-13><a href=#document>Document</a></code>, marked as an <a href=https://dom.spec.whatwg.org/#html-document id=windows:html-documents data-x-internal=html-documents>HTML document</a> in <a id=windows:quirks-mode href=https://dom.spec.whatwg.org/#concept-document-quirks data-x-internal=quirks-mode>quirks mode</a>, whose <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=windows:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> is "<code>text/html</code>",
   and which is both <a href=#ready-for-post-load-tasks id=windows:ready-for-post-load-tasks>ready for post-load tasks</a> and <a href=#completely-loaded id=windows:completely-loaded>completely loaded</a>
   immediately.<li><p>Ensure that <var>document</var> has a single child <code id=windows:the-html-element><a href=#the-html-element>html</a></code> node, which itself
   has two empty child nodes: a <code id=windows:the-head-element><a href=#the-head-element>head</a></code> element, and a <code id=windows:the-body-element><a href=#the-body-element>body</a></code> element.<li><p>Set <var>window</var>'s <a href=#concept-document-window id=windows:concept-document-window>associated
   <code>Document</code></a> to <var>document</var>.<li>
    <p>Set <var>browsingContext</var>'s <code id=windows:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object's
    <a href=#concept-windowproxy-window id=windows:concept-windowproxy-window>[[Window]]</a> internal slot
    value to <var>window</var>.</p>

    <p class=note>The internal slot value is updated when navigations occur.</p>
   <li>
    <p id=about-blank-origin>Set the <a href=#concept-origin id=windows:concept-origin-2>origin</a> of <var>document</var>:</p>

    <ul><li><p>If <var>browsingContext</var> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-5>creator browsing context</a>, then the
     <a href=#concept-origin id=windows:concept-origin-3>origin</a> of <var>document</var> is the <a href=#creator-origin id=windows:creator-origin>creator origin</a>.<li><p>Otherwise, the <a href=#concept-origin id=windows:concept-origin-4>origin</a> of <var>document</var> is a unique <a href=#concept-origin-opaque id=windows:concept-origin-opaque>opaque origin</a>.</ul>
   <li><p>If <var>browsingContext</var> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-6>creator browsing context</a>, then set
   <var>document</var>'s <a href="#the-document's-referrer" id="windows:the-document's-referrer">referrer</a> to the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=windows:concept-url-serializer data-x-internal=concept-url-serializer>serialization</a> of <a href=#creator-url id=windows:creator-url>creator URL</a>.<li><p>If <var>browsingContext</var> has a <a href=#creator-browsing-context id=windows:creator-browsing-context-7>creator browsing context</a>, then set
   <var>document</var>'s <a href=#concept-document-referrer-policy id=windows:concept-document-referrer-policy-2>referrer policy</a> to
   the <a href=#creator-referrer-policy id=windows:creator-referrer-policy>creator referrer policy</a>.<li><p><a href=#implement-the-sandboxing id=windows:implement-the-sandboxing>Implement the sandboxing</a> for <var>document</var>.<li><p><a href=#set-the-allow*-flags id=windows:set-the-allow*-flags>Set the allow* flags</a> for <var>document</var>.<li><p>Set <var>settingsObject</var>'s <a href=#concept-environment-execution-ready-flag id=windows:concept-environment-execution-ready-flag>execution ready flag</a>.<li><p>Add <var>document</var> to <var>browsingContext</var>'s <a href=#session-history id=windows:session-history-3>session
   history</a>.<li><p>Return <var>browsingContext</var>.</ol>

  


  <h4 id=nested-browsing-contexts>7.1.1 Nested browsing contexts<a href=#nested-browsing-contexts class=self-link></a></h4>

  <p>Certain elements (for example, <code id=nested-browsing-contexts:the-iframe-element><a href=#the-iframe-element>iframe</a></code> elements) can instantiate further <a href=#browsing-context id=nested-browsing-contexts:browsing-context>browsing contexts</a>. These elements are called <dfn id=browsing-context-container data-lt="browsing context container" data-export="">browsing
  context containers</dfn>.</p>

  <p>Each <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container>browsing context container</a> has a <dfn id=nested-browsing-context data-export="">nested browsing
  context</dfn>, which is either a <a href=#browsing-context id=nested-browsing-contexts:browsing-context-2>browsing context</a> or null.</p>

  <p>If a <a href=#browsing-context id=nested-browsing-contexts:browsing-context-3>browsing context</a> is the <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context>nested browsing context</a> of a
  <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-2>browsing context container</a>, then the browsing context is said to be <dfn id=browsing-context-nested-through data-export="">nested through</dfn> the <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-3>browsing
  context container</a>'s <a id=nested-browsing-contexts:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.</p>

  <p>A <a href=#browsing-context id=nested-browsing-contexts:browsing-context-4>browsing context</a> <var>child</var> is said to be a <dfn id=child-browsing-context data-export="">child
  browsing context</dfn> of another <a href=#browsing-context id=nested-browsing-contexts:browsing-context-5>browsing context</a> <var>parent</var>, if all of the
  following conditions hold:</p>

  <ul><li><p><var>child</var> is a <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-2>nested browsing context</a> of a <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-4>browsing context
   container</a> <var>element</var><li><p><var>element</var> is <a id=nested-browsing-contexts:connected href=https://dom.spec.whatwg.org/#connected data-x-internal=connected>connected</a><li><p><var>element</var>'s <a id=nested-browsing-contexts:shadow-including-root href=https://dom.spec.whatwg.org/#concept-shadow-including-root data-x-internal=shadow-including-root>shadow-including root</a>'s <a href=#concept-document-bc id=nested-browsing-contexts:concept-document-bc>browsing context</a> is <var>parent</var></ul>

  <p>A <a href=#browsing-context id=nested-browsing-contexts:browsing-context-6>browsing context</a> <var>child</var> is then a <dfn id=document-tree-child-browsing-context>document-tree child browsing
  context</dfn> of <var>parent</var> if it is a <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context>child browsing context</a> and its
  <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-5>browsing context container</a> is not just <a id=nested-browsing-contexts:connected-2 href=https://dom.spec.whatwg.org/#connected data-x-internal=connected>connected</a>, but also <a id=nested-browsing-contexts:in-a-document-tree href=https://dom.spec.whatwg.org/#in-a-document-tree data-x-internal=in-a-document-tree>in a
  document tree</a>.</p>

  <p>A <a href=#browsing-context id=nested-browsing-contexts:browsing-context-7>browsing context</a> <var>child</var> may have a <dfn id=parent-browsing-context data-export="">parent browsing
  context</dfn>. This is the unique <a href=#browsing-context id=nested-browsing-contexts:browsing-context-8>browsing context</a> that has <var>child</var> as a
  <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-2>child browsing context</a>, if any such browsing context exists. Otherwise, the
  <a href=#browsing-context id=nested-browsing-contexts:browsing-context-9>browsing context</a> has no <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context>parent browsing context</a>.</p>

  <p>A <a href=#browsing-context id=nested-browsing-contexts:browsing-context-10>browsing context</a> <var>A</var> is said to be an <dfn id=ancestor-browsing-context data-lt="ancestor browsing context" data-export="">ancestor</dfn> of a browsing context
  <var>B</var> if there exists a browsing context <var>A'</var> that is a <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-3>child browsing
  context</a> of <var>A</var> and that is itself an <a href=#ancestor-browsing-context id=nested-browsing-contexts:ancestor-browsing-context>ancestor</a> of <var>B</var>, or if the browsing context <var>A</var> is the
  <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-2>parent browsing context</a> of <var>B</var>.</p>

  <p>A <a href=#browsing-context id=nested-browsing-contexts:browsing-context-11>browsing context</a> that is not a <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-3>nested browsing context</a> has no
  <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-3>parent browsing context</a>, and is the <dfn id=top-level-browsing-context data-export="">top-level browsing
  context</dfn> of all the browsing contexts for which it is an <a href=#ancestor-browsing-context id=nested-browsing-contexts:ancestor-browsing-context-2>ancestor browsing
  context</a>.</p>

  <p>The transitive closure of <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-4>parent browsing contexts</a>
  for a <a href=#browsing-context id=nested-browsing-contexts:browsing-context-12>browsing context</a> that is a <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-4>nested browsing context</a> gives the list
  of <a href=#ancestor-browsing-context id=nested-browsing-contexts:ancestor-browsing-context-3>ancestor browsing contexts</a>.</p>

  <p>The <dfn id=list-of-the-descendant-browsing-contexts>list of the descendant browsing contexts</dfn> of a <code id=nested-browsing-contexts:document><a href=#document>Document</a></code> <var>d</var>
  is the (ordered) list returned by the following algorithm:</p>

  <ol><li><p>Let <var>list</var> be an empty list.<li>

    <p>For each <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-4>child browsing context</a> of <var>d</var> that is <a href=#browsing-context-nested-through id=nested-browsing-contexts:browsing-context-nested-through>nested through</a> an element that is <a href=https://dom.spec.whatwg.org/#in-a-document id=nested-browsing-contexts:in-a-document data-x-internal=in-a-document>in
    the <code>Document</code></a> <var>d</var>, in the <a id=nested-browsing-contexts:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> of the elements
    nesting those <a href=#browsing-context id=nested-browsing-contexts:browsing-context-13>browsing contexts</a>, run these substeps:</p>

    <ol><li><p>Append that <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-5>child browsing context</a> to the list <var>list</var>.</p>

     <li><p>Append the <a href=#list-of-the-descendant-browsing-contexts id=nested-browsing-contexts:list-of-the-descendant-browsing-contexts>list of the descendant browsing contexts</a> of the <a href=#active-document id=nested-browsing-contexts:active-document>active
     document</a> of that <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-6>child browsing context</a> to the list <var>list</var>.</ol>

   <li><p>Return the constructed <var>list</var>.</ol>

  <p>A <code id=nested-browsing-contexts:document-2><a href=#document>Document</a></code> is said to be <dfn data-dfn-for=Document id=fully-active data-export="">fully
  active</dfn> when it has a <a href=#concept-document-bc id=nested-browsing-contexts:concept-document-bc-2>browsing context</a> and it is
  the <a href=#active-document id=nested-browsing-contexts:active-document-2>active document</a> of that <a href=#browsing-context id=nested-browsing-contexts:browsing-context-14>browsing context</a>, and either its browsing
  context is a <a href=#top-level-browsing-context id=nested-browsing-contexts:top-level-browsing-context>top-level browsing context</a>, or it has a <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-5>parent browsing
  context</a> and the <code id=nested-browsing-contexts:document-3><a href=#document>Document</a></code> <a href=#browsing-context-nested-through id=nested-browsing-contexts:browsing-context-nested-through-2>through which</a> it is <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-5>nested</a> is itself
  <a href=#fully-active id=nested-browsing-contexts:fully-active>fully active</a>.</p>

  <p>Because they are associated with an element, <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-7>child
  browsing contexts</a> are always tied to a specific <code id=nested-browsing-contexts:document-4><a href=#document>Document</a></code> in their <a href=#parent-browsing-context id=nested-browsing-contexts:parent-browsing-context-6>parent
  browsing context</a>. User agents must not allow the user to interact with <a href=#child-browsing-context id=nested-browsing-contexts:child-browsing-context-8>child browsing contexts</a> of elements that are in <code id=nested-browsing-contexts:document-5><a href=#document>Document</a></code>s
  that are not themselves <a href=#fully-active id=nested-browsing-contexts:fully-active-2>fully active</a>.</p>

  <p>A <a href=#browsing-context id=nested-browsing-contexts:browsing-context-15>browsing context</a> that is a <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-6>nested browsing context</a> can be put into
  a <dfn id=delaying-load-events-mode>delaying <code>load</code> events mode</dfn>. This is used when it is
  <a href=#navigate id=nested-browsing-contexts:navigate>navigated</a>, to <a href=#delay-the-load-event id=nested-browsing-contexts:delay-the-load-event>delay the load event</a> of its
  <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-6>browsing context container</a> before the new <code id=nested-browsing-contexts:document-6><a href=#document>Document</a></code> is created.</p>



  <p>The <dfn id=document-family>document family</dfn> of a <a href=#browsing-context id=nested-browsing-contexts:browsing-context-16>browsing context</a> consists of the union of all
  the <code id=nested-browsing-contexts:document-7><a href=#document>Document</a></code> objects in that <a href=#browsing-context id=nested-browsing-contexts:browsing-context-17>browsing context</a>'s <a href=#session-history id=nested-browsing-contexts:session-history>session
  history</a> and the <a href=#document-family id=nested-browsing-contexts:document-family>document families</a> of all those
  <code id=nested-browsing-contexts:document-8><a href=#document>Document</a></code> objects. The <a href=#document-family id=nested-browsing-contexts:document-family-2>document family</a> of a <code id=nested-browsing-contexts:document-9><a href=#document>Document</a></code> object
  consists of the union of all the <a href=#document-family id=nested-browsing-contexts:document-family-3>document families</a> of the
  <a href=#browsing-context id=nested-browsing-contexts:browsing-context-18>browsing contexts</a> that are <a href=#browsing-context-nested-through id=nested-browsing-contexts:browsing-context-nested-through-3>nested through</a> the <code id=nested-browsing-contexts:document-10><a href=#document>Document</a></code> object.</p>

  <p>The <dfn id=concept-bcc-content-document>content document</dfn> of a <a href=#browsing-context-container id=nested-browsing-contexts:browsing-context-container-7>browsing
  context container</a> <var>container</var> is the result of the following algorithm:</p>

  <ol><li><p>If <var>container</var>'s <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-7>nested browsing context</a> is null, then return
   null.<li><p>Let <var>context</var> be <var>container</var>'s <a href=#nested-browsing-context id=nested-browsing-contexts:nested-browsing-context-8>nested browsing
   context</a>.<li><p>Let <var>document</var> be <var>context</var>'s <a href=#active-document id=nested-browsing-contexts:active-document-3>active document</a>.<li><p>If <var>document</var>'s <a href=#concept-origin id=nested-browsing-contexts:concept-origin>origin</a> and the <a href=#concept-settings-object-origin id=nested-browsing-contexts:concept-settings-object-origin>origin</a> specified by the <a href=#current-settings-object id=nested-browsing-contexts:current-settings-object>current settings
   object</a> are not <a href=#same-origin-domain id=nested-browsing-contexts:same-origin-domain>same origin-domain</a>, then return null.<li><p>Return <var>document</var>.</ol>


  <h5 id=navigating-nested-browsing-contexts-in-the-dom>7.1.1.1 Navigating nested browsing contexts in the DOM<a href=#navigating-nested-browsing-contexts-in-the-dom class=self-link></a></h5>

  <dl class=domintro><dt><var>window</var> . <code id=navigating-nested-browsing-contexts-in-the-dom:dom-top><a href=#dom-top>top</a></code><dd>

    <p>Returns the <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy><a href=#windowproxy>WindowProxy</a></code> for the <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context>top-level browsing context</a>.</p>

   <dt><var>window</var> . <code id=navigating-nested-browsing-contexts-in-the-dom:dom-parent><a href=#dom-parent>parent</a></code><dd>

    <p>Returns the <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> for the <a href=#parent-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:parent-browsing-context>parent browsing context</a>.</p>

   <dt><var>window</var> . <code id=navigating-nested-browsing-contexts-in-the-dom:dom-frameelement><a href=#dom-frameelement>frameElement</a></code><dd>

    <p>Returns the <code id=navigating-nested-browsing-contexts-in-the-dom:element><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code> for the <a href=#browsing-context-container id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-container>browsing context container</a>.</p>

    <p>Returns null if there isn't one, and in cross-origin situations.</p>

   </dl>

  

  <p>The <dfn id=dom-top><code>top</code></dfn> IDL attribute, on getting, must run the
  following algorithm:</p>

  <ol><li><p>Let <var>windowProxy</var> be this <code id=navigating-nested-browsing-contexts-in-the-dom:window><a href=#window>Window</a></code> object's <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-3><a href=#windowproxy>WindowProxy</a></code>
   object.<li><p>If there is no <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context>browsing context</a> with <var>windowProxy</var> as its
   <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-4><a href=#windowproxy>WindowProxy</a></code> object, then return null.</p>

   <li><p>Let <var>context</var> be that <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-2>browsing context</a>.<li><p>If <var>context</var> is a <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-2>top-level browsing context</a>, then return
   <var>context</var>'s <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-5><a href=#windowproxy>WindowProxy</a></code> object.<li><p>Otherwise, <var>context</var> must have a <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-3>top-level browsing context</a> (i.e. an
   <a href=#ancestor-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:ancestor-browsing-context>ancestor browsing context</a> with no <a href=#parent-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:parent-browsing-context-2>parent browsing context</a>). Return that
   <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-4>top-level browsing context</a>'s <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-6><a href=#windowproxy>WindowProxy</a></code> object.</ol>

  <p>The <dfn id=dom-parent><code>parent</code></dfn> IDL attribute, on getting, must run the
  following algorithm:</p>

  <ol><li><p>Let <var>windowProxy</var> be this <code id=navigating-nested-browsing-contexts-in-the-dom:window-2><a href=#window>Window</a></code> object's <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-7><a href=#windowproxy>WindowProxy</a></code>
   object.<li><p>If there is no <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-3>browsing context</a> with <var>windowProxy</var> as its
   <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-8><a href=#windowproxy>WindowProxy</a></code> object, then return null.</p>

   <li><p>Let <var>context</var> be that <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-4>browsing context</a>.<li><p>If <var>context</var> is a <a href=#child-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:child-browsing-context>child browsing context</a> of another <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-5>browsing
   context</a> <var>parent</var>, then return <var>parent</var>'s <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-9><a href=#windowproxy>WindowProxy</a></code>
   object.<li><p>Otherwise, <var>context</var> must be a <a href=#top-level-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-5>top-level browsing context</a>. Return
   <var>context</var>'s <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-10><a href=#windowproxy>WindowProxy</a></code> object.</ol>

  <p>The <dfn id=dom-frameelement><code>frameElement</code></dfn> IDL attribute, on getting,
  must run the following algorithm:</p>

  <ol><li><p>Let <var>windowProxy</var> be this <code id=navigating-nested-browsing-contexts-in-the-dom:window-3><a href=#window>Window</a></code> object's <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-11><a href=#windowproxy>WindowProxy</a></code>
   object.<li><p>If there is no <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-6>browsing context</a> with <var>windowProxy</var> as its
   <code id=navigating-nested-browsing-contexts-in-the-dom:windowproxy-12><a href=#windowproxy>WindowProxy</a></code> object, then return null.</p>

   <li><p>Let <var>context</var> be that <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-7>browsing context</a>.<li><p>If <var>context</var> is not a <a href=#nested-browsing-context id=navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context>nested browsing context</a>, then return
   null.<li><p>Let <var>container</var> be <var>context</var>'s <a href=#browsing-context-container id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-container-2>browsing context
   container</a>.<li><p>If <var>container</var>'s <a id=navigating-nested-browsing-contexts-in-the-dom:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#concept-origin id=navigating-nested-browsing-contexts-in-the-dom:concept-origin>origin</a> is not
   <a href=#same-origin-domain id=navigating-nested-browsing-contexts-in-the-dom:same-origin-domain>same origin-domain</a> with the <a href=#current-settings-object id=navigating-nested-browsing-contexts-in-the-dom:current-settings-object>current settings object</a>'s <a href=#concept-settings-object-origin id=navigating-nested-browsing-contexts-in-the-dom:concept-settings-object-origin>origin</a>, then return null.<li><p>Return <var>container</var>.</ol>

  <div class=example>
   <p>An example of when these IDL attributes can return null is as follows:</p>

   <pre>&lt;!DOCTYPE html>
&lt;iframe>&lt;/iframe>

&lt;script>
"use strict";
const element = document.querySelector("iframe");
const iframeWindow = element.contentWindow;
element.remove();

console.assert(iframeWindow.top === null);
console.assert(iframeWindow.parent === null);
console.assert(iframeWindow.frameElement === null);
&lt;/script></pre>

   <p>Here the <a href=#browsing-context id=navigating-nested-browsing-contexts-in-the-dom:browsing-context-8>browsing context</a> corresponding to <code>iframeWindow</code>
   was <a href=#a-browsing-context-is-discarded id=navigating-nested-browsing-contexts-in-the-dom:a-browsing-context-is-discarded>discarded</a> when <code>element</code> was removed from the document.</p>
  </div>

  



  <h4 id=auxiliary-browsing-contexts>7.1.2 Auxiliary browsing contexts<a href=#auxiliary-browsing-contexts class=self-link></a></h4>

  <p>It is possible to create new browsing contexts that are related to a <a href=#top-level-browsing-context id=auxiliary-browsing-contexts:top-level-browsing-context>top-level browsing
  context</a> without being nested through an element. Such browsing contexts are called <dfn id=auxiliary-browsing-context data-lt="auxiliary browsing context" data-export="">auxiliary
  browsing contexts</dfn>. Auxiliary browsing contexts are always <a href=#top-level-browsing-context id=auxiliary-browsing-contexts:top-level-browsing-context-2 data-lt="top-level browsing context" data-export="">top-level browsing
  contexts</a>.</p>

  <p>An <a href=#auxiliary-browsing-context id=auxiliary-browsing-contexts:auxiliary-browsing-context>auxiliary browsing context</a> has an <dfn id=opener-browsing-context data-export="">opener browsing
  context</dfn>, which is the <a href=#browsing-context id=auxiliary-browsing-contexts:browsing-context>browsing context</a> from which the <a href=#auxiliary-browsing-context id=auxiliary-browsing-contexts:auxiliary-browsing-context-2>auxiliary browsing
  context</a> was created.</p>


  <h5 id=navigating-auxiliary-browsing-contexts-in-the-dom>7.1.2.1 Navigating auxiliary browsing contexts in the DOM<a href=#navigating-auxiliary-browsing-contexts-in-the-dom class=self-link></a></h5>

  <p>The <dfn id=dom-opener><code>opener</code></dfn> IDL attribute on the <code id=navigating-auxiliary-browsing-contexts-in-the-dom:window><a href=#window>Window</a></code>
  object, on getting, must return the <code id=navigating-auxiliary-browsing-contexts-in-the-dom:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of the <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context>browsing
  context</a> from which the current <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-2>browsing context</a> was created (its <a href=#opener-browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:opener-browsing-context>opener
  browsing context</a>), if there is one, if it is still available, and if the current
  <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-3>browsing context</a> has not <i id=navigating-auxiliary-browsing-contexts-in-the-dom:disowned-its-opener><a href=#disowned-its-opener>disowned its opener</a></i>;
  otherwise, it must return null. On setting, if the new value is null then the current
  <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-4>browsing context</a> must <dfn id=disowned-its-opener data-export="">disown its
  opener</dfn>; if the new value is anything else then the user agent must

    
    call the [[DefineOwnProperty]] internal method of the <code id=navigating-auxiliary-browsing-contexts-in-the-dom:window-2><a href=#window>Window</a></code> object, passing the
    property name "<code>opener</code>" as the property key, and the Property Descriptor {
    [[Value]]: <var>value</var>, [[Writable]]: true, [[Enumerable]]: true,
    [[Configurable]]: true } as the property descriptor,
    

  where <var>value</var> is the new value.</p>

 <div class=note>
  <p>If a <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-5>browsing context</a> has <a href=#disowned-its-opener id=navigating-auxiliary-browsing-contexts-in-the-dom:disowned-its-opener-2>disowned its
  opener</a>, the value of its <code id=navigating-auxiliary-browsing-contexts-in-the-dom:dom-opener><a href=#dom-opener>window.opener</a></code> is <code>null</code>. That prevents scripts in the <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-6>browsing context</a> from changing
  any properties of its <a href=#opener-browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:opener-browsing-context-2>opener browsing context</a>'s <code id=navigating-auxiliary-browsing-contexts-in-the-dom:window-3><a href=#window>Window</a></code> (i.e., the window
  from which the <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-7>browsing context</a> was created).</p>

  <p>Otherwise, if a <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-8>browsing context</a> has <em>not</em> <a href=#disowned-its-opener id=navigating-auxiliary-browsing-contexts-in-the-dom:disowned-its-opener-3>disowned its
  opener</a>, then scripts in that <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-9>browsing context</a> can use <code id=navigating-auxiliary-browsing-contexts-in-the-dom:dom-opener-2><a href=#dom-opener>window.opener</a></code> to change properties of its <a href=#opener-browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:opener-browsing-context-3>opener browsing
  context</a>'s <code id=navigating-auxiliary-browsing-contexts-in-the-dom:window-4><a href=#window>Window</a></code>. For example, a script running in the <a href=#browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-10>browsing
  context</a> can change the value of <code>window.opener.location</code>, causing the
  <a href=#opener-browsing-context id=navigating-auxiliary-browsing-contexts-in-the-dom:opener-browsing-context-4>opener browsing context</a> to navigate to a completely different document.</p>
 </div>



  

  <h4 id=security-nav>7.1.3 Security<a href=#security-nav class=self-link></a></h4>

  <p id=security-1>A <a href=#browsing-context id=security-nav:browsing-context>browsing context</a> <var>A</var> is <dfn id=familiar-with>familiar
  with</dfn> a second <a href=#browsing-context id=security-nav:browsing-context-2>browsing context</a> <var>B</var> if one of the following
  conditions is true:</p>

  <ul><li>Either the <a href=#concept-origin id=security-nav:concept-origin>origin</a> of the <a href=#active-document id=security-nav:active-document>active document</a> of <var>A</var>
   is the <a href=#same-origin id=security-nav:same-origin>same</a> as the <a href=#concept-origin id=security-nav:concept-origin-2>origin</a> of the <a href=#active-document id=security-nav:active-document-2>active
   document</a> of <var>B</var>, or<li>The browsing context <var>A</var> is a <a href=#nested-browsing-context id=security-nav:nested-browsing-context>nested browsing context</a> with a
   <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context>top-level browsing context</a>, and its <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-2>top-level browsing context</a> is <var>B</var>, or<li>The browsing context <var>B</var> is an <a href=#auxiliary-browsing-context id=security-nav:auxiliary-browsing-context>auxiliary browsing context</a> and
   <var>A</var> is <a href=#familiar-with id=security-nav:familiar-with>familiar with</a> <var>B</var>'s <a href=#opener-browsing-context id=security-nav:opener-browsing-context>opener
   browsing context</a>, or<li>The browsing context <var>B</var> is not a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-3>top-level browsing context</a>,
   but there exists an <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context>ancestor browsing context</a> of <var>B</var> whose
   <a href=#active-document id=security-nav:active-document-3>active document</a> has the <a href=#same-origin id=security-nav:same-origin-2>same</a> <a href=#concept-origin id=security-nav:concept-origin-3>origin</a> as
   the <a href=#active-document id=security-nav:active-document-4>active document</a> of <var>A</var> (possibly in fact being <var>A</var> itself).</ul>

  <hr>

  <p>A <a href=#browsing-context id=security-nav:browsing-context-3>browsing context</a> <var>A</var> is <dfn id=allowed-to-navigate>allowed to navigate</dfn> a
  second <a href=#browsing-context id=security-nav:browsing-context-4>browsing context</a> <var>B</var> if the following algorithm terminates
  positively:</p>

  <ol><li><p>If <var>A</var> is not the same <a href=#browsing-context id=security-nav:browsing-context-5>browsing context</a> as <var>B</var>, and <var>A</var> is not one of the <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-2>ancestor browsing contexts</a> of <var>B</var>, and <var>B</var>
   is not a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-4>top-level browsing context</a>, and <var>A</var>'s <a href=#active-document id=security-nav:active-document-5>active
   document</a>'s <a href=#active-sandboxing-flag-set id=security-nav:active-sandboxing-flag-set>active sandboxing flag set</a> has its <a href=#sandboxed-navigation-browsing-context-flag id=security-nav:sandboxed-navigation-browsing-context-flag>sandboxed navigation
   browsing context flag</a> set, then abort these steps negatively.<li><p>Otherwise, if <var>B</var> is a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-5>top-level browsing context</a>, and is one of the
   <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-3>ancestor browsing contexts</a> of <var>A</var>, and
   <var>A</var>'s <a href=#active-document id=security-nav:active-document-6>active document</a>'s <a href=#active-sandboxing-flag-set id=security-nav:active-sandboxing-flag-set-2>active sandboxing flag set</a> has its
   <a href=#sandboxed-top-level-navigation-browsing-context-flag id=security-nav:sandboxed-top-level-navigation-browsing-context-flag>sandboxed top-level navigation browsing context flag</a> set, then abort these steps
   negatively.<li><p>Otherwise, if <var>B</var> is a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-6>top-level browsing context</a>, and is
   neither <var>A</var> nor one of the <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-4>ancestor
   browsing contexts</a> of <var>A</var>, and <var>A</var>'s
   <code id=security-nav:document><a href=#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=security-nav:active-sandboxing-flag-set-3>active sandboxing flag set</a> has its <a href=#sandboxed-navigation-browsing-context-flag id=security-nav:sandboxed-navigation-browsing-context-flag-2>sandboxed
   navigation browsing context flag</a> set, and <var>A</var> is not the <a href=#one-permitted-sandboxed-navigator id=security-nav:one-permitted-sandboxed-navigator>one
   permitted sandboxed navigator</a> of <var>B</var>, then abort these steps
   negatively.<li><p>Otherwise, terminate positively!</ol>

  <hr>

  <p>An element has a <dfn id=browsing-context-scope-origin>browsing context scope origin</dfn> if its <code id=security-nav:document-2><a href=#document>Document</a></code>'s
  <a href=#concept-document-bc id=security-nav:concept-document-bc>browsing context</a> is a <a href=#top-level-browsing-context id=security-nav:top-level-browsing-context-7>top-level browsing
  context</a> or if all of its <code id=security-nav:document-3><a href=#document>Document</a></code>'s <a href=#ancestor-browsing-context id=security-nav:ancestor-browsing-context-5>ancestor browsing contexts</a> all have <a href=#active-document id=security-nav:active-document-7>active
  documents</a> whose <a href=#concept-origin id=security-nav:concept-origin-4>origin</a> are the <a href=#same-origin id=security-nav:same-origin-3>same origin</a> as the element's
  <a id=security-nav:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s <a href=#concept-origin id=security-nav:concept-origin-5>origin</a>. If an element has a <a href=#browsing-context-scope-origin id=security-nav:browsing-context-scope-origin>browsing context scope
  origin</a>, then its value is the <a href=#concept-origin id=security-nav:concept-origin-6>origin</a> of the element's <a id=security-nav:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node
  document</a>.</p>

  



  

  <h4 id=groupings-of-browsing-contexts>7.1.4 Groupings of browsing contexts<a href=#groupings-of-browsing-contexts class=self-link></a></h4>

  <p>Each <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context>browsing context</a> is defined as having a list of one or more <dfn id=directly-reachable-browsing-contexts>directly
  reachable browsing contexts</dfn>. These are:</p>

  <ul><li>The <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-2>browsing context</a> itself.<li>All the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-3>browsing context</a>'s <a href=#child-browsing-context id=groupings-of-browsing-contexts:child-browsing-context>child browsing
   contexts</a>.<li>The <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-4>browsing context</a>'s <a href=#parent-browsing-context id=groupings-of-browsing-contexts:parent-browsing-context>parent browsing context</a>.<li>All the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-5>browsing contexts</a> that have the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-6>browsing
   context</a> as their <a href=#opener-browsing-context id=groupings-of-browsing-contexts:opener-browsing-context>opener browsing context</a>.<li>The <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-7>browsing context</a>'s <a href=#opener-browsing-context id=groupings-of-browsing-contexts:opener-browsing-context-2>opener browsing context</a>.</ul>

  <p>The transitive closure of all the <a href=#browsing-context id=groupings-of-browsing-contexts:browsing-context-8>browsing contexts</a> that
  are <a href=#directly-reachable-browsing-contexts id=groupings-of-browsing-contexts:directly-reachable-browsing-contexts>directly reachable browsing contexts</a> forms a <dfn id=unit-of-related-browsing-contexts>unit of related browsing
  contexts</dfn>.</p>

  <p>Each <a href=#unit-of-related-browsing-contexts id=groupings-of-browsing-contexts:unit-of-related-browsing-contexts>unit of related browsing contexts</a> is then further divided into the smallest
  number of groups such that every member of each group has an <a href=#active-document id=groupings-of-browsing-contexts:active-document>active document</a> with an
  <a href=#concept-origin id=groupings-of-browsing-contexts:concept-origin>origin</a> that, through appropriate manipulation of the <code id=groupings-of-browsing-contexts:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> attribute, could be made to be <a href=#same-origin-domain id=groupings-of-browsing-contexts:same-origin-domain>same
  origin-domain</a> with other members of the group, but could not be made the same as members of
  any other group. Each such group is a <dfn id=unit-of-related-similar-origin-browsing-contexts data-export="">unit of related similar-origin browsing
  contexts</dfn>.</p>

  <p class=note>There is also at most one <a href=#event-loop id=groupings-of-browsing-contexts:event-loop>event loop</a> per <a href=#unit-of-related-similar-origin-browsing-contexts id=groupings-of-browsing-contexts:unit-of-related-similar-origin-browsing-contexts>unit of related
  similar-origin browsing contexts</a> (though several <a href=#unit-of-related-similar-origin-browsing-contexts id=groupings-of-browsing-contexts:unit-of-related-similar-origin-browsing-contexts-2>units of related similar-origin browsing contexts</a> can
  have a shared <a href=#event-loop id=groupings-of-browsing-contexts:event-loop-2>event loop</a>).</p>

  



  <h4 id=browsing-context-names>7.1.5 Browsing context names<a href=#browsing-context-names class=self-link></a></h4>

  <p>Browsing contexts can have a <dfn id=browsing-context-name>browsing context name</dfn>. Unless stated otherwise, it is
  the empty string.</p>

  <p>A <dfn id=valid-browsing-context-name>valid browsing context name</dfn> is any string with at least one character that does
  not start with a U+005F LOW LINE character. (Names starting with an underscore are reserved for
  special keywords.)</p>

  <p>A <dfn id=valid-browsing-context-name-or-keyword>valid browsing context name or keyword</dfn> is any string that is either a <a href=#valid-browsing-context-name id=browsing-context-names:valid-browsing-context-name>valid
  browsing context name</a> or that is an <a id=browsing-context-names:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for one of:
  <code>_blank</code>, <code>_self</code>, <code>_parent</code>, or
  <code>_top</code>.</p>

  <p>These values have different meanings based on whether the page is sandboxed or not, as
  summarized in the following (non-normative) table. In this table, "current" means the
  <a href=#browsing-context id=browsing-context-names:browsing-context>browsing context</a> that the link or script is in, "parent" means the <a href=#parent-browsing-context id=browsing-context-names:parent-browsing-context>parent
  browsing context</a> of the one the link or script is in, "top" means the <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context>top-level
  browsing context</a> of the one the link or script is in, "new" means a new <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-2>top-level
  browsing context</a> or <a href=#auxiliary-browsing-context id=browsing-context-names:auxiliary-browsing-context>auxiliary browsing context</a> is to be created, subject to
  various user preferences and user agent policies, "none" means that nothing will happen, and
  "maybe new" means the same as "new" if the "<code id=browsing-context-names:attr-iframe-sandbox-allow-popups><a href=#attr-iframe-sandbox-allow-popups>allow-popups</a></code>" keyword is also specified on the
  <code id=browsing-context-names:attr-iframe-sandbox><a href=#attr-iframe-sandbox>sandbox</a></code> attribute (or if the user overrode the
  sandboxing), and the same as "none" otherwise.</p>

  <table><thead><tr><th rowspan=2>Keyword
     <th rowspan=2>Ordinary effect
     <th colspan=2>Effect in an <code id=browsing-context-names:the-iframe-element><a href=#the-iframe-element>iframe</a></code> with...
    <tr><th><code>sandbox=""</code>
     <th><code>sandbox="allow-top-navigation"</code>

   <tbody><tr><td>none specified, for links and form submissions 
     <td>current
     <td>current
     <td>current

    <tr><td>empty string
     <td>current
     <td>current
     <td>current

    <tr><td><code>_blank</code>
     <td>new
     <td>maybe new
     <td>maybe new

    <tr><td><code>_self</code>
     <td>current
     <td>current
     <td>current

    <tr><td><code>_parent</code> if there isn't a parent
     <td>current
     <td>current
     <td>current

    <tr><td><code>_parent</code> if parent is also top
     <td>parent/top
     <td>none
     <td>parent/top

    <tr><td><code>_parent</code> if there is one and it's not top
     <td>parent
     <td>none
     <td>none

    <tr><td><code>_top</code> if top is current
     <td>current
     <td>current
     <td>current

    <tr><td><code>_top</code> if top is not current
     <td>top
     <td>none
     <td>top

    <tr><td>name that doesn't exist
     <td>new
     <td>maybe new
     <td>maybe new

    <tr><td>name that exists and is a descendant
     <td>specified descendant
     <td>specified descendant
     <td>specified descendant

    <tr><td>name that exists and is current
     <td>current
     <td>current
     <td>current

    <tr><td>name that exists and is an ancestor that is top
     <td>specified ancestor
     <td>none
     <td>specified ancestor/top

    <tr><td>name that exists and is an ancestor that is not top
     <td>specified ancestor
     <td>none
     <td>none

    <tr><td>other name that exists with common top
     <td>specified
     <td>none
     <td>none

    <tr><td>name that exists with different top, if <a href=#familiar-with id=browsing-context-names:familiar-with>familiar</a> and <a href=#one-permitted-sandboxed-navigator id=browsing-context-names:one-permitted-sandboxed-navigator>one permitted sandboxed navigator</a>
     <td>specified
     <td>specified
     <td>specified

    <tr><td>name that exists with different top, if <a href=#familiar-with id=browsing-context-names:familiar-with-2>familiar</a> but not <a href=#one-permitted-sandboxed-navigator id=browsing-context-names:one-permitted-sandboxed-navigator-2>one permitted sandboxed navigator</a>
     <td>specified
     <td>none
     <td>none

    <tr><td>name that exists with different top, not <a href=#familiar-with id=browsing-context-names:familiar-with-3>familiar</a>
     <td>new
     <td>maybe new
     <td>maybe new

  </table>

  <p class=tablenote><small>Most of the restrictions on sandboxed browsing contexts are applied by
  other algorithms, e.g. the <a href=#navigate id=browsing-context-names:navigate>navigation</a> algorithm, not <a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=browsing-context-names:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>the rules
  for choosing a browsing context given a browsing context name</a> given below.</small></p>

  

  <hr>

  <p><dfn id=the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>The rules for choosing a browsing context given a browsing context name</dfn> are as
  follows. The rules assume that they are being applied in the context of a <a href=#browsing-context id=browsing-context-names:browsing-context-2>browsing
  context</a>, as part of the execution of a <a href=#concept-task id=browsing-context-names:concept-task>task</a>.</p>

  <ol><li>

    <p>If the given browsing context name is the empty string or <code>_self</code>, then
    the chosen browsing context must be the current one.</p>

   <li><p>If the given browsing context name is <code>_parent</code>, then the chosen
   browsing context must be the <a href=#parent-browsing-context id=browsing-context-names:parent-browsing-context-2><em>parent</em> browsing context</a> of the current one,
   unless there isn't one, in which case the chosen browsing context must be the current browsing
   context.<li><p>If the given browsing context name is <code>_top</code>, then the chosen browsing
   context must be the <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-3>top-level browsing context</a> of the current one, if there is one,
   or else the current browsing context.<li>

    <p>If the given browsing context name is not <code>_blank</code> and there exists a
    browsing context whose <a href=#browsing-context-name id=browsing-context-names:browsing-context-name>name</a> is the same as the given
    browsing context name, and the current browsing context is <a href=#familiar-with id=browsing-context-names:familiar-with-4>familiar with</a> that
    browsing context, and the user agent determines that the two browsing contexts are related
    enough that it is ok if they reach each other, then that browsing context must be the chosen
    one. If there are multiple matching browsing contexts, the user agent should select one in some
    arbitrary consistent manner, such as the most recently opened, most recently focused, or more
    closely related.</p>

   <li>

    <p>Otherwise, a new browsing context is being requested, and what happens depends on the user
    agent's configuration and abilities — it is determined by the rules given for the first
    applicable option from the following list:</p>

    <dl class=switch><dt id=popup-blocker>If the algorithm is not <a href=#triggered-by-user-activation id=browsing-context-names:triggered-by-user-activation>triggered by user activation</a> and
     the user agent has been configured to not show popups (i.e. the user agent has a "popup
     blocker" enabled)<dd>

      <p>There is no chosen browsing context. The user agent may inform the user that a popup has
      been blocked.</p>

     <dt id=sandboxWindowOpen>If the current browsing context's <a href=#active-document id=browsing-context-names:active-document>active document</a>'s
     <a href=#active-sandboxing-flag-set id=browsing-context-names:active-sandboxing-flag-set>active sandboxing flag set</a> has the <a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=browsing-context-names:sandboxed-auxiliary-navigation-browsing-context-flag>sandboxed auxiliary navigation browsing
     context flag</a> set.<dd>

      <p>Typically, there is no chosen browsing context.</p>

      <p>The user agent may offer to <a href=#creating-a-new-browsing-context id=browsing-context-names:creating-a-new-browsing-context>create</a> a new <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-4>top-level browsing context</a> or reuse
      an existing <a href=#top-level-browsing-context id=browsing-context-names:top-level-browsing-context-5>top-level browsing context</a>. If the user picks one of those options,
      then the designated browsing context must be the chosen one (the browsing context's name isn't
      set to the given browsing context name). The default behavior (if the user agent doesn't
      offer the option to the user, or if the user declines to allow a browsing context to be used)
      must be that there must not be a chosen browsing context.</p>

      <p class=warning>If this case occurs, it means that an author has explicitly sandboxed the
      document that is trying to open a link.</p>

     <dt id=noopener>If the user agent has been configured such that in this instance it will
     create a new browsing context:<dd>
      <p>A new <a href=#auxiliary-browsing-context id=browsing-context-names:auxiliary-browsing-context-2>auxiliary browsing context</a> must be created, with the <a href=#opener-browsing-context id=browsing-context-names:opener-browsing-context>opener
      browsing context</a> being the current one. If the given browsing context name is not
      <code>_blank</code>, then the new auxiliary browsing context's name must be the
      given browsing context name (otherwise, it has no name). The chosen browsing context must be
      this new browsing context.</p>

      <p class=note>If the newly created <a href=#browsing-context id=browsing-context-names:browsing-context-3>browsing context</a> is immediately <a href=#navigate id=browsing-context-names:navigate-2>navigated</a>, then the navigation will be done with <a href=#replacement-enabled id=browsing-context-names:replacement-enabled>replacement
      enabled</a>.</p>
     <dt>If the user agent has been configured such that in this instance it will reuse the current
     browsing context<dd><p>The chosen browsing context is the current browsing context.<dt>If the user agent has been configured such that in this instance it will not find a
     browsing context<dd><p>There must not be a chosen browsing context.</dl>

    <p>User agent implementors are encouraged to provide a way for users to configure the user agent
    to always reuse the current browsing context.</p>

    <p>If the chosen browsing context picked above, if any, is a new browsing context, then:</p>

    <ol><li><p>Let <var>flagSet</var> be the current browsing context's <a href=#active-document id=browsing-context-names:active-document-2>active document</a>'s
     <a href=#active-sandboxing-flag-set id=browsing-context-names:active-sandboxing-flag-set-2>active sandboxing flag set</a>.<li><p>If <var>flagSet</var>'s <a href=#sandboxed-navigation-browsing-context-flag id=browsing-context-names:sandboxed-navigation-browsing-context-flag>sandboxed navigation browsing context flag</a> is set,
     then the current browsing context must be set as the new browsing context's <a href=#one-permitted-sandboxed-navigator id=browsing-context-names:one-permitted-sandboxed-navigator-3>one permitted
     sandboxed navigator</a>.<li><p>If <var>flagSet</var>'s <a href=#sandbox-propagates-to-auxiliary-browsing-contexts-flag id=browsing-context-names:sandbox-propagates-to-auxiliary-browsing-contexts-flag>sandbox propagates to auxiliary browsing contexts
     flag</a> is set, then all the flags that are set in <var>flagSet</var> must be set in the
     new browsing context's <a href=#popup-sandboxing-flag-set id=browsing-context-names:popup-sandboxing-flag-set>popup sandboxing flag set</a>.</ol>

   </ol>

  


  

  <h4 id=script-settings-for-browsing-contexts>7.1.6 Script settings for browsing contexts<a href=#script-settings-for-browsing-contexts class=self-link></a></h4>

  <p>When the user agent is required to <dfn id=set-up-a-browsing-context-environment-settings-object>set up a browsing context environment settings
  object</dfn>, given a <a id=script-settings-for-browsing-contexts:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution context</a> <var>execution context</var> and
  an optional <a href=#environment id=script-settings-for-browsing-contexts:environment>environment</a> <var>reserved environment</var>, it must run the following
  steps:</p>

  <ol><li><p>Let <var>realm</var> be the value of <var>execution context</var>'s Realm
   component.<li><p>Let <var>window</var> be <var>realm</var>'s <a href=#concept-realm-global id=script-settings-for-browsing-contexts:concept-realm-global>global
   object</a>.<li><p>Let <var>url</var> be a copy of the <a href=https://dom.spec.whatwg.org/#concept-document-url id="script-settings-for-browsing-contexts:the-document's-address" data-x-internal="the-document's-address">URL</a> of
   <var>window</var>'s <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window>associated
   <code>Document</code></a>.<li>
    <p>Let <var>settings object</var> be a new <a href=#environment-settings-object id=script-settings-for-browsing-contexts:environment-settings-object>environment settings object</a> whose
    algorithms are defined as follows:</p>

    <dl><dt>The <a href=#realm-execution-context id=script-settings-for-browsing-contexts:realm-execution-context>realm execution context</a><dd>

      <p>Return <var>execution context</var>.</p>

     <dt>The <a href=#concept-settings-object-module-map id=script-settings-for-browsing-contexts:concept-settings-object-module-map>module map</a><dd>

      <p>Return the <a href=#concept-document-module-map id=script-settings-for-browsing-contexts:concept-document-module-map>module map</a> of
      <var>window</var>'s <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window-2>associated
      <code>Document</code></a>.</p>

     <dt>The <a href=#responsible-browsing-context id=script-settings-for-browsing-contexts:responsible-browsing-context>responsible browsing context</a><dd>

      <p>Return the <a href=#browsing-context id=script-settings-for-browsing-contexts:browsing-context>browsing context</a> with which <var>window</var> is associated.</p>

     <dt>The <a href=#responsible-event-loop id=script-settings-for-browsing-contexts:responsible-event-loop>responsible event loop</a><dd>

      <p>Return the <a href=#event-loop id=script-settings-for-browsing-contexts:event-loop>event loop</a> that is associated with the <a href=#unit-of-related-similar-origin-browsing-contexts id=script-settings-for-browsing-contexts:unit-of-related-similar-origin-browsing-contexts>unit of related
      similar-origin browsing contexts</a> to which <var>window</var>'s <a href=#browsing-context id=script-settings-for-browsing-contexts:browsing-context-2>browsing
      context</a> belongs.</p>

     <dt>The <a href=#responsible-document id=script-settings-for-browsing-contexts:responsible-document>responsible document</a><dd>

      <p>Return <var>window</var>'s <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window-3>associated
      <code>Document</code></a>.</p>

     <dt>The <a href=#api-url-character-encoding id=script-settings-for-browsing-contexts:api-url-character-encoding>API URL character encoding</a><dd>

      <p>Return the current <a href=https://dom.spec.whatwg.org/#concept-document-encoding id="script-settings-for-browsing-contexts:document's-character-encoding" data-x-internal="document's-character-encoding">character encoding</a>
      of <var>window</var>'s <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window-4>associated
      <code>Document</code></a>.</p>

     <dt>The <a href=#api-base-url id=script-settings-for-browsing-contexts:api-base-url>API base URL</a><dd>

      <p>Return the current <a href=#document-base-url id=script-settings-for-browsing-contexts:document-base-url>base URL</a> of <var>window</var>'s
      <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window-5>associated <code>Document</code></a>.</p>

     <dt>The <a href=#concept-settings-object-origin id=script-settings-for-browsing-contexts:concept-settings-object-origin>origin</a><dd>

      <p>Return the <a href=#concept-origin id=script-settings-for-browsing-contexts:concept-origin>origin</a> of <var>window</var>'s <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window-6>associated <code>Document</code></a>.</p>

     <dt>The <a href=#https-state id=script-settings-for-browsing-contexts:https-state>HTTPS state</a><dd>

      <p>Return the <a href=#concept-document-https-state id=script-settings-for-browsing-contexts:concept-document-https-state>HTTPS state</a> of
      <var>window</var>'s <a href=#concept-document-window id=script-settings-for-browsing-contexts:concept-document-window-7>associated
      <code>Document</code></a>.</p>

     <dt>The <a href=#concept-settings-object-referrer-policy id=script-settings-for-browsing-contexts:concept-settings-object-referrer-policy>referrer policy</a><dd>

      <ol><li><p>Let <var>document</var> be the <code id=script-settings-for-browsing-contexts:document><a href=#document>Document</a></code> with which <var>window</var> is
       currently associated.<li><p>While <var>document</var> is <a href=#an-iframe-srcdoc-document id=script-settings-for-browsing-contexts:an-iframe-srcdoc-document>an <code>iframe</code>
       <code>srcdoc</code> document</a> and <var>document</var>'s
       <a href=#concept-document-referrer-policy id=script-settings-for-browsing-contexts:concept-document-referrer-policy>referrer policy</a> is the empty
       string, set <var>document</var> to <var>document</var>'s
       <a href=#concept-document-bc id=script-settings-for-browsing-contexts:concept-document-bc>browsing context</a>'s
       <a href=#browsing-context-container id=script-settings-for-browsing-contexts:browsing-context-container>browsing context container</a>'s <a id=script-settings-for-browsing-contexts:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.<li><p>Return <var>document</var>'s <a href=#concept-document-referrer-policy id=script-settings-for-browsing-contexts:concept-document-referrer-policy-2>referrer
       policy</a>.</ol>

    </dl>
   <li>
    <p>If <var>reserved environment</var> is given, then:</p>

    <ol><li><p>Set <var>settings object</var>'s <a href=#concept-environment-id id=script-settings-for-browsing-contexts:concept-environment-id>id</a> to
     <var>reserved environment</var>'s <a href=#concept-environment-id id=script-settings-for-browsing-contexts:concept-environment-id-2>id</a>,
     <var>settings object</var>'s <a href=#concept-environment-creation-url id=script-settings-for-browsing-contexts:concept-environment-creation-url>creation
     URL</a> to <var>reserved environment</var>'s <a href=#concept-environment-creation-url id=script-settings-for-browsing-contexts:concept-environment-creation-url-2>creation URL</a>, <var>settings object</var>'s
     <a href=#concept-environment-target-browsing-context id=script-settings-for-browsing-contexts:concept-environment-target-browsing-context>target browsing context</a> to
     <var>reserved environment</var>'s <a href=#concept-environment-target-browsing-context id=script-settings-for-browsing-contexts:concept-environment-target-browsing-context-2>target browsing context</a>, and
     <var>settings object</var>'s <a href=#concept-environment-active-service-worker id=script-settings-for-browsing-contexts:concept-environment-active-service-worker>active
     service worker</a> to <var>reserved environment</var>'s <a href=#concept-environment-active-service-worker id=script-settings-for-browsing-contexts:concept-environment-active-service-worker-2>active service worker</a>.<li>
      <p>Set <var>reserved environment</var>'s <a href=#concept-environment-id id=script-settings-for-browsing-contexts:concept-environment-id-3>id</a> to
      the empty string.</p>

      <p class=note>The identity of the reserved environment is considered to be fully
      transferred to the created <a href=#environment-settings-object id=script-settings-for-browsing-contexts:environment-settings-object-2>environment settings object</a>. The reserved environment
      is not searchable by the <a href=#environment id=script-settings-for-browsing-contexts:environment-2>environment</a>’s <a href=#concept-environment-id id=script-settings-for-browsing-contexts:concept-environment-id-4>id</a> from this point on.</p>
     </ol>
   <li><p>Otherwise, set <var>settings object</var>'s <a href=#concept-environment-id id=script-settings-for-browsing-contexts:concept-environment-id-5>id</a> to a new unique opaque string, <var>settings
   object</var>'s <a href=#concept-environment-creation-url id=script-settings-for-browsing-contexts:concept-environment-creation-url-3>creation URL</a> to
   <var>url</var>, <var>settings object</var>'s <a href=#concept-environment-target-browsing-context id=script-settings-for-browsing-contexts:concept-environment-target-browsing-context-3>target browsing context</a> to null, and
   <var>settings object</var>'s <a href=#concept-environment-active-service-worker id=script-settings-for-browsing-contexts:concept-environment-active-service-worker-3>active
   service worker</a> to null.<li><p>Set <var>realm</var>'s [[HostDefined]] field to <var>settings object</var>.<li><p>Return <var>settings object</var>.</ol>

  



  <h3 id=cross-origin-objects>7.2 Security infrastructure for <code id=cross-origin-objects:window><a href=#window>Window</a></code>,
  <code id=cross-origin-objects:windowproxy><a href=#windowproxy>WindowProxy</a></code>, and <code id=cross-origin-objects:location><a href=#location>Location</a></code> objects<a href=#cross-origin-objects class=self-link></a></h3>

  <p>Although typically objects cannot be accessed across <a href=#concept-origin id=cross-origin-objects:concept-origin>origins</a>, the
  web platform would not be true to itself if it did not have some legacy exceptions to that rule
  that the web depends upon.


  <h4 id=integration-with-idl>7.2.1 Integration with IDL<a href=#integration-with-idl class=self-link></a></h4>

  <p>When <a id=integration-with-idl:perform-a-security-check href=https://heycam.github.io/webidl/#dfn-perform-a-security-check data-x-internal=perform-a-security-check>perform a security check</a> is invoked, with a <var>platformObject</var>,
  <var>identifier</var>, and <var>type</var>, run these steps:</p>

  <ol><li>
    <p>If <var>platformObject</var> is a <code id=integration-with-idl:window><a href=#window>Window</a></code> or <code id=integration-with-idl:location><a href=#location>Location</a></code> object,
    then:</p>

    <ol><li>
      <p>Repeat for each <var>e</var> that is an element of
      <a href=#crossoriginproperties-(-o-) id=integration-with-idl:crossoriginproperties-(-o-)>CrossOriginProperties</a>(<var>platformObject</var>):</p>

      <ol><li>
        <p>If <a id=integration-with-idl:samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>e</var>.[[Property]], <var>identifier</var>) is true,
        then:</p>

        <ol><li><p>If <var>type</var> is "<code>method</code>" and <var>e</var> has neither
         [[NeedsGet]] nor [[NeedsSet]], then return.<li><p>Otherwise, if <var>type</var> is "<code>getter</code>" and
         <var>e</var>.[[NeedsGet]] is true, then return.<li><p>Otherwise, if <var>type</var> is "<code>setter</code>" and
         <var>e</var>.[[NeedsSet]] is true, then return.</ol>
       </ol>
     </ol>
   <li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=integration-with-idl:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>platformObject</var>) is false, then throw
   a <a id=integration-with-idl:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=integration-with-idl:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>


  <h4 id=shared-internal-slot:-crossoriginpropertydescriptormap>7.2.2 Shared internal slot: [[CrossOriginPropertyDescriptorMap]]<a href=#shared-internal-slot:-crossoriginpropertydescriptormap class=self-link></a></h4>

  <p><code id=shared-internal-slot:-crossoriginpropertydescriptormap:window><a href=#window>Window</a></code> and <code id=shared-internal-slot:-crossoriginpropertydescriptormap:location><a href=#location>Location</a></code> objects both have a
  <dfn id=crossoriginpropertydescriptormap>[[CrossOriginPropertyDescriptorMap]]</dfn> internal slot, whose value is initially an empty
  map.

  <p class=note>The <a href=#crossoriginpropertydescriptormap id=shared-internal-slot:-crossoriginpropertydescriptormap:crossoriginpropertydescriptormap>[[CrossOriginPropertyDescriptorMap]]</a> internal slot contains a map
  with entries whose keys are (<var>currentGlobal</var>, <var>objectGlobal</var>,
  <var>propertyKey</var>)-tuples and values are property descriptors, as a memoization of what is
  visible to scripts when <var>currentGlobal</var> inspects a <code id=shared-internal-slot:-crossoriginpropertydescriptormap:window-2><a href=#window>Window</a></code> or
  <code id=shared-internal-slot:-crossoriginpropertydescriptormap:location-2><a href=#location>Location</a></code> object from <var>objectGlobal</var>. It is filled lazily by
  <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=shared-internal-slot:-crossoriginpropertydescriptormap:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>, which consults it on future lookups.</p>

  <p>User agents should allow a value held in the map to be garbage collected along with its
  corresponding key when nothing holds a reference to any part of the value. That is, as long as
  garbage collection is not observable.</p>

  <p class=example>For example, with <code>const href =
  Object.getOwnPropertyDescriptor(crossOriginLocation, "href").set</code> the value and its
  corresponding key in the map cannot be garbage collected as that would be observable.</p>

  <p>User agents may have an optimization whereby they remove key-value pairs from the map when
  <code id=shared-internal-slot:-crossoriginpropertydescriptormap:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> is set. This is not observable as <code id=shared-internal-slot:-crossoriginpropertydescriptormap:dom-document-domain-2><a href=#dom-document-domain>document.domain</a></code> cannot revisit an earlier value.</p>

  <p class=example>For example, setting <code id=shared-internal-slot:-crossoriginpropertydescriptormap:dom-document-domain-3><a href=#dom-document-domain>document.domain</a></code>
  to "<code>example.com</code>" on www.example.com means user agents can remove all
  key-value pairs from the map where part of the key is www.example.com, as that can never be part
  of the <a href=#concept-origin id=shared-internal-slot:-crossoriginpropertydescriptormap:concept-origin>origin</a> again and therefore the corresponding value could never be retrieved
  from the map.</p>


  <h4 id=shared-abstract-operations>7.2.3 Shared abstract operations<a href=#shared-abstract-operations class=self-link></a></h4>

  <h5 id=crossoriginproperties-(-o-)>7.2.3.1 <dfn>CrossOriginProperties</dfn> ( <var>O</var> )<a href=#crossoriginproperties-(-o-) class=self-link></a></h5>

  <ol><li><p>Assert: <var>O</var> is a <code id=crossoriginproperties-(-o-):location><a href=#location>Location</a></code> or <code id=crossoriginproperties-(-o-):window><a href=#window>Window</a></code> object.<li><p>If <var>O</var> is a <code id=crossoriginproperties-(-o-):location-2><a href=#location>Location</a></code> object, then return «
   { [[Property]]: "<code>href</code>", [[NeedsGet]]: false, [[NeedsSet]]: true },
   { [[Property]]: "<code>replace</code>" } ».<li><p>Let <var>crossOriginWindowProperties</var> be «
   { [[Property]]: "<code>window</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>self</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>location</code>", [[NeedsGet]]: true, [[NeedsSet]]: true },
   { [[Property]]: "<code>close</code>" },
   { [[Property]]: "<code>closed</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>focus</code>" },
   { [[Property]]: "<code>blur</code>" },
   { [[Property]]: "<code>frames</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>length</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>top</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>opener</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>parent</code>", [[NeedsGet]]: true, [[NeedsSet]]: false },
   { [[Property]]: "<code>postMessage</code>" } ».<li>
    <p>Repeat for each <var>e</var> that is an element of <var>O</var>'s <a href=#document-tree-child-browsing-context-name-property-set id=crossoriginproperties-(-o-):document-tree-child-browsing-context-name-property-set>document-tree child
    browsing context name property set</a>:</p>

    <ol><li><p>Add { [[Property]]: <var>e</var> } as the last element of
     <var>crossOriginWindowProperties</var>.</ol>
   <li><p>Return <var>crossOriginWindowProperties</var>.</ol>

  <p class=note>Indexed properties do not need to be safelisted as they are handled directly by
  the <code id=crossoriginproperties-(-o-):windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <h5 id=isplatformobjectsameorigin-(-o-)>7.2.3.2 <dfn>IsPlatformObjectSameOrigin</dfn> ( <var>O</var> )<a href=#isplatformobjectsameorigin-(-o-) class=self-link></a></h5>

  <ol><li><p>Return true if the <a href=#current-settings-object id=isplatformobjectsameorigin-(-o-):current-settings-object>current settings object</a>'s <a href=#concept-settings-object-origin id=isplatformobjectsameorigin-(-o-):concept-settings-object-origin>origin</a> is <a href=#same-origin-domain id=isplatformobjectsameorigin-(-o-):same-origin-domain>same origin-domain</a> with
   <var>O</var>'s <a href=#relevant-settings-object id=isplatformobjectsameorigin-(-o-):relevant-settings-object>relevant settings object</a>'s <a href=#concept-settings-object-origin id=isplatformobjectsameorigin-(-o-):concept-settings-object-origin-2>origin</a>, and false otherwise.</ol>

  <h5 id=crossorigingetownpropertyhelper-(-o,-p-)>7.2.3.3 <dfn>CrossOriginGetOwnPropertyHelper</dfn> ( <var>O</var>, <var>P</var> )<a href=#crossorigingetownpropertyhelper-(-o,-p-) class=self-link></a></h5>

  <p class=note>If this abstract operation returns undefined and there is no custom behavior, the
  caller needs to throw a <a id=crossorigingetownpropertyhelper-(-o,-p-):securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=crossorigingetownpropertyhelper-(-o,-p-):domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <ol><li><p>If <var>P</var> is <a href=#@@tostringtag id=crossorigingetownpropertyhelper-(-o,-p-):@@tostringtag>@@toStringTag</a>, <a href=#@@hasinstance id=crossorigingetownpropertyhelper-(-o,-p-):@@hasinstance>@@hasInstance</a>, or
   <a href=#@@isconcatspreadable id=crossorigingetownpropertyhelper-(-o,-p-):@@isconcatspreadable>@@isConcatSpreadable</a>, then return <a id=crossorigingetownpropertyhelper-(-o,-p-):propertydescriptor href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
   [[Value]]: undefined,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: true }.<li><p>Let <var>crossOriginKey</var> be a tuple consisting of the <a href=#current-settings-object id=crossorigingetownpropertyhelper-(-o,-p-):current-settings-object>current settings
   object</a>, <var>O</var>'s <a href=#relevant-settings-object id=crossorigingetownpropertyhelper-(-o,-p-):relevant-settings-object>relevant settings object</a>, and <var>P</var>.<li>
    <p>Repeat for each <var>e</var> that is an element of
    <a href=#crossoriginproperties-(-o-) id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginproperties-(-o-)>CrossOriginProperties</a>(<var>O</var>):</p>

    <ol><li>
      <p>If <a id=crossorigingetownpropertyhelper-(-o,-p-):samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>e</var>.[[Property]], <var>P</var>) is true, then:</p>

      <ol><li><p>If the value of the <a href=#crossoriginpropertydescriptormap id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginpropertydescriptormap>[[CrossOriginPropertyDescriptorMap]]</a> internal slot of
       <var>O</var> contains an entry whose key is <var>crossOriginKey</var>, then return that
       entry's value.<li><p>Let <var>originalDesc</var> be <a id=crossorigingetownpropertyhelper-(-o,-p-):ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<var>O</var>,
       <var>P</var>).<li><p>Let <var>crossOriginDesc</var> be undefined.<li>
        <p>If <var>e</var>.[[NeedsGet]] and <var>e</var>.[[NeedsSet]] are absent, then:</p>

        <ol><li><p>Let <var>value</var> be <var>originalDesc</var>.[[Value]].<li><p>If <a id=crossorigingetownpropertyhelper-(-o,-p-):iscallable href=https://tc39.github.io/ecma262/#sec-iscallable data-x-internal=iscallable>IsCallable</a>(<var>value</var>) is true, then set <var>value</var> to
         an anonymous built-in function, created in the <a id=crossorigingetownpropertyhelper-(-o,-p-):current-realm-record href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>, that
         performs the same steps as the IDL operation <var>P</var> on object <var>O</var>.<li><p>Set <var>crossOriginDesc</var> to <a id=crossorigingetownpropertyhelper-(-o,-p-):propertydescriptor-2 href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
         [[Value]]: <var>value</var>,
         [[Enumerable]]: false,
         [[Writable]]: false,
         [[Configurable]]: true }.</ol>
       <li>
        <p>Otherwise:</p>

        <ol><li><p>Let <var>crossOriginGet</var> be undefined.<li><p>If <var>e</var>.[[NeedsGet]] is true, then set <var>crossOriginGet</var> to an
         anonymous built-in function, created in the <a id=crossorigingetownpropertyhelper-(-o,-p-):current-realm-record-2 href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>, that
         performs the same steps as the getter of the IDL attribute <var>P</var> on object
         <var>O</var>.<li><p>Let <var>crossOriginSet</var> be undefined.<li><p>If <var>e</var>.[[NeedsSet]] is true, then set <var>crossOriginSet</var> to an
         anonymous built-in function, created in the <a id=crossorigingetownpropertyhelper-(-o,-p-):current-realm-record-3 href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>, that
         performs the same steps as the setter of the IDL attribute <var>P</var> on object
         <var>O</var>.<li><p>Set <var>crossOriginDesc</var> to <a id=crossorigingetownpropertyhelper-(-o,-p-):propertydescriptor-3 href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
         [[Get]]: <var>crossOriginGet</var>,
         [[Set]]: <var>crossOriginSet</var>,
         [[Enumerable]]: false,
         [[Configurable]]: true }.</ol>
       <li><p>Create an entry in the value of the <a href=#crossoriginpropertydescriptormap id=crossorigingetownpropertyhelper-(-o,-p-):crossoriginpropertydescriptormap-2>[[CrossOriginPropertyDescriptorMap]]</a>
       internal slot of <var>O</var> with key <var>crossOriginKey</var> and value
       <var>crossOriginDesc</var>.<li><p>Return <var>crossOriginDesc</var>.</ol>
     </ol>
   <li><p>Return undefined.</ol>

  <p class=note>The reason that the property descriptors produced here are configurable is to
  preserve the <a id=crossorigingetownpropertyhelper-(-o,-p-):invariants-of-the-essential-internal-methods href=https://tc39.github.io/ecma262/#sec-invariants-of-the-essential-internal-methods data-x-internal=invariants-of-the-essential-internal-methods>invariants of the essential internal methods</a> required by the JavaScript
  specification. In particular, since the value of the property can change as a consequence of
  navigation, it is required that the property be configurable. (However, see <a href=https://github.com/tc39/ecma262/issues/672>tc39/ecma262 issue #672</a> and references to it
  elsewhere in this specification for cases where we are not able to preserve these invariants, for
  compatibility with existing Web content.) <a href=#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <h5 id=crossoriginget-(-o,-p,-receiver-)>7.2.3.4 <dfn>CrossOriginGet</dfn> ( <var>O</var>, <var>P</var>, <var>Receiver</var> )<a href=#crossoriginget-(-o,-p,-receiver-) class=self-link></a></h5>

  <ol><li><p>Let <var>desc</var> be ? <var>O</var>.[[GetOwnProperty]](<var>P</var>).<li><p>Assert: <var>desc</var> is not undefined.<li><p>If <a id=crossoriginget-(-o,-p,-receiver-):isdatadescriptor href=https://tc39.github.io/ecma262/#sec-isdatadescriptor data-x-internal=isdatadescriptor>IsDataDescriptor</a>(<var>desc</var>) is true, then return
   <var>desc</var>.[[Value]].<li><p>Assert: <a id=crossoriginget-(-o,-p,-receiver-):isaccessordescriptor href=https://tc39.github.io/ecma262/#sec-isaccessordescriptor data-x-internal=isaccessordescriptor>IsAccessorDescriptor</a>(<var>desc</var>) is true.<li><p>Let <var>getter</var> be <var>desc</var>.[[Get]].<li><p>If <var>getter</var> is undefined, throw a <a id=crossoriginget-(-o,-p,-receiver-):securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=crossoriginget-(-o,-p,-receiver-):domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Return ? <a id=crossoriginget-(-o,-p,-receiver-):call href=https://tc39.github.io/ecma262/#sec-call data-x-internal=call>Call</a>(<var>getter</var>, <var>Receiver</var>).</ol>

  <h5 id=crossoriginset-(-o,-p,-v,-receiver-)>7.2.3.5 <dfn>CrossOriginSet</dfn> ( <var>O</var>, <var>P</var>, <var>V</var>,
  <var>Receiver</var> )<a href=#crossoriginset-(-o,-p,-v,-receiver-) class=self-link></a></h5>

  <ol><li><p>Let <var>desc</var> be ? <var>O</var>.[[GetOwnProperty]](<var>P</var>).<li><p>Assert: <var>desc</var> is not undefined.<li>
    <p>If <var>desc</var>.[[Set]] is present and its value is not undefined, then:

    <ol><li><p>Perform ? <a id=crossoriginset-(-o,-p,-v,-receiver-):call href=https://tc39.github.io/ecma262/#sec-call data-x-internal=call>Call</a>(<var>setter</var>, <var>Receiver</var>,
     «<var>V</var>»).<li><p>Return true.</ol>
   <li><p>Throw a <a id=crossoriginset-(-o,-p,-v,-receiver-):securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=crossoriginset-(-o,-p,-v,-receiver-):domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=crossoriginownpropertykeys-(-o-)>7.2.3.6 <dfn>CrossOriginOwnPropertyKeys</dfn> ( <var>O</var> )<a href=#crossoriginownpropertykeys-(-o-) class=self-link></a></h5>

  <ol><li><p>Let <var>keys</var> be a new empty <a href=https://tc39.github.io/ecma262/#sec-list-and-record-specification-type id=crossoriginownpropertykeys-(-o-):js-list data-x-internal=js-list>List</a>.<li>
    <p>Repeat for each <var>e</var> that is an element of
    <a href=#crossoriginproperties-(-o-) id=crossoriginownpropertykeys-(-o-):crossoriginproperties-(-o-)>CrossOriginProperties</a>(<var>O</var>):</p>

    <ol><li><p>Add <var>e</var>.[[Property]] as the last element of <var>keys</var>.</ol>
   <li><p>Return the concatenation of <var>keys</var> and « <a href=#@@tostringtag id=crossoriginownpropertykeys-(-o-):@@tostringtag>@@toStringTag</a>,
   <a href=#@@hasinstance id=crossoriginownpropertykeys-(-o-):@@hasinstance>@@hasInstance</a>, <a href=#@@isconcatspreadable id=crossoriginownpropertykeys-(-o-):@@isconcatspreadable>@@isConcatSpreadable</a> ».</ol>



  <h3 id=the-window-object>7.3 The <code id=the-window-object:window><a href=#window>Window</a></code> object<a href=#the-window-object class=self-link></a></h3>

  <pre class=idl>[PrimaryGlobal, LegacyUnenumerableNamedProperties] 
interface <dfn id=window data-dfn-type=interface data-export="">Window</dfn> : <a id=the-window-object:eventtarget href=https://dom.spec.whatwg.org/#interface-eventtarget data-x-internal=eventtarget>EventTarget</a> {
  // the current browsing context
  [Unforgeable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy>WindowProxy</a> <a href=#dom-window id=the-window-object:dom-window>window</a>;
  [Replaceable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-2>WindowProxy</a> <a href=#dom-self id=the-window-object:dom-self>self</a>;
  [Unforgeable] readonly attribute <a href=#document id=the-window-object:document>Document</a> <a href=#dom-document-2 id=the-window-object:dom-document-2>document</a>;
  attribute DOMString <a href=#dom-name id=the-window-object:dom-name>name</a>; 
  [PutForwards=<a href=#dom-location-href id=the-window-object:dom-location-href>href</a>, Unforgeable] readonly attribute <a href=#location id=the-window-object:location>Location</a> <a href=#dom-location id=the-window-object:dom-location>location</a>;
  readonly attribute <a href=#history-3 id=the-window-object:history-3>History</a> <a href=#dom-history id=the-window-object:dom-history>history</a>;
  readonly attribute <a href=#customelementregistry id=the-window-object:customelementregistry>CustomElementRegistry</a> <a href=#dom-window-customelements id=the-window-object:dom-window-customelements>customElements</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop>BarProp</a> <a href=#dom-window-locationbar id=the-window-object:dom-window-locationbar>locationbar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-2>BarProp</a> <a href=#dom-window-menubar id=the-window-object:dom-window-menubar>menubar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-3>BarProp</a> <a href=#dom-window-personalbar id=the-window-object:dom-window-personalbar>personalbar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-4>BarProp</a> <a href=#dom-window-scrollbars id=the-window-object:dom-window-scrollbars>scrollbars</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-5>BarProp</a> <a href=#dom-window-statusbar id=the-window-object:dom-window-statusbar>statusbar</a>;
  [Replaceable] readonly attribute <a href=#barprop id=the-window-object:barprop-6>BarProp</a> <a href=#dom-window-toolbar id=the-window-object:dom-window-toolbar>toolbar</a>;
  attribute DOMString <a href=#dom-window-status id=the-window-object:dom-window-status>status</a>;
  void <a href=#dom-window-close id=the-window-object:dom-window-close>close</a>();
  readonly attribute boolean <a href=#dom-window-closed id=the-window-object:dom-window-closed>closed</a>;
  void <a href=#dom-window-stop id=the-window-object:dom-window-stop>stop</a>();
  void <a href=#dom-window-focus id=the-window-object:dom-window-focus>focus</a>();
  void <a href=#dom-window-blur id=the-window-object:dom-window-blur>blur</a>();

  // other browsing contexts
  [Replaceable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-3>WindowProxy</a> <a href=#dom-frames id=the-window-object:dom-frames>frames</a>;
  [Replaceable] readonly attribute unsigned long <a href=#dom-length id=the-window-object:dom-length>length</a>;
  [Unforgeable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-4>WindowProxy</a>? <a href=#dom-top id=the-window-object:dom-top>top</a>;
  attribute any <a href=#dom-opener id=the-window-object:dom-opener>opener</a>;
  [Replaceable] readonly attribute <a href=#windowproxy id=the-window-object:windowproxy-5>WindowProxy</a>? <a href=#dom-parent id=the-window-object:dom-parent>parent</a>;
  readonly attribute <a id=the-window-object:element href=https://dom.spec.whatwg.org/#interface-element data-x-internal=element>Element</a>? <a href=#dom-frameelement id=the-window-object:dom-frameelement>frameElement</a>;
  <a href=#windowproxy id=the-window-object:windowproxy-6>WindowProxy</a>? <a href=#dom-open id=the-window-object:dom-open>open</a>(optional USVString url = "about:blank", optional DOMString target = "_blank", [TreatNullAs=EmptyString] optional DOMString features = "");
  <a href=#dom-window-nameditem>getter</a> <a href=https://heycam.github.io/webidl/#idl-object id=the-window-object:idl-object data-x-internal=idl-object>object</a> (DOMString name);
  // Since this is the global object, the IDL named getter adds a NamedPropertiesObject exotic
  // object on the prototype chain. Indeed, this does not make the global object an exotic object.
  // Indexed access is taken care of by the <a href=#windowproxy id=the-window-object:windowproxy-7>WindowProxy</a> exotic object.

  // the user agent
  readonly attribute <a href=#navigator id=the-window-object:navigator>Navigator</a> <a href=#dom-navigator id=the-window-object:dom-navigator>navigator</a>; 
  readonly attribute <a href=#applicationcache id=the-window-object:applicationcache>ApplicationCache</a> <a href=#dom-applicationcache id=the-window-object:dom-applicationcache>applicationCache</a>;

  // user prompts
  void <a href=#dom-alert id=the-window-object:dom-alert>alert</a>();
  void <a href=#dom-alert id=the-window-object:dom-alert-2>alert</a>(DOMString message);
  boolean <a href=#dom-confirm id=the-window-object:dom-confirm>confirm</a>(optional DOMString message = "");
  DOMString? <a href=#dom-prompt id=the-window-object:dom-prompt>prompt</a>(optional DOMString message = "", optional DOMString default = "");
  void <a href=#dom-print id=the-window-object:dom-print>print</a>();

  unsigned long <a href=#dom-window-requestanimationframe id=the-window-object:dom-window-requestanimationframe>requestAnimationFrame</a>(<a href=#framerequestcallback id=the-window-object:framerequestcallback>FrameRequestCallback</a> callback);
  void <a href=#dom-window-cancelanimationframe id=the-window-object:dom-window-cancelanimationframe>cancelAnimationFrame</a>(unsigned long handle);

  void <a href=#dom-window-postmessage id=the-window-object:dom-window-postmessage>postMessage</a>(any message, USVString targetOrigin, optional sequence&lt;<a href=https://heycam.github.io/webidl/#idl-object id=the-window-object:idl-object-2 data-x-internal=idl-object>object</a>> transfer = []);

  // <a href="#Window-partial">also has obsolete members</a>
};
<a href=#window id=the-window-object:window-2>Window</a> implements <a href=#globaleventhandlers id=the-window-object:globaleventhandlers>GlobalEventHandlers</a>;
<a href=#window id=the-window-object:window-3>Window</a> implements <a href=#windoweventhandlers id=the-window-object:windoweventhandlers>WindowEventHandlers</a>;

callback <dfn id=framerequestcallback>FrameRequestCallback</dfn> = void (<a id=the-window-object:domhighrestimestamp href=https://w3c.github.io/hr-time/#dom-domhighrestimestamp data-x-internal=domhighrestimestamp>DOMHighResTimeStamp</a> time);</pre>



  <dl class=domintro><dt><var>window</var> . <code id=the-window-object:dom-window-2><a href=#dom-window>window</a></code><dt><var>window</var> . <code id=the-window-object:dom-frames-2><a href=#dom-frames>frames</a></code><dt><var>window</var> . <code id=the-window-object:dom-self-2><a href=#dom-self>self</a></code><dd>

    <p>These attributes all return <var>window</var>.</p>

   <dt><var>window</var> . <code id=the-window-object:dom-document-2-2><a href=#dom-document-2>document</a></code><dd>

    <p>Returns the <code id=the-window-object:document-2><a href=#document>Document</a></code> associated with <var>window</var>.</p>

   <dt><var>document</var> . <code id=the-window-object:dom-document-defaultview><a href=#dom-document-defaultview>defaultView</a></code><dd>

    <p>Returns the <code id=the-window-object:window-4><a href=#window>Window</a></code> object of the <a href=#active-document id=the-window-object:active-document>active document</a>.</p>

   </dl>

  

  <p>The <code id=the-window-object:window-5><a href=#window>Window</a></code> has an <dfn id=concept-document-window data-export="">associated
  <code>Document</code></dfn>, which is a <code id=the-window-object:document-3><a href=#document>Document</a></code> object. It is set when the
  <code id=the-window-object:window-6><a href=#window>Window</a></code> object is created, and only ever changed during <a href=#navigate id=the-window-object:navigate>navigation</a> from the initial <code id=the-window-object:about:blank><a href=#about:blank>about:blank</a></code>
  <code id=the-window-object:document-4><a href=#document>Document</a></code>.</p>

  <p>The <dfn id=dom-window><code>window</code></dfn>, <dfn id=dom-frames><code>frames</code></dfn>, and <dfn id=dom-self><code>self</code></dfn> IDL
  attributes, on getting, must all return this <code id=the-window-object:window-7><a href=#window>Window</a></code> object's <a href=#browsing-context id=the-window-object:browsing-context>browsing
  context</a>'s <code id=the-window-object:windowproxy-8><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <p>The <dfn id=dom-document-2><code>document</code></dfn> IDL attribute, on getting, must
  return this <code id=the-window-object:window-8><a href=#window>Window</a></code> object's <a href=#concept-document-window id=the-window-object:concept-document-window>associated
  <code>Document</code></a>.</p>

  <p class=note>The <code id=the-window-object:document-5><a href=#document>Document</a></code> object associated with a <code id=the-window-object:window-9><a href=#window>Window</a></code> object can
  change in exactly one case: when the <a href=#navigate id=the-window-object:navigate-2>navigate</a> algorithm <a href=#initialise-the-document-object id=the-window-object:initialise-the-document-object>initializes a new <code>Document</code> object</a> for the first page loaded
  in a <a href=#browsing-context id=the-window-object:browsing-context-2>browsing context</a>. In that specific case, the <code id=the-window-object:window-10><a href=#window>Window</a></code> object of the
  original <code id=the-window-object:about:blank-2><a href=#about:blank>about:blank</a></code> page is reused and gets a new <code id=the-window-object:document-6><a href=#document>Document</a></code> object.</p>

  <p>The <dfn id=dom-document-defaultview><code>defaultView</code></dfn> IDL attribute of the
  <code id=the-window-object:document-7><a href=#document>Document</a></code> interface, on getting, must return this <code id=the-window-object:document-8><a href=#document>Document</a></code>'s <a href=#concept-document-bc id=the-window-object:concept-document-bc>browsing context</a>'s <code id=the-window-object:windowproxy-9><a href=#windowproxy>WindowProxy</a></code> object, if this
  <code id=the-window-object:document-9><a href=#document>Document</a></code> has an associated browsing context, or null otherwise.</p>

  <hr>

  <p>For historical reasons, <code id=the-window-object:window-11><a href=#window>Window</a></code> objects must also have a writable, configurable,
  non-enumerable property named <dfn id=htmldocument><code>HTMLDocument</code></dfn> whose value is the
  <code id=the-window-object:document-10><a href=#document>Document</a></code> <a id=the-window-object:interface-object href=https://heycam.github.io/webidl/#dfn-interface-object data-x-internal=interface-object>interface object</a>.</p>

  


  <h4 id=apis-for-creating-and-navigating-browsing-contexts-by-name>7.3.1 APIs for creating and navigating browsing contexts by name<a href=#apis-for-creating-and-navigating-browsing-contexts-by-name class=self-link></a></h4>

  <dl class=domintro><dt><var>window</var> = <var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open><a href=#dom-open>open</a></code>( [ <var>url</var> [, <var>target</var> [, <var>features</var> ] ] ] )<dd>

    <p>Opens a window to show <var>url</var> (defaults to <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank><a href=#about:blank>about:blank</a></code>), and returns it.
    The <var>target</var> argument gives the name of the new window. If a window exists with that
    name already, it is reused. The <var id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-features><a data-x-internal=dom-open-features href=https://drafts.csswg.org/cssom-view/#the-features-argument-to-the-open()-method>features</a></var> argument can be
    used to influence the rendering of the new window.</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-name><a href=#dom-name>name</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the name of the window.</p>

    <p>Can be set, to change the name.</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-close><a href=#dom-window-close>close</a></code>()<dd>

    <p>Closes the window.</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-closed><a href=#dom-window-closed>closed</a></code><dd>

    <p>Returns true if the window has been closed, false otherwise.</p>

   <dt><var>window</var> . <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-stop><a href=#dom-window-stop>stop</a></code>()<dd>

    <p>Cancels the document load.</p>

   </dl>

  

  <p>The <dfn id=dom-open><code>open(<var>url</var>, <var>target</var>,
  <var>features</var>)</code></dfn> method on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window><a href=#window>Window</a></code> objects provides a mechanism for
  <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate>navigating</a> an existing <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context>browsing context</a> or opening and
  navigating an <a href=#auxiliary-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:auxiliary-browsing-context>auxiliary browsing context</a>.</p>

  <p>When the method is invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>entry settings</var> be the <a href=#entry-settings-object id=apis-for-creating-and-navigating-browsing-contexts-by-name:entry-settings-object>entry settings object</a>.<li><p>Let <var>source browsing context</var> be the <a href=#responsible-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context>responsible browsing context</a>
   specified by <var>entry settings</var>.<li><p>If <var>target</var> is the empty string, let it be the string "<code>_blank</code>" instead.<li>

    <p>If the user has indicated a preference for which <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-2>browsing context</a> to navigate,
    follow these substeps:</p>

    <ol><li><p>Let <var>target browsing context</var> be the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-3>browsing context</a> indicated by
     the user.<li><p>If <var>target browsing context</var> is a new <a href=#top-level-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context>top-level browsing context</a>,
     let the <var>source browsing context</var> be set as <var>target browsing context</var>'s
     <a href=#one-permitted-sandboxed-navigator id=apis-for-creating-and-navigating-browsing-contexts-by-name:one-permitted-sandboxed-navigator>one permitted sandboxed navigator</a>.</ol>

    <p class=example>For example, suppose there is a user agent that supports control-clicking a
    link to open it in a new tab. If a user clicks in that user agent on an element whose <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:handler-onclick><a href=#handler-onclick>onclick</a></code> handler uses the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-2><a href=#dom-open>window.open()</a></code> API to open a page in an iframe, but, while doing so,
    holds the control key down, the user agent could override the selection of the target browsing
    context to instead target a new tab.</p>

    <p>Otherwise, apply <a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>the rules for choosing a browsing context given a browsing context
    name</a> using <var>target</var> as the name and <var>source browsing context</var> as the
    context in which the algorithm is executed. If this results in there not being a chosen browsing
    context, then return null. Otherwise, let <var>target browsing context</var> be the
    <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-4>browsing context</a> so obtained.</p>

   <li><p>If <var>target browsing context</var> was just created, either as part of <a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name-2>the rules
   for choosing a browsing context given a browsing context name</a> or due to the user
   indicating a preference for navigating a new <a href=#top-level-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context-2>top-level browsing context</a>, then let
   <var>new</var> be true. Otherwise, let it be false.<li><p>Interpret <var>features</var> <a href=https://drafts.csswg.org/cssom-view/#the-features-argument-to-the-open()-method id=apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-features-2 data-x-internal=dom-open-features>as defined in the CSSOM
   View specification</a>. <a href=#refsCSSOMVIEW>[CSSOMVIEW]</a><li>

    <p>If <var>url</var> is the empty string, run the appropriate steps from the following list:</p>

    <dl><dt>If <var>new</var> is false<dd><p>Jump to the step labeled <i>end</i>.<dt>If <var>new</var> is true<dd><p>Let <var>resource</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> "<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-2><a href=#about:blank>about:blank</a></code>".</dl>

    <p>Otherwise, <a href=#parse-a-url id=apis-for-creating-and-navigating-browsing-contexts-by-name:parse-a-url>parse</a> <var>url</var> relative to <var>entry
    settings</var>, and let <var>resource</var> be the <a href=#resulting-url-record id=apis-for-creating-and-navigating-browsing-contexts-by-name:resulting-url-record>resulting URL record</a>, if any. If
    the <a href=#parse-a-url id=apis-for-creating-and-navigating-browsing-contexts-by-name:parse-a-url-2>parse a URL</a> algorithm failed, then run one of the following two steps
    instead:</p>

    <ul><li><p>Let <var>resource</var> be a resource representing an inline error page.<li><p>If <var>new</var> is false, jump to the step labeled <i>end</i>, otherwise, let
     <var>resource</var> be the <a id=apis-for-creating-and-navigating-browsing-contexts-by-name:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> "<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-3><a href=#about:blank>about:blank</a></code>".</ul>

   <li>

    <p>If <var>resource</var> is "<code id=apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-4><a href=#about:blank>about:blank</a></code>" and <var>new</var> is true, then
    <a href=#queue-a-task id=apis-for-creating-and-navigating-browsing-contexts-by-name:queue-a-task>queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=apis-for-creating-and-navigating-browsing-contexts-by-name:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:event-load><a href=#event-load>load</a></code> at <var>target browsing context</var>'s <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-2><a href=#window>Window</a></code>
    object, with <var>legacy target override flag</var> set.</p>

    <p>Otherwise, <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-2>navigate</a> <var>target browsing context</var>
    to <var>resource</var>, with the <var><a href=#exceptions-enabled id=apis-for-creating-and-navigating-browsing-contexts-by-name:exceptions-enabled>exceptions enabled flag</a></var> set. If
    <var>new</var> is true, then <a href=#replacement-enabled id=apis-for-creating-and-navigating-browsing-contexts-by-name:replacement-enabled>replacement must be
    enabled</a>. The <a href=#source-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:source-browsing-context>source browsing context</a> is <var>source browsing context</var>.
    Rethrow any exceptions.</p>

   <li>
    <p><i>End</i>:</p>

    <ol><li><p>If the result of <a href=#split-a-string-on-commas id=apis-for-creating-and-navigating-browsing-contexts-by-name:split-a-string-on-commas>splitting <var>features</var>
     on commas</a> contains the token "<code>noopener</code>", then <a href=#disowned-its-opener id=apis-for-creating-and-navigating-browsing-contexts-by-name:disowned-its-opener>disown <var>target browsing context</var>'s opener</a> and
     return null.<li><p>Otherwise, return the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of <var>target browsing
     context</var>.</ol>

   </ol>

  <hr>

  <p>The <dfn id=dom-name><code>name</code></dfn> attribute of the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-3><a href=#window>Window</a></code> object
  must, on getting, return the current <a href=#browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-name>name</a> of the
  <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-5>browsing context</a>; and, on setting, set the <a href=#browsing-context-name id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-name-2>name</a> of the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-6>browsing context</a> to the new value.</p>

  <p class=note>The name <a href=#resetBCName>gets reset</a> when the browsing context is
  <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-3>navigated</a> to another <a href=#concept-origin id=apis-for-creating-and-navigating-browsing-contexts-by-name:concept-origin>origin</a>.</p>

  <hr>

  <p>The <dfn id=dom-window-close><code>close()</code></dfn> method on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-4><a href=#window>Window</a></code>
  objects should, if all the following conditions are met, <a href=#close-a-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:close-a-browsing-context>close</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-7>browsing context</a> <var>A</var>:

  <ul class=brief><li>The corresponding <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-8>browsing context</a> <var>A</var> is
   <a href=#script-closable id=apis-for-creating-and-navigating-browsing-contexts-by-name:script-closable>script-closable</a>.<li>The <a href=#responsible-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context-2>responsible browsing context</a> specified by the <a href=#incumbent-settings-object id=apis-for-creating-and-navigating-browsing-contexts-by-name:incumbent-settings-object>incumbent settings
   object</a> is <a href=#familiar-with id=apis-for-creating-and-navigating-browsing-contexts-by-name:familiar-with>familiar with</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-9>browsing context</a> <var>A</var>.<li id=sandboxClose>The <a href=#responsible-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context-3>responsible browsing context</a> specified by the
   <a href=#incumbent-settings-object id=apis-for-creating-and-navigating-browsing-contexts-by-name:incumbent-settings-object-2>incumbent settings object</a> is <a href=#allowed-to-navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:allowed-to-navigate>allowed to navigate</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-10>browsing
   context</a> <var>A</var>.</ul>

  <p>A <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-11>browsing context</a> is <dfn id=script-closable>script-closable</dfn> if it is an <a href=#auxiliary-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:auxiliary-browsing-context-2>auxiliary
  browsing context</a> that was created by a script (as opposed to by an action of the user), or
  if it is a <a href=#top-level-browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context-3>top-level browsing context</a> whose <a href=#session-history id=apis-for-creating-and-navigating-browsing-contexts-by-name:session-history>session history</a> contains
  only one <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:document><a href=#document>Document</a></code>.</p>

  <p>The <dfn id=dom-window-closed><code>closed</code></dfn> attribute on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-5><a href=#window>Window</a></code>
  objects must return true if the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-6><a href=#window>Window</a></code> object's <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-12>browsing context</a> has
  been <a href=#a-browsing-context-is-discarded id=apis-for-creating-and-navigating-browsing-contexts-by-name:a-browsing-context-is-discarded>discarded</a>, and false otherwise.</p>

  <p>The <dfn id=dom-window-stop><code>stop()</code></dfn> method on <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-7><a href=#window>Window</a></code>
  objects should, if there is an existing attempt to <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-4>navigate</a> the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-13>browsing
  context</a> and that attempt is not currently running the <a href=#unload-a-document id=apis-for-creating-and-navigating-browsing-contexts-by-name:unload-a-document>unload a document</a>
  algorithm, cancel that <a href=#navigate id=apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-5>navigation</a>; then, it must <a href=#abort-a-document id=apis-for-creating-and-navigating-browsing-contexts-by-name:abort-a-document>abort</a> the <a href=#active-document id=apis-for-creating-and-navigating-browsing-contexts-by-name:active-document>active document</a> of the <a href=#browsing-context id=apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-14>browsing
  context</a> of the <code id=apis-for-creating-and-navigating-browsing-contexts-by-name:window-8><a href=#window>Window</a></code> object on which it was invoked.</p>

  


  <h4 id=accessing-other-browsing-contexts>7.3.2 Accessing other browsing contexts<a href=#accessing-other-browsing-contexts class=self-link></a></h4>

  <dl class=domintro><dt><var>window</var> . <code id=accessing-other-browsing-contexts:dom-length><a href=#dom-length>length</a></code><dd>

    <p>Returns the number of <a href=#document-tree-child-browsing-context id=accessing-other-browsing-contexts:document-tree-child-browsing-context>document-tree child browsing contexts</a>.</p>

   <dt><var>window</var>[<var>index</var>]<dd>

    <p>Returns the indicated <a href=#document-tree-child-browsing-context id=accessing-other-browsing-contexts:document-tree-child-browsing-context-2>document-tree child browsing context</a>.</p>

   </dl>

  

  <p id=number-of-child-browsing-contexts>The <dfn id=number-of-document-tree-child-browsing-contexts>number of document-tree child browsing
  contexts</dfn> of a <code id=accessing-other-browsing-contexts:window><a href=#window>Window</a></code> object <var>W</var> is the number of <a href=#document-tree-child-browsing-context id=accessing-other-browsing-contexts:document-tree-child-browsing-context-3>document-tree child browsing contexts</a> of
  <var>W</var>'s <a href=#concept-document-window id=accessing-other-browsing-contexts:concept-document-window>associated <code>Document</code></a>'s
  <a href=#concept-document-bc id=accessing-other-browsing-contexts:concept-document-bc>browsing context</a>.</p>

  <p>The <dfn id=dom-length><code>length</code></dfn> IDL attribute's getter must return the
  <a href=#number-of-document-tree-child-browsing-contexts id=accessing-other-browsing-contexts:number-of-document-tree-child-browsing-contexts>number of document-tree child browsing contexts</a> of this <code id=accessing-other-browsing-contexts:window-2><a href=#window>Window</a></code>
  object.</p>

  <p class=note>Indexed access to <a href=#document-tree-child-browsing-context id=accessing-other-browsing-contexts:document-tree-child-browsing-context-4>document-tree child browsing contexts</a> is defined through the <a href=#windowproxy-getownproperty>[[GetOwnProperty]]</a> internal method of the
  <code id=accessing-other-browsing-contexts:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.</p>

  



  <h4 id=named-access-on-the-window-object>7.3.3 Named access on the <code id=named-access-on-the-window-object:window><a href=#window>Window</a></code> object<a href=#named-access-on-the-window-object class=self-link></a></h4>

  <dl class=domintro><dt><var>window</var>[<var>name</var>]<dd>

    <p>Returns the indicated element or collection of elements.</p>

    <p>As a general rule, relying on this will lead to brittle code. Which IDs end up mapping to
    this API can vary over time, as new features are added to the Web platform, for example. Instead
    of this, use <code>document.getElementById()</code> or <code>document.querySelector()</code>.</p>

   </dl>

  

  <p id=child-browsing-context-name-property-set>The <dfn id=document-tree-child-browsing-context-name-property-set>document-tree child browsing context
  name property set</dfn> of a <code id=named-access-on-the-window-object:window-2><a href=#window>Window</a></code> object <var>window</var> is the return value of
  running these steps:</p>

  <ol><li><p>Let <var>activeDocument</var> be <var>window</var>'s <a href=#browsing-context id=named-access-on-the-window-object:browsing-context>browsing context</a>'s
   <a href=#active-document id=named-access-on-the-window-object:active-document>active document</a>.<li><p>Let <var>childBrowsingContexts</var> be all <a href=#document-tree-child-browsing-context id=named-access-on-the-window-object:document-tree-child-browsing-context>document-tree child browsing contexts</a> of <var>activeDocument</var>'s <a href=#concept-document-bc id=named-access-on-the-window-object:concept-document-bc>browsing context</a> whose <a href=#browsing-context-name id=named-access-on-the-window-object:browsing-context-name>browsing context name</a> is
   not the empty string, in order, and including only the first <a href=#document-tree-child-browsing-context id=named-access-on-the-window-object:document-tree-child-browsing-context-2>document-tree child browsing
   context</a> with a given <a href=#browsing-context-name id=named-access-on-the-window-object:browsing-context-name-2>name</a> if multiple <a href=#document-tree-child-browsing-context id=named-access-on-the-window-object:document-tree-child-browsing-context-3>document-tree child browsing contexts</a> have
   the same one.<li><p>Remove each <a href=#browsing-context id=named-access-on-the-window-object:browsing-context-2>browsing context</a> from <var>childBrowsingContexts</var> whose
   <a href=#active-document id=named-access-on-the-window-object:active-document-2>active document</a>'s <a href=#concept-origin id=named-access-on-the-window-object:concept-origin>origin</a> is not <a href=#same-origin id=named-access-on-the-window-object:same-origin>same origin</a> with
   <var>activeDocument</var>'s <a href=#concept-origin id=named-access-on-the-window-object:concept-origin-2>origin</a> and whose <a href=#browsing-context-name id=named-access-on-the-window-object:browsing-context-name-3>browsing context name</a> does
   not match the name of its <a href=#browsing-context-container id=named-access-on-the-window-object:browsing-context-container>browsing context container</a>'s <code>name</code>
   content attribute value.<li><p>Return the <a href=#browsing-context-name id=named-access-on-the-window-object:browsing-context-name-4>browsing context names</a> of
   <var>childBrowsingContexts</var>, in the same order.</ol>

  <div class=example>
   <p>This means that in the following example, hosted on <code>https://example.org/</code>, assuming <code>https://elsewhere.example/</code>
   sets <code id=named-access-on-the-window-object:dom-name><a href=#dom-name>window.name</a></code> to "<code>spices</code>", evaluating
   <code>window.spices</code> after everything has loaded will yield undefined:</p>

   <pre>&lt;iframe src=https://elsewhere.example.com/>&lt;/iframe>
&lt;iframe name=spices>&lt;/iframe></pre>
  </div>

  <p>The <code id=named-access-on-the-window-object:window-3><a href=#window>Window</a></code> object <a href=https://heycam.github.io/webidl/#dfn-support-named-properties id=named-access-on-the-window-object:support-named-properties data-x-internal=support-named-properties>supports named
  properties</a>. The <a id=named-access-on-the-window-object:supported-property-names href=https://heycam.github.io/webidl/#dfn-supported-property-names data-x-internal=supported-property-names>supported property names</a> of a <code id=named-access-on-the-window-object:window-4><a href=#window>Window</a></code> object
  <var>window</var> at any moment consist of the following, in <a id=named-access-on-the-window-object:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> according to
  the element that contributed them, ignoring later duplicates:</p>

  <ul><li><p><var>window</var>'s <a href=#document-tree-child-browsing-context-name-property-set id=named-access-on-the-window-object:document-tree-child-browsing-context-name-property-set>document-tree child browsing context name property
   set</a>;<li><p>the value of the <code>name</code> content attribute for all
   <code id=named-access-on-the-window-object:the-applet-element><a href=#the-applet-element>applet</a></code>, <code id=named-access-on-the-window-object:the-embed-element><a href=#the-embed-element>embed</a></code>, <code id=named-access-on-the-window-object:the-form-element><a href=#the-form-element>form</a></code>, <code id=named-access-on-the-window-object:frameset><a href=#frameset>frameset</a></code>,
   <code id=named-access-on-the-window-object:the-img-element><a href=#the-img-element>img</a></code>, and <code id=named-access-on-the-window-object:the-object-element><a href=#the-object-element>object</a></code> elements that have a non-empty <code>name</code> content attribute and are <a id=named-access-on-the-window-object:in-a-document-tree href=https://dom.spec.whatwg.org/#in-a-document-tree data-x-internal=in-a-document-tree>in a document tree</a> with
   <var>window</var>'s <a href=#browsing-context id=named-access-on-the-window-object:browsing-context-3>browsing context</a>'s <a href=#active-document id=named-access-on-the-window-object:active-document-3>active document</a> as their
   <a id=named-access-on-the-window-object:root href=https://dom.spec.whatwg.org/#concept-tree-root data-x-internal=root>root</a>; and<li><p>the value of the <code id=named-access-on-the-window-object:the-id-attribute><a href=#the-id-attribute>id</a></code> content attribute for all <a href=#html-elements id=named-access-on-the-window-object:html-elements>HTML
   elements</a> that have a non-empty <code id=named-access-on-the-window-object:the-id-attribute-2><a href=#the-id-attribute>id</a></code> content attribute and are
   <a id=named-access-on-the-window-object:in-a-document-tree-2 href=https://dom.spec.whatwg.org/#in-a-document-tree data-x-internal=in-a-document-tree>in a document tree</a> with <var>window</var>'s <a href=#browsing-context id=named-access-on-the-window-object:browsing-context-4>browsing context</a>'s
   <a href=#active-document id=named-access-on-the-window-object:active-document-4>active document</a> as their <a id=named-access-on-the-window-object:root-2 href=https://dom.spec.whatwg.org/#concept-tree-root data-x-internal=root>root</a>.</ul>

  <p id=dom-window-nameditem>To <a id=named-access-on-the-window-object:determine-the-value-of-a-named-property href=https://heycam.github.io/webidl/#dfn-determine-the-value-of-a-named-property data-x-internal=determine-the-value-of-a-named-property>determine the value of a named property</a>
  <var>name</var> in a <code id=named-access-on-the-window-object:window-5><a href=#window>Window</a></code>, the user agent must return the value obtained using the
  following steps:</p>

  <ol><li>

    <p>Let <var>objects</var> be the list of <a href=#dom-window-nameditem-filter id=named-access-on-the-window-object:dom-window-nameditem-filter>named
    objects</a> with the name <var>name</var>.</p>

    <p class=note>There will be at least one such object, by definition.</p>

   <li>

    <p>If <var>objects</var> contains a <a href=#nested-browsing-context id=named-access-on-the-window-object:nested-browsing-context>nested browsing context</a>, then return
    the <code id=named-access-on-the-window-object:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of the <a href=#nested-browsing-context id=named-access-on-the-window-object:nested-browsing-context-2>nested browsing context</a> corresponding to
    the first <a href=#browsing-context-container id=named-access-on-the-window-object:browsing-context-container-2>browsing context container</a> in <a id=named-access-on-the-window-object:tree-order-2 href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> whose
    <a href=#nested-browsing-context id=named-access-on-the-window-object:nested-browsing-context-3>nested browsing context</a> is in <var>objects</var>, and abort these steps.</p>

   <li>

    <p>Otherwise, if <var>objects</var> has only one element, return that element and
    abort these steps.</p>

   <li>

    <p>Otherwise return an <code id=named-access-on-the-window-object:htmlcollection><a data-x-internal=htmlcollection href=https://dom.spec.whatwg.org/#interface-htmlcollection>HTMLCollection</a></code> rooted at the <code id=named-access-on-the-window-object:document><a href=#document>Document</a></code> node,
    whose filter matches only <a href=#dom-window-nameditem-filter id=named-access-on-the-window-object:dom-window-nameditem-filter-2>named objects</a> with
    the name <var>name</var>. (By definition, these will all be elements.)</p> 

   </ol>

  <p><dfn id=dom-window-nameditem-filter>Named objects</dfn> with the name <var>name</var>,
  for the purposes of the above algorithm, consist of the following:</p>

  <ul><li><p><a href=#document-tree-child-browsing-context id=named-access-on-the-window-object:document-tree-child-browsing-context-4>document-tree child browsing
   contexts</a> of the <a href=#active-document id=named-access-on-the-window-object:active-document-5>active document</a> whose name is <var>name</var>;<li><p><code id=named-access-on-the-window-object:the-a-element><a href=#the-a-element>a</a></code>, <code id=named-access-on-the-window-object:the-applet-element-2><a href=#the-applet-element>applet</a></code>, <code id=named-access-on-the-window-object:the-area-element><a href=#the-area-element>area</a></code>, <code id=named-access-on-the-window-object:the-embed-element-2><a href=#the-embed-element>embed</a></code>,
   <code id=named-access-on-the-window-object:the-form-element-2><a href=#the-form-element>form</a></code>, <code id=named-access-on-the-window-object:frameset-2><a href=#frameset>frameset</a></code>, <code id=named-access-on-the-window-object:the-img-element-2><a href=#the-img-element>img</a></code>, or <code id=named-access-on-the-window-object:the-object-element-2><a href=#the-object-element>object</a></code> elements that
   have a <code>name</code> content attribute whose value is <var>name</var> and are
   <a id=named-access-on-the-window-object:in-a-document-tree-3 href=https://dom.spec.whatwg.org/#in-a-document-tree data-x-internal=in-a-document-tree>in a document tree</a> with the <a href=#active-document id=named-access-on-the-window-object:active-document-6>active document</a> as their
   <a id=named-access-on-the-window-object:root-3 href=https://dom.spec.whatwg.org/#concept-tree-root data-x-internal=root>root</a>; and<li><p><a href=#html-elements id=named-access-on-the-window-object:html-elements-2>HTML elements</a> that have an <code id=named-access-on-the-window-object:the-id-attribute-3><a href=#the-id-attribute>id</a></code> content attribute
   whose value is <var>name</var> and are <a id=named-access-on-the-window-object:in-a-document-tree-4 href=https://dom.spec.whatwg.org/#in-a-document-tree data-x-internal=in-a-document-tree>in a document tree</a> with the <a href=#active-document id=named-access-on-the-window-object:active-document-7>active
   document</a> as their <a id=named-access-on-the-window-object:root-4 href=https://dom.spec.whatwg.org/#concept-tree-root data-x-internal=root>root</a>.</ul>

  


  

  <h4 id=garbage-collection-and-browsing-contexts>7.3.4 Garbage collection and browsing contexts<a href=#garbage-collection-and-browsing-contexts class=self-link></a></h4>

  <p>A <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context>browsing context</a> has a strong reference to each of its <code id=garbage-collection-and-browsing-contexts:document><a href=#document>Document</a></code>s
  and its <code id=garbage-collection-and-browsing-contexts:windowproxy><a href=#windowproxy>WindowProxy</a></code> object, and the user agent itself has a strong reference to its
  <a href=#top-level-browsing-context id=garbage-collection-and-browsing-contexts:top-level-browsing-context>top-level browsing contexts</a>.</p>

  <p>A <code id=garbage-collection-and-browsing-contexts:document-2><a href=#document>Document</a></code> has a strong reference to its <code id=garbage-collection-and-browsing-contexts:window><a href=#window>Window</a></code> object.</p>

  <p class=note>A <code id=garbage-collection-and-browsing-contexts:window-2><a href=#window>Window</a></code> object <a href=#implied-strong-reference id=garbage-collection-and-browsing-contexts:implied-strong-reference>has a strong
  reference</a> to its <code id=garbage-collection-and-browsing-contexts:document-3><a href=#document>Document</a></code> object through its <code id=garbage-collection-and-browsing-contexts:dom-document-2><a href=#dom-document-2>document</a></code> attribute. Thus, references from other scripts to either of
  those objects will keep both alive. Similarly, both <code id=garbage-collection-and-browsing-contexts:document-4><a href=#document>Document</a></code> and <code id=garbage-collection-and-browsing-contexts:window-3><a href=#window>Window</a></code>
  objects have <a href=#implied-strong-reference id=garbage-collection-and-browsing-contexts:implied-strong-reference-2>implied strong references</a> to the
  <code id=garbage-collection-and-browsing-contexts:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object.</p>

  <p>Each <a href=#concept-script id=garbage-collection-and-browsing-contexts:concept-script>script</a> has a strong reference to its <a href=#settings-object id=garbage-collection-and-browsing-contexts:settings-object>settings
  object</a>, and each <a href=#environment-settings-object id=garbage-collection-and-browsing-contexts:environment-settings-object>environment settings object</a> has strong references to its
  <a href=#concept-settings-object-global id=garbage-collection-and-browsing-contexts:concept-settings-object-global>global object</a>, <a href=#responsible-browsing-context id=garbage-collection-and-browsing-contexts:responsible-browsing-context>responsible browsing
  context</a>, and <a href=#responsible-document id=garbage-collection-and-browsing-contexts:responsible-document>responsible document</a> (if any).</p>

  
  <p>When a <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-2>browsing context</a> is to <dfn id=discard-a-document data-export="">discard a
  <code>Document</code></dfn>, the user agent must run the following steps:</p>

  <ol><li><p>Set the <code id=garbage-collection-and-browsing-contexts:document-5><a href=#document>Document</a></code>'s <i id=garbage-collection-and-browsing-contexts:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state to false.<li><p>Run any <a href=#unloading-document-cleanup-steps id=garbage-collection-and-browsing-contexts:unloading-document-cleanup-steps>unloading document cleanup steps</a> for the <code id=garbage-collection-and-browsing-contexts:document-6><a href=#document>Document</a></code> that
   are defined by this specification and <a href=#other-applicable-specifications id=garbage-collection-and-browsing-contexts:other-applicable-specifications>other applicable specifications</a>.<li><p><a href=#abort-a-document id=garbage-collection-and-browsing-contexts:abort-a-document>Abort the <code>Document</code></a>.<li><p>Remove any <a href=#concept-task id=garbage-collection-and-browsing-contexts:concept-task>tasks</a> associated with the
   <code id=garbage-collection-and-browsing-contexts:document-7><a href=#document>Document</a></code> in any <a href=#task-source id=garbage-collection-and-browsing-contexts:task-source>task source</a>, without running those tasks.<li><p><a href=#a-browsing-context-is-discarded id=garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded>Discard</a> all the <a href=#child-browsing-context id=garbage-collection-and-browsing-contexts:child-browsing-context>child browsing contexts</a> of the <code id=garbage-collection-and-browsing-contexts:document-8><a href=#document>Document</a></code>.<li><p>Lose the strong reference from the <code id=garbage-collection-and-browsing-contexts:document-9><a href=#document>Document</a></code>'s <a href=#concept-document-bc id=garbage-collection-and-browsing-contexts:concept-document-bc>browsing context</a> to the <code id=garbage-collection-and-browsing-contexts:document-10><a href=#document>Document</a></code>.</ol>

  <p class=note>Whenever a <code id=garbage-collection-and-browsing-contexts:document-11><a href=#document>Document</a></code> object is <a href=#discard-a-document id=garbage-collection-and-browsing-contexts:discard-a-document>discarded</a>, it is also removed from the list of <a href="#the-worker's-documents" id="garbage-collection-and-browsing-contexts:the-worker's-documents">the worker's
  <code>Document</code>s</a> of each worker whose list contains that <code id=garbage-collection-and-browsing-contexts:document-12><a href=#document>Document</a></code>.</p>

  <p>When <dfn id=a-browsing-context-is-discarded data-export="">a <em>browsing context</em> is discarded</dfn>, the strong reference
  from the user agent itself to the <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-3>browsing context</a> must be severed, and all the
  <code id=garbage-collection-and-browsing-contexts:document-13><a href=#document>Document</a></code> objects for all the entries in the <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-4>browsing context</a>'s session
  history must be <a href=#discard-a-document id=garbage-collection-and-browsing-contexts:discard-a-document-2>discarded</a> as well.</p>

  <p>User agents may <a href=#a-browsing-context-is-discarded id=garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded-2>discard</a> <a href=#top-level-browsing-context id=garbage-collection-and-browsing-contexts:top-level-browsing-context-2>top-level browsing contexts</a> at any time (typically, in
  response to user requests, e.g. when a user force-closes a window containing one or more <a href=#top-level-browsing-context id=garbage-collection-and-browsing-contexts:top-level-browsing-context-3>top-level browsing contexts</a>). Other <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-5>browsing contexts</a> must be discarded once their
  <code id=garbage-collection-and-browsing-contexts:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object is eligible for garbage collection, in addition to the other
  places where this specification requires them to be discarded.</p>

  <p>A <code id=garbage-collection-and-browsing-contexts:windowproxy-4><a href=#windowproxy>WindowProxy</a></code> does <em>not</em> have a strong reference to the <a href=#browsing-context id=garbage-collection-and-browsing-contexts:browsing-context-6>browsing
  context</a> it was created alongside. In particular, it is possible for a <a href=#nested-browsing-context id=garbage-collection-and-browsing-contexts:nested-browsing-context>nested
  browsing context</a> to be <a href=#a-browsing-context-is-discarded id=garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded-3>discarded</a> even
  if JavaScript code holds a reference to its <code id=garbage-collection-and-browsing-contexts:windowproxy-5><a href=#windowproxy>WindowProxy</a></code> object.</p>

  


  <h4 id=closing-browsing-contexts>7.3.5 Closing browsing contexts<a href=#closing-browsing-contexts class=self-link></a></h4>

  <p>When the user agent is required to <dfn id=close-a-browsing-context>close a browsing context</dfn>, it must run the
  following steps:</p>

  <ol><li><p>Let <var>specified browsing context</var> be the <a href=#browsing-context id=closing-browsing-contexts:browsing-context>browsing context</a>
   being closed.<li><p><a href=#prompt-to-unload-a-document id=closing-browsing-contexts:prompt-to-unload-a-document>Prompt to unload</a> the <a href=#active-document id=closing-browsing-contexts:active-document>active
   document</a> of the <var>specified browsing context</var>. If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=closing-browsing-contexts:refused-to-allow-the-document-to-be-unloaded>refused
   to allow the document to be unloaded</a>, then abort these steps.<li><p><a href=#unload-a-document id=closing-browsing-contexts:unload-a-document>Unload</a> the <a href=#active-document id=closing-browsing-contexts:active-document-2>active document</a> of the <var>specified browsing context</var> with the <var>recycle</var> parameter set to
   false.<li><p>Remove the <var>specified browsing context</var> from the user interface (e.g.
   close or hide its tab in a tabbed browser).<li><p><a href=#a-browsing-context-is-discarded id=closing-browsing-contexts:a-browsing-context-is-discarded>Discard</a> the <var>specified
   browsing context</var>.</ol>

  <p>User agents should offer users the ability to arbitrarily <a href=#close-a-browsing-context id=closing-browsing-contexts:close-a-browsing-context>close</a> any <a href=#top-level-browsing-context id=closing-browsing-contexts:top-level-browsing-context>top-level browsing context</a>.</p>



  <h4 id=browser-interface-elements>7.3.6 Browser interface elements<a href=#browser-interface-elements class=self-link></a></h4>

  <p>To allow Web pages to integrate with Web browsers, certain Web browser interface elements are
  exposed in a limited way to scripts in Web pages.</p>

  <p>Each interface element is represented by a <code id=browser-interface-elements:barprop><a href=#barprop>BarProp</a></code> object:</p>

  <pre class=idl>interface <dfn id=barprop>BarProp</dfn> {
  readonly attribute boolean <a href=#dom-barprop-visible id=browser-interface-elements:dom-barprop-visible>visible</a>;
};</pre>

  <dl class=domintro><dt><var>window</var> . <code id=browser-interface-elements:dom-window-locationbar><a href=#dom-window-locationbar>locationbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-2><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>Returns true if the location bar is visible; otherwise, returns false.</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-menubar><a href=#dom-window-menubar>menubar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-3><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>Returns true if the menu bar is visible; otherwise, returns false.</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-personalbar><a href=#dom-window-personalbar>personalbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-4><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>Returns true if the personal bar is visible; otherwise, returns false.</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-scrollbars><a href=#dom-window-scrollbars>scrollbars</a></code> . <code id=browser-interface-elements:dom-barprop-visible-5><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>Returns true if the scroll bars are visible; otherwise, returns false.</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-statusbar><a href=#dom-window-statusbar>statusbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-6><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>Returns true if the status bar is visible; otherwise, returns false.</p>
   <dt><var>window</var> . <code id=browser-interface-elements:dom-window-toolbar><a href=#dom-window-toolbar>toolbar</a></code> . <code id=browser-interface-elements:dom-barprop-visible-7><a href=#dom-barprop-visible>visible</a></code><dd>
    <p>Returns true if the toolbar is visible; otherwise, returns false.</p>
   </dl>

  

  <p>The <dfn id=dom-barprop-visible>visible</dfn> attribute, on getting, must return either
  true or a value determined by the user agent to most accurately represent the visibility state of
  the user interface element that the object represents, as described below.</p>

  <p>The following <code id=browser-interface-elements:barprop-2><a href=#barprop>BarProp</a></code> objects exist for each <code id=browser-interface-elements:document><a href=#document>Document</a></code> object in a
  <a href=#browsing-context id=browser-interface-elements:browsing-context>browsing context</a>. Some of the user interface elements represented by these objects
  might have no equivalent in some user agents; for those user agents, except when otherwise
  specified, the object must act as if it was present and visible (i.e. its <code id=browser-interface-elements:dom-barprop-visible-8><a href=#dom-barprop-visible>visible</a></code> attribute must return true).</p>

  <dl><dt><dfn id=the-location-bar-barprop-object>The location bar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains a control that displays the
   <a id=browser-interface-elements:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a href=#active-document id=browser-interface-elements:active-document>active document</a>, or some similar interface concept.<dt><dfn id=the-menu-bar-barprop-object>The menu bar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains a list of commands in menu form, or some
   similar interface concept.<dt><dfn id=the-personal-bar-barprop-object>The personal bar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains links to the user's favorite pages, or
   some similar interface concept.<dt><dfn id=the-scrollbar-barprop-object>The scrollbar <code>BarProp</code> object</dfn><dd>Represents the user interface element that contains a scrolling mechanism, or some similar
   interface concept.<dt><dfn id=the-status-bar-barprop-object>The status bar <code>BarProp</code> object</dfn><dd>Represents a user interface element found immediately below or after the document, as
   appropriate for the user's media, which typically provides information about ongoing network
   activity or information about elements that the user's pointing device is current indicating. If
   the user agent has no such user interface element, then the object may act as if the
   corresponding user interface element was absent (i.e. its <code id=browser-interface-elements:dom-barprop-visible-9><a href=#dom-barprop-visible>visible</a></code> attribute may return false).<dt><dfn id=the-toolbar-barprop-object>The toolbar <code>BarProp</code> object</dfn><dd>Represents the user interface element found immediately above or before the document, as
   appropriate for the user's media, which typically provides <a href=#session-history id=browser-interface-elements:session-history>session history</a> traversal
   controls (back and forward buttons, reload buttons, etc). If the user agent has no such user
   interface element, then the object may act as if the corresponding user interface element was
   absent (i.e. its <code id=browser-interface-elements:dom-barprop-visible-10><a href=#dom-barprop-visible>visible</a></code> attribute may return
   false).</dl>

  <p>The <dfn id=dom-window-locationbar><code>locationbar</code></dfn> attribute must return
  <a href=#the-location-bar-barprop-object id=browser-interface-elements:the-location-bar-barprop-object>the location bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-menubar><code>menubar</code></dfn> attribute must return <a href=#the-menu-bar-barprop-object id=browser-interface-elements:the-menu-bar-barprop-object>the
  menu bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-personalbar><code>personalbar</code></dfn> attribute must return
  <a href=#the-personal-bar-barprop-object id=browser-interface-elements:the-personal-bar-barprop-object>the personal bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-scrollbars><code>scrollbars</code></dfn> attribute must return
  <a href=#the-scrollbar-barprop-object id=browser-interface-elements:the-scrollbar-barprop-object>the scrollbar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-statusbar><code>statusbar</code></dfn> attribute must return
  <a href=#the-status-bar-barprop-object id=browser-interface-elements:the-status-bar-barprop-object>the status bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id=dom-window-toolbar><code>toolbar</code></dfn> attribute must return <a href=#the-toolbar-barprop-object id=browser-interface-elements:the-toolbar-barprop-object>the
  toolbar <code>BarProp</code> object</a>.</p>



  <hr>

  <p>For historical reasons, the <dfn id=dom-window-status><code>status</code></dfn> attribute
  on the <code id=browser-interface-elements:window><a href=#window>Window</a></code> object must, on getting, return the last string it was set to, and on
  setting, must set itself to the new value. When the <code id=browser-interface-elements:window-2><a href=#window>Window</a></code> object is created, the
  attribute must be set to the empty string. It does not do anything else.</p>

  


  

  <h3 id=the-windowproxy-exotic-object>7.4 The <code id=the-windowproxy-exotic-object:windowproxy><a href=#windowproxy>WindowProxy</a></code> exotic object<a href=#the-windowproxy-exotic-object class=self-link></a></h3>

  <p>A <dfn id=windowproxy data-dfn-type=interface data-export=""><code>WindowProxy</code></dfn> is an exotic
  object that wraps a <code id=the-windowproxy-exotic-object:window><a href=#window>Window</a></code> ordinary object, indirecting most operations through to
  the wrapped object. Each <a href=#browsing-context id=the-windowproxy-exotic-object:browsing-context>browsing context</a> has an associated <code id=the-windowproxy-exotic-object:windowproxy-2><a href=#windowproxy>WindowProxy</a></code>
  object. When the <a href=#browsing-context id=the-windowproxy-exotic-object:browsing-context-2>browsing context</a> is <a href=#navigate id=the-windowproxy-exotic-object:navigate>navigated</a>, the
  <code id=the-windowproxy-exotic-object:window-2><a href=#window>Window</a></code> object wrapped by the <a href=#browsing-context id=the-windowproxy-exotic-object:browsing-context-3>browsing context</a>'s associated
  <code id=the-windowproxy-exotic-object:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object is changed.</p>

  <p>There is no <code id=the-windowproxy-exotic-object:windowproxy-4><a href=#windowproxy>WindowProxy</a></code> <a id=the-windowproxy-exotic-object:interface-object href=https://heycam.github.io/webidl/#dfn-interface-object data-x-internal=interface-object>interface object</a>.</p>

  <p>Every <code id=the-windowproxy-exotic-object:windowproxy-5><a href=#windowproxy>WindowProxy</a></code> object has a
  <dfn id=concept-windowproxy-window>[[Window]]</dfn> internal slot representing the wrapped
  <code id=the-windowproxy-exotic-object:window-3><a href=#window>Window</a></code> object.</p>

  <p>The <code id=the-windowproxy-exotic-object:windowproxy-6><a href=#windowproxy>WindowProxy</a></code> object internal methods are described in the subsections
  below.</p>

  <p class=note>Although <code id=the-windowproxy-exotic-object:windowproxy-7><a href=#windowproxy>WindowProxy</a></code> is named as a "proxy", it does not do
  polymorphic dispatch on its target's internal methods as a real proxy would, due to a desire to
  reuse machinery between <code id=the-windowproxy-exotic-object:windowproxy-8><a href=#windowproxy>WindowProxy</a></code> and <code id=the-windowproxy-exotic-object:location><a href=#location>Location</a></code> objects. As long as the
  <code id=the-windowproxy-exotic-object:window-4><a href=#window>Window</a></code> object remains an ordinary object this is unobservable and can be implemented
  either way.</p>

  <h4 id=windowproxy-getprototypeof>7.4.1 [[GetPrototypeOf]] ( )<a href=#windowproxy-getprototypeof class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-getprototypeof:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-getprototypeof:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return !
   <a id=windowproxy-getprototypeof:ordinarygetprototypeof href=https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof data-x-internal=ordinarygetprototypeof>OrdinaryGetPrototypeOf</a>(<var>W</var>).<li><p>Return null.</ol>

  <h4 id=windowproxy-setprototypeof>7.4.2 [[SetPrototypeOf]] ( <var>V</var> )<a href=#windowproxy-setprototypeof class=self-link></a></h4>

  <ol><li><p>Return false.</ol>

  <h4 id=windowproxy-isextensible>7.4.3 [[IsExtensible]] ( )<a href=#windowproxy-isextensible class=self-link></a></h4>

  <ol><li><p>Return true.</ol>

  <h4 id=windowproxy-preventextensions>7.4.4 [[PreventExtensions]] ( )<a href=#windowproxy-preventextensions class=self-link></a></h4>

  <ol><li><p>Return false.</ol>

  <h4 id=windowproxy-getownproperty>7.4.5 [[GetOwnProperty]] ( <var>P</var> )<a href=#windowproxy-getownproperty class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-getownproperty:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li>
    <p>If <var>P</var> is an <a id=windowproxy-getownproperty:array-index-property-name href=https://heycam.github.io/webidl/#dfn-array-index-property-name data-x-internal=array-index-property-name>array index property name</a>, then:</p>

    <ol><li><p>Let <var>index</var> be <a id=windowproxy-getownproperty:touint32 href=https://tc39.github.io/ecma262/#sec-touint32 data-x-internal=touint32>ToUint32</a>(<var>P</var>).<li><p>Let <var>maxProperties</var> be the <a href=#number-of-document-tree-child-browsing-contexts id=windowproxy-getownproperty:number-of-document-tree-child-browsing-contexts>number of document-tree child browsing
     contexts</a> of <var>W</var>.<li><p>Let <var>value</var> be undefined.<li>
      <p>If <var>maxProperties</var> is greater than 0 and <var>index</var> is less than
      <var>maxProperties</var>, then:</p>

      <ol><li><p>Let <var>document</var> be <var>W</var>'s <a href=#concept-document-window id=windowproxy-getownproperty:concept-document-window>associated <code>Document</code></a>.<li><p>Set <var>value</var> to the <code id=windowproxy-getownproperty:windowproxy><a href=#windowproxy>WindowProxy</a></code> object of the <var>index</var>th
       <a href=#document-tree-child-browsing-context id=windowproxy-getownproperty:document-tree-child-browsing-context>document-tree child browsing context</a> of <var>document</var>'s <a href=#concept-document-bc id=windowproxy-getownproperty:concept-document-bc>browsing context</a>, sorted in the order
       that their <a href=#browsing-context-container id=windowproxy-getownproperty:browsing-context-container>browsing context container</a>
       elements were most recently inserted into <var>document</var>, the
       <code id=windowproxy-getownproperty:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object of the most recently inserted <a href=#browsing-context-container id=windowproxy-getownproperty:browsing-context-container-2>browsing context
       container</a>'s <a href=#nested-browsing-context id=windowproxy-getownproperty:nested-browsing-context>nested browsing context</a> being last.</ol>

     <li><p>Return <a id=windowproxy-getownproperty:propertydescriptor href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
     [[Value]]: <var>value</var>,
     [[Writable]]: false,
     [[Enumerable]]: false,
     [[Configurable]]: true }.</ol>
   <li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-getownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return
    <a id=windowproxy-getownproperty:ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<var>W</var>, <var>P</var>).</p>

    <p class=note>This is a <a href=#willful-violation id=windowproxy-getownproperty:willful-violation>willful violation</a> of the JavaScript specification's
    <a id=windowproxy-getownproperty:invariants-of-the-essential-internal-methods href=https://tc39.github.io/ecma262/#sec-invariants-of-the-essential-internal-methods data-x-internal=invariants-of-the-essential-internal-methods>invariants of the essential internal methods</a> to maintain compatibility with
    existing Web content. See <a href=https://github.com/tc39/ecma262/issues/672>tc39/ecma262
    issue #672</a> for more information. <a href=#refsJAVASCRIPT>[JAVASCRIPT]</a></p>
   <li><p>Let <var>property</var> be <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=windowproxy-getownproperty:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>(<var>W</var>,
   <var>P</var>).<li><p>If <var>property</var> is not undefined, return <var>property</var>.<li>
    <p>If <var>property</var> is undefined and <var>P</var> is in <var>W</var>'s <a href=#document-tree-child-browsing-context-name-property-set id=windowproxy-getownproperty:document-tree-child-browsing-context-name-property-set>document-tree
    child browsing context name property set</a>, then:</p>

    <ol><li><p>Let <var>value</var> be the <code id=windowproxy-getownproperty:windowproxy-3><a href=#windowproxy>WindowProxy</a></code> object of the
     <a href=#dom-window-nameditem-filter id=windowproxy-getownproperty:dom-window-nameditem-filter>named object</a> with the name <var>P</var>.

     <li><p>Return <a id=windowproxy-getownproperty:propertydescriptor-2 href=https://tc39.github.io/ecma262/#sec-property-descriptor-specification-type data-x-internal=propertydescriptor>PropertyDescriptor</a>{
     [[Value]]: <var>value</var>,
     [[Enumerable]]: false,
     [[Writable]]: false,
     [[Configurable]]: true }.</ol>

   <li><p>Throw a <a id=windowproxy-getownproperty:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=windowproxy-getownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h4 id=windowproxy-defineownproperty>7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var>
  )<a href=#windowproxy-defineownproperty class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-defineownproperty:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-defineownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then:

    <ol><li><p>If <var>P</var> is an <a id=windowproxy-defineownproperty:array-index-property-name href=https://heycam.github.io/webidl/#dfn-array-index-property-name data-x-internal=array-index-property-name>array index property name</a>, return false.<li>
      <p>Return ? <a id=windowproxy-defineownproperty:ordinarydefineownproperty href=https://tc39.github.io/ecma262/#sec-ordinarydefineownproperty data-x-internal=ordinarydefineownproperty>OrdinaryDefineOwnProperty</a>(<var>W</var>, <var>P</var>,
      <var>Desc</var>).</p>

      <p class=note>This is a <a href=#willful-violation id=windowproxy-defineownproperty:willful-violation>willful violation</a> of the JavaScript specification's
      <a id=windowproxy-defineownproperty:invariants-of-the-essential-internal-methods href=https://tc39.github.io/ecma262/#sec-invariants-of-the-essential-internal-methods data-x-internal=invariants-of-the-essential-internal-methods>invariants of the essential internal methods</a> to maintain compatibility with
      existing Web content. See <a href=https://github.com/tc39/ecma262/issues/672>tc39/ecma262
      issue #672</a> for more information. <a href=#refsJAVASCRIPT>[JAVASCRIPT]</a></p>
     </ol>

   <li><p>Throw a <a id=windowproxy-defineownproperty:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=windowproxy-defineownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h4 id=windowproxy-get>7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )<a href=#windowproxy-get class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-get:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-get:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return ?
   <a id=windowproxy-get:ordinaryget href=https://tc39.github.io/ecma262/#sec-ordinaryget data-x-internal=ordinaryget>OrdinaryGet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).<li><p>Return ? <a href=#crossoriginget-(-o,-p,-receiver-) id=windowproxy-get:crossoriginget-(-o,-p,-receiver-)>CrossOriginGet</a>(<b>this</b>, <var>P</var>,
   <var>Receiver</var>).</ol>

  <h4 id=windowproxy-set>7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )<a href=#windowproxy-set class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-set:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-set:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return ?
   <a id=windowproxy-set:ordinaryset href=https://tc39.github.io/ecma262/#sec-ordinaryset data-x-internal=ordinaryset>OrdinarySet</a>(<var>W</var>, <b>this</b>, <var>Receiver</var>).<li><p>Return ? <a href=#crossoriginset-(-o,-p,-v,-receiver-) id=windowproxy-set:crossoriginset-(-o,-p,-v,-receiver-)>CrossOriginSet</a>(<b>this</b>, <var>P</var>, <var>V</var>,
   <var>Receiver</var>).</ol>

  <h4 id=windowproxy-delete>7.4.9 [[Delete]] ( <var>P</var> )<a href=#windowproxy-delete class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-delete:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-delete:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then:

    <ol><li><p>If <var>P</var> is an <a id=windowproxy-delete:array-index-property-name href=https://heycam.github.io/webidl/#dfn-array-index-property-name data-x-internal=array-index-property-name>array index property name</a>, then return
     false.<li><p>Return ? <a id=windowproxy-delete:ordinarydelete href=https://tc39.github.io/ecma262/#sec-ordinarydelete data-x-internal=ordinarydelete>OrdinaryDelete</a>(<var>W</var>, <var>P</var>).</ol>

   <li><p>Throw a <a id=windowproxy-delete:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=windowproxy-delete:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h4 id=windowproxy-ownpropertykeys>7.4.10 [[OwnPropertyKeys]] ( )<a href=#windowproxy-ownpropertykeys class=self-link></a></h4>

  <ol><li><p>Let <var>W</var> be the value of the
   <a href=#concept-windowproxy-window id=windowproxy-ownpropertykeys:concept-windowproxy-window>[[Window]]</a> internal slot of
   <b>this</b>.<li><p>Let <var>keys</var> be a new empty <a href=https://tc39.github.io/ecma262/#sec-list-and-record-specification-type id=windowproxy-ownpropertykeys:js-list data-x-internal=js-list>List</a>.<li><p>Let <var>maxProperties</var> be the <a href=#number-of-document-tree-child-browsing-contexts id=windowproxy-ownpropertykeys:number-of-document-tree-child-browsing-contexts>number of document-tree child browsing
   contexts</a> of <var>W</var>.<li><p>Let <var>index</var> be 0.<li>
    <p>Repeat while <var>index</var> &lt; <var>maxProperties</var>,

    <ol><li><p>Add ! <a id=windowproxy-ownpropertykeys:tostring href=https://tc39.github.io/ecma262/#sec-tostring data-x-internal=tostring>ToString</a>(<var>index</var>) as the last element of
     <var>keys</var>.<li><p>Increment <var>index</var> by 1.</ol>
   <li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=windowproxy-ownpropertykeys:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<var>W</var>) is true, then return the
   concatenation of <var>keys</var> and !
   <a id=windowproxy-ownpropertykeys:ordinaryownpropertykeys href=https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys data-x-internal=ordinaryownpropertykeys>OrdinaryOwnPropertyKeys</a>(<var>W</var>).<li><p>Return the concatenation of <var>keys</var> and !
   <a href=#crossoriginownpropertykeys-(-o-) id=windowproxy-ownpropertykeys:crossoriginownpropertykeys-(-o-)>CrossOriginOwnPropertyKeys</a>(<var>W</var>).</ol>

  





  <h3 id=origin>7.5 Origin<a href=#origin class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=28374" title="Should canvas really get tainted by a cross-origin (via document.domain) drawImage call?">28374</a></div>
  

  <p>Origins are the fundamental currency of the Web's security model. Two actors in the Web
  platform that share an origin are assumed to trust each other and to have the same authority.
  Actors with differing origins are considered potentially hostile versus each other, and are
  isolated from each other to varying degrees.</p>

  <p class=example>For example, if Example Bank's Web site, hosted at <code>bank.example.com</code>, tries to examine the DOM of Example Charity's Web site, hosted
  at <code>charity.example.org</code>, a <a id=origin:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=origin:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> will be raised.</p>

  <hr>

  <p id=origin-2>An <dfn data-export="" id=concept-origin>origin</dfn> is
  one of the following:</p>

  <dl><dt>An <dfn id=concept-origin-opaque data-export="">opaque origin</dfn><dd><p>An internal value, with no serialization it can be recreated from (it is serialized as
   "<code>null</code>" per <a href=#ascii-serialisation-of-an-origin id=origin:ascii-serialisation-of-an-origin>ASCII serialization of an origin</a>), for which the
   only meaningful operation is testing for equality.<dt>A <dfn id=concept-origin-tuple data-export="">tuple origin</dfn><dd>
    <p>A <a href=#concept-origin-tuple id=origin:concept-origin-tuple>tuple</a> consists of:

    <ul class=brief><li>A <dfn data-dfn-for=origin id=concept-origin-scheme data-export="">scheme</dfn> (a
     <a href=https://url.spec.whatwg.org/#concept-url-scheme id=origin:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>).<li>A <dfn data-dfn-for=origin id=concept-origin-host data-export="">host</dfn> (a
     <a href=https://url.spec.whatwg.org/#concept-host id=origin:concept-host data-x-internal=concept-host>host</a>).<li>A <dfn data-dfn-for=origin id=concept-origin-port data-export="">port</dfn> (a
     <a href=https://url.spec.whatwg.org/#concept-url-port id=origin:concept-url-port data-x-internal=concept-url-port>port</a>).<li>A <dfn data-dfn-for=origin id=concept-origin-domain data-export="">domain</dfn>
     (null or a <a href=https://url.spec.whatwg.org/#concept-domain id=origin:concept-domain data-x-internal=concept-domain>domain</a>). Null unless stated otherwise.</ul>
   </dl>

  <p class=note><a href=#concept-origin id=origin:concept-origin>Origins</a> can be shared, e.g., among multiple
  <code id=origin:document><a href=#document>Document</a></code> objects. Furthermore, <a href=#concept-origin id=origin:concept-origin-2>origins</a> are generally
  immutable. Only the <a href=#concept-origin-domain id=origin:concept-origin-domain>domain</a> of a <a href=#concept-origin-tuple id=origin:concept-origin-tuple-2>tuple origin</a> can be changed, and only through the <code id=origin:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> API.</p>

  <p>The <dfn id=concept-origin-effective-domain data-export="">effective domain</dfn> of an
  <a href=#concept-origin id=origin:concept-origin-3>origin</a> <var>origin</var> is computed as follows:</p>

  <ol><li><p>If <var>origin</var> is an <a href=#concept-origin-opaque id=origin:concept-origin-opaque>opaque origin</a>, then
   return <var>origin</var>.<li><p>If <var>origin</var>'s <a href=#concept-origin-domain id=origin:concept-origin-domain-2>domain</a> is non-null,
   then return <var>origin</var>'s <a href=#concept-origin-domain id=origin:concept-origin-domain-3>domain</a>.<li><p>Return <var>origin</var>'s <a href=#concept-origin-host id=origin:concept-origin-host>host</a>.</ol>

  

  <p>Various specification objects are defined to have an <a href=#concept-origin id=origin:concept-origin-4>origin</a>. These <a href=#concept-origin id=origin:concept-origin-5>origins</a> are determined as follows:</p>

  <dl><dt>For <code id=origin:document-2><a href=#document>Document</a></code> objects<dd>

    <dl class=switch><dt id=sandboxOrigin>If the <code id=origin:document-3><a href=#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=origin:active-sandboxing-flag-set>active sandboxing flag set</a>
     has its <a href=#sandboxed-origin-browsing-context-flag id=origin:sandboxed-origin-browsing-context-flag>sandboxed origin browsing context flag</a> set<dt>If the <code id=origin:document-4><a href=#document>Document</a></code> was generated from a <a href=https://tools.ietf.org/html/rfc2397#section-2 id=origin:data-protocol data-x-internal=data-protocol><code>data:</code> URL</a><dd><p>A unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-2>opaque origin</a> assigned when the
     <code id=origin:document-5><a href=#document>Document</a></code> is created.<dt>If the <code id=origin:document-6><a href=#document>Document</a></code>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="origin:the-document's-address" data-x-internal="the-document's-address">URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=origin:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a> is a <a id=origin:network-scheme href=https://url.spec.whatwg.org/#network-scheme data-x-internal=network-scheme>network scheme</a><dd>
      <p>A copy of the <code id=origin:document-7><a href=#document>Document</a></code>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="origin:the-document's-address-2" data-x-internal="the-document's-address">URL</a>'s
      <a href=https://url.spec.whatwg.org/#concept-url-origin id=origin:concept-url-origin data-x-internal=concept-url-origin>origin</a> assigned when the <code id=origin:document-8><a href=#document>Document</a></code> is
      created.</p>

      <p class=note>The <code id=origin:dom-document-open><a href=#dom-document-open>document.open()</a></code> method can change
      the <code id=origin:document-9><a href=#document>Document</a></code>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="origin:the-document's-address-3" data-x-internal="the-document's-address">URL</a> to
      "<code id=origin:about:blank><a href=#about:blank>about:blank</a></code>". Therefore the <a href=#concept-origin id=origin:concept-origin-6>origin</a> is assigned when the
      <code id=origin:document-10><a href=#document>Document</a></code> is created.</p>
     <dt>If the <code id=origin:document-11><a href=#document>Document</a></code> is the initial "<code id=origin:about:blank-2><a href=#about:blank>about:blank</a></code>" document<dd><p><a href=#about-blank-origin>The one it was assigned when its browsing context was
     created</a>.<dt>If the <code id=origin:document-12><a href=#document>Document</a></code> is a non-initial "<code id=origin:about:blank-3><a href=#about:blank>about:blank</a></code>" document<dd><p>The <a href=#concept-settings-object-origin id=origin:concept-settings-object-origin>origin</a> of the <a href=#incumbent-settings-object id=origin:incumbent-settings-object>incumbent
     settings object</a> when the <a href=#navigate id=origin:navigate>navigate</a> algorithm was invoked, or, if no <a href=#concept-script id=origin:concept-script>script</a> was involved, the <a href=#concept-origin id=origin:concept-origin-7>origin</a> of the <a id=origin:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node
     document</a> of the element that initiated the <a href=#navigate id=origin:navigate-2>navigation</a> to
     that <a id=origin:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>.<dt>If the <code id=origin:document-13><a href=#document>Document</a></code> was created as part of the processing for <a href=#javascript-protocol id=origin:javascript-protocol><code>javascript:</code> URLs</a><dd><p>The <a href=#concept-origin id=origin:concept-origin-8>origin</a> of the <a href=#active-document id=origin:active-document>active document</a> of the <a href=#browsing-context id=origin:browsing-context>browsing
     context</a> being navigated when the <a href=#navigate id=origin:navigate-3>navigate</a> algorithm was invoked.<dt>If the <code id=origin:document-14><a href=#document>Document</a></code> is <a href=#an-iframe-srcdoc-document id=origin:an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a><dd><p>The <a href=#concept-origin id=origin:concept-origin-9>origin</a> of the <code id=origin:document-15><a href=#document>Document</a></code>'s <a href=#concept-document-bc id=origin:concept-document-bc>browsing context</a>'s <a href=#browsing-context-container id=origin:browsing-context-container>browsing context
     container</a>'s <a id=origin:node-document-2 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>.<dt>If the <code id=origin:document-16><a href=#document>Document</a></code> was obtained in some other manner (e.g. a <code id=origin:document-17><a href=#document>Document</a></code>
     created using the <code id=origin:dom-domimplementation-createdocument><a data-x-internal=dom-domimplementation-createdocument href=https://dom.spec.whatwg.org/#dom-domimplementation-createdocument>createDocument()</a></code>
     API, etc)<dd>
      <p>The default behavior as defined in the WHATWG DOM standard applies. <a href=#refsDOM>[DOM]</a>.</p>

      <p class=note>The <a href=#concept-origin id=origin:concept-origin-10>origin</a> is a unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-3>opaque origin</a> assigned when the <code id=origin:document-18><a href=#document>Document</a></code> is
      created.</p>
     </dl>

   <dt>For images of <code id=origin:the-img-element><a href=#the-img-element>img</a></code> elements<dd>

    <dl class=switch><dt>If the image data is <a href=#cors-cross-origin id=origin:cors-cross-origin>CORS-cross-origin</a><dd><p>A unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-4>opaque origin</a> assigned when the
     image is created.<dt>If the image data is <a href=#cors-same-origin id=origin:cors-same-origin>CORS-same-origin</a><dd><p>The <code id=origin:the-img-element-2><a href=#the-img-element>img</a></code> element's <a id=origin:node-document-3 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s
     <a href=#concept-origin id=origin:concept-origin-11>origin</a>.</dl>

   <dt>For <code id=origin:the-audio-element><a href=#the-audio-element>audio</a></code> and <code id=origin:the-video-element><a href=#the-video-element>video</a></code> elements<dd>

    <dl class=switch><dt>If the <a href=#media-data id=origin:media-data>media data</a> is <a href=#cors-cross-origin id=origin:cors-cross-origin-2>CORS-cross-origin</a><dd><p>A unique <a href=#concept-origin-opaque id=origin:concept-origin-opaque-5>opaque origin</a> assigned when the
     <a href=#media-data id=origin:media-data-2>media data</a> is fetched.<dt>If the <a href=#media-data id=origin:media-data-3>media data</a> is <a href=#cors-same-origin id=origin:cors-same-origin-2>CORS-same-origin</a><dd><p>The <a href=#media-element id=origin:media-element>media element</a>'s <a id=origin:node-document-4 href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>'s
     <a href=#concept-origin id=origin:concept-origin-12>origin</a>.</dl>

   </dl>

  <p>Other specifications can override the above definitions by themselves specifying the origin of
  a particular <code id=origin:document-19><a href=#document>Document</a></code> object, image, or <a href=#media-element id=origin:media-element-2>media element</a>.</p>

  <hr>

  <p>The <dfn data-export="" id=unicode-serialisation-of-an-origin>Unicode
  serialization of an origin</dfn> is the string obtained by applying the following algorithm to the
  given <a href=#concept-origin id=origin:concept-origin-13>origin</a> <var>origin</var>:</p>

  <ol><li><p>If <var>origin</var> is an <a href=#concept-origin-opaque id=origin:concept-origin-opaque-6>opaque origin</a>, then
   return "<code>null</code>".<li><p>Let <var>host</var> be <var>origin</var>'s <a href=#concept-origin-host id=origin:concept-origin-host-2>host</a>.<li><p>Let <var>unicodeHost</var> be <var>host</var> if <var>host</var> is not a <a href=https://url.spec.whatwg.org/#concept-domain id=origin:concept-domain-2 data-x-internal=concept-domain>domain</a>, and the result of applying <a id=origin:domain-to-unicode href=https://url.spec.whatwg.org/#concept-domain-to-unicode data-x-internal=domain-to-unicode>domain to Unicode</a>
   to <var>host</var> otherwise.<li><p>Let <var>unicodeOrigin</var> be a new <a href=#concept-origin-tuple id=origin:concept-origin-tuple-3>tuple
   origin</a> consisting <var>origin</var>'s <a href=#concept-origin-scheme id=origin:concept-origin-scheme>scheme</a>,
   <var>unicodeHost</var>, and <var>origin</var>'s <a href=#concept-origin-port id=origin:concept-origin-port>port</a>.<li>
    <p>Return the <a href=#ascii-serialisation-of-an-origin id=origin:ascii-serialisation-of-an-origin-2>ASCII serialization of an origin</a>, given <var>unicodeOrigin</var>.</p>

    <p class=note>The name <a href=#ascii-serialisation-of-an-origin id=origin:ascii-serialisation-of-an-origin-3>ASCII serialization of an origin</a> is misleading, as it
    merely serializes an origin, which are all ASCII by default due to the <a id=origin:url-parser href=https://url.spec.whatwg.org/#concept-url-parser data-x-internal=url-parser>URL
    parser</a>.</p>
   </ol>

  <p class=example>The <a href=#unicode-serialisation-of-an-origin id=origin:unicode-serialisation-of-an-origin>Unicode
  serialization</a> of ("<code>https</code>", "<code>xn--maraa-rta.example</code>", null, null) is "<code>https://maraña.example</code>".</p>

  <p>The <dfn data-export="" id=ascii-serialisation-of-an-origin>ASCII serialization
  of an origin</dfn> is the string obtained by applying the following algorithm to the given
  <a href=#concept-origin id=origin:concept-origin-14>origin</a> <var>origin</var>:</p>

  <ol><li><p>If <var>origin</var> is an <a href=#concept-origin-opaque id=origin:concept-origin-opaque-7>opaque origin</a>, then
   return "<code>null</code>".<li><p>Otherwise, let <var>result</var> be <var>origin</var>'s <a href=#concept-origin-scheme id=origin:concept-origin-scheme-2>scheme</a>.<li><p>Append "<code>://</code>" to <var>result</var>.<li><p>Append <var>origin</var>'s <a href=#concept-origin-host id=origin:concept-origin-host-3>host</a>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=origin:host-serializer data-x-internal=host-serializer>serialized</a>, to <var>result</var>.<li><p>If <var>origin</var>'s <a href=#concept-origin-port id=origin:concept-origin-port-2>port</a> is non-null, append
   a U+003A COLON character (:), and <var>origin</var>'s <a href=#concept-origin-port id=origin:concept-origin-port-3>port</a>, <a href=https://url.spec.whatwg.org/#serialize-an-integer id=origin:serialize-an-integer data-x-internal=serialize-an-integer>serialized</a>,
   to <var>result</var>.<li><p>Return <var>result</var>.</ol>

  <hr>

  <p>Two <a href=#concept-origin id=origin:concept-origin-15>origins</a>, <var>A</var> and <var>B</var>, are said to be
  <dfn id=same-origin data-export="">same origin</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href=#concept-origin-opaque id=origin:concept-origin-opaque-8>opaque
   origin</a>, then return true.<li><p>If <var>A</var> and <var>B</var> are both <a href=#concept-origin-tuple id=origin:concept-origin-tuple-4>tuple
   origins</a> and their <a href=#concept-origin-scheme id=origin:concept-origin-scheme-3>schemes</a>, <a href=#concept-origin-host id=origin:concept-origin-host-4>hosts</a>, and <a href=#concept-origin-port id=origin:concept-origin-port-4>port</a> are
   identical, then return true.<li><p>Return false.</ol>

  <p>Two <a href=#concept-origin id=origin:concept-origin-16>origins</a>, <var>A</var> and <var>B</var>, are said to be
  <dfn id=same-origin-domain data-export="">same origin-domain</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href=#concept-origin-opaque id=origin:concept-origin-opaque-9>opaque
   origin</a>, then return true.<li>
    <p>If <var>A</var> and <var>B</var> are both <a href=#concept-origin-tuple id=origin:concept-origin-tuple-5>tuple
    origins</a>, run these substeps:</p>

    <ol><li><p>If <var>A</var> and <var>B</var>'s <a href=#concept-origin-scheme id=origin:concept-origin-scheme-4>schemes</a>
     are identical, and their <a href=#concept-origin-domain id=origin:concept-origin-domain-4>domains</a> are identical and
     non-null, then return true.<li><p>Otherwise, if <var>A</var> and <var>B</var> are <a href=#same-origin id=origin:same-origin>same origin</a> and their <a href=#concept-origin-domain id=origin:concept-origin-domain-5>domains</a> are identical and null, then return
     true.</ol>

   <li><p>Return false.</ol>

  <div class=example>
   <table><tr><th><var>A</var>
     <th><var>B</var>
     <th><a href=#same-origin id=origin:same-origin-2>same origin</a>
     <th><a href=#same-origin-domain id=origin:same-origin-domain>same origin-domain</a>
    <tr><td>("<code>https</code>", "<code>example.org</code>", null, null)
     <td>("<code>https</code>", "<code>example.org</code>", null, null)
     <td>✅
     <td>✅
    <tr><td>("<code>https</code>", "<code>example.org</code>", 314, null)
     <td>("<code>https</code>", "<code>example.org</code>", 420, null)
     <td>❌
     <td>❌
    <tr><td>("<code>https</code>", "<code>example.org</code>", 314, "<code>example.org</code>")
     <td>("<code>https</code>", "<code>example.org</code>", 420, "<code>example.org</code>")
     <td>❌
     <td>✅
    <tr><td>("<code>https</code>", "<code>example.org</code>", null, null)
     <td>("<code>https</code>", "<code>example.org</code>", null, "<code>example.org</code>")
     <td>✅
     <td>❌
    <tr><td>("<code>https</code>", "<code>example.org</code>", null, "<code>example.org</code>")
     <td>("<code>http</code>", "<code>example.org</code>", null, "<code>example.org</code>")
     <td>❌
     <td>❌
   </table>
  </div>

  


  <h4 id=relaxing-the-same-origin-restriction>7.5.1 Relaxing the same-origin restriction<a href=#relaxing-the-same-origin-restriction class=self-link></a></h4>

  <dl class=domintro><dt><var>document</var> . <code id=relaxing-the-same-origin-restriction:dom-document-domain><a href=#dom-document-domain>domain</a></code> [ = <var>domain</var> ]<dd>

    <p>Returns the current domain used for security checks.</p>

    <p>Can be set to a value that removes subdomains, to change the <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin>origin</a>'s <a href=#concept-origin-domain id=relaxing-the-same-origin-restriction:concept-origin-domain>domain</a> to allow pages on other subdomains of the same
    domain (if they do the same thing) to access each other. (Can't be set in sandboxed
    <code id=relaxing-the-same-origin-restriction:the-iframe-element><a href=#the-iframe-element>iframe</a></code>s.)</p>

   </dl>

  

  <p>The <dfn id=dom-document-domain><code>domain</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=relaxing-the-same-origin-restriction:document><a href=#document>Document</a></code> object does not have a <a href=#concept-document-bc id=relaxing-the-same-origin-restriction:concept-document-bc>browsing context</a>, then return the empty string.

   <li><p>Let <var>effectiveDomain</var> be this <code id=relaxing-the-same-origin-restriction:document-2><a href=#document>Document</a></code>'s <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin-2>origin</a>'s <a href=#concept-origin-effective-domain id=relaxing-the-same-origin-restriction:concept-origin-effective-domain>effective domain</a>.

   <li><p>If <var>effectiveDomain</var> is an <a href=#concept-origin-opaque id=relaxing-the-same-origin-restriction:concept-origin-opaque>opaque
   origin</a>, then return the empty string.<li><p>Return <var>effectiveDomain</var>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=relaxing-the-same-origin-restriction:host-serializer data-x-internal=host-serializer>serialized</a>.</ol>

  <p>The <code id=relaxing-the-same-origin-restriction:dom-document-domain-2><a href=#dom-document-domain>domain</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=relaxing-the-same-origin-restriction:document-3><a href=#document>Document</a></code> object has no <a href=#concept-document-bc id=relaxing-the-same-origin-restriction:concept-document-bc-2>browsing
   context</a>, then throw a <a id=relaxing-the-same-origin-restriction:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=relaxing-the-same-origin-restriction:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If this <code id=relaxing-the-same-origin-restriction:document-4><a href=#document>Document</a></code> object's <a href=#active-sandboxing-flag-set id=relaxing-the-same-origin-restriction:active-sandboxing-flag-set>active sandboxing flag set</a> has its
   <a href=#sandboxed-document.domain-browsing-context-flag id=relaxing-the-same-origin-restriction:sandboxed-document.domain-browsing-context-flag>sandboxed <code>document.domain</code> browsing context
   flag</a> set, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-2 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=relaxing-the-same-origin-restriction:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If the given value is the empty string, then throw a
   <a id=relaxing-the-same-origin-restriction:securityerror-3 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=relaxing-the-same-origin-restriction:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>host</var> be the result of <a href=https://url.spec.whatwg.org/#concept-host-parser id=relaxing-the-same-origin-restriction:host-parser data-x-internal=host-parser>parsing</a> the given
   value.<li><p>If <var>host</var> is failure, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-4 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
   <code id=relaxing-the-same-origin-restriction:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>effectiveDomain</var> be this <code id=relaxing-the-same-origin-restriction:document-5><a href=#document>Document</a></code> object's
   <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin-3>origin</a>'s <a href=#concept-origin-effective-domain id=relaxing-the-same-origin-restriction:concept-origin-effective-domain-2>effective
   domain</a>.<li>
    <p>If <var>host</var> is <em>not</em> <a href=https://url.spec.whatwg.org/#concept-host-equals id=relaxing-the-same-origin-restriction:host-equals data-x-internal=host-equals>equal</a> to
    <var>effectiveDomain</var>, then run these substeps:</p>

    <ol><li>
      <p>If <var>host</var> or <var>effectiveDomain</var> is not a <a href=https://url.spec.whatwg.org/#concept-domain id=relaxing-the-same-origin-restriction:concept-domain data-x-internal=concept-domain>domain</a>, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-5 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
      <code id=relaxing-the-same-origin-restriction:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

      <p class=note>This is meant to exclude <a href=https://url.spec.whatwg.org/#concept-host id=relaxing-the-same-origin-restriction:concept-host data-x-internal=concept-host>hosts</a> that are an
      <a id=relaxing-the-same-origin-restriction:ipv4-address href=https://url.spec.whatwg.org/#concept-ipv4 data-x-internal=ipv4-address>IPv4 address</a> or an <a id=relaxing-the-same-origin-restriction:ipv6-address href=https://url.spec.whatwg.org/#concept-ipv6 data-x-internal=ipv6-address>IPv6 address</a>.</p>
     <li><p>If <var>host</var>, prefixed by a U+002E FULL STOP (.), does not exactly match the end
     of <var>effectiveDomain</var>, then throw a <a id=relaxing-the-same-origin-restriction:securityerror-6 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
     <code id=relaxing-the-same-origin-restriction:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
      <p>If <var>host</var> matches a suffix in the Public Suffix List, or, if <var>host</var>,
      prefixed by a U+002E FULL STOP (.), matches the end of a suffix in the Public Suffix List,
      then throw a <a id=relaxing-the-same-origin-restriction:securityerror-7 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=relaxing-the-same-origin-restriction:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>. <a href=#refsPSL>[PSL]</a></p>

      <p>Suffixes must be compared after applying the <a id=relaxing-the-same-origin-restriction:host-parser-2 href=https://url.spec.whatwg.org/#concept-host-parser data-x-internal=host-parser>host parser</a> algorithm.</p>
     </ol>
   <li><p>Set this <code id=relaxing-the-same-origin-restriction:document-6><a href=#document>Document</a></code> object's <a href=#concept-origin id=relaxing-the-same-origin-restriction:concept-origin-4>origin</a>'s <a href=#concept-origin-domain id=relaxing-the-same-origin-restriction:concept-origin-domain-2>domain</a> to <var>host</var>.</ol>

  

  <p class=note>The <code id=relaxing-the-same-origin-restriction:dom-document-domain-3><a href=#dom-document-domain>document.domain</a></code> attribute is used to
  enable pages on different hosts of a domain to access each other's DOMs.</p>

  <p class=warning>Do not use the <code id=relaxing-the-same-origin-restriction:dom-document-domain-4><a href=#dom-document-domain>document.domain</a></code>
  attribute when using shared hosting. If an untrusted third party is able to host an HTTP server at
  the same IP address but on a different port, then the same-origin protection that normally
  protects two different sites on the same host will fail, as the ports are ignored when comparing
  origins after the <code id=relaxing-the-same-origin-restriction:dom-document-domain-5><a href=#dom-document-domain>document.domain</a></code> attribute has been
  used.</p>





  <h3 id=sandboxing>7.6 Sandboxing<a href=#sandboxing class=self-link></a></h3>

  <p>A <dfn id=sandboxing-flag-set data-export="">sandboxing flag set</dfn> is a set of zero or more of the following
  flags, which are used to restrict the abilities that potentially untrusted resources have:</p>

  <dl><dt>The <dfn id=sandboxed-navigation-browsing-context-flag data-export="">sandboxed navigation browsing context flag</dfn><dd>

    <p>This flag <a href=#sandboxLinks>prevents content from navigating browsing contexts other
    than the sandboxed browsing context itself</a> (or browsing contexts further nested inside it),
    <a href=#auxiliary-browsing-context id=sandboxing:auxiliary-browsing-context>auxiliary browsing contexts</a> (which are protected
    by the <a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag>sandboxed auxiliary navigation browsing context flag</a> defined next), and the
    <a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context>top-level browsing context</a> (which is protected by the <a href=#sandboxed-top-level-navigation-browsing-context-flag id=sandboxing:sandboxed-top-level-navigation-browsing-context-flag>sandboxed top-level
    navigation browsing context flag</a> defined below).</p>

    <p>If the <a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-2>sandboxed auxiliary navigation browsing context flag</a> is not set, then in
    certain cases the restrictions nonetheless allow popups (new <a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-2>top-level browsing contexts</a>) to be opened. These <a href=#browsing-context id=sandboxing:browsing-context>browsing contexts</a> always have <dfn id=one-permitted-sandboxed-navigator>one permitted sandboxed navigator</dfn>, set
    when the browsing context is created, which allows the <a href=#browsing-context id=sandboxing:browsing-context-2>browsing context</a> that
    created them to actually navigate them. (Otherwise, the <a href=#sandboxed-navigation-browsing-context-flag id=sandboxing:sandboxed-navigation-browsing-context-flag>sandboxed navigation browsing
    context flag</a> would prevent them from being navigated even if they were opened.)</p>

   <dt>The <dfn id=sandboxed-auxiliary-navigation-browsing-context-flag data-export="">sandboxed auxiliary navigation browsing context flag</dfn><dd>

    <p>This flag <a href=#sandboxWindowOpen>prevents content from creating new auxiliary browsing
    contexts</a>, e.g. using the <code id=sandboxing:attr-hyperlink-target><a href=#attr-hyperlink-target>target</a></code> attribute or
    the <code id=sandboxing:dom-open><a href=#dom-open>window.open()</a></code> method.</p>

   <dt>The <dfn id=sandboxed-top-level-navigation-browsing-context-flag data-export="">sandboxed top-level navigation browsing context flag</dfn><dd>

    <p>This flag <a href=#sandboxLinks>prevents content from navigating their <span>top-level
    browsing context</span></a> and <a href=#sandboxClose>prevents content from closing their
    <span>top-level browsing context</span></a>.</p>

    <p>When the <a href=#sandboxed-top-level-navigation-browsing-context-flag id=sandboxing:sandboxed-top-level-navigation-browsing-context-flag-2>sandboxed top-level navigation browsing context flag</a> is <em>not</em>
    set, content can navigate its <a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-3>top-level browsing context</a>, but other <a href=#browsing-context id=sandboxing:browsing-context-3>browsing contexts</a> are still protected by the <a href=#sandboxed-navigation-browsing-context-flag id=sandboxing:sandboxed-navigation-browsing-context-flag-2>sandboxed
    navigation browsing context flag</a> and possibly the <a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-3>sandboxed auxiliary navigation
    browsing context flag</a>.</p>

   <dt>The <dfn id=sandboxed-plugins-browsing-context-flag data-export="">sandboxed plugins browsing context flag</dfn><dd>

    <p>This flag prevents content from instantiating <a href=#plugin id=sandboxing:plugin>plugins</a>, whether
    using <a href=#sandboxPluginEmbed>the <code>embed</code> element</a>, <a href=#sandboxPluginObject>the <code>object</code> element</a>, <a href=#sandboxPluginApplet>the <code>applet</code> element</a>, or through <a href=#sandboxPluginNavigate>navigation</a> of a <a href=#nested-browsing-context id=sandboxing:nested-browsing-context>nested browsing context</a>, unless
    those <a href=#plugin id=sandboxing:plugin-2>plugins</a> can be <a href=#concept-plugin-secure id=sandboxing:concept-plugin-secure>secured</a>.</p>

   <dt>The <dfn id=sandboxed-origin-browsing-context-flag data-export="">sandboxed origin browsing context flag</dfn><dd>

    <p>This flag <a href=#sandboxOrigin>forces content into a unique origin</a>, thus preventing
    it from accessing other content from the same <a href=#concept-origin id=sandboxing:concept-origin>origin</a>.</p>

    <p>This flag also <a href=#sandboxCookies>prevents script from reading from or writing to the
    <code>document.cookie</code> IDL attribute</a>, and blocks access to
    <code id=sandboxing:dom-localstorage><a href=#dom-localstorage>localStorage</a></code>.</p>

   <dt>The <dfn id=sandboxed-forms-browsing-context-flag data-export="">sandboxed forms browsing context flag</dfn><dd>

    <p>This flag <a href=#sandboxSubmitBlocked>blocks form submission</a>.</p>

   <dt>The <dfn id=sandboxed-pointer-lock-browsing-context-flag data-export="">sandboxed pointer lock browsing context flag</dfn><dd>

    <p>This flag disables the Pointer Lock API. <a href=#refsPOINTERLOCK>[POINTERLOCK]</a></p>

   <dt>The <dfn id=sandboxed-scripts-browsing-context-flag data-export="">sandboxed scripts browsing context flag</dfn><dd>

    <p>This flag <a href=#sandboxScriptBlocked>blocks script execution</a>.</p>

   <dt>The <dfn id=sandboxed-automatic-features-browsing-context-flag data-export="">sandboxed automatic features browsing context flag</dfn><dd>

    <p>This flag blocks features that trigger automatically, such as <a href=#attr-media-autoplay id=sandboxing:attr-media-autoplay>automatically playing a video</a> or <a href=#attr-fe-autofocus id=sandboxing:attr-fe-autofocus>automatically focusing a form control</a>.</p>

   <dt>The <dfn id=sandboxed-storage-area-urls-flag data-export="">sandboxed storage area URLs flag</dfn><dd>

    <p>This flag prevents URL schemes that use storage areas from being able to access the origin's
    data.</p>

   <dt>The <dfn id=sandboxed-document.domain-browsing-context-flag data-export="">sandboxed <code>document.domain</code>
   browsing context flag</dfn><dd>

    <p>This flag prevents content from using the
    <code id=sandboxing:dom-document-domain><a href=#dom-document-domain>document.domain</a></code> setter.</p>

   <dt>The <dfn id=sandbox-propagates-to-auxiliary-browsing-contexts-flag data-export="">sandbox propagates to auxiliary browsing contexts flag</dfn><dd>

    <p>This flag prevents content from escaping the sandbox by ensuring that any
    <a href=#auxiliary-browsing-context id=sandboxing:auxiliary-browsing-context-2>auxiliary browsing context</a> it creates inherits the content's
    <a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set>active sandboxing flag set</a>.</p>

   <dt>The <dfn id=sandboxed-modals-flag data-export="">sandboxed modals flag</dfn><dd>

    <p>This flag prevents content from using any of the following features to produce modal
    dialogs:</p>

    <ul><li><code id=sandboxing:dom-alert><a href=#dom-alert>window.alert()</a></code><li><code id=sandboxing:dom-confirm><a href=#dom-confirm>window.confirm()</a></code><li><code id=sandboxing:dom-print><a href=#dom-print>window.print()</a></code><li><code id=sandboxing:dom-prompt><a href=#dom-prompt>window.prompt()</a></code><li>the <code id=sandboxing:event-beforeunload><a href=#event-beforeunload>beforeunload</a></code> event</ul>

   <dt>The <dfn id=sandboxed-orientation-lock-browsing-context-flag data-export="">sandboxed orientation lock browsing context flag</dfn><dd>

    <p>This flag disables the ability to lock the screen orientation. <a href=#refsSCREENORIENTATION>[SCREENORIENTATION]</a></p>

   <dt>The <dfn id=sandboxed-presentation-browsing-context-flag data-export="">sandboxed presentation browsing context flag</dfn><dd>

    <p>This flag disables the Presentation API. <a href=#refsPRESENTATION>[PRESENTATION]</a></p>

   </dl>

  <p>When the user agent is to <dfn id=parse-a-sandboxing-directive data-export="">parse a sandboxing directive</dfn>, given a
  string <var>input</var>, a <a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set>sandboxing flag set</a> <var>output</var>, it must run the
  following steps:</p>

  <ol><li><p><a href=#split-a-string-on-spaces id=sandboxing:split-a-string-on-spaces>Split <var>input</var> on spaces</a>,
   to obtain <var>tokens</var>.<li><p>Let <var>output</var> be empty.<li>

    <p>Add the following flags to <var>output</var>:</p>

    <ul><li><p>The <a href=#sandboxed-navigation-browsing-context-flag id=sandboxing:sandboxed-navigation-browsing-context-flag-3>sandboxed navigation browsing context flag</a>.<li><p>The <a href=#sandboxed-auxiliary-navigation-browsing-context-flag id=sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-4>sandboxed auxiliary navigation browsing context flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-popups><code>allow-popups</code></dfn> keyword.<li><p>The <a href=#sandboxed-top-level-navigation-browsing-context-flag id=sandboxing:sandboxed-top-level-navigation-browsing-context-flag-3>sandboxed top-level navigation browsing context flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-top-navigation><code>allow-top-navigation</code></dfn>
     keyword.<li><p>The <a href=#sandboxed-plugins-browsing-context-flag id=sandboxing:sandboxed-plugins-browsing-context-flag>sandboxed plugins browsing context flag</a>.<li>

      <p>The <a href=#sandboxed-origin-browsing-context-flag id=sandboxing:sandboxed-origin-browsing-context-flag>sandboxed origin browsing context flag</a>, unless the <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-same-origin><code>allow-same-origin</code></dfn>
      keyword.</p>

      <div class=note>

       <p>The <code id=sandboxing:attr-iframe-sandbox-allow-same-origin><a href=#attr-iframe-sandbox-allow-same-origin>allow-same-origin</a></code> keyword
       is intended for two cases.</p>

       <p>First, it can be used to allow content from the same site to be sandboxed to disable
       scripting, while still allowing access to the DOM of the sandboxed content.</p>

       <p>Second, it can be used to embed content from a third-party site, sandboxed to prevent that
       site from opening pop-up windows, etc, without preventing the embedded page from
       communicating back to its originating site, using the database APIs to store data, etc.</p>

      </div>

     <li><p>The <a href=#sandboxed-forms-browsing-context-flag id=sandboxing:sandboxed-forms-browsing-context-flag>sandboxed forms browsing context flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-forms><code>allow-forms</code></dfn> keyword.<li><p>The <a href=#sandboxed-pointer-lock-browsing-context-flag id=sandboxing:sandboxed-pointer-lock-browsing-context-flag>sandboxed pointer lock browsing context flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-pointer-lock><code>allow-pointer-lock</code></dfn>
     keyword.<li><p>The <a href=#sandboxed-scripts-browsing-context-flag id=sandboxing:sandboxed-scripts-browsing-context-flag>sandboxed scripts browsing context flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-scripts><code>allow-scripts</code></dfn> keyword.<li>

      <p>The <a href=#sandboxed-automatic-features-browsing-context-flag id=sandboxing:sandboxed-automatic-features-browsing-context-flag>sandboxed automatic features browsing context flag</a>, unless <var>tokens</var> contains the <code id=sandboxing:attr-iframe-sandbox-allow-scripts><a href=#attr-iframe-sandbox-allow-scripts>allow-scripts</a></code> keyword (defined above).</p>

      <p class=note>This flag is relaxed by the same keyword as scripts, because when scripts are
      enabled these features are trivially possible anyway, and it would be unfortunate to force
      authors to use script to do them when sandboxed rather than allowing them to use the
      declarative features.</p>

     <li><p>The <a href=#sandboxed-storage-area-urls-flag id=sandboxing:sandboxed-storage-area-urls-flag>sandboxed storage area URLs flag</a>.<li><p>The <a href=#sandboxed-document.domain-browsing-context-flag id=sandboxing:sandboxed-document.domain-browsing-context-flag>sandboxed <code>document.domain</code> browsing
     context flag</a>.<li><p>The <a href=#sandbox-propagates-to-auxiliary-browsing-contexts-flag id=sandboxing:sandbox-propagates-to-auxiliary-browsing-contexts-flag>sandbox propagates to auxiliary browsing contexts flag</a>, unless
     <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-popups-to-escape-sandbox><code>allow-popups-to-escape-sandbox</code></dfn>
     keyword.<li><p>The <a href=#sandboxed-modals-flag id=sandboxing:sandboxed-modals-flag>sandboxed modals flag</a>, unless <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-modals><code>allow-modals</code></dfn> keyword.<li><p>The <a href=#sandboxed-orientation-lock-browsing-context-flag id=sandboxing:sandboxed-orientation-lock-browsing-context-flag>sandboxed orientation lock browsing context flag</a>, unless
     <var>tokens</var> contains the <dfn id=attr-iframe-sandbox-allow-orientation-lock><code>allow-orientation-lock</code></dfn>
     keyword.<li><p>The <a href=#sandboxed-presentation-browsing-context-flag id=sandboxing:sandboxed-presentation-browsing-context-flag>sandboxed presentation browsing context flag</a>, unless <var>tokens</var>
     contains the <dfn id=attr-iframe-sandbox-allow-presentation><code>allow-presentation</code></dfn>
     keyword.</ul>

   </ol>

  <hr>

  <p>Every <a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-4>top-level browsing context</a> has a <dfn id=popup-sandboxing-flag-set>popup sandboxing flag set</dfn>, which
  is a <a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-2>sandboxing flag set</a>. When a <a href=#browsing-context id=sandboxing:browsing-context-4>browsing context</a> is created, its
  <a href=#popup-sandboxing-flag-set id=sandboxing:popup-sandboxing-flag-set>popup sandboxing flag set</a> must be empty. It is populated by <a href=#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name id=sandboxing:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name>the rules for
  choosing a browsing context given a browsing context name</a>.</p>

  <p>Every <a href=#browsing-context id=sandboxing:browsing-context-5>browsing context</a> that is a <a href=#nested-browsing-context id=sandboxing:nested-browsing-context-2>nested browsing context</a> has an
  <dfn id=iframe-sandboxing-flag-set><code>iframe</code> sandboxing flag set</dfn>, which is a <a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-3>sandboxing flag set</a>.
  Which flags in a <a href=#nested-browsing-context id=sandboxing:nested-browsing-context-3>nested browsing context</a>'s <a href=#iframe-sandboxing-flag-set id=sandboxing:iframe-sandboxing-flag-set><code>iframe</code> sandboxing flag
  set</a> are set at any particular time is determined by the <code id=sandboxing:the-iframe-element><a href=#the-iframe-element>iframe</a></code> element's <code id=sandboxing:attr-iframe-sandbox><a href=#attr-iframe-sandbox>sandbox</a></code> attribute.</p>

  <p>Every <code id=sandboxing:document><a href=#document>Document</a></code> has an <dfn id=active-sandboxing-flag-set>active sandboxing flag set</dfn>, which is a
  <a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-4>sandboxing flag set</a>. When the <code id=sandboxing:document-2><a href=#document>Document</a></code> is created, its <a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set-2>active
  sandboxing flag set</a> must be empty. It is populated by the <a href=#navigate id=sandboxing:navigate>navigation
  algorithm</a>.</p>

  <p>Every resource that is obtained by the <a href=#navigate id=sandboxing:navigate-2>navigation algorithm</a> has
  a <dfn id=forced-sandboxing-flag-set data-export="">forced sandboxing flag set</dfn>, which is a <a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-5>sandboxing flag
  set</a>. A resource by default has no flags set in its <a href=#forced-sandboxing-flag-set id=sandboxing:forced-sandboxing-flag-set>forced sandboxing flag set</a>,
  but other specifications can define that certain flags are set.</p>

  <p class=note>In particular, the <a href=#forced-sandboxing-flag-set id=sandboxing:forced-sandboxing-flag-set-2>forced sandboxing flag set</a> is used by
  <cite>Content Security Policy</cite>. <a href=#refsCSP>[CSP]</a></p>

  <hr>

  <p>To <dfn id=implement-the-sandboxing>implement the sandboxing</dfn> for a <code id=sandboxing:document-3><a href=#document>Document</a></code> object <var>document</var>,
  populate <var>document</var>'s <a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set-3>active sandboxing flag set</a> with the union of the flags
  that are present in the following <a href=#sandboxing-flag-set id=sandboxing:sandboxing-flag-set-6>sandboxing flag
  sets</a>:</p>

  <ul><li><p>If <var>document</var>'s <a href=#concept-document-bc id=sandboxing:concept-document-bc>browsing context</a> is a
   <a href=#top-level-browsing-context id=sandboxing:top-level-browsing-context-5>top-level browsing context</a>, then: the flags set on the <a href=#browsing-context id=sandboxing:browsing-context-6>browsing
   context</a>'s <a href=#popup-sandboxing-flag-set id=sandboxing:popup-sandboxing-flag-set-2>popup sandboxing flag set</a>.<li><p>If <var>document</var>'s <a href=#concept-document-bc id=sandboxing:concept-document-bc-2>browsing context</a> is a
   <a href=#nested-browsing-context id=sandboxing:nested-browsing-context-4>nested browsing context</a>, then: the flags set on the <a href=#browsing-context id=sandboxing:browsing-context-7>browsing context</a>'s
   <a href=#iframe-sandboxing-flag-set id=sandboxing:iframe-sandboxing-flag-set-2><code>iframe</code> sandboxing flag set</a>.<li><p>If <var>document</var>'s <a href=#concept-document-bc id=sandboxing:concept-document-bc-3>browsing context</a> is a
   <a href=#nested-browsing-context id=sandboxing:nested-browsing-context-5>nested browsing context</a>, then: the flags set on the <a href=#browsing-context id=sandboxing:browsing-context-8>browsing context</a>'s
   <a href=#parent-browsing-context id=sandboxing:parent-browsing-context>parent browsing context</a>'s <a href=#active-document id=sandboxing:active-document>active document</a>'s <a href=#active-sandboxing-flag-set id=sandboxing:active-sandboxing-flag-set-4>active sandboxing
   flag set</a>.<li><p>The flags set on <var>document</var>'s resource's <a href=#forced-sandboxing-flag-set id=sandboxing:forced-sandboxing-flag-set-3>forced sandboxing flag set</a>,
   if it has one.</ul>



  <h3 id=history>7.7 Session history and navigation<a href=#history class=self-link></a></h3>

  <h4 id=the-session-history-of-browsing-contexts>7.7.1 The session history of browsing contexts<a href=#the-session-history-of-browsing-contexts class=self-link></a></h4>

  <p>The sequence of <code id=the-session-history-of-browsing-contexts:document><a href=#document>Document</a></code>s in a <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context>browsing context</a> is its <dfn id=session-history>session
  history</dfn>. Each <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-2>browsing context</a>, including <a href=#nested-browsing-context id=the-session-history-of-browsing-contexts:nested-browsing-context>nested browsing contexts</a>, has a distinct session history. A <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-3>browsing
  context</a>'s session history consists of a flat list of <a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry>session history entries</a>. Each <dfn id=session-history-entry>session history entry</dfn> consists, at a
  minimum, of a <a id=the-session-history-of-browsing-contexts:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, and each entry may in addition have a <a href=#state-object id=the-session-history-of-browsing-contexts:state-object>state object</a>, a
  title, a <code id=the-session-history-of-browsing-contexts:document-2><a href=#document>Document</a></code> object, form data, a <a href=#scroll-restoration-mode id=the-session-history-of-browsing-contexts:scroll-restoration-mode>scroll restoration mode</a>, a scroll
  position, a <a href=#browsing-context-name id=the-session-history-of-browsing-contexts:browsing-context-name>browsing context name</a>, and other information associated with it.</p>

  <p class=note>Each entry, when first created, has a <code id=the-session-history-of-browsing-contexts:document-3><a href=#document>Document</a></code>. However, when a
  <code id=the-session-history-of-browsing-contexts:document-4><a href=#document>Document</a></code> is not <a href=#fully-active id=the-session-history-of-browsing-contexts:fully-active>active</a>, it's possible for it to be
  <a href=#discard-a-document id=the-session-history-of-browsing-contexts:discard-a-document>discarded</a> to free resources. The <a id=the-session-history-of-browsing-contexts:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> and
  other data in a <a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry-2>session history entry</a> is then used to bring a new
  <code id=the-session-history-of-browsing-contexts:document-5><a href=#document>Document</a></code> into being to take the place of the original, should the user agent find
  itself having to reactivate that <code id=the-session-history-of-browsing-contexts:document-6><a href=#document>Document</a></code>.</p>

  <p class=note>Titles associated with <a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry-3>session history
  entries</a> need not have any relation with the current <code id=the-session-history-of-browsing-contexts:the-title-element><a href=#the-title-element>title</a></code> of the
  <code id=the-session-history-of-browsing-contexts:document-7><a href=#document>Document</a></code>. The title of a <a href=#session-history-entry id=the-session-history-of-browsing-contexts:session-history-entry-4>session history entry</a> is intended to explain
  the state of the document at that point, so that the user can navigate the document's history.</p>

  <p>URLs without associated <a href=#state-object id=the-session-history-of-browsing-contexts:state-object-2>state objects</a> are added to the
  session history as the user (or script) navigates from page to page.</p>

  <hr>

  <p>Each <code id=the-session-history-of-browsing-contexts:document-8><a href=#document>Document</a></code> object in a <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-4>browsing context</a>'s <a href=#session-history id=the-session-history-of-browsing-contexts:session-history>session
  history</a> is associated with a unique <code id=the-session-history-of-browsing-contexts:history-3><a href=#history-3>History</a></code> object which must all model the
  same underlying <a href=#session-history id=the-session-history-of-browsing-contexts:session-history-2>session history</a>.</p>

  

  <p>The <dfn id=dom-history><code>history</code></dfn> attribute of the <code id=the-session-history-of-browsing-contexts:window><a href=#window>Window</a></code>
  interface must return the object implementing the <code id=the-session-history-of-browsing-contexts:history-3-2><a href=#history-3>History</a></code> interface for this
  <code id=the-session-history-of-browsing-contexts:window-2><a href=#window>Window</a></code> object's <a href=#concept-document-window id=the-session-history-of-browsing-contexts:concept-document-window>associated
  <code>Document</code></a>.</p>

  

  <hr>

  <p>A <dfn id=state-object>state object</dfn> is an object representing a user interface state.</p>

  <p>Pages can <a href=#dom-history-pushstate id=the-session-history-of-browsing-contexts:dom-history-pushstate>add</a> <a href=#state-object id=the-session-history-of-browsing-contexts:state-object-3>state
  objects</a> to the session history. These are then <a href=#event-popstate id=the-session-history-of-browsing-contexts:event-popstate>returned to the
  script</a> when the user (or script) goes back in the history, thus enabling authors to use the
  "navigation" metaphor even in one-page applications.</p>

  <div class=note>

   <p><a href=#state-object id=the-session-history-of-browsing-contexts:state-object-4>State objects</a> are intended to be used for two main purposes:
   first, storing a preparsed description of the state in the <a id=the-session-history-of-browsing-contexts:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> so that in the simple
   case an author doesn't have to do the parsing (though one would still need the parsing for
   handling <a href=https://url.spec.whatwg.org/#concept-url id=the-session-history-of-browsing-contexts:url-4 data-x-internal=url>URLs</a> passed around by users, so it's only a minor
   optimization), and second, so that the author can store state that one wouldn't store in the URL
   because it only applies to the current <code id=the-session-history-of-browsing-contexts:document-9><a href=#document>Document</a></code> instance and it would have to be
   reconstructed if a new <code id=the-session-history-of-browsing-contexts:document-10><a href=#document>Document</a></code> were opened.</p>

   <p>An example of the latter would be something like keeping track of the precise coordinate from
   which a pop-up <code id=the-session-history-of-browsing-contexts:the-div-element><a href=#the-div-element>div</a></code> was made to animate, so that if the user goes back, it can be
   made to animate to the same location. Or alternatively, it could be used to keep a pointer into a
   cache of data that would be fetched from the server based on the information in the
   <a id=the-session-history-of-browsing-contexts:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, so that when going back and forward, the information doesn't have to be fetched
   again.</p>

  </div>

  <hr>

  <p>At any point, one of the entries in the session history is the <dfn id=current-entry>current entry</dfn>. This
  is the entry representing the <a href=#active-document id=the-session-history-of-browsing-contexts:active-document>active document</a> of the <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-5>browsing context</a>.
  Which entry is the <a href=#current-entry id=the-session-history-of-browsing-contexts:current-entry>current entry</a> is changed by the algorithms defined in this
  specification, e.g. during <a href=#traverse-the-history id=the-session-history-of-browsing-contexts:traverse-the-history>session history
  traversal</a>.</p>

  <p class=note>The <a href=#current-entry id=the-session-history-of-browsing-contexts:current-entry-2>current entry</a> is usually an entry for the <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-session-history-of-browsing-contexts:the-document's-address" data-x-internal="the-document's-address">URL</a> of the <code id=the-session-history-of-browsing-contexts:document-11><a href=#document>Document</a></code>. However, it can also be one
  of the entries for <a href=#state-object id=the-session-history-of-browsing-contexts:state-object-5>state objects</a> added to the history by that
  document.</p>

  <p><dfn id=an-entry-with-persisted-user-state>An entry with persisted user state</dfn> is one that also has user-agent defined state.
  This specification does not specify what kind of state can be stored.</p>

  <p class=example>For example, some user agents might want to persist the scroll position, or the
  values of form controls.</p>

  <p class=note>User agents that persist the value of form controls are encouraged to also persist
  their directionality (the value of the element's <code id=the-session-history-of-browsing-contexts:the-dir-attribute><a href=#the-dir-attribute>dir</a></code> attribute).
  This prevents values from being displayed incorrectly after a history traversal when the user had
  originally entered the values with an explicit, non-default directionality.</p>

  <p>An entry's <dfn id=scroll-restoration-mode>scroll restoration mode</dfn> indicates whether the user agent should
  restore the persisted scroll position (if any) when traversing to it. The scroll restoration
  mode may be one of the following:</p>

  <dl><dt>"<dfn id=dom-scrollrestoration-auto><code>auto</code></dfn>"<dd>The user agent is responsible for restoring the scroll position upon navigation.<dt>"<dfn id=dom-scrollrestoration-manual><code>manual</code></dfn>"<dd>The page is responsible for restoring the scroll position and the user agent does not
   attempt to do so automatically</dl>

  <p>If unspecified, the <a href=#scroll-restoration-mode id=the-session-history-of-browsing-contexts:scroll-restoration-mode-2>scroll restoration mode</a> of a new entry must be set to
  "<code id=the-session-history-of-browsing-contexts:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>".</p>

  <p>Entries that consist of <a href=#state-object id=the-session-history-of-browsing-contexts:state-object-6>state objects</a> share the same
  <code id=the-session-history-of-browsing-contexts:document-12><a href=#document>Document</a></code> as the entry for the page that was active when they were added.</p>

  <p>Contiguous entries that differ just by their <a href=https://url.spec.whatwg.org/#concept-url id=the-session-history-of-browsing-contexts:url-6 data-x-internal=url>URLs</a>' <a href=https://url.spec.whatwg.org/#concept-url-fragment id=the-session-history-of-browsing-contexts:concept-url-fragment data-x-internal=concept-url-fragment>fragments</a> also share the same <code id=the-session-history-of-browsing-contexts:document-13><a href=#document>Document</a></code>.</p>

  <p class=note>All entries that share the same <code id=the-session-history-of-browsing-contexts:document-14><a href=#document>Document</a></code> (and that are therefore
  merely different states of one particular document) are contiguous by definition.</p>

  <p>Each <code id=the-session-history-of-browsing-contexts:document-15><a href=#document>Document</a></code> in a <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-6>browsing context</a> can also have a <dfn id=latest-entry>latest
  entry</dfn>. This is the entry for that <code id=the-session-history-of-browsing-contexts:document-16><a href=#document>Document</a></code> to which the <a href=#browsing-context id=the-session-history-of-browsing-contexts:browsing-context-7>browsing
  context</a>'s <a href=#session-history id=the-session-history-of-browsing-contexts:session-history-3>session history</a> was most recently traversed. When a
  <code id=the-session-history-of-browsing-contexts:document-17><a href=#document>Document</a></code> is created, it initially has no <a href=#latest-entry id=the-session-history-of-browsing-contexts:latest-entry>latest entry</a>.</p>

  

  <p>User agents may <a href=#discard-a-document id=the-session-history-of-browsing-contexts:discard-a-document-2>discard</a> the <code id=the-session-history-of-browsing-contexts:document-18><a href=#document>Document</a></code>
  objects of entries other than the <a href=#current-entry id=the-session-history-of-browsing-contexts:current-entry-3>current entry</a> that are not referenced from any
  script, reloading the pages afresh when the user or script navigates back to such pages. This
  specification does not specify when user agents should discard <code id=the-session-history-of-browsing-contexts:document-19><a href=#document>Document</a></code> objects and
  when they should cache them.</p>

  <p>Entries that have had their <code id=the-session-history-of-browsing-contexts:document-20><a href=#document>Document</a></code> objects discarded must, for the purposes of
  the algorithms given below, act as if they had not. When the user or script navigates back or
  forwards to a page which has no in-memory DOM objects, any other entries that shared the same
  <code id=the-session-history-of-browsing-contexts:document-21><a href=#document>Document</a></code> object with it must share the new object as well.</p>

  




  <h4 id=the-history-interface>7.7.2 The <code id=the-history-interface:history-3><a href=#history-3>History</a></code> interface<a href=#the-history-interface class=self-link></a></h4>

  <pre class=idl>enum <dfn id=scrollrestoration>ScrollRestoration</dfn> { "<a href=#dom-scrollrestoration-auto id=the-history-interface:dom-scrollrestoration-auto>auto</a>", "<a href=#dom-scrollrestoration-manual id=the-history-interface:dom-scrollrestoration-manual>manual</a>" };

interface <dfn id=history-3>History</dfn> {
  readonly attribute unsigned long <a href=#dom-history-length id=the-history-interface:dom-history-length>length</a>;
  attribute <a href=#scrollrestoration id=the-history-interface:scrollrestoration>ScrollRestoration</a> <a href=#dom-history-scroll-restoration id=the-history-interface:dom-history-scroll-restoration>scrollRestoration</a>;
  readonly attribute any <a href=#dom-history-state id=the-history-interface:dom-history-state>state</a>;
  void <a href=#dom-history-go id=the-history-interface:dom-history-go>go</a>(optional long delta = 0);
  void <a href=#dom-history-back id=the-history-interface:dom-history-back>back</a>();
  void <a href=#dom-history-forward id=the-history-interface:dom-history-forward>forward</a>();
  void <a href=#dom-history-pushstate id=the-history-interface:dom-history-pushstate>pushState</a>(any data, DOMString title, optional USVString? url = null);
  void <a href=#dom-history-replacestate id=the-history-interface:dom-history-replacestate>replaceState</a>(any data, DOMString title, optional USVString? url = null);
};</pre>

  <dl class=domintro><dt><var>window</var> . <code id=the-history-interface:dom-history><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-length-2><a href=#dom-history-length>length</a></code><dd>

    <p>Returns the number of entries in the <a href=#joint-session-history id=the-history-interface:joint-session-history>joint session history</a>.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-2><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-scroll-restoration-2><a href=#dom-history-scroll-restoration>scrollRestoration</a></code> [ = <var>value</var> ]<dd>

    <p>Returns the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode>scroll restoration mode</a> of the current entry in the <a href=#session-history id=the-history-interface:session-history>session
    history</a>.</p>

    <p>Can be set, to change the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-2>scroll restoration mode</a> of the current entry in the <a href=#session-history id=the-history-interface:session-history-2>session history</a>.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-3><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-state-2><a href=#dom-history-state>state</a></code><dd>

    <p>Returns the current <a href=#state-object id=the-history-interface:state-object>state object</a>.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-4><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-go-2><a href=#dom-history-go>go</a></code>( [ <var>delta</var> ] )<dd>

    <p>Goes back or forward the specified number of steps in the <a href=#joint-session-history id=the-history-interface:joint-session-history-2>joint session history</a>.</p>

    <p>A zero delta will reload the current page.</p>

    <p>If the delta is out of range, does nothing.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-5><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-back-2><a href=#dom-history-back>back</a></code>()<dd>

    <p>Goes back one step in the <a href=#joint-session-history id=the-history-interface:joint-session-history-3>joint session history</a>.</p>

    <p>If there is no previous page, does nothing.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-6><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-forward-2><a href=#dom-history-forward>forward</a></code>()<dd>

    <p>Goes forward one step in the <a href=#joint-session-history id=the-history-interface:joint-session-history-4>joint session history</a>.</p>

    <p>If there is no next page, does nothing.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-7><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-pushstate-2><a href=#dom-history-pushstate>pushState</a></code>(<var>data</var>, <var>title</var> [, <var>url</var> ] )<dd>

    <p>Pushes the given data onto the session history, with the given title, and, if provided and
    not null, the given URL.</p>

   <dt><var>window</var> . <code id=the-history-interface:dom-history-8><a href=#dom-history>history</a></code> . <code id=the-history-interface:dom-history-replacestate-2><a href=#dom-history-replacestate>replaceState</a></code>(<var>data</var>, <var>title</var> [, <var>url</var> ] )<dd>

    <p>Updates the current entry in the session history to have the given data, title, and, if
    provided and not null, URL.</p>

   </dl>



  <p>The <dfn id=joint-session-history>joint session history</dfn> of a <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context>top-level browsing context</a> is the union
  of all the <a href=#session-history id=the-history-interface:session-history-3>session histories</a> of all <a href=#concept-document-bc id=the-history-interface:concept-document-bc>browsing contexts</a> of all the <a href=#fully-active id=the-history-interface:fully-active>fully active</a>
  <code id=the-history-interface:document><a href=#document>Document</a></code> objects that share that <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-2>top-level browsing context</a>, with all
  the entries that are <a href=#current-entry id=the-history-interface:current-entry>current entries</a> in their respective <a href=#session-history id=the-history-interface:session-history-4>session histories</a> removed except for the <a href=#current-entry-of-the-joint-session-history id=the-history-interface:current-entry-of-the-joint-session-history>current entry of
  the joint session history</a>.</p>

  <p>The <dfn id=current-entry-of-the-joint-session-history>current entry of the joint session history</dfn> is the entry that most recently
  became a <a href=#current-entry id=the-history-interface:current-entry-2>current entry</a> in its <a href=#session-history id=the-history-interface:session-history-5>session history</a>.</p>

  <p>Entries in the <a href=#joint-session-history id=the-history-interface:joint-session-history-5>joint session history</a> are ordered chronologically by the time they
  were added to their respective <a href=#session-history id=the-history-interface:session-history-6>session histories</a>. Each entry
  has an index; the earliest entry has index 0, and the subsequent entries are numbered with
  consecutively increasing integers (1, 2, 3, etc).</p>

  <p class=note>Since each <code id=the-history-interface:document-2><a href=#document>Document</a></code> in a <a href=#browsing-context id=the-history-interface:browsing-context>browsing context</a> might have a
  different <a href=#event-loop id=the-history-interface:event-loop>event loop</a>, the actual state of the <a href=#joint-session-history id=the-history-interface:joint-session-history-6>joint session history</a> can
  be somewhat nebulous. For example, two sibling <code id=the-history-interface:the-iframe-element><a href=#the-iframe-element>iframe</a></code> elements could both <a href=#traverse-the-history id=the-history-interface:traverse-the-history>traverse</a> from one unique origin to another at the same time,
  so their precise order might not be well-defined; similarly, since they might only find out about
  each other later, they might disagree about the length of the <a href=#joint-session-history id=the-history-interface:joint-session-history-7>joint session
  history</a>.</p>



  

  <p>The <dfn id=dom-history-length><code>length</code></dfn> attribute of the
  <code id=the-history-interface:history-3-2><a href=#history-3>History</a></code> interface, on getting, must return the number of entries in the
  <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-3>top-level browsing context</a>'s <a href=#joint-session-history id=the-history-interface:joint-session-history-8>joint session history</a>. If this
  <code id=the-history-interface:history-3-3><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-3><a href=#document>Document</a></code> that is not
  <a href=#fully-active id=the-history-interface:fully-active-2>fully active</a>, getting must instead throw a <a id=the-history-interface:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=the-history-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>The actual entries are not accessible from script.</p>

  <p>The <dfn id=dom-history-scroll-restoration><code>scrollRestoration</code></dfn> attribute
  of the History interface, on getting, must return the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-3>scroll restoration mode</a> of the
  current entry in the <a href=#session-history id=the-history-interface:session-history-7>session history</a>. On setting, the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-4>scroll restoration mode
  </a> of the current entry in the <a href=#session-history id=the-history-interface:session-history-8>session history</a> must be set to the new
  value.  If this <code id=the-history-interface:history-3-4><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-4><a href=#document>Document</a></code> that is
  not <a href=#fully-active id=the-history-interface:fully-active-3>fully active</a>, both getting and setting must instead throw a
  <a id=the-history-interface:securityerror-2 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>The <dfn id=dom-history-state><code>state</code></dfn> attribute of the
  <code id=the-history-interface:history-3-5><a href=#history-3>History</a></code> interface, on getting, must return the last value it was set to by the user
  agent. If this <code id=the-history-interface:history-3-6><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-5><a href=#document>Document</a></code> that is
  not <a href=#fully-active id=the-history-interface:fully-active-4>fully active</a>, getting must instead throw a
  <a id=the-history-interface:securityerror-3 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>. Initially, its value must be
  null.</p>

  <p>When the <dfn id=dom-history-go><code>go(<var>delta</var>)</code></dfn> method is
  invoked, if <var>delta</var> is zero, the user agent must act as if the
  <code id=the-history-interface:dom-location-reload><a href=#dom-location-reload>location.reload()</a></code> method was called instead. Otherwise,
  the user agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta>traverse the history by a delta</a> whose value is
  <var>delta</var>. If this <code id=the-history-interface:history-3-7><a href=#history-3>History</a></code> object is associated with a <code id=the-history-interface:document-6><a href=#document>Document</a></code>
  that is not <a href=#fully-active id=the-history-interface:fully-active-5>fully active</a>, invoking must instead throw a
  <a id=the-history-interface:securityerror-4 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>When the <dfn id=dom-history-back><code>back()</code></dfn> method is invoked, the user
  agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta-2>traverse the history by a delta</a> −1. If this <code id=the-history-interface:history-3-8><a href=#history-3>History</a></code>
  object is associated with a <code id=the-history-interface:document-7><a href=#document>Document</a></code> that is not <a href=#fully-active id=the-history-interface:fully-active-6>fully active</a>,
  invoking must instead throw a <a id=the-history-interface:securityerror-5 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=the-history-interface:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>

  <p>When the <dfn id=dom-history-forward><code>forward()</code></dfn> method is invoked, the
  user agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta-3>traverse the history by a delta</a> +1. If this <code id=the-history-interface:history-3-9><a href=#history-3>History</a></code>
  object is associated with a <code id=the-history-interface:document-8><a href=#document>Document</a></code> that is not <a href=#fully-active id=the-history-interface:fully-active-7>fully active</a>,
  invoking must instead throw a <a id=the-history-interface:securityerror-6 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a>
  <code id=the-history-interface:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</p>



  <hr>

  <p>Each <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-4>top-level browsing context</a> has a <dfn id=session-history-traversal-queue>session history traversal queue</dfn>,
  initially empty, to which <a href=#concept-task id=the-history-interface:concept-task>tasks</a> can be added.</p>

  <p>Each <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-5>top-level browsing context</a>, when created, must begin running
  the following algorithm, known as the <dfn id=session-history-event-loop>session history event loop</dfn> for that
  <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-6>top-level browsing context</a>, <a href=#in-parallel id=the-history-interface:in-parallel>in parallel</a>:</p>

  <ol><li><p>Wait until this <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-7>top-level browsing context</a>'s <a href=#session-history-traversal-queue id=the-history-interface:session-history-traversal-queue>session history traversal
   queue</a> is not empty.<li><p>Pull the first <a href=#concept-task id=the-history-interface:concept-task-2>task</a> from this <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-8>top-level browsing
   context</a>'s <a href=#session-history-traversal-queue id=the-history-interface:session-history-traversal-queue-2>session history traversal queue</a>, and execute it.<li><p>Return to the first step of this algorithm.</p>

  </ol>

  <p>The <a href=#session-history-event-loop id=the-history-interface:session-history-event-loop>session history event loop</a> helps coordinate cross-browsing-context transitions
  of the <a href=#joint-session-history id=the-history-interface:joint-session-history-9>joint session history</a>: since each <a href=#browsing-context id=the-history-interface:browsing-context-2>browsing context</a> might, at any
  particular time, have a different <a href=#event-loop id=the-history-interface:event-loop-2>event loop</a> (this can happen if the user agent has
  more than one <a href=#event-loop id=the-history-interface:event-loop-3>event loop</a> per <a href=#unit-of-related-browsing-contexts id=the-history-interface:unit-of-related-browsing-contexts>unit of related browsing contexts</a>),
  transitions would otherwise have to involve cross-event-loop synchronization.</p>

  <hr>

  <p>To <dfn id=traverse-the-history-by-a-delta>traverse the history by a delta</dfn> <var>delta</var>, the user agent must
  append a <a href=#concept-task id=the-history-interface:concept-task-3>task</a> to this <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-9>top-level browsing context</a>'s
  <a href=#session-history-traversal-queue id=the-history-interface:session-history-traversal-queue-3>session history traversal queue</a>, the <a href=#concept-task id=the-history-interface:concept-task-4>task</a>
  consisting of running the following steps:</p>

  <ol><li><p>If the index of the <a href=#current-entry-of-the-joint-session-history id=the-history-interface:current-entry-of-the-joint-session-history-2>current entry of the joint session history</a> plus <var>delta</var> is less than zero or greater than or equal to the number of items in the
   <a href=#joint-session-history id=the-history-interface:joint-session-history-10>joint session history</a>, then abort these steps.</p>

   <li><p>Let <var>specified entry</var> be the entry in the <a href=#joint-session-history id=the-history-interface:joint-session-history-11>joint session
   history</a> whose index is the sum of <var>delta</var> and the index of the
   <a href=#current-entry-of-the-joint-session-history id=the-history-interface:current-entry-of-the-joint-session-history-3>current entry of the joint session history</a>.<li><p>Let <var>specified browsing context</var> be the <a href=#browsing-context id=the-history-interface:browsing-context-3>browsing context</a> of
   the <var>specified entry</var>.<li><p>If the <var>specified browsing context</var>'s <a href=#active-document id=the-history-interface:active-document>active document</a>'s
   <a href=#unload-a-document id=the-history-interface:unload-a-document>unload a document</a> algorithm is currently running, abort these steps.<li>

    <p><a href=#queue-a-task id=the-history-interface:queue-a-task>Queue a task</a> that consists of running the following substeps. The relevant
    <a href=#event-loop id=the-history-interface:event-loop-4>event loop</a> is that of the <var>specified browsing context</var>'s
    <a href=#active-document id=the-history-interface:active-document-2>active document</a>. The <a href=#task-source id=the-history-interface:task-source>task source</a> for the queued task is the
    <a href=#history-traversal-task-source id=the-history-interface:history-traversal-task-source>history traversal task source</a>.</p>

    <ol><li><p>If there is an ongoing attempt to navigate <var>specified browsing context</var>
     that has not yet <a href=#concept-navigate-mature id=the-history-interface:concept-navigate-mature>matured</a> (i.e. it has not passed the
     point of making its <code id=the-history-interface:document-9><a href=#document>Document</a></code> the <a href=#active-document id=the-history-interface:active-document-3>active document</a>), then cancel that
     attempt to navigate the <a href=#browsing-context id=the-history-interface:browsing-context-4>browsing context</a>.<li>

      <p>If the <var>specified browsing context</var>'s <a href=#active-document id=the-history-interface:active-document-4>active document</a> is not
      the same <code id=the-history-interface:document-10><a href=#document>Document</a></code> as the <code id=the-history-interface:document-11><a href=#document>Document</a></code> of the <var>specified
      entry</var>, then run these substeps:</p>

      <ol><li><p><a href=#prompt-to-unload-a-document id=the-history-interface:prompt-to-unload-a-document>Prompt to unload</a> the <a href=#active-document id=the-history-interface:active-document-5>active
       document</a> of the <var>specified browsing context</var>. If the user
       <a href=#refused-to-allow-the-document-to-be-unloaded id=the-history-interface:refused-to-allow-the-document-to-be-unloaded>refused to allow the document to be unloaded</a>, then abort these steps.<li><p><a href=#unload-a-document id=the-history-interface:unload-a-document-2>Unload</a> the <a href=#active-document id=the-history-interface:active-document-6>active document</a> of the
       <var>specified browsing context</var> with the <var>recycle</var> parameter
       set to false.</ol>

     <li><p><a href=#traverse-the-history id=the-history-interface:traverse-the-history-2>Traverse the history</a> of the <var>specified browsing context</var> to
     the <var>specified entry</var>.</p>

    </ol>

   </ol>

  <p>When the user navigates through a <a href=#browsing-context id=the-history-interface:browsing-context-5>browsing context</a>, e.g. using a browser's back
  and forward buttons, the user agent must <a href=#traverse-the-history-by-a-delta id=the-history-interface:traverse-the-history-by-a-delta-4>traverse the history by a delta</a> equivalent
  to the action specified by the user.</p>

  <hr id=history-1> 

  <p>The <dfn id=dom-history-pushstate><code>pushState(<var>data</var>, <var>title</var>, <var>url</var>)</code></dfn> method adds a state object entry to
  the history.<div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> history<span class="and_chr yes"><span>Chrome for Android</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>5+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>5.0+</span></span><span class="and_uc partial"><span>UC Browser for Android (limited)</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>4+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>4.2+</span></span><span class="safari yes"><span>Safari</span> <span>6+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>11.5+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=history">caniuse.com</a></div>

  <p>The <dfn id=dom-history-replacestate><code>replaceState(<var>data</var>, <var>title</var>, <var>url</var>)</code></dfn> method updates the state object,
  title, and optionally the <a id=the-history-interface:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a href=#current-entry id=the-history-interface:current-entry-3>current entry</a> in the history.</p>

  <p>When either of these methods is invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>document</var> be the unique <code id=the-history-interface:document-12><a href=#document>Document</a></code> object this
   <code id=the-history-interface:history-3-10><a href=#history-3>History</a></code> object is associated with.<li><p>If <var>document</var> is not <a href=#fully-active id=the-history-interface:fully-active-8>fully active</a>, throw a
   <a id=the-history-interface:securityerror-7 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Optionally, abort these steps. (For example, the user agent might disallow calls to these
   methods that are invoked on a timer, or from event listeners that are not triggered in response
   to a clear user action, or that are invoked in rapid succession.)<li><p>Let <var>targetRealm</var> be this <code id=the-history-interface:history-3-11><a href=#history-3>History</a></code> object's <a href=#concept-relevant-realm id=the-history-interface:concept-relevant-realm>relevant Realm</a>.<li><p>Let <var>cloned data</var> be <a href=#structuredclone id=the-history-interface:structuredclone>StructuredClone</a>(<var>data</var>,
   <var>targetRealm</var>). Rethrow any exceptions.<li>

    <p>If the third argument is not null, run these substeps:</p>

    <ol><li><a href=#parse-a-url id=the-history-interface:parse-a-url>Parse</a> the value of the third argument, relative to the
     <a href=#relevant-settings-object id=the-history-interface:relevant-settings-object>relevant settings object</a> of this <code id=the-history-interface:history-3-12><a href=#history-3>History</a></code> object.<li>If that fails, throw a <a id=the-history-interface:securityerror-8 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-8><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>
     and abort these steps.<li><p>Let <var>new URL</var> be the <a href=#resulting-url-record id=the-history-interface:resulting-url-record>resulting URL record</a>.<li>Compare <var>new URL</var> to <var>document</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-history-interface:the-document's-address" data-x-internal="the-document's-address">URL</a>. If any component of these two <a href=https://url.spec.whatwg.org/#concept-url id=the-history-interface:url-record data-x-internal=url-record>URL records</a> differ other than the <a href=https://url.spec.whatwg.org/#concept-url-path id=the-history-interface:concept-url-path data-x-internal=concept-url-path>path</a>,
     <a href=https://url.spec.whatwg.org/#concept-url-query id=the-history-interface:concept-url-query data-x-internal=concept-url-query>query</a>, and <a href=https://url.spec.whatwg.org/#concept-url-fragment id=the-history-interface:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> components, then throw a
     <a id=the-history-interface:securityerror-9 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-9><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and abort these steps.<li>If the <a href=https://url.spec.whatwg.org/#concept-url-origin id=the-history-interface:concept-url-origin data-x-internal=concept-url-origin>origin</a> of <var>new URL</var> is not
     <a href=#same-origin id=the-history-interface:same-origin>same origin</a> with the <a href=#concept-origin id=the-history-interface:concept-origin>origin</a> of <var>document</var>, and either the
     <a href=https://url.spec.whatwg.org/#concept-url-path id=the-history-interface:concept-url-path-2 data-x-internal=concept-url-path>path</a> or <a href=https://url.spec.whatwg.org/#concept-url-query id=the-history-interface:concept-url-query-2 data-x-internal=concept-url-query>query</a>
     components of the two <a href=https://url.spec.whatwg.org/#concept-url id=the-history-interface:url-record-2 data-x-internal=url-record>URL records</a> compared in the previous
     step differ, throw a <a id=the-history-interface:securityerror-10 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-history-interface:domexception-10><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> and
     abort these steps. (This prevents sandboxed content from spoofing other pages on the same
     origin.)</ol>

   <li><p>If the third argument is null, then let <var>new URL</var> be the <a id=the-history-interface:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>
   of the <a href=#current-entry id=the-history-interface:current-entry-4>current entry</a>.<li>

    <p>If the method invoked was the <code id=the-history-interface:dom-history-pushstate-3><a href=#dom-history-pushstate>pushState()</a></code>
    method:</p>

    <ol><li>

      <p>Remove all the entries in the <a href=#browsing-context id=the-history-interface:browsing-context-6>browsing context</a>'s <a href=#session-history id=the-history-interface:session-history-9>session history</a>
      after the <a href=#current-entry id=the-history-interface:current-entry-5>current entry</a>. If the <a href=#current-entry id=the-history-interface:current-entry-6>current entry</a> is the last entry in
      the session history, then no entries are removed.</p>

      <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the user
      agent's user interface.</p>

     <li><p>Remove any <a href=#concept-task id=the-history-interface:concept-task-5>tasks</a> queued by the <a href=#history-traversal-task-source id=the-history-interface:history-traversal-task-source-2>history traversal
     task source</a> that are associated with any <code id=the-history-interface:document-13><a href=#document>Document</a></code> objects in the
     <a href=#top-level-browsing-context id=the-history-interface:top-level-browsing-context-10>top-level browsing context</a>'s <a href=#document-family id=the-history-interface:document-family>document family</a>.<li><p>If appropriate, update the <a href=#current-entry id=the-history-interface:current-entry-7>current entry</a> to reflect any state that the user
     agent wishes to persist. The entry is then said to be <a href=#an-entry-with-persisted-user-state id=the-history-interface:an-entry-with-persisted-user-state>an entry with persisted user
     state</a>.<li><p>Add a <a href=#state-object id=the-history-interface:state-object-2>state object</a> entry to the session history, after the <a href=#current-entry id=the-history-interface:current-entry-8>current
     entry</a>, with <var>cloned data</var> as the <a href=#state-object id=the-history-interface:state-object-3>state object</a>, the given
     <var>title</var> as the title, <var>new URL</var> as the <a id=the-history-interface:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>
     of the entry, and the <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-5>scroll restoration mode</a> of the current entry in the
     <a href=#session-history id=the-history-interface:session-history-10>session history</a> as the scroll restoration mode.<li><p>Update the <a href=#current-entry id=the-history-interface:current-entry-9>current entry</a> to be this newly added entry.</ol>

    <p>Otherwise, if the method invoked was the <code id=the-history-interface:dom-history-replacestate-3><a href=#dom-history-replacestate>replaceState()</a></code> method:</p>

    <ol><li><p>Update the <a href=#current-entry id=the-history-interface:current-entry-10>current entry</a> in the session history so that <var>cloned data</var> is the entry's new state object, the given <var>title</var>
     is the new title, and <var>new URL</var> is the entry's new <a id=the-history-interface:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>.</ol>

   <li><p>If the <a href=#current-entry id=the-history-interface:current-entry-11>current entry</a> in the session history represents a non-GET request
   (e.g. it was the result of a POST submission) then update it to instead represent a GET
   request.<li>

    <p>Set <var>document</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-history-interface:the-document's-address-2" data-x-internal="the-document's-address">URL</a> to <var>new
    URL</var>.</p>

    <p class=note>Since this is neither a <a href=#navigate id=the-history-interface:navigate>navigation</a> of the
    <a href=#browsing-context id=the-history-interface:browsing-context-7>browsing context</a> nor a <a href=#traverse-the-history id=the-history-interface:traverse-the-history-3>history traversal</a>,
    it does not cause a <code id=the-history-interface:event-hashchange><a href=#event-hashchange>hashchange</a></code> event to be fired.</p>

   <li>

    <p>Set <code id=the-history-interface:dom-history-state-3><a href=#dom-history-state>history.state</a></code> to
    <a href=#structuredclone id=the-history-interface:structuredclone-2>StructuredClone</a>(<var>cloned data</var>, <var>targetRealm</var>).</p> 

   <li><p>Set the <a href=#current-entry id=the-history-interface:current-entry-12>current entry</a>'s <code id=the-history-interface:document-14><a href=#document>Document</a></code> object's <a href=#latest-entry id=the-history-interface:latest-entry>latest
   entry</a> to the <a href=#current-entry id=the-history-interface:current-entry-13>current entry</a>.</ol>

  <p class=note>The <var>title</var> is purely advisory. User agents might use the title
  in the user interface.</p>

  <p>User agents may limit the number of state objects added to the session history per page. If a
  page hits the UA-defined limit, user agents must remove the entry immediately after the first
  entry for that <code id=the-history-interface:document-15><a href=#document>Document</a></code> object in the session history after having added the new
  entry. (Thus the state history acts as a FIFO buffer for eviction, but as a LIFO buffer for
  navigation.)</p>

  

  <div class=example>

   <p>Consider a game where the user can navigate along a line, such that the user is always at some
   coordinate, and such that the user can bookmark the page corresponding to a particular
   coordinate, to return to it later.</p>

   <p>A static page implementing the x=5 position in such a game could look like the following:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;!-- this is https://example.com/line?x=5 -->
&lt;html lang="en">
&lt;title>Line Game - 5&lt;/title>
&lt;p>You are at coordinate 5 on the line.&lt;/p>
&lt;p>
 &lt;a href="?x=6">Advance to 6&lt;/a> or
 &lt;a href="?x=4">retreat to 4&lt;/a>?
&lt;/p></pre>

   <p>The problem with such a system is that each time the user clicks, the whole page has to be
   reloaded. Here instead is another way of doing it, using script:</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;!-- this starts off as https://example.com/line?x=5 -->
&lt;html lang="en">
&lt;title>Line Game - 5&lt;/title>
&lt;p>You are at coordinate &lt;span id="coord">5&lt;/span> on the line.&lt;/p>
&lt;p>
 &lt;a href="?x=6" onclick="go(1); return false;">Advance to 6&lt;/a> or
 &lt;a href="?x=4" onclick="go(-1); return false;">retreat to 4&lt;/a>?
&lt;/p>
&lt;script>
 var currentPage = 5; // prefilled by server
 function go(d) {
   setupPage(currentPage + d);
   history.pushState(currentPage, document.title, '?x=' + currentPage);
 }
 onpopstate = function(event) {
   setupPage(event.state);
 }
 function setupPage(page) {
   currentPage = page;
   document.title = 'Line Game - ' + currentPage;
   document.getElementById('coord').textContent = currentPage;
   document.links[0].href = '?x=' + (currentPage+1);
   document.links[0].textContent = 'Advance to ' + (currentPage+1);
   document.links[1].href = '?x=' + (currentPage-1);
   document.links[1].textContent = 'retreat to ' + (currentPage-1);
 }
&lt;/script></pre>

   <p>In systems without script, this still works like the previous example. However, users that
   <em>do</em> have script support can now navigate much faster, since there is no network access
   for the same experience. Furthermore, contrary to the experience the user would have with just a
   naïve script-based approach, bookmarking and navigating the session history still work.</p>

   <p>In the example above, the <var>data</var> argument to the <code id=the-history-interface:dom-history-pushstate-4><a href=#dom-history-pushstate>pushState()</a></code> method is the same information as would be sent
   to the server, but in a more convenient form, so that the script doesn't have to parse the URL
   each time the user navigates.</p>

  </div>

  <div class=example>

   <p>Applications might not use the same title for a <a href=#session-history-entry id=the-history-interface:session-history-entry>session history entry</a> as the
   value of the document's <code id=the-history-interface:the-title-element><a href=#the-title-element>title</a></code> element at that time. For example, here is a simple
   page that shows a block in the <code id=the-history-interface:the-title-element-2><a href=#the-title-element>title</a></code> element. Clearly, when navigating backwards to
   a previous state the user does not go back in time, and therefore it would be inappropriate to
   put the time in the session history title.</p>

   <pre>&lt;!DOCTYPE HTML>
&lt;HTML LANG=EN>
&lt;TITLE>Line&lt;/TITLE>
&lt;SCRIPT>
 setInterval(function () { document.title = 'Line - ' + new Date(); }, 1000);
 var i = 1;
 function inc() {
   set(i+1);
   history.pushState(i, 'Line - ' + i);
 }
 function set(newI) {
   i = newI;
   document.forms.F.I.value = newI;
 }
&lt;/SCRIPT>
&lt;BODY ONPOPSTATE="set(event.state)">
&lt;FORM NAME=F>
State: &lt;OUTPUT NAME=I>1&lt;/OUTPUT> &lt;INPUT VALUE="Increment" TYPE=BUTTON ONCLICK="inc()">
&lt;/FORM></pre>

  </div>

  <div class=example>
   <p>Most applications want to use the same <a href=#scroll-restoration-mode id=the-history-interface:scroll-restoration-mode-6>scroll restoration mode</a> value for all of
   their history entries. To achieve this they should set the <code id=the-history-interface:dom-history-scroll-restoration-3><a href=#dom-history-scroll-restoration>scrollRestoration</a></code> attribute as soon as possible
   (e.g., in the first <code id=the-history-interface:the-script-element><a href=#the-script-element>script</a></code> element in the document's <code id=the-history-interface:the-head-element><a href=#the-head-element>head</a></code> element) to
   ensure that any entry added to the history session gets the desired scroll restoration mode.</p>

   <pre>&lt;head>
  &lt;script>
       if ('scrollRestoration' in history)
            history.scrollRestoration = 'manual';
  &lt;/script>
&lt;/head>
   </pre>
  </div>


  

  <h4 id=history-notes>7.7.3 Implementation notes for session history<a href=#history-notes class=self-link></a></h4>
  

  <p><i>This section is non-normative.</i></p>

  <p>The <code id=history-notes:history-3><a href=#history-3>History</a></code> interface is not meant to place restrictions on how implementations
  represent the session history to the user.</p>

  <p>For example, session history could be implemented in a tree-like manner, with each page having
  multiple "forward" pages. This specification doesn't define how the linear list of pages in the
  <code id=history-notes:dom-history><a href=#dom-history>history</a></code> object are derived from the actual session history as
  seen from the user's perspective.</p>

  <p>Similarly, a page containing two <code id=history-notes:the-iframe-element><a href=#the-iframe-element>iframe</a></code>s has a <code id=history-notes:dom-history-2><a href=#dom-history>history</a></code> object distinct from the <code id=history-notes:the-iframe-element-2><a href=#the-iframe-element>iframe</a></code>s' <code id=history-notes:dom-history-3><a href=#dom-history>history</a></code> objects, despite the fact that typical Web browsers present the
  user with just one "Back" button, with a session history that interleaves the navigation of the
  two inner frames and the outer page.</p>


  <p><strong>Security</strong>: It is suggested that to avoid letting a page "hijack" the history
  navigation facilities of a UA by abusing <code id=history-notes:dom-history-pushstate><a href=#dom-history-pushstate>pushState()</a></code>,
  the UA provide the user with a way to jump back to the previous page (rather than just going back
  to the previous state). For example, the back button could have a drop down showing just the pages
  in the session history, and not showing any of the states. Similarly, an aural browser could have
  two "back" commands, one that goes back to the previous state, and one that jumps straight back to
  the previous page.</p>

  <p>For both <code id=history-notes:dom-history-pushstate-2><a href=#dom-history-pushstate>pushState()</a></code> and <code id=history-notes:dom-history-replacestate><a href=#dom-history-replacestate>replaceState()</a></code>, user agents are encouraged to prevent
  abuse of these APIs via too-frequent calls or over-large state objects. As detailed above, the
  algorithm explicitly allows user agents to ignore any such calls when appropriate.</p>


  


  <h4 id=the-location-interface>7.7.4 The <code id=the-location-interface:location><a href=#location>Location</a></code> interface<a href=#the-location-interface class=self-link></a></h4>

  <p>Each <code id=the-location-interface:window><a href=#window>Window</a></code> object is associated with a unique instance of a <code id=the-location-interface:location-2><a href=#location>Location</a></code>
  object, allocated when the <code id=the-location-interface:window-2><a href=#window>Window</a></code> object is created.</p>

  

  <p class=warning>The <code id=the-location-interface:location-3><a href=#location>Location</a></code> exotic object is defined through a mishmash of IDL,
  invocation of JavaScript internal methods post-creation, and overridden JavaScript internal
  methods. Coupled with its scary security policy, please take extra care while implementing
  this excrescence.</p>

  <p>To create a <code id=the-location-interface:location-4><a href=#location>Location</a></code> object, run these steps:</p>

  <ol><li><p>Let <var>location</var> be a new <code id=the-location-interface:location-5><a href=#location>Location</a></code> <a id=the-location-interface:platform-object href=https://heycam.github.io/webidl/#dfn-platform-object data-x-internal=platform-object>platform
   object</a>.<li><p>Perform ! <var>location</var>.[[DefineOwnProperty]]("<code>toString</code>", {
   [[Value]]: <a id=the-location-interface:%objproto_tostring% href=https://tc39.github.io/ecma262/#sec-object.prototype.tostring data-x-internal=%objproto_tostring%>%ObjProto_toString%</a>,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).<li><p>Perform ! <var>location</var>.[[DefineOwnProperty]]("<code>toJSON</code>", {
   [[Value]]: undefined,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).<li><p>Perform ! <var>location</var>.[[DefineOwnProperty]]("<code>valueOf</code>", {
   [[Value]]: <a id=the-location-interface:%objproto_valueof% href=https://tc39.github.io/ecma262/#sec-object.prototype.valueof data-x-internal=%objproto_valueof%>%ObjProto_valueOf%</a>,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).<li><p>Perform ! <var>location</var>.[[DefineOwnProperty]](<a href=#@@toprimitive id=the-location-interface:@@toprimitive>@@toPrimitive</a>, {
   [[Value]]: undefined,
   [[Writable]]: false,
   [[Enumerable]]: false,
   [[Configurable]]: false }).<li><p>Set the value of the <a href=#defaultproperties id=the-location-interface:defaultproperties>[[DefaultProperties]]</a> internal slot of
   <var>location</var> to <var>location</var>.[[OwnPropertyKeys]]().<li><p>Return <var>location</var>.</ol>

  

  <dl class=domintro><dt><var>document</var> . <code id=the-location-interface:dom-document-location><a href=#dom-document-location>location</a></code> [ = <var>value</var> ]<dt><var>window</var> . <code id=the-location-interface:dom-location><a href=#dom-location>location</a></code> [ = <var>value</var> ]<dd>

    <p>Returns a <code id=the-location-interface:location-6><a href=#location>Location</a></code> object with the current page's location.</p>

    <p>Can be set, to navigate to another page.</p>

   </dl>

  

  <p>The <code id=the-location-interface:document><a href=#document>Document</a></code> object's <dfn id=dom-document-location><code>location</code></dfn> attribute's getter must return this
  <code id=the-location-interface:document-2><a href=#document>Document</a></code> object's <a href=#concept-relevant-global id=the-location-interface:concept-relevant-global>relevant global
  object</a>'s <code id=the-location-interface:location-7><a href=#location>Location</a></code> object, if this <code id=the-location-interface:document-3><a href=#document>Document</a></code> object is <a href=#fully-active id=the-location-interface:fully-active>fully
  active</a>, and null otherwise.</p>

  <p>The <code id=the-location-interface:window-3><a href=#window>Window</a></code> object's <dfn id=dom-location><code>location</code></dfn>
  attribute's getter must return this <code id=the-location-interface:window-4><a href=#window>Window</a></code> object's <code id=the-location-interface:location-8><a href=#location>Location</a></code> object.</p>

  

  <p><code id=the-location-interface:location-9><a href=#location>Location</a></code> objects provide a representation of the <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-location-interface:the-document's-address" data-x-internal="the-document's-address">URL</a> of the <a href=#active-document id=the-location-interface:active-document>active document</a> of their
  <code id=the-location-interface:document-4><a href=#document>Document</a></code>'s <a href=#concept-document-bc id=the-location-interface:concept-document-bc>browsing context</a>, and allow the
  <a href=#current-entry id=the-location-interface:current-entry>current entry</a> of the <a href=#browsing-context id=the-location-interface:browsing-context>browsing context</a>'s session history to be changed,
  by adding or replacing entries in the <code id=the-location-interface:dom-history><a href=#dom-history>history</a></code> object.</p>

  <pre class=idl>interface <dfn id=location>Location</dfn> {
  [Unforgeable] stringifier attribute USVString <a href=#dom-location-href id=the-location-interface:dom-location-href>href</a>;
  [Unforgeable] readonly attribute USVString <a href=#dom-location-origin id=the-location-interface:dom-location-origin>origin</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-protocol id=the-location-interface:dom-location-protocol>protocol</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-host id=the-location-interface:dom-location-host>host</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-hostname id=the-location-interface:dom-location-hostname>hostname</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-port id=the-location-interface:dom-location-port>port</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-pathname id=the-location-interface:dom-location-pathname>pathname</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-search id=the-location-interface:dom-location-search>search</a>;
  [Unforgeable] attribute USVString <a href=#dom-location-hash id=the-location-interface:dom-location-hash>hash</a>;

  [Unforgeable] void <a href=#dom-location-assign id=the-location-interface:dom-location-assign>assign</a>(USVString url);
  [Unforgeable] void <a href=#dom-location-replace id=the-location-interface:dom-location-replace>replace</a>(USVString url);
  [Unforgeable] void <a href=#dom-location-reload id=the-location-interface:dom-location-reload>reload</a>();

  [Unforgeable, SameObject] readonly attribute <a href=#domstringlist id=the-location-interface:domstringlist>DOMStringList</a> <a href=#dom-location-ancestororigins id=the-location-interface:dom-location-ancestororigins>ancestorOrigins</a>;
};</pre>

  <dl class=domintro><dt><var>location</var> . <code>toString()</code><dt><var>location</var> . <code id=the-location-interface:dom-location-href-2><a href=#dom-location-href>href</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-10><a href=#location>Location</a></code> object's URL.</p>
    <p>Can be set, to navigate to the given URL.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-origin-2><a href=#dom-location-origin>origin</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-11><a href=#location>Location</a></code> object's URL's origin.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-protocol-2><a href=#dom-location-protocol>protocol</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-12><a href=#location>Location</a></code> object's URL's scheme.</p>
    <p>Can be set, to navigate to the same URL with a changed scheme.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-host-2><a href=#dom-location-host>host</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-13><a href=#location>Location</a></code> object's URL's host and port (if different from the default
    port for the scheme).</p>
    <p>Can be set, to navigate to the same URL with a changed host and port.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-hostname-2><a href=#dom-location-hostname>hostname</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-14><a href=#location>Location</a></code> object's URL's host.</p>
    <p>Can be set, to navigate to the same URL with a changed host.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-port-2><a href=#dom-location-port>port</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-15><a href=#location>Location</a></code> object's URL's port.</p>
    <p>Can be set, to navigate to the same URL with a changed port.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-pathname-2><a href=#dom-location-pathname>pathname</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-16><a href=#location>Location</a></code> object's URL's path.</p>
    <p>Can be set, to navigate to the same URL with a changed path.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-search-2><a href=#dom-location-search>search</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-17><a href=#location>Location</a></code> object's URL's query (includes leading "<code>?</code>" if non-empty).</p>
    <p>Can be set, to navigate to the same URL with a changed query (ignores leading "<code>?</code>").</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-hash-2><a href=#dom-location-hash>hash</a></code><dd>
    <p>Returns the <code id=the-location-interface:location-18><a href=#location>Location</a></code> object's URL's fragment (includes leading "<code>#</code>" if non-empty).</p>
    <p>Can be set, to navigate to the same URL with a changed fragment (ignores leading "<code>#</code>").</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-assign-2><a href=#dom-location-assign>assign</a></code>(<var>url</var>)<dd>
    <p>Navigates to the given URL.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-replace-2><a href=#dom-location-replace>replace</a></code>(<var>url</var>)<dd>
    <p>Removes the current page from the session history and navigates to the given URL.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-reload-2><a href=#dom-location-reload>reload</a></code>()<dd>
    <p>Reloads the current page.</p>
   <dt><var>location</var> . <code id=the-location-interface:dom-location-ancestororigins-2><a href=#dom-location-ancestororigins>ancestorOrigins</a></code><dd>
    <p>Returns a <code id=the-location-interface:domstringlist-2><a href=#domstringlist>DOMStringList</a></code> object listing the origins of the ancestor <a href=#browsing-context id=the-location-interface:browsing-context-2>browsing contexts</a>, from the <a href=#parent-browsing-context id=the-location-interface:parent-browsing-context>parent browsing
    context</a> to the <a href=#top-level-browsing-context id=the-location-interface:top-level-browsing-context>top-level browsing context</a>.</p>
   </dl>

  

  <p>A <code id=the-location-interface:location-19><a href=#location>Location</a></code> object has an associated <dfn id=relevant-document>relevant <code>Document</code></dfn>,
  which is this <code id=the-location-interface:location-20><a href=#location>Location</a></code> object's associated <code id=the-location-interface:document-5><a href=#document>Document</a></code> object's <a href=#concept-document-bc id=the-location-interface:concept-document-bc-2>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-2>active document</a>.</p>

  <p>A <code id=the-location-interface:location-21><a href=#location>Location</a></code> object has an associated <dfn id=concept-location-url>url</dfn>,
  which is this <code id=the-location-interface:location-22><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document>relevant <code>Document</code></a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-location-interface:the-document's-address-2" data-x-internal="the-document's-address">URL</a>.</p>

  <p>A <code id=the-location-interface:location-23><a href=#location>Location</a></code> object has an associated <dfn id=concept-location-ancestor-origins-list>ancestor origins list</dfn>. When a
  <code id=the-location-interface:location-24><a href=#location>Location</a></code> object is created, its <a href=#concept-location-ancestor-origins-list id=the-location-interface:concept-location-ancestor-origins-list>ancestor origins list</a> must be set to a
  <code id=the-location-interface:domstringlist-3><a href=#domstringlist>DOMStringList</a></code> object whose associated list is the <a id=the-location-interface:list href=https://infra.spec.whatwg.org/#list data-x-internal=list>list</a> of strings that
  the following steps would produce:</p>

  <ol><li><p>Let <var>output</var> be a new <a id=the-location-interface:list-2 href=https://infra.spec.whatwg.org/#list data-x-internal=list>list</a> of strings.<li><p>Let <var>current</var> be the <a href=#concept-document-bc id=the-location-interface:concept-document-bc-3>browsing context</a>
   of the <code id=the-location-interface:document-6><a href=#document>Document</a></code> with which this <code id=the-location-interface:location-25><a href=#location>Location</a></code> object is associated.<li><p><i>Loop</i>: If <var>current</var> has no <a href=#parent-browsing-context id=the-location-interface:parent-browsing-context-2>parent browsing context</a>, jump to
   the step labeled <i>end</i>.<li><p>Let <var>current</var> be <var>current</var>'s <a href=#parent-browsing-context id=the-location-interface:parent-browsing-context-3>parent browsing
   context</a>.<li><p><a href=https://infra.spec.whatwg.org/#list-append id=the-location-interface:list-append data-x-internal=list-append>Append</a> the <a href=#unicode-serialisation-of-an-origin id=the-location-interface:unicode-serialisation-of-an-origin>Unicode serialization</a> of <var>current</var>'s <a href=#active-document id=the-location-interface:active-document-3>active document</a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin>origin</a> to <var>output</var>.<li><p>Return to the step labeled <i>loop</i>.<li><p><i>End</i>: Return <var>output</var>.</ol>

  <p>A <code id=the-location-interface:location-26><a href=#location>Location</a></code> object has an associated <dfn id=location-object-setter-navigate><code>Location</code>-object-setter
  navigate</dfn> algorithm, which given a <var>url</var>, runs these steps:</p>

  <ol><li>
    <p>If any of the following conditions are met, let <var>replacement flag</var> be unset;
    otherwise, let it be set:</p>

    <ul class=brief><li>This <code id=the-location-interface:location-27><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-2>relevant <code>Document</code></a> has
     <a href=#completely-loaded id=the-location-interface:completely-loaded>completely loaded</a>, or<li>In the <a href=#concept-task id=the-location-interface:concept-task>task</a> in which the algorithm is running, an
     <a id=the-location-interface:activation-behaviour href=https://dom.spec.whatwg.org/#eventtarget-activation-behavior data-x-internal=activation-behaviour>activation behavior</a> is currently being processed whose <code id=the-location-interface:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event's <code id=the-location-interface:dom-event-istrusted><a data-x-internal=dom-event-istrusted href=https://dom.spec.whatwg.org/#dom-event-istrusted>isTrusted</a></code>
     attribute is true, or<li>In the <a href=#concept-task id=the-location-interface:concept-task-2>task</a> in which the algorithm is running, the event
     listener for a <code id=the-location-interface:event-click-2><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event, whose <code id=the-location-interface:dom-event-istrusted-2><a data-x-internal=dom-event-istrusted href=https://dom.spec.whatwg.org/#dom-event-istrusted>isTrusted</a></code> attribute is true, is being handled.</ul>
   <li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate><code>Location</code>-object navigate</a>, given <var>url</var> and
   <var>replacement flag</var>.</ol>

  <p>To <dfn id=location-object-navigate><code>Location</code>-object navigate</dfn>, given a <var>url</var> and
  <var>replacement flag</var>, run these steps:</p>

  <ol><li><p>The <a href=#source-browsing-context id=the-location-interface:source-browsing-context>source browsing context</a> is the <a href=#responsible-browsing-context id=the-location-interface:responsible-browsing-context>responsible browsing context</a>
   specified by the <a href=#incumbent-settings-object id=the-location-interface:incumbent-settings-object>incumbent settings object</a>.<li>
    <p><a href=#navigate id=the-location-interface:navigate>Navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-3>browsing context</a> to
    <var>url</var>, with the <var><a href=#exceptions-enabled id=the-location-interface:exceptions-enabled>exceptions enabled flag</a></var> set. Rethrow any
    exceptions.</p>

    <p>If the <var>replacement flag</var> is set or the <a href=#browsing-context id=the-location-interface:browsing-context-4>browsing context</a>'s
    <a href=#session-history id=the-location-interface:session-history>session history</a> contains only one <code id=the-location-interface:document-7><a href=#document>Document</a></code>, and that was the
    <code id=the-location-interface:about:blank><a href=#about:blank>about:blank</a></code> <code id=the-location-interface:document-8><a href=#document>Document</a></code> created when the <a href=#browsing-context id=the-location-interface:browsing-context-5>browsing context</a>
    was created, then the navigation must be done with <a href=#replacement-enabled id=the-location-interface:replacement-enabled>replacement enabled</a>.</p>
    
   </ol>

  <p>The <dfn id=dom-location-href><code>href</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-28><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-3>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-2>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin>origin</a>, then throw a
   <a id=the-location-interface:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Return this <code id=the-location-interface:location-29><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url>url</a>,
   <a href=https://url.spec.whatwg.org/#concept-url-serializer id=the-location-interface:concept-url-serializer data-x-internal=concept-url-serializer>serialized</a>.</ol>

  <p>The <code id=the-location-interface:dom-location-href-3><a href=#dom-location-href>href</a></code> attribute's setter must run these steps:</p>

  <ol><li><p><a href=#parse-a-url id=the-location-interface:parse-a-url>Parse</a> the given value relative to the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-2>entry
   settings object</a>. If that failed, throw a <code id=the-location-interface:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate><code>Location</code>-object-setter navigate</a> to the <a href=#resulting-url-record id=the-location-interface:resulting-url-record>resulting URL
   record</a>.</ol>

  <p class=note>The <code id=the-location-interface:dom-location-href-4><a href=#dom-location-href>href</a></code> attribute setter intentionally
  has no security check.</p>

  <p>The <dfn id=dom-location-origin><code>origin</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-30><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-4>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-3>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-2>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-3>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-2>origin</a>, then throw a
   <a id=the-location-interface:securityerror-2 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Return the <a href=#unicode-serialisation-of-an-origin id=the-location-interface:unicode-serialisation-of-an-origin-2>Unicode serialization</a>
   of this <code id=the-location-interface:location-31><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-2>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-origin id=the-location-interface:concept-url-origin data-x-internal=concept-url-origin>origin</a>.</ol>

  <p class="note no-backref">It returns the Unicode rather than the ASCII serialization for
  compatibility with <code id=the-location-interface:messageevent><a href=#messageevent>MessageEvent</a></code>.</p>

  <p>The <dfn id=dom-location-protocol><code>protocol</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-32><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-5>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-4>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-3>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-4>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-3>origin</a>, then throw a
   <a id=the-location-interface:securityerror-3 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Return this <code id=the-location-interface:location-33><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-3>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=the-location-interface:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>,
   followed by "<code>:</code>".</ol>

  <p>The <code id=the-location-interface:dom-location-protocol-3><a href=#dom-location-protocol>protocol</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-34><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-6>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-5>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-4>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-5>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-4>origin</a>, then throw a
   <a id=the-location-interface:securityerror-4 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-35><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-4>url</a>.<li><p>Let <var>possibleFailure</var> be the result of <a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser data-x-internal=basic-url-parser>basic URL
   parsing</a> the given value, followed by "<code>:</code>", with <var>copyURL</var>
   as <var>url</var> and <a id=the-location-interface:scheme-start-state href=https://url.spec.whatwg.org/#scheme-start-state data-x-internal=scheme-start-state>scheme start state</a> as <var>state override</var>.<li><p>If <var>possibleFailure</var> is failure, then throw a
   <a id=the-location-interface:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=the-location-interface:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=the-location-interface:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a> is not an
   <a id=the-location-interface:http(s)-scheme href=https://url.spec.whatwg.org/#http-scheme data-x-internal=http(s)-scheme>HTTP(S) scheme</a>, then terminate these steps.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-2><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p>The <dfn id=dom-location-host><code>host</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-36><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-7>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-6>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-5>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-6>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-5>origin</a>, then throw a
   <a id=the-location-interface:securityerror-5 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>url</var> be this <code id=the-location-interface:location-37><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-5>url</a>.<li><p>If <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=the-location-interface:concept-url-host data-x-internal=concept-url-host>host</a> is null, return the empty
   string.<li><p>If <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=the-location-interface:concept-url-port data-x-internal=concept-url-port>port</a> is null, return
   <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=the-location-interface:concept-url-host-2 data-x-internal=concept-url-host>host</a>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=the-location-interface:host-serializer data-x-internal=host-serializer>serialized</a>.<li><p>Return <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=the-location-interface:concept-url-host-3 data-x-internal=concept-url-host>host</a>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=the-location-interface:host-serializer-2 data-x-internal=host-serializer>serialized</a>, followed by "<code>:</code>" and <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=the-location-interface:concept-url-port-2 data-x-internal=concept-url-port>port</a>, <a href=https://url.spec.whatwg.org/#serialize-an-integer id=the-location-interface:serialize-an-integer data-x-internal=serialize-an-integer>serialized</a>.</ol>

  <p>The <code id=the-location-interface:dom-location-host-3><a href=#dom-location-host>host</a></code> attribute's setter must run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-38><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-8>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-7>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-6>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-7>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-6>origin</a>, then throw a
   <a id=the-location-interface:securityerror-6 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-39><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-6>url</a>.<li><p>If <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag href=https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, terminate these
   steps.<li><p><a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-2 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:host-state href=https://url.spec.whatwg.org/#host-state data-x-internal=host-state>host state</a> as <var>state
   override</var>.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-3><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p>The <dfn id=dom-location-hostname><code>hostname</code></dfn> attribute's getter must
  run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-40><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-9>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-8>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-7>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-8>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-7>origin</a>, then throw a
   <a id=the-location-interface:securityerror-7 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-8><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If this <code id=the-location-interface:location-41><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-7>url</a>'s
   <a href=https://url.spec.whatwg.org/#concept-url-host id=the-location-interface:concept-url-host-4 data-x-internal=concept-url-host>host</a> is null, return the empty string.<li><p>Return this <code id=the-location-interface:location-42><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-8>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=the-location-interface:concept-url-host-5 data-x-internal=concept-url-host>host</a>, <a href=https://url.spec.whatwg.org/#concept-host-serializer id=the-location-interface:host-serializer-3 data-x-internal=host-serializer>serialized</a>.</ol>

  <p>The <code id=the-location-interface:dom-location-hostname-3><a href=#dom-location-hostname>hostname</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-43><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-10>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-9>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-8>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-9>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-8>origin</a>, then throw a
   <a id=the-location-interface:securityerror-8 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-9><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-44><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-9>url</a>.<li><p>If <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-2 href=https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, terminate these
   steps.<li><p><a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-3 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:hostname-state href=https://url.spec.whatwg.org/#hostname-state data-x-internal=hostname-state>hostname state</a> as <var>state
   override</var>.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-4><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p>The <dfn id=dom-location-port><code>port</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-45><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-11>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-10>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-9>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-10>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-9>origin</a>, then throw a
   <a id=the-location-interface:securityerror-9 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-10><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If this <code id=the-location-interface:location-46><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-10>url</a>'s
   <a href=https://url.spec.whatwg.org/#concept-url-port id=the-location-interface:concept-url-port-3 data-x-internal=concept-url-port>port</a> is null, return the empty string.<li><p>Return this <code id=the-location-interface:location-47><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-11>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=the-location-interface:concept-url-port-4 data-x-internal=concept-url-port>port</a>, <a href=https://url.spec.whatwg.org/#serialize-an-integer id=the-location-interface:serialize-an-integer-2 data-x-internal=serialize-an-integer>serialized</a>.</ol>

  <p>The <code id=the-location-interface:dom-location-port-3><a href=#dom-location-port>port</a></code> attribute's setter must run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-48><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-12>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-11>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-10>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-11>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-10>origin</a>, then throw a
   <a id=the-location-interface:securityerror-10 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-11><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-49><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-12>url</a>.<li><p>If <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-host id=the-location-interface:concept-url-host-6 data-x-internal=concept-url-host>host</a> is null,
   <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-3 href=https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, or <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=the-location-interface:concept-url-scheme-3 data-x-internal=concept-url-scheme>scheme</a> is "<code>file</code>", terminate these
   steps.<li><p>If the given value is the empty string, then set <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-port id=the-location-interface:concept-url-port-5 data-x-internal=concept-url-port>port</a> to null.<li><p>Otherwise, <a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-4 data-x-internal=basic-url-parser>basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:port-state href=https://url.spec.whatwg.org/#port-state data-x-internal=port-state>port state</a> as <var>state
   override</var>.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-5><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p>The <dfn id=dom-location-pathname><code>pathname</code></dfn> attribute's getter must
  run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-50><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-13>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-12>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-11>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-12>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-11>origin</a>, then throw a
   <a id=the-location-interface:securityerror-11 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-12><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>url</var> be this <code id=the-location-interface:location-51><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-13>url</a>.<li><p>If <var>url</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-4 href=https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, return the first string
   in <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-path id=the-location-interface:concept-url-path data-x-internal=concept-url-path>path</a>.<li><p>Return "<code>/</code>", followed by the strings in <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-path id=the-location-interface:concept-url-path-2 data-x-internal=concept-url-path>path</a> (including empty strings), separated from each other by
   "<code>/</code>".</ol>

  <p>The <code id=the-location-interface:dom-location-pathname-3><a href=#dom-location-pathname>pathname</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-52><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-14>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-13>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-12>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-13>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-12>origin</a>, then throw a
   <a id=the-location-interface:securityerror-12 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-13><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-53><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-14>url</a>.<li><p>If <var>copyURL</var>'s <a id=the-location-interface:cannot-be-a-base-url-flag-5 href=https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag data-x-internal=cannot-be-a-base-url-flag>cannot-be-a-base-URL flag</a> is set, terminate these
   steps.<li><p>Set <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-path id=the-location-interface:concept-url-path-3 data-x-internal=concept-url-path>path</a> to the empty
   list.<li><p><a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-5 data-x-internal=basic-url-parser>Basic URL parse</a> the given value, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:path-start-state href=https://url.spec.whatwg.org/#path-start-state data-x-internal=path-start-state>path start state</a> as <var>state
   override</var>.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-6><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p>The <dfn id=dom-location-search><code>search</code></dfn> attribute's getter must run
  these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-54><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-15>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-14>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-13>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-14>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-13>origin</a>, then throw a
   <a id=the-location-interface:securityerror-13 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-14><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If this <code id=the-location-interface:location-55><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-15>url</a>'s
   <a href=https://url.spec.whatwg.org/#concept-url-query id=the-location-interface:concept-url-query data-x-internal=concept-url-query>query</a> is either null or the empty string, return the
   empty string.<li><p>Return "<code>?</code>", followed by this <code id=the-location-interface:location-56><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-16>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-query id=the-location-interface:concept-url-query-2 data-x-internal=concept-url-query>query</a>.</ol>

  <p>The <code id=the-location-interface:dom-location-search-3><a href=#dom-location-search>search</a></code> attribute's setter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-57><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-16>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-15>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-14>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-15>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-14>origin</a>, then throw a
   <a id=the-location-interface:securityerror-14 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-15><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-58><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-17>url</a>.<li><p>If the given value is the empty string, set <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-query id=the-location-interface:concept-url-query-3 data-x-internal=concept-url-query>query</a> to null.

   <li>
    <p>Otherwise, run these substeps:</p>

    <ol><li><p>Let <var>input</var> be the given value with a single leading "<code>?</code>"
     removed, if any.<li><p>Set <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-query id=the-location-interface:concept-url-query-4 data-x-internal=concept-url-query>query</a> to the empty
     string.<li><p><a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-6 data-x-internal=basic-url-parser>Basic URL parse</a> <var>input</var>, with
     <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:query-state href=https://url.spec.whatwg.org/#query-state data-x-internal=query-state>query state</a> as <var>state override</var>,
     and the <a href=#relevant-document id=the-location-interface:relevant-document-17>relevant <code>Document</code></a>'s <a id="the-location-interface:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character
     encoding</a> as <var>encoding override</var>.</ol>
   <li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-7><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p>The <dfn id=dom-location-hash><code>hash</code></dfn> attribute's getter must run these
  steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-59><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-18>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-16>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-15>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-16>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-15>origin</a>, then throw a
   <a id=the-location-interface:securityerror-15 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-16><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>If this <code id=the-location-interface:location-60><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-18>url</a>'s
   <a href=https://url.spec.whatwg.org/#concept-url-fragment id=the-location-interface:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is either null or the empty string, return
   the empty string.<li><p>Return "<code>#</code>", followed by this <code id=the-location-interface:location-61><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-19>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=the-location-interface:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>.</ol>

  <p>The <code id=the-location-interface:dom-location-hash-3><a href=#dom-location-hash>hash</a></code> attribute's setter must run these steps:</p>

  <ol><li><p>If this <code id=the-location-interface:location-62><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-19>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-17>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-16>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-17>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-16>origin</a>, then throw a
   <a id=the-location-interface:securityerror-16 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-17><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Let <var>copyURL</var> be a copy of this <code id=the-location-interface:location-63><a href=#location>Location</a></code> object's <a href=#concept-location-url id=the-location-interface:concept-location-url-20>url</a>.<li><p>If <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=the-location-interface:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is "<code>javascript</code>", terminate these steps.<li><p>Let <var>input</var> be the given value with a single leading "<code>#</code>"
   removed, if any.<li><p>Set <var>copyURL</var>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=the-location-interface:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> to the empty
   string.<li><p><a href=https://url.spec.whatwg.org/#concept-basic-url-parser id=the-location-interface:basic-url-parser-7 data-x-internal=basic-url-parser>Basic URL parse</a> <var>input</var>, with
   <var>copyURL</var> as <var>url</var> and <a id=the-location-interface:fragment-state href=https://url.spec.whatwg.org/#fragment-state data-x-internal=fragment-state>fragment state</a> as <var>state
   override</var>.<li><p><a href=#location-object-setter-navigate id=the-location-interface:location-object-setter-navigate-8><code>Location</code>-object-setter navigate</a> to <var>copyURL</var>.</ol>

  <p class=note>Unlike the equivalent API for the <code id=the-location-interface:the-a-element><a href=#the-a-element>a</a></code> and <code id=the-location-interface:the-area-element><a href=#the-area-element>area</a></code> elements,
  the <code id=the-location-interface:dom-location-hash-4><a href=#dom-location-hash>hash</a></code> attribute's setter does not special case the
  empty string to remain compatible with deployed scripts.</p>

  <hr>

  <p>When the <dfn id=dom-location-assign><code>assign(<var>url</var>)</code></dfn>
  method is invoked, the user agent must run the following steps:

  <ol><li><p>If this <code id=the-location-interface:location-64><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-20>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-18>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-17>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-18>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-17>origin</a>, then throw a
   <a id=the-location-interface:securityerror-17 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-18><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p><a href=#parse-a-url id=the-location-interface:parse-a-url-2>Parse</a> <var>url</var> relative to the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-19>entry
   settings object</a>. If that failed, throw a <a id=the-location-interface:syntaxerror-2 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=the-location-interface:domexception-19><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate-2><code>Location</code>-object navigate</a> to the <a href=#resulting-url-record id=the-location-interface:resulting-url-record-2>resulting URL
   record</a>.</ol>

  <p>When the <dfn id=dom-location-replace><code>replace(<var>url</var>)</code></dfn>
  method is invoked, the user agent must run the following steps:

  <ol><li><p><a href=#parse-a-url id=the-location-interface:parse-a-url-3>Parse</a> <var>url</var> relative to the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-20>entry
   settings object</a>. If that failed, throw a <a id=the-location-interface:syntaxerror-3 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a>
   <code id=the-location-interface:domexception-20><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p><a href=#location-object-navigate id=the-location-interface:location-object-navigate-3><code>Location</code>-object navigate</a> to the <a href=#resulting-url-record id=the-location-interface:resulting-url-record-3>resulting URL
   record</a> with the <var>replacement flag</var> set.</ol>

  <p class=note>The <code id=the-location-interface:dom-location-replace-3><a href=#dom-location-replace>replace()</a></code> method intentionally has
  no security check.</p>

  <p>When the <dfn id=dom-location-reload><code>reload()</code></dfn> method is invoked, the
  user agent must run the appropriate steps from the following list:</p>

  <dl class=switch><dt>If this <code id=the-location-interface:location-65><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-21>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-19>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-18>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-21>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-18>origin</a><dd><p>Throw a <a id=the-location-interface:securityerror-18 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-21><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<dt>If the currently executing <a href=#concept-task id=the-location-interface:concept-task-3>task</a> is the dispatch of a <code id=the-location-interface:event-resize><a data-x-internal=event-resize href=https://drafts.csswg.org/cssom-view/#eventdef-window-resize>resize</a></code> event in response to the user resizing the <a href=#browsing-context id=the-location-interface:browsing-context-6>browsing
   context</a><dd><p>Repaint the <a href=#browsing-context id=the-location-interface:browsing-context-7>browsing context</a> and abort these steps.<dt>If the <a href=#browsing-context id=the-location-interface:browsing-context-8>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-4>active document</a> is <a href=#an-iframe-srcdoc-document id=the-location-interface:an-iframe-srcdoc-document>an
   <code>iframe</code> <code>srcdoc</code> document</a><dd><p><a href=#process-the-iframe-attributes id=the-location-interface:process-the-iframe-attributes>Reprocess the <code>iframe</code>
   attributes</a> of the <a href=#browsing-context id=the-location-interface:browsing-context-9>browsing context</a>'s <a href=#browsing-context-container id=the-location-interface:browsing-context-container>browsing context
   container</a>.<dt>If the <a href=#browsing-context id=the-location-interface:browsing-context-10>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-5>active document</a> has its <a href=#reload-override-flag id=the-location-interface:reload-override-flag>reload
   override flag</a> set<dd><p>Perform <a href=#an-overridden-reload id=the-location-interface:an-overridden-reload>an overridden reload</a>, with the <a href=#browsing-context id=the-location-interface:browsing-context-11>browsing context</a> being
   navigated as the <a href=#responsible-browsing-context id=the-location-interface:responsible-browsing-context-2>responsible browsing context</a>. Rethrow any exceptions.<dt>Otherwise<dd><p><a href=#navigate id=the-location-interface:navigate-2>Navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-12>browsing context</a> to
   this <code id=the-location-interface:location-66><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-22>relevant <code>Document</code></a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="the-location-interface:the-document's-address-3" data-x-internal="the-document's-address">URL</a> to perform an <a href=#entry-update id=the-location-interface:entry-update>entry update</a> of the
   <a href=#browsing-context id=the-location-interface:browsing-context-13>browsing context</a>'s <a href=#current-entry id=the-location-interface:current-entry-2>current entry</a>, with the <var><a href=#exceptions-enabled id=the-location-interface:exceptions-enabled-2>exceptions
   enabled flag</a></var> set. The <a href=#source-browsing-context id=the-location-interface:source-browsing-context-2>source browsing context</a> must be the
   <a href=#browsing-context id=the-location-interface:browsing-context-14>browsing context</a> being navigated. This is a <a href=#reload-triggered-navigation id=the-location-interface:reload-triggered-navigation>reload-triggered
   navigation</a>. Rethrow any exceptions.</dl>

  <p>When a user requests that the <a href=#active-document id=the-location-interface:active-document-6>active document</a> of a <a href=#browsing-context id=the-location-interface:browsing-context-15>browsing context</a>
  be reloaded through a user interface element, the user agent should <a href=#navigate id=the-location-interface:navigate-3>navigate</a> the <a href=#browsing-context id=the-location-interface:browsing-context-16>browsing context</a> to the same resource as that
  <code id=the-location-interface:document-9><a href=#document>Document</a></code>, to perform an <a href=#entry-update id=the-location-interface:entry-update-2>entry update</a> of the <a href=#browsing-context id=the-location-interface:browsing-context-17>browsing
  context</a>'s <a href=#current-entry id=the-location-interface:current-entry-3>current entry</a>. This is a <a href=#reload-triggered-navigation id=the-location-interface:reload-triggered-navigation-2>reload-triggered navigation</a>.
  In the case of non-idempotent methods (e.g. HTTP POST), the user agent should prompt the user to
  confirm the operation first, since otherwise transactions (e.g. purchases or database
  modifications) could be repeated. User agents may allow the user to explicitly override any caches
  when reloading. If <a href=#browsing-context id=the-location-interface:browsing-context-18>browsing context</a>'s <a href=#active-document id=the-location-interface:active-document-7>active document</a>'s <a href=#reload-override-flag id=the-location-interface:reload-override-flag-2>reload
  override flag</a> is set, then the user agent may instead perform <a href=#an-overridden-reload id=the-location-interface:an-overridden-reload-2>an overridden
  reload</a> rather than the navigation described in this paragraph (with the <a href=#browsing-context id=the-location-interface:browsing-context-19>browsing
  context</a> being reloaded as the <a href=#source-browsing-context id=the-location-interface:source-browsing-context-3>source browsing context</a>).</p>

  <hr>

  <p>The <dfn id=dom-location-ancestororigins><code>ancestorOrigins</code></dfn> attribute's
  getter must run these steps:

  <ol><li><p>If this <code id=the-location-interface:location-67><a href=#location>Location</a></code> object's <a href=#relevant-document id=the-location-interface:relevant-document-23>relevant <code>Document</code></a>'s
   <a href=#concept-origin id=the-location-interface:concept-origin-20>origin</a> is not <a href=#same-origin-domain id=the-location-interface:same-origin-domain-19>same origin-domain</a> with the <a href=#entry-settings-object id=the-location-interface:entry-settings-object-22>entry settings
   object</a>'s <a href=#concept-settings-object-origin id=the-location-interface:concept-settings-object-origin-19>origin</a>, then throw a
   <a id=the-location-interface:securityerror-19 href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=the-location-interface:domexception-22><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li><p>Otherwise, return this <code id=the-location-interface:location-68><a href=#location>Location</a></code> object's <a href=#concept-location-ancestor-origins-list id=the-location-interface:concept-location-ancestor-origins-list-2>ancestor origins list</a>.</ol>

  <hr>

  <p>As explained earlier, the <code id=the-location-interface:location-69><a href=#location>Location</a></code> exotic object requires additional logic beyond
  IDL for security purposes. The internal slot and internal methods <code id=the-location-interface:location-70><a href=#location>Location</a></code> objects
  must implement are defined below.</p>

  <p>Every <code id=the-location-interface:location-71><a href=#location>Location</a></code> object has a <dfn id=defaultproperties>[[DefaultProperties]]</dfn> internal slot
  representing its own properties at time of its creation.</p>

  <h5 id=location-getprototypeof>7.7.4.1 [[GetPrototypeOf]] ( )<a href=#location-getprototypeof class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-getprototypeof:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return !
   <a id=location-getprototypeof:ordinarygetprototypeof href=https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof data-x-internal=ordinarygetprototypeof>OrdinaryGetPrototypeOf</a>(<b>this</b>).<li><p>Return null.</ol>

  <h5 id=location-setprototypeof>7.7.4.2 [[SetPrototypeOf]] ( <var>V</var> )<a href=#location-setprototypeof class=self-link></a></h5>

  <ol><li><p>Return false.</ol>

  <h5 id=location-isextensible>7.7.4.3 [[IsExtensible]] ( )<a href=#location-isextensible class=self-link></a></h5>

  <ol><li><p>Return true.</ol>

  <h5 id=location-preventextensions>7.7.4.4 [[PreventExtensions]] ( )<a href=#location-preventextensions class=self-link></a></h5>

  <ol><li><p>Return false.</ol>

  <h5 id=location-getownproperty>7.7.4.5 [[GetOwnProperty]] ( <var>P</var> )<a href=#location-getownproperty class=self-link></a></h5>

  <ol><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-getownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then:</p>

    <ol><li><p>Let <var>desc</var> be <a id=location-getownproperty:ordinarygetownproperty href=https://tc39.github.io/ecma262/#sec-ordinarygetownproperty data-x-internal=ordinarygetownproperty>OrdinaryGetOwnProperty</a>(<b>this</b>,
     <var>P</var>).<li><p>If the value of the <a href=#defaultproperties id=location-getownproperty:defaultproperties>[[DefaultProperties]]</a> internal slot of <b>this</b>
     contains <var>P</var>, then set <var>desc</var>.[[Configurable]] to true.<li><p>Return <var>desc</var>.</ol>
   <li><p>Let <var>property</var> be ! <a href=#crossorigingetownpropertyhelper-(-o,-p-) id=location-getownproperty:crossorigingetownpropertyhelper-(-o,-p-)>CrossOriginGetOwnPropertyHelper</a>(<b>this</b>,
   <var>P</var>).<li><p>If <var>property</var> is not undefined, return <var>property</var>.<li><p>Throw a <a id=location-getownproperty:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-getownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=location-defineownproperty>7.7.4.6 [[DefineOwnProperty]] ( <var>P</var>, <var>Desc</var> )<a href=#location-defineownproperty class=self-link></a></h5>

  <ol><li>
    <p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-defineownproperty:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then:</p>

    <ol><li><p>If the value of the <a href=#defaultproperties id=location-defineownproperty:defaultproperties>[[DefaultProperties]]</a> internal slot of <b>this</b>
     contains <var>P</var>, then return false.<li><p>Return ? <a id=location-defineownproperty:ordinarydefineownproperty href=https://tc39.github.io/ecma262/#sec-ordinarydefineownproperty data-x-internal=ordinarydefineownproperty>OrdinaryDefineOwnProperty</a>(<b>this</b>, <var>P</var>,
     <var>Desc</var>).</ol>
   <li><p>Throw a <a id=location-defineownproperty:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-defineownproperty:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=location-get>7.7.4.7 [[Get]] ( <var>P</var>, <var>Receiver</var> )<a href=#location-get class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-get:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-get:ordinaryget href=https://tc39.github.io/ecma262/#sec-ordinaryget data-x-internal=ordinaryget>OrdinaryGet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).<li><p>Return ? <a href=#crossoriginget-(-o,-p,-receiver-) id=location-get:crossoriginget-(-o,-p,-receiver-)>CrossOriginGet</a>(<b>this</b>, <var>P</var>,
   <var>Receiver</var>).</ol>

  <h5 id=location-set>7.7.4.8 [[Set]] ( <var>P</var>, <var>V</var>, <var>Receiver</var> )<a href=#location-set class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-set:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-set:ordinaryset href=https://tc39.github.io/ecma262/#sec-ordinaryset data-x-internal=ordinaryset>OrdinarySet</a>(<b>this</b>, <var>P</var>, <var>Receiver</var>).<li><p>Return ? <a href=#crossoriginset-(-o,-p,-v,-receiver-) id=location-set:crossoriginset-(-o,-p,-v,-receiver-)>CrossOriginSet</a>(<b>this</b>, <var>P</var>, <var>V</var>,
   <var>Receiver</var>).</ol>

  <h5 id=location-delete>7.7.4.9 [[Delete]] ( <var>P</var> )<a href=#location-delete class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-delete:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return ?
   <a id=location-delete:ordinarydelete href=https://tc39.github.io/ecma262/#sec-ordinarydelete data-x-internal=ordinarydelete>OrdinaryDelete</a>(<b>this</b>, <var>P</var>).<li><p>Throw a <a id=location-delete:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=location-delete:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.</ol>

  <h5 id=location-ownpropertykeys>7.7.4.10 [[OwnPropertyKeys]] ( )<a href=#location-ownpropertykeys class=self-link></a></h5>

  <ol><li><p>If <a href=#isplatformobjectsameorigin-(-o-) id=location-ownpropertykeys:isplatformobjectsameorigin-(-o-)>IsPlatformObjectSameOrigin</a>(<b>this</b>) is true, then return !
   <a id=location-ownpropertykeys:ordinaryownpropertykeys href=https://tc39.github.io/ecma262/#sec-ordinaryownpropertykeys data-x-internal=ordinaryownpropertykeys>OrdinaryOwnPropertyKeys</a>(<b>this</b>).<li><p>Return ! <a href=#crossoriginownpropertykeys-(-o-) id=location-ownpropertykeys:crossoriginownpropertykeys-(-o-)>CrossOriginOwnPropertyKeys</a>(<b>this</b>).</ol>

  



  <h3 id=browsing-the-web>7.8 Browsing the Web<a href=#browsing-the-web class=self-link></a></h3>

  

  <h4 id=navigating-across-documents>7.8.1 Navigating across documents<a href=#navigating-across-documents class=self-link></a></h4>

  <p>Certain actions cause the <a href=#browsing-context id=navigating-across-documents:browsing-context>browsing context</a> to <i id=navigating-across-documents:navigate><a href=#navigate>navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class=example>For example, <a href=#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2>following a hyperlink</a>,
  <a href=#concept-form-submit id=navigating-across-documents:concept-form-submit>form submission</a>, and the <code id=navigating-across-documents:dom-open><a href=#dom-open>window.open()</a></code> and <code id=navigating-across-documents:dom-location-assign><a href=#dom-location-assign>location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class=note>A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a href=#an-iframe-srcdoc-document id=navigating-across-documents:an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id=source-browsing-context data-export="">source browsing context</dfn>, which is the
  browsing context which was responsible for starting the navigation.</p>

  
  
  <p>To <dfn id=navigate data-export="">navigate</dfn> a browsing context <var>browsingContext</var> to a
  resource <var>resource</var>, optionally with an <dfn data-export="" id=exceptions-enabled><var>exceptions enabled flag</var></dfn>, the user agent must run these steps:</p>

  <ol><li><p>If <var>resource</var> is a <a id=navigating-across-documents:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, then set <var>resource</var> to a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url data-x-internal=concept-request-url>url</a> is
   <var>resource</var>.<li id=sandboxLinks>
    <p>If the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context>source browsing context</a> is not <a href=#allowed-to-navigate id=navigating-across-documents:allowed-to-navigate>allowed to navigate</a>
    <var>browsingContext</var>, then:</p>

    <ol><li><p>If the <var><a href=#exceptions-enabled id=navigating-across-documents:exceptions-enabled>exceptions enabled flag</a></var> is set, then throw a
     <a id=navigating-across-documents:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=navigating-across-documents:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
      <p>Otherwise, the user agent may instead offer to open <var>resource</var> in a new
      <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context>top-level browsing context</a> or in the <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context-2>top-level browsing context</a> of
      the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-2>source browsing context</a>, at the user's option, in which case the user agent
      must <a href=#navigate id=navigating-across-documents:navigate-2>navigate</a> that designated <a href=#top-level-browsing-context id=navigating-across-documents:top-level-browsing-context-3>top-level
      browsing context</a> to <var>resource</var> as if the user had requested it
      independently.</p>

      <p class=note>Doing so, however, can be dangerous, as it means that the user is overriding
      the author's explicit request to sandbox the content.</p>
     </ol>
   <li><p>If there is a preexisting attempt to navigate <var>browsingContext</var>, and the
   <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-3>source browsing context</a> is the same as <var>browsingContext</var>, and that attempt
   is currently running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document>unload a document</a> algorithm, then abort these steps without
   affecting the preexisting attempt to navigate <var>browsingContext</var>.<li><p>If the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document>prompt to unload a document</a> algorithm is being run for the
   <a href=#active-document id=navigating-across-documents:active-document>active document</a> of <var>browsingContext</var>, then abort these steps without
   affecting the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-2>prompt to unload a document</a> algorithm.<li id=navigate-fragid-step><p>If this is not a <dfn id=reload-triggered-navigation>reload-triggered navigation</dfn>,
   <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-2 data-x-internal=concept-request>request</a>, <var>resource</var>'s
   <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-2 data-x-internal=concept-request-url>url</a> <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals data-x-internal=concept-url-equals>equals</a>
   <var>browsingContext</var>'s <a href=#active-document id=navigating-across-documents:active-document-2>active document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">URL</a> with <var>exclude fragments flag</var> set, and
   <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-3 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is non-null, then <a href=#scroll-to-fragid id=navigating-across-documents:scroll-to-fragid>navigate to that fragment</a> and abort these steps.<li><p>Cancel any preexisting but not yet <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature>mature</a>
   attempt to navigate <var>browsingContext</var>, including canceling any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm started by those attempts. If one of those attempts
   has already created and <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object>initialized a new
   <code>Document</code> object</a>, <a href=#abort-a-document id=navigating-across-documents:abort-a-document>abort</a> that
   <code id=navigating-across-documents:document><a href=#document>Document</a></code> also. (Navigation attempts that have <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-2>matured</a> already have session history entries, and are
   therefore handled during the <a href=#update-the-session-history-with-the-new-page id=navigating-across-documents:update-the-session-history-with-the-new-page>update the session history with the new page</a> algorithm,
   later.)<li>

    <p><a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-3>Prompt to unload</a> the <a href=#active-document id=navigating-across-documents:active-document-3>active
    document</a> of <var>browsingContext</var>. If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=navigating-across-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document
    to be unloaded</a>, then abort these steps.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-3>navigation</a> algorithm gets canceled
    while this step is running, the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-4>prompt to unload a document</a> algorithm must
    nonetheless be run to completion.</p>

   <li><p><a href=#abort-a-document id=navigating-across-documents:abort-a-document-2>Abort</a> the <a href=#active-document id=navigating-across-documents:active-document-4>active document</a> of
   <var>browsingContext</var>.<li>

    <p>If <var>browsingContext</var> is a <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context>nested browsing context</a>, then put it in the
    <a href=#delaying-load-events-mode id=navigating-across-documents:delaying-load-events-mode>delaying <code>load</code> events mode</a>.</p>

    <p>The user agent must take this <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context-2>nested browsing context</a> out of the <a href=#delaying-load-events-mode id=navigating-across-documents:delaying-load-events-mode-2>delaying
    <code>load</code> events mode</a> when this <a href=#navigate id=navigating-across-documents:navigate-4>navigation</a> algorithm later <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-3>matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    

   <li><p>Let <var>navigationType</var> be "<code>form-submission</code>" if the <a href=#navigate id=navigating-across-documents:navigate-5>navigation algorithm</a> was invoked as a result of the <a href=#concept-form-submit id=navigating-across-documents:concept-form-submit-2>form submission algorithm</a>, and "<code>other</code>"
   otherwise.<li><p>Return to whatever algorithm invoked the navigation steps and continue running these steps
   <a href=#in-parallel id=navigating-across-documents:in-parallel>in parallel</a>.<li>

    <p>This is the step that attempts to obtain <var>resource</var>, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response data-x-internal=concept-response>response</a><dd><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response>process a navigate response</a> with null, <var>resource</var>,
     <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-4>source browsing context</a>, and
     <var>browsingContext</var>, and then abort these steps.<dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-3 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-4 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
     is "<code id=navigating-across-documents:javascript-protocol><a href=#javascript-protocol>javascript</a></code>"<dd>

      

      <p><a href=#queue-a-task id=navigating-across-documents:queue-a-task>Queue a task</a> to run <dfn id=javascript-protocol>these
      "<code>javascript:</code> URL" steps</dfn>, associated with the <a href=#active-document id=navigating-across-documents:active-document-5>active document</a>
      of <var>browsingContext</var>:</p>

      <ol id=concept-js-deref><li>
        <p>Let <var>result</var> be undefined, and jump to the step labeled <i>process result</i>
        below if either of the following are true:</p>

        <ul><li><p>The <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-5>source browsing context</a>'s <a href=#active-document id=navigating-across-documents:active-document-6>active document</a>'s
         <a href=#concept-origin id=navigating-across-documents:concept-origin>origin</a> is not the <a href=#same-origin id=navigating-across-documents:same-origin>same origin</a> as <var>browsingContext</var>'s
         <a href=#active-document id=navigating-across-documents:active-document-7>active document</a>'s <a href=#concept-origin id=navigating-across-documents:concept-origin-2>origin</a>.<li><p>The <a id=navigating-across-documents:should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation request of type from source in target be blocked by
         Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when
         executed upon <var>resource</var>, "<code>other</code>", the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-6>source
         browsing context</a>, and <var>browsingContext</var>. <a href=#refsCSP>[CSP]</a></ul>
       <li><p>Let <var>urlString</var> be the result of running the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> on <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-5 data-x-internal=concept-request-url>url</a>.<li><p>Remove the leading "<code>javascript:</code>" string from
       <var>urlString</var>.<li><p>Let <var>script source</var> be the result of applying the <a id=navigating-across-documents:percent-decode href=https://url.spec.whatwg.org/#percent-decode data-x-internal=percent-decode>percent decode</a>
       algorithm to <var>urlString</var>.<li><p>Replace <var>script source</var> with the result of applying the <a id=navigating-across-documents:utf-8-decode href=https://encoding.spec.whatwg.org/#utf-8-decode data-x-internal=utf-8-decode>UTF-8
       decode</a> algorithm to <var>script source</var>.<li><p>Let <var>address</var> be the <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the
       <a href=#active-document id=navigating-across-documents:active-document-8>active document</a> of <var>browsingContext</var>.<li><p>Let <var>settings</var> be the <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object>relevant settings object</a> for the
       <a href=#active-document id=navigating-across-documents:active-document-9>active document</a> of <var>browsingContext</var>.<li><p>Let <var>script</var> be the result of <a href=#creating-a-classic-script id=navigating-across-documents:creating-a-classic-script>creating a classic script</a> given
       <var>script source</var> and <var>settings</var>.<li><p>Let <var>result</var> be the result of <a href=#run-a-classic-script id=navigating-across-documents:run-a-classic-script>running the
       classic script</a> <var>script</var>. If evaluation was unsuccessful, let
       <var>result</var> be undefined instead. (The result will also be undefined if <a href=#concept-bc-noscript id=navigating-across-documents:concept-bc-noscript>scripting is disabled</a>.)<li><p>Let <var>response</var> be null.<li>

        <p><i>Process result</i>: If <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=navigating-across-documents:js-type data-x-internal=js-type>Type</a>(<var>result</var>) is not
        String, then set <var>response</var> to a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-2 data-x-internal=concept-response>response</a> whose <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status data-x-internal=concept-response-status>status</a> is <code>204</code>.</p>

        <p>Otherwise, set <var>response</var> a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-3 data-x-internal=concept-response>response</a>
        whose <a href=https://fetch.spec.whatwg.org/#concept-response-header-list id=navigating-across-documents:concept-response-header-list data-x-internal=concept-response-header-list>header list</a> consists of `<code>Content-Type</code>`/`<code id=navigating-across-documents:text/html><a href=#text/html>text/html</a></code>` and `<code id=navigating-across-documents:http-referrer-policy><a data-x-internal=http-referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header-dfn>Referrer-Policy</a></code>`/<var>settings</var>'s <a id=navigating-across-documents:referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy data-x-internal=referrer-policy>referrer
        policy</a>, whose <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body data-x-internal=concept-response-body>body</a> is <var>result</var>,
        and whose <a href=https://fetch.spec.whatwg.org/#concept-response-https-state id=navigating-across-documents:concept-response-https-state data-x-internal=concept-response-https-state>HTTPS state</a> is
        <var>settings</var>'s <a href=#https-state id=navigating-across-documents:https-state>HTTPS state</a>.</p>

        <p class=warning>The exact conversion between the JavaScript string <var>result</var> and
        the bytes that comprise a <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body-2 data-x-internal=concept-response-body>response body</a> is
        not yet specified, pending further investigation into user agent behavior. See <a href=https://github.com/whatwg/html/issues/1129>issue #1129</a>.</p>

        <p>When it comes time to <a href="#set-the-document's-address" id="navigating-across-documents:set-the-document's-address">set the document's address</a>, use <var>address</var> as
        the <a href=#override-url id=navigating-across-documents:override-url>override URL</a>.</p>
       <li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-2>process a navigate response</a> with <var>resource</var>,
       <var>response</var>, <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-7>source browsing context</a>, and
       <var>browsingContext</var>, and then abort these steps.</ol>

      <p>The <a href=#task-source id=navigating-across-documents:task-source>task source</a> for this <a href=#concept-task id=navigating-across-documents:concept-task>task</a> is the
      <a href=#dom-manipulation-task-source id=navigating-across-documents:dom-manipulation-task-source>DOM manipulation task source</a>.</p>

      <div class=example>

       <p>So for example a <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-2><code>javascript:</code> URL</a> in
       an <code id=navigating-across-documents:attr-hyperlink-href><a href=#attr-hyperlink-href>href</a></code> attribute of an <code id=navigating-across-documents:the-a-element><a href=#the-a-element>a</a></code> element
       would only be evaluated when the link was <a href=#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2-2>followed</a>, while such a URL in the <code id=navigating-across-documents:attr-iframe-src><a href=#attr-iframe-src>src</a></code> attribute of an <code id=navigating-across-documents:the-iframe-element><a href=#the-iframe-element>iframe</a></code> element would be
       evaluated in the context of the <code id=navigating-across-documents:the-iframe-element-2><a href=#the-iframe-element>iframe</a></code>'s own <a href=#nested-browsing-context id=navigating-across-documents:nested-browsing-context-3>nested browsing
       context</a> when the <code id=navigating-across-documents:the-iframe-element-3><a href=#the-iframe-element>iframe</a></code> is being set up; once evaluated, its return value
       (if it was a string) would replace that <a href=#browsing-context id=navigating-across-documents:browsing-context-2>browsing context</a>'s
       <code id=navigating-across-documents:document-2><a href=#document>Document</a></code>, thus also changing the <code id=navigating-across-documents:window><a href=#window>Window</a></code> object of that
       <a href=#browsing-context id=navigating-across-documents:browsing-context-3>browsing context</a>.</p>

      </div>

     <dt>If <var>resource</var> is to be fetched using `<code>GET</code>`, and there are
     <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache>relevant application caches</a> that are
     identified by a URL with the <a href=#same-origin id=navigating-across-documents:same-origin-2>same origin</a> as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign>foreign</a>, and whose <a href=#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode>mode</a> is <a href=#concept-appcache-mode-fast id=navigating-across-documents:concept-appcache-mode-fast>fast</a>, and the user agent is not in a mode where it
     will avoid using <a href=#application-cache id=navigating-across-documents:application-cache>application caches</a><dd>

      <p>Fetch <var>resource</var> from the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection>most
      appropriate application cache</a> of those that match.</p>

      <p class=example>For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

      <p class=XXX>This still needs to be integrated with the Fetch
      standard. <a href=#refsFETCH>[FETCH]</a></p>

     <dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-4 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-6 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a>
     is a <a id=navigating-across-documents:fetch-scheme href=https://url.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a><dd><p>Run <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch>process a navigate fetch</a> given <var>resource</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-8>source
     browsing context</a>, and <var>browsing context</var>, and <var>type</var>.<dt>Otherwise, <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-5 data-x-internal=concept-request>request</a> whose
     <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-7 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-3 data-x-internal=concept-url-scheme>scheme</a>
     is neither "<code id=navigating-across-documents:javascript-protocol-3><a href=#javascript-protocol>javascript</a></code>" nor a <a id=navigating-across-documents:fetch-scheme-2 href=https://url.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch
     scheme</a><dd><p>Run <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme>process a navigate URL scheme</a> given <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-8 data-x-internal=concept-request-url>url</a> and <var>browsingContext</var>.</dl>
   </ol>

  <p>To <dfn id=process-a-navigate-fetch data-export="">process a navigate fetch</dfn>, given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-6 data-x-internal=concept-request>request</a> <var>request</var>, <a href=#browsing-context id=navigating-across-documents:browsing-context-4>browsing context</a>
  <var>sourceBrowsingContext</var>, <a href=#browsing-context id=navigating-across-documents:browsing-context-5>browsing context</a> <var>browsingContext</var>, and
  string <var>type</var>, run these steps:</p>

  <ol><li><p>Let <var>response</var> be null.<li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=navigating-across-documents:concept-request-client data-x-internal=concept-request-client>client</a> to
   <var>sourceBrowsingContext</var>'s <a href=#active-document id=navigating-across-documents:active-document-10>active document</a>'s <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object-2>relevant settings
   object</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=navigating-across-documents:concept-request-destination data-x-internal=concept-request-destination>destination</a> to "<code>document</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-mode id=navigating-across-documents:concept-request-mode data-x-internal=concept-request-mode>mode</a> to "<code>navigate</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-credentials-mode id=navigating-across-documents:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials
   mode</a> to "<code>include</code>", <a id=navigating-across-documents:use-url-credentials-flag href=https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-redirect-mode id=navigating-across-documents:concept-request-redirect-mode data-x-internal=concept-request-redirect-mode>redirect mode</a> to "<code>manual</code>",
   and <a href=https://fetch.spec.whatwg.org/#concept-request-target-client-id id=navigating-across-documents:concept-request-target-client-id data-x-internal=concept-request-target-client-id>target client id</a> to
   <var>browsingContext</var>'s <a href=#active-document id=navigating-across-documents:active-document-11>active document</a>'s <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object-3>relevant settings
   object</a>'s <a href=#concept-environment-id id=navigating-across-documents:concept-environment-id>id</a>.<li><p>If <var>browsingContext</var> is a <a href=#child-browsing-context id=navigating-across-documents:child-browsing-context>child browsing context</a> and the
   <a href=#browsing-context-container id=navigating-across-documents:browsing-context-container>browsing context container</a> of <var>browsingContext</var> has a <a href=#browsing-context-scope-origin id=navigating-across-documents:browsing-context-scope-origin>browsing
   context scope origin</a>, then set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-origin id=navigating-across-documents:concept-request-origin data-x-internal=concept-request-origin>origin</a> to that <a href=#browsing-context-scope-origin id=navigating-across-documents:browsing-context-scope-origin-2>browsing context scope
   origin</a>.<li>
    <p>Create a new <a href=#environment id=navigating-across-documents:environment>environment</a> <var>reservedEnvironment</var>, and set its <a href=#concept-environment-id id=navigating-across-documents:concept-environment-id-2>id</a> to a new unique opaque string, its <a href=#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url>creation URL</a> to <var>request</var>'s
    <a id=navigating-across-documents:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>url</a>, and its <a href=#concept-environment-target-browsing-context id=navigating-across-documents:concept-environment-target-browsing-context>target
    browsing context</a> to <var>browsingContext</var>.</p>

    <p class=note>The created environment's <a href=#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker>active service worker</a> is set in the
    <a href=https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm id=navigating-across-documents:on-fetch-request-algorithm data-x-internal=on-fetch-request-algorithm>handle fetch</a> algorithm during the fetch if its
    <a href=#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url-2>creation URL</a> matches a service worker
    registration. <a href=#refsSW>[SW]</a></p>
   <li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reserved-client id=navigating-across-documents:concept-request-reserved-client data-x-internal=concept-request-reserved-client>reserved
   client</a> to <var>reservedEnvironment</var>.<li>
    <p>If the <a id=navigating-across-documents:should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy-2 href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation request of type from source in target be blocked by Content
    Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon
    <var>request</var>, <var>navigationType</var>, <var>sourceBrowsingContext</var>, and
    <var>browsingContext</var>, then set <var>response</var> to a network error.
    <a href=#refsCSP>[CSP]</a></p>

    <p>Otherwise:</p>

    <ol><li><p><a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch-2 data-x-internal=concept-fetch>Fetch</a> <var>request</var>.<li><p>Wait for the <a href=#concept-task id=navigating-across-documents:concept-task-2>task</a> on the <a href=#networking-task-source id=navigating-across-documents:networking-task-source>networking task
     source</a> to <a id=navigating-across-documents:process-response href=https://fetch.spec.whatwg.org/#process-response data-x-internal=process-response>process response</a> and set <var>response</var> to the
     result.</ol>
   <li id=navigate-redirect-step>
    <p>If <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url data-x-internal=concept-response-location-url>location URL</a>
    and it is either failure or a <a id=navigating-across-documents:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is an <a id=navigating-across-documents:http(s)-scheme href=https://url.spec.whatwg.org/#http-scheme data-x-internal=http(s)-scheme>HTTP(S) scheme</a>, then set
    <var>response</var> to the result of performing <a id=navigating-across-documents:http-redirect-fetch href=https://fetch.spec.whatwg.org/#concept-http-redirect-fetch data-x-internal=http-redirect-fetch>HTTP-redirect fetch</a> using
    <var>request</var> and <var>response</var> and then run this step again.</p>

    <p class=note>Navigation handles redirects manually as navigation is the only place in the web
    platform that cares for redirects to <code id=navigating-across-documents:mailto-protocol><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URLs and
    such.</p>
   <li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-2 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-5 data-x-internal=concept-url-scheme>scheme</a> is "<code>blob</code>", "<code>file</code>", "<code>filesystem</code>", or "<code>javascript</code>", then set <var>response</var> to a network error.<li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-3 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-6 data-x-internal=concept-url-scheme>scheme</a> is a <a id=navigating-across-documents:fetch-scheme-3 href=https://url.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a>, then run
   <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch-2>process a navigate fetch</a> with a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-7 data-x-internal=concept-request>request</a>
   whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-9 data-x-internal=concept-request-url>url</a> is <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-4 data-x-internal=concept-response-location-url>location URL</a>, <var>sourceBrowsingContext</var>,
   <var>browsingContext</var>, and <var>type</var>.

   <li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-5 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, run the
   <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme-2>process a navigate URL scheme</a> given <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-6 data-x-internal=concept-response-location-url>location URL</a> and
   <var>browsingContext</var>.<li>

    <p><strong>Fallback in prefer-online mode</strong>: If <var>response</var> was not fetched from
    an <a href=#application-cache id=navigating-across-documents:application-cache-2>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    there are <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache-2>relevant application caches</a> that are
    identified by a URL with the <a href=#same-origin id=navigating-across-documents:same-origin-3>same origin</a> as the URL in question, and that have this
    URL as one of their entries, excluding entries marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-2>foreign</a>, and whose <a href=#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode-2>mode</a> is <a href=#concept-appcache-mode-prefer-online id=navigating-across-documents:concept-appcache-mode-prefer-online>prefer-online</a>, and the user didn't cancel
    the navigation attempt during the earlier step, and <var>response</var> is either a network
    error or its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-2 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok
    status</a>, then:</p>

    <p>Let <var>candidate</var> be the response identified by the URL in question from the
    <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-2>most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-3>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached response.</p>

   <li>

    <p><strong>Fallback for fallback entries</strong>: If <var>response</var> was not fetched from
    an <a href=#application-cache id=navigating-across-documents:application-cache-3>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    its URL <a href=#concept-appcache-matches-fallback id=navigating-across-documents:concept-appcache-matches-fallback>matches the fallback namespace</a>
    of one or more <a href=#relevant-application-cache id=navigating-across-documents:relevant-application-cache-3>relevant application caches</a>, and
    the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-3>most appropriate application cache</a> of those
    that match does not have an entry in its <a href=#concept-appcache-onlinesafelist id=navigating-across-documents:concept-appcache-onlinesafelist>online
    safelist</a> that has the <a href=#same-origin id=navigating-across-documents:same-origin-4>same origin</a> as <var>response</var>'s URL and that is a
    <a href=#prefix-match id=navigating-across-documents:prefix-match>prefix match</a> for <var>response</var>'s URL, and the user didn't cancel the
    navigation attempt during the earlier step, and <var>response</var> is either a network error or
    its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-3 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status-2 href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok status</a>,
    then:</p>
    

    <p>Let <var>candidate</var> be the <a href=#concept-appcache-fallback id=navigating-across-documents:concept-appcache-fallback>fallback
    response</a> specified for the <a href=#concept-appcache-fallback-ns id=navigating-across-documents:concept-appcache-fallback-ns>fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href=#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-4>most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href=#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-4>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-3" data-x-internal="the-document's-address">URL</a>, if appropriate, will still be the
    originally requested URL, not the fallback URL, but the user agent may indicate to the user that
    the original page load failed, that the page used was a fallback response, and what the URL of
    the fallback response actually is.</p>
   <li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-3>process a navigate response</a> given <var>request</var>,
   <var>response</var>, <var>navigationType</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-9>source browsing context</a>,
   <var>browsingContext</var>, and <var>reservedEnvironment</var>.</ol>

  <p>To <dfn id=process-a-navigate-response data-export="">process a navigate response</dfn>, given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-8 data-x-internal=concept-request>request</a> <var>request</var>, a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-4 data-x-internal=concept-response>response</a> <var>response</var>, a string <var>type</var>, two
  <a href=#browsing-context id=navigating-across-documents:browsing-context-6>browsing contexts</a> <var>source</var> and
  <var>browsingContext</var>, and an optional <a href=#environment id=navigating-across-documents:environment-2>environment</a>
  <var>reservedEnvironment</var>, run these steps:</p>

  <ol><li>
    <p>If any of the following are true, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline>display the inline
    content with an appropriate error shown to the user</a>, with the newly created
    <code id=navigating-across-documents:document-3><a href=#document>Document</a></code> object's <a href=#concept-origin id=navigating-across-documents:concept-origin-3>origin</a> set to a new <a href=#concept-origin-opaque id=navigating-across-documents:concept-origin-opaque>opaque origin</a>, and abort these steps.</p>

    <ul><li><p><var>response</var> is a network error.<li><p class=XXX>TODO: Define <code>X-Frame-Options</code>
     processing here [<a href=https://github.com/whatwg/html/issue/1230>whatwg/html#1230</a>].<li><p>The <a id=navigating-across-documents:should-navigation-response-to-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-response data-x-internal=should-navigation-response-to-navigation-request-of-type-from-source-in-target-be-blocked-by-content-security-policy>Should navigation response to navigation request of type from source in target
     be blocked by Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon <var>request</var>, <var>response</var>,
     <var>type</var>, <var>source</var>, and <var>browsingContext</var>. <a href=#refsCSP>[CSP]</a></ul>

    <p class=note>This is where the network errors defined and propagated by the WHATWG Fetch
    standard, such as DNS or TLS errors, end up being displayed to users. <a href=#refsFETCH>[FETCH]</a></p>
   <li><p>If <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-4 data-x-internal=concept-response-status>status</a> is
   <code>204</code> or <code>205</code>, then abort these steps.<li><p>If <var>response</var> has an `<code id=navigating-across-documents:http-content-disposition><a data-x-internal=http-content-disposition href=https://tools.ietf.org/html/rfc6266>Content-Disposition</a></code>` header specifying the <code>attachment</code> disposition type, then handle it <a href=#as-a-download id=navigating-across-documents:as-a-download>as a download</a> and abort
   these steps.<li><p>Let <var>type</var> be the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=navigating-across-documents:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed type of
   <var>response</var></a>.<li>
    <p>If the user agent has been configured to process resources of the given <var>type</var>
    using some mechanism other than rendering the content in a <a href=#browsing-context id=navigating-across-documents:browsing-context-7>browsing context</a>, then
    skip this step. Otherwise, if the <var>type</var> is one of the following types, jump to the
    appropriate entry in the following list, and process <var>response</var> as described there:</p>

    <dl class=switch><dt>an <a id=navigating-across-documents:html-mime-type href=https://mimesniff.spec.whatwg.org/#html-mime-type data-x-internal=html-mime-type>HTML MIME type</a><dd>Follow the steps given in the <a href=#read-html id=navigating-across-documents:read-html>HTML document</a> section,
     and then, once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-6>navigate</a> algorithm.<dt>an <a id=navigating-across-documents:xml-mime-type href=https://mimesniff.spec.whatwg.org/#xml-mime-type data-x-internal=xml-mime-type>XML MIME type</a> that is not an <a href=#explicitly-supported-xml-type id=navigating-across-documents:explicitly-supported-xml-type>explicitly supported XML
     type</a><dd>Follow the steps given in the <a href=#read-xml id=navigating-across-documents:read-xml>XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps
     given in the <a href=#read-xml id=navigating-across-documents:read-xml-2>XML document</a> section have completed, abort this
     <a href=#navigate id=navigating-across-documents:navigate-7>navigate</a> algorithm.<dt>a <a href=#javascript-mime-type id=navigating-across-documents:javascript-mime-type>JavaScript MIME type</a><dt>a <a href=#json-mime-type id=navigating-across-documents:json-mime-type>JSON MIME type</a> that is not an <a href=#explicitly-supported-json-type id=navigating-across-documents:explicitly-supported-json-type>explicitly supported JSON
     type</a><dt>"<code id=navigating-across-documents:text/cache-manifest><a href=#text/cache-manifest>text/cache-manifest</a></code>"<dt>"<code id=navigating-across-documents:text/css><a href=#text/css>text/css</a></code>"<dt>"<code id=navigating-across-documents:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>"<dt>"<code id=navigating-across-documents:text/vtt><a href=#text/vtt>text/vtt</a></code>"<dd>Follow the steps given in the <a href=#read-text id=navigating-across-documents:read-text>plain text file</a> section,
     and then, once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-8>navigate</a> algorithm.<dt>"<code id=navigating-across-documents:multipart/x-mixed-replace><a href=#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code>"<dd>Follow the steps given in the <a href=#read-multipart-x-mixed-replace id=navigating-across-documents:read-multipart-x-mixed-replace>multipart/x-mixed-replace</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-9>navigate</a> algorithm.<dt>A supported image, video, or audio type<dd>Follow the steps given in the <a href=#read-media id=navigating-across-documents:read-media>media</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-10>navigate</a> algorithm.<dt>A type that will use an external application to render the content in
     <var>browsingContext</var><dd>Follow the steps given in the <a href=#read-plugin id=navigating-across-documents:read-plugin>plugin</a> section, and then,
     once they have completed, abort this <a href=#navigate id=navigating-across-documents:navigate-11>navigate</a> algorithm.</dl>

    <p>An <dfn id=explicitly-supported-xml-type>explicitly supported XML type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href=#plugin id=navigating-across-documents:plugin>plugin</a> rendering
    directly in <var>browsingContext</var>, or a separate application), or one for which the user
    agent has dedicated processing rules (e.g. a Web browser with a built-in Atom feed viewer would
    be said to explicitly support the <code id=navigating-across-documents:application/atom+xml><a href=#application/atom+xml>application/atom+xml</a></code> MIME type), or one for which
    the user agent has a dedicated handler (e.g. one registered using <code id=navigating-across-documents:dom-navigator-registercontenthandler><a href=#dom-navigator-registercontenthandler>registerContentHandler()</a></code>).</p>

    <p>The term <dfn id=json-mime-type>JSON MIME type</dfn> is used to refer to the <a href=https://mimesniff.spec.whatwg.org/#mime-type id=navigating-across-documents:mime-type data-x-internal=mime-type>MIME
    types</a> <code id=navigating-across-documents:application/json><a href=#application/json>application/json</a></code>, <code id=navigating-across-documents:text/json><a href=#text/json>text/json</a></code>, and any <a id=navigating-across-documents:mime-type-2 href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME
    type</a> whose subtype ends with the five characters "<code>+json</code>".

    <p>An <dfn id=explicitly-supported-json-type>explicitly supported JSON type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href=#plugin id=navigating-across-documents:plugin-2>plugin</a> rendering
    directly in <var>browsingContext</var>, or a separate application), or one for which the user
    agent has dedicated processing rules, or one for which the user agent has a dedicated handler
    (e.g. one registered using <code id=navigating-across-documents:dom-navigator-registercontenthandler-2><a href=#dom-navigator-registercontenthandler>registerContentHandler()</a></code>).</p>

    <p><dfn id="set-the-document's-address">Setting the document's address</dfn>: If there is no
    <dfn id=override-url>override URL</dfn>, then any <code id=navigating-across-documents:document-4><a href=#document>Document</a></code> created by these steps must have its
    <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">URL</a> set to the <a id=navigating-across-documents:url-7 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that was
    originally to be fetched, ignoring any other data that was used to obtain the resource. However,
    if there <em>is</em> an <a href=#override-url id=navigating-across-documents:override-url-2>override URL</a>, then any <code id=navigating-across-documents:document-5><a href=#document>Document</a></code> created by
    these steps must have its <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-5" data-x-internal="the-document's-address">URL</a> set to that
    <a id=navigating-across-documents:url-8 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> instead.</p>

    <p class=note>An <a href=#override-url id=navigating-across-documents:override-url-3>override URL</a> is set when <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-4>dereferencing a <code>javascript:</code> URL</a> and when
    performing <a href=#an-overridden-reload id=navigating-across-documents:an-overridden-reload>an overridden reload</a>.</p>

    <p><dfn id=initialise-the-document-object data-export="">Initializing a new <code>Document</code> object</dfn>: when a
    <code id=navigating-across-documents:document-6><a href=#document>Document</a></code> is created as part of the above steps, the user agent will be required to
    additionally run the following algorithm after creating the new object:</p>

    <ol><li><p>Let <var>window</var> be null.<li><p>Let <var>settingsObject</var> be null.<li><p>If <var>browsingContext</var>'s only entry in its <a href=#session-history id=navigating-across-documents:session-history>session history</a> is the
     <code id=navigating-across-documents:about:blank><a href=#about:blank>about:blank</a></code> <code id=navigating-across-documents:document-7><a href=#document>Document</a></code> that was added when <var>browsingContext</var>
     was <a href=#creating-a-new-browsing-context id=navigating-across-documents:creating-a-new-browsing-context>created</a>, and navigation is occurring
     with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled>replacement enabled</a>, and that <code id=navigating-across-documents:document-8><a href=#document>Document</a></code> has the <a href=#same-origin id=navigating-across-documents:same-origin-5>same
     origin</a> as the new <code id=navigating-across-documents:document-9><a href=#document>Document</a></code>, then set <var>window</var> to the
     <code id=navigating-across-documents:window-2><a href=#window>Window</a></code> object of that <code id=navigating-across-documents:document-10><a href=#document>Document</a></code>, and set <var>settingsObject</var> to
     <var>window</var>'s <a href=#relevant-settings-object id=navigating-across-documents:relevant-settings-object-4>relevant settings object</a>.<li>
      <p>Otherwise,</p>

      <ol><li>
        <p>Call the JavaScript <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=navigating-across-documents:js-initializehostdefinedrealm data-x-internal=js-initializehostdefinedrealm>InitializeHostDefinedRealm()</a> abstract operation
        with the following customizations:</p>

        <ul><li><p>For the global object, create a new <code id=navigating-across-documents:window-3><a href=#window>Window</a></code> object and set
         <var>window</var> to it.<li><p>For the global <b>this</b> value, use <var>browsingContext</var>'s
         <code id=navigating-across-documents:windowproxy><a href=#windowproxy>WindowProxy</a></code> object.<li><p>Let <var>realm execution context</var> be the created <a id=navigating-across-documents:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
         context</a>.</ul>
       <li><p><a href=#set-up-a-browsing-context-environment-settings-object id=navigating-across-documents:set-up-a-browsing-context-environment-settings-object>Set up a browsing context environment settings object</a> with <var>realm
       execution context</var> and <var>reservedEnvironment</var>, if present, and set
       <var>settingsObject</var> to the result.</ol>
     <li><p>Set <var>window</var>'s <a href=#concept-document-window id=navigating-across-documents:concept-document-window>associated
     <code>Document</code></a> to the new <code id=navigating-across-documents:document-11><a href=#document>Document</a></code>.<li><p>Set <var>browsingContext</var>'s <code id=navigating-across-documents:windowproxy-2><a href=#windowproxy>WindowProxy</a></code> object's
     <a href=#concept-windowproxy-window id=navigating-across-documents:concept-windowproxy-window>[[Window]]</a> internal slot
     value to <var>window</var>.<li><p>Set the <code id=navigating-across-documents:document-12><a href=#document>Document</a></code>'s <a href=#concept-document-https-state id=navigating-across-documents:concept-document-https-state>HTTPS
     state</a> to the <a href=https://fetch.spec.whatwg.org/#concept-response-https-state id=navigating-across-documents:concept-response-https-state-2 data-x-internal=concept-response-https-state>HTTPS state</a> of the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-5 data-x-internal=concept-response>response</a> used to generate the document.<li><p>Set the <code id=navigating-across-documents:document-13><a href=#document>Document</a></code>'s <a href=#concept-document-referrer-policy id=navigating-across-documents:concept-document-referrer-policy>referrer
     policy</a> to the result of <a href=https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header id=navigating-across-documents:parse-referrer-policy-header data-x-internal=parse-referrer-policy-header>parsing the
     `<code>Referrer-Policy</code>` header</a> of the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-6 data-x-internal=concept-response>response</a> used to generate the document. <a href=#refsREFERRERPOLICY>[REFERRERPOLICY]</a><li><p>Execute the <a id="navigating-across-documents:initialize-a-document's-csp-list" href=https://w3c.github.io/webappsec-csp/#initialize-document-csp data-x-internal="initialize-a-document's-csp-list">Initialize a <code>Document</code>'s CSP list</a>
     algorithm on the <code id=navigating-across-documents:document-14><a href=#document>Document</a></code> object and the <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-7 data-x-internal=concept-response>response</a> used to generate the document. <a href=#refsCSP>[CSP]</a></p>

     <li>
      <p>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-9 data-x-internal=concept-request>request</a>, then set
      <a href="#the-document's-referrer" id="navigating-across-documents:the-document's-referrer">the document's referrer</a> to the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer-2 data-x-internal=concept-url-serializer>serialization</a> of <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer data-x-internal=concept-request-referrer>referrer</a>, if <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer-2 data-x-internal=concept-request-referrer>referrer</a> is a <a id=navigating-across-documents:url-record href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a>, and the empty
      string otherwise.</p>

      <p class=note>Per the WHATWG Fetch standard a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-10 data-x-internal=concept-request>request</a>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer-3 data-x-internal=concept-request-referrer>referrer</a> will be either a <a id=navigating-across-documents:url-record-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a> or
      "<code>no-referrer</code>" at this point.</p>
     <li><p><a href=#implement-the-sandboxing id=navigating-across-documents:implement-the-sandboxing>Implement the sandboxing</a> for the <code id=navigating-across-documents:document-15><a href=#document>Document</a></code>.<li><p><a href=#set-the-allow*-flags id=navigating-across-documents:set-the-allow*-flags>Set the allow* flags</a> for the <code id=navigating-across-documents:document-16><a href=#document>Document</a></code>.<li><p>Set <var>settingsObject</var>'s <a href=#concept-environment-execution-ready-flag id=navigating-across-documents:concept-environment-execution-ready-flag>execution ready flag</a>.<li>
      <p>If <var>settingsObject</var>'s <a href=#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker-2>active service worker</a> is not null,
      then:</p>

      <ol><li>
        <p>If <var>settingsObject</var> is a <a href=https://w3c.github.io/webappsec-secure-contexts/#secure-context id=navigating-across-documents:secure-context data-x-internal=secure-context>secure context</a>,
        then:</p>

        <ol><li><p>If <var>browsingContext</var> has an <a href=#opener-browsing-context id=navigating-across-documents:opener-browsing-context>opener browsing context</a> and
         <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=navigating-across-documents:concept-request-client-2 data-x-internal=concept-request-client>client</a> is a <a href=https://w3c.github.io/webappsec-secure-contexts/#non-secure-context id=navigating-across-documents:non-secure-context data-x-internal=non-secure-context>non-secure context</a>, then <a href=#disowned-its-opener id=navigating-across-documents:disowned-its-opener>disown <var>browsingContext</var>'s opener</a>.</ol>
       <li><p>Otherwise, set <var>settingsObject</var>'s <a href=#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker-3>active service worker</a> to
       null.</ol>
     </ol>

   <li id=navigate-non-Document>

    <p><i>Non-document content</i>: If, given <var>type</var>, the new resource is to be
    handled by displaying some sort of inline content, e.g. a native rendering of the content, an
    error message because the specified type is not supported, or an inline prompt to allow the user
    to select <a href=#dom-navigator-registercontenthandler id=navigating-across-documents:dom-navigator-registercontenthandler-3>a registered handler</a> for
    the given type, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-2>display the inline content</a>, and
    then abort these steps.</p>

    <p class=note>In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   <li><p>Otherwise, the document's <var>type</var> is such that the resource will not affect
   <var>browsingContext</var>, e.g., because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a href=#as-a-download id=navigating-across-documents:as-a-download-2>as a download</a>. <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software>Process the resource appropriately</a>.</p>

  </ol>

  <p>To <dfn id=process-a-navigate-url-scheme>process a navigate URL scheme</dfn>, given a <a id=navigating-across-documents:url-9 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>url</var> and
  <a href=#browsing-context id=navigating-across-documents:browsing-context-8>browsing context</a> <var>browsingContext</var>, run these steps:</p>

  <ol><li><p>If <var>url</var> is to be handled using a mechanism that does not affect
   <var>browsingContext</var>, e.g., because <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-7 data-x-internal=concept-url-scheme>scheme</a> is handled externally, then <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software-2>proceed with that mechanism instead</a>.<li>
    <p>Otherwise, <var>url</var> is to be handled by displaying some sort of inline content, e.g.,
    an error message because the specified scheme is not one of the supported protocols, or an
    inline prompt to allow the user to select <a href=#dom-navigator-registerprotocolhandler id=navigating-across-documents:dom-navigator-registerprotocolhandler>a
    registered handler</a> for the given scheme. <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-3>Display the
    inline content</a>.</p>

    <p class=note>In the case of a registered handler being used, <a href=#navigate id=navigating-across-documents:navigate-12>navigate</a> will be
    invoked with a new URL.</p>
   </ol>

  <p>When a resource is handled by <dfn id=hand-off-to-external-software>passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id=navigating-across-documents:mailto-protocol-2><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-10>source browsing
  context</a>'s <a href=#active-document id=navigating-across-documents:active-document-12>active document</a>'s <a href=#concept-origin id=navigating-across-documents:concept-origin-4>origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href=#navigate id=navigating-across-documents:navigate-13>navigate</a> algorithm, when it was invoked,
  was not <a href=#triggered-by-user-activation id=navigating-across-documents:triggered-by-user-activation>triggered by user activation</a>, the user agent should not invoke the external
  software package without prior user confirmation.</p>

  <p class=example>For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id=update-the-session-history-with-the-new-page>update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a href=#queue-a-task id=navigating-across-documents:queue-a-task-2>queue a task</a> (associated with the <code id=navigating-across-documents:document-17><a href=#document>Document</a></code>
  object of the <a href=#current-entry id=navigating-across-documents:current-entry>current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    <p><a href=#unload-a-document id=navigating-across-documents:unload-a-document-2>Unload</a> the <code id=navigating-across-documents:document-18><a href=#document>Document</a></code> object of the
    <a href=#current-entry id=navigating-across-documents:current-entry-2>current entry</a>, with the <var>recycle</var> parameter set to false.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-14>navigation</a> algorithm is canceled while
    this step is running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-3>unload a document</a> algorithm, then the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-4>unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href=#navigate id=navigating-across-documents:navigate-15>navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   <li>

    <dl><dt>If the navigation was initiated for <dfn id=entry-update>entry update</dfn> of an entry<dd>

      <ol><li><p>Replace the <code id=navigating-across-documents:document-19><a href=#document>Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code id=navigating-across-documents:document-20><a href=#document>Document</a></code>.<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history>Traverse the history</a> to the new entry.</ol>

     <dt>If the navigation was initiated with a <a id=navigating-across-documents:url-10 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals-2 data-x-internal=concept-url-equals>equals</a> the <a href=#browsing-context id=navigating-across-documents:browsing-context-9>browsing context</a>'s <a href=#active-document id=navigating-across-documents:active-document-13>active
     document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">URL</a><dd>
      <ol><li><p>Replace the <a href=#current-entry id=navigating-across-documents:current-entry-3>current entry</a> with a new entry representing the new resource
       and its <code id=navigating-across-documents:document-21><a href=#document>Document</a></code> object, related state, and the default <a href=#scroll-restoration-mode id=navigating-across-documents:scroll-restoration-mode>scroll restoration
       mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>".<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-2>Traverse the history</a> to the new entry.</ol>
     <dt>Otherwise<dd>

      <ol><li>

        <p>Remove all the entries in the <a href=#browsing-context id=navigating-across-documents:browsing-context-10>browsing context</a>'s <a href=#session-history id=navigating-across-documents:session-history-2>session
        history</a> after the <a href=#current-entry id=navigating-across-documents:current-entry-4>current entry</a>. If the <a href=#current-entry id=navigating-across-documents:current-entry-5>current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       <li><p>Append a new entry at the end of the <code id=navigating-across-documents:history-3><a href=#history-3>History</a></code> object representing the new
       resource and its <code id=navigating-across-documents:document-22><a href=#document>Document</a></code> object, related state, and the default <a href=#scroll-restoration-mode id=navigating-across-documents:scroll-restoration-mode-2>scroll
       restoration mode</a> of "<code id=navigating-across-documents:dom-scrollrestoration-auto-2><a href=#dom-scrollrestoration-auto>auto</a></code>".<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-3>Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-2>replacement enabled</a>, then the traversal must itself be initiated with
       <a href=#replacement-enabled id=navigating-across-documents:replacement-enabled-3>replacement enabled</a>.</p>

       </ol>

     </dl>

   <li><p>The <a href=#navigate id=navigating-across-documents:navigate-16>navigation algorithm</a> has now <dfn id=concept-navigate-mature>matured</dfn>.<li><p><i>Fragment loop</i>: <a href=#spin-the-event-loop id=navigating-across-documents:spin-the-event-loop>Spin the event loop</a> for a user-agent-defined amount of
   time, as desired by the user agent implementor. (This is intended to allow the user agent to
   optimize the user experience in the face of performance concerns.)<li><p>If the <code id=navigating-across-documents:document-23><a href=#document>Document</a></code> object has no parser, or its parser has <a href=#stop-parsing id=navigating-across-documents:stop-parsing>stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, then abort
   these steps.<li><p><a href=#scroll-to-the-fragment-identifier id=navigating-across-documents:scroll-to-the-fragment-identifier>Scroll to the fragment</a> given in the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="navigating-across-documents:the-document's-address-7" data-x-internal="the-document's-address">URL</a>. If this fails to find <a href=#the-indicated-part-of-the-document id=navigating-across-documents:the-indicated-part-of-the-document>an indicated part of the document</a>, then return to the <i>fragment
   loop</i> step.</ol>

  <p>The <a href=#task-source id=navigating-across-documents:task-source-2>task source</a> for this <a href=#concept-task id=navigating-across-documents:concept-task-3>task</a> is the
  <a href=#networking-task-source id=navigating-across-documents:networking-task-source-2>networking task source</a>.</p>


  <h4 id=read-html>7.8.2 <dfn>Page load processing model for HTML files</dfn><a href=#read-html class=self-link></a></h4>

  <p>When an HTML document is to be loaded in a <a href=#browsing-context id=read-html:browsing-context>browsing context</a>, the user agent must
  <a href=#queue-a-task id=read-html:queue-a-task>queue a task</a> to create a <code id=read-html:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-html:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-html:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-html:initialise-the-document-object>initialize the <code>Document</code> object</a>, and finally create an <a href=#html-parser id=read-html:html-parser>HTML
  parser</a> and associate it with the <code id=read-html:document-2><a href=#document>Document</a></code>. Each <a href=#concept-task id=read-html:concept-task>task</a> that the <a href=#networking-task-source id=read-html:networking-task-source>networking task source</a> places on the
  <a href=#task-queue id=read-html:task-queue>task queue</a> while fetching runs must then fill the parser's <a href=#the-input-byte-stream id=read-html:the-input-byte-stream>input byte
  stream</a> with the fetched bytes and cause the <a href=#html-parser id=read-html:html-parser-2>HTML parser</a> to perform the
  appropriate processing of the input stream.</p>

  <p class=note>The <a href=#the-input-byte-stream id=read-html:the-input-byte-stream-2>input byte stream</a> converts bytes into characters for use in the
  <a href=#tokenization id=read-html:tokenization>tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a href=#content-type id=read-html:content-type>Content-Type metadata</a> of the
  resource; the computed type is not used for this purpose.</p>

  

  <p>When no more bytes are available, the user agent must <a href=#queue-a-task id=read-html:queue-a-task-2>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-html:event-load><a href=#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-html:document-3><a href=#document>Document</a></code> object, but before any script execution, certainly
  before the parser <a href=#stop-parsing id=read-html:stop-parsing>stops</a>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-html:update-the-session-history-with-the-new-page>update the
  session history with the new page</a>.</p>

  <p class=note><a href=#concept-appcache-init id=read-html:concept-appcache-init>Application cache selection</a> happens <a href=#parser-appcache>in the HTML parser</a>.</p>

  <p>The <a href=#task-source id=read-html:task-source>task source</a> for the two tasks mentioned in this section must be the
  <a href=#networking-task-source id=read-html:networking-task-source-2>networking task source</a>.</p>



  <h4 id=read-xml>7.8.3 <dfn>Page load processing model for XML files</dfn><a href=#read-xml class=self-link></a></h4><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=bugs><strong>Spec bugs:</strong> <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=17976" title="xml-stylesheet with type=text/xsl needs to be handled explicitly">17976</a></div>

  <p>When faced with displaying an XML file inline, user agents must follow the requirements defined
  in the XML and Namespaces in XML recommendations, RFC 7303, DOM, and other relevant specifications
  to create a <code id=read-xml:document><a href=#document>Document</a></code> object and a corresponding <a href=#xml-parser id=read-xml:xml-parser>XML parser</a>. <a href=#refsXML>[XML]</a> <a href=#refsXMLNS>[XMLNS]</a> <a href=#refsRFC7303>[RFC7303]</a> <a href=#refsDOM>[DOM]</a></p>

  <p class=note>At the time of writing, the XML specification community had not actually yet
  specified how XML and the DOM interact.</p> 

  <p>After the <code id=read-xml:document-2><a href=#document>Document</a></code> is created, the user agent must <a href=#initialise-the-document-object id=read-xml:initialise-the-document-object>initialize the
  <code>Document</code> object</a>.</p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a id="read-xml:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the <a id=read-xml:document-element href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a>, as parsed according to the XML specifications cited
  above, is found to be an <code id=read-xml:the-html-element><a href=#the-html-element>html</a></code> element with an attribute <code id=read-xml:attr-html-manifest><a href=#attr-html-manifest>manifest</a></code> whose value is not the empty string, then, as soon as
  the element is <a href=#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document>inserted into the document</a>,
  the user agent must <a href=#parse-a-url id=read-xml:parse-a-url>parse</a> the value of that attribute relative
  to that element's <a id=read-xml:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a>, and if that is successful, must apply the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=read-xml:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> algorithm to the <a href=#resulting-url-record id=read-xml:resulting-url-record>resulting URL
  record</a> with the <i>exclude fragment flag</i> set to obtain <var>manifest URL</var>, and
  then run the <a href=#concept-appcache-init id=read-xml:concept-appcache-init>application cache selection algorithm</a>
  with <var>manifest URL</var> as the manifest URL, passing in the newly-created
  <code id=read-xml:document-3><a href=#document>Document</a></code>. Otherwise, if the attribute is absent, its value is the empty string, or
  parsing its value fails, then as soon as the <a id=read-xml:document-element-2 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> is <a href=#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document-2>inserted into the document</a>, the user agent must run the <a href=#concept-appcache-init id=read-xml:concept-appcache-init-2>application cache selection algorithm</a> with no manifest, and
  passing in the <code id=read-xml:document-4><a href=#document>Document</a></code>.</p>

  <p class=note>Because the processing of the <code id=read-xml:attr-html-manifest-2><a href=#attr-html-manifest>manifest</a></code>
  attribute happens only once the <a id=read-xml:document-element-3 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> is parsed, any URLs referenced by
  processing instructions before the <a id=read-xml:document-element-4 href=https://dom.spec.whatwg.org/#document-element data-x-internal=document-element>document element</a> (such as <code>&lt;?xml-stylesheet?></code> PIs) will be fetched from the network and cannot be
  cached.</p>

  <p>User agents may examine the namespace of the root <code id=read-xml:element><a data-x-internal=element href=https://dom.spec.whatwg.org/#interface-element>Element</a></code> node of this
  <code id=read-xml:document-5><a href=#document>Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href=#navigate-non-Document>the next step</a> (labeled <i>non-document content</i>) in the
  <a href=#navigate id=read-xml:navigate>navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code id=read-xml:document-6><a href=#document>Document</a></code>, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-xml:update-the-session-history-with-the-new-page>update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code id=read-xml:document-7><a href=#document>Document</a></code>.</p>


  <h4 id=read-text>7.8.4 <dfn>Page load processing model for text files</dfn><a href=#read-text class=self-link></a></h4>

  <p>When a plain text document is to be loaded in a <a href=#browsing-context id=read-text:browsing-context>browsing context</a>, the user agent
  must <a href=#queue-a-task id=read-text:queue-a-task>queue a task</a> to create a <code id=read-text:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-text:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-text:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var> in the
  <a href=#navigate id=read-text:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-text:initialise-the-document-object>initialize the <code>Document</code> object</a>,
  create an <a href=#html-parser id=read-text:html-parser>HTML parser</a>, associate it with the <code id=read-text:document-2><a href=#document>Document</a></code>, act as if the
  tokenizer had emitted a start tag token with the tag name "pre" followed by a single U+000A LINE
  FEED (LF) character, and switch the <a href=#html-parser id=read-text:html-parser-2>HTML parser</a>'s tokenizer to the <a href=#plaintext-state id=read-text:plaintext-state>PLAINTEXT
  state</a>. Each <a href=#concept-task id=read-text:concept-task>task</a> that the <a href=#networking-task-source id=read-text:networking-task-source>networking task
  source</a> places on the <a href=#task-queue id=read-text:task-queue>task queue</a> while fetching runs must then fill the
  parser's <a href=#the-input-byte-stream id=read-text:the-input-byte-stream>input byte stream</a> with the fetched bytes and cause the <a href=#html-parser id=read-text:html-parser-3>HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined by the specifications for the
  <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the resource (<var>type</var>
  in the <a href=#navigate id=read-text:navigate-2>navigate</a> algorithm).</p>

  <p>The <a id="read-text:document's-character-encoding" href=https://dom.spec.whatwg.org/#concept-document-encoding data-x-internal="document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code id=read-text:document-3><a href=#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-text:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-text:document-4><a href=#document>Document</a></code>.</p>

  

  <p>When no more bytes are available, the user agent must <a href=#queue-a-task id=read-text:queue-a-task-2>queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id=read-text:event-load><a href=#event-load>load</a></code> event to be fired.</p>

  <p>After creating the <code id=read-text:document-5><a href=#document>Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-text:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-text:the-head-element><a href=#the-head-element>head</a></code> element of the <code id=read-text:document-6><a href=#document>Document</a></code>,
  e.g., linking to a style sheet, providing script, or giving the document a <code id=read-text:the-title-element><a href=#the-title-element>title</a></code>.</p>

  <p class=note>In particular, if the user agent supports the <code>Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., a CSS
  extension.</p>

  <p>The <a href=#task-source id=read-text:task-source>task source</a> for the two tasks mentioned in this section must be the
  <a href=#networking-task-source id=read-text:networking-task-source-2>networking task source</a>.</p>


  <h4 id=read-multipart-x-mixed-replace>7.8.5 <dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn><a href=#read-multipart-x-mixed-replace class=self-link></a></h4>

  <p>When a resource with the type <code id=read-multipart-x-mixed-replace:multipart/x-mixed-replace><a href=#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code> is to be loaded in a
  <a href=#browsing-context id=read-multipart-x-mixed-replace:browsing-context>browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. <a href=#refsRFC2046>[RFC2046]</a></p>

  <p>For each body part obtained from the resource, the user agent must run <a href=#process-a-navigate-response id=read-multipart-x-mixed-replace:process-a-navigate-response>process a navigate
  response</a> using the new body part and the same <a href=#browsing-context id=read-multipart-x-mixed-replace:browsing-context-2>browsing context</a>, with
  <a href=#replacement-enabled id=read-multipart-x-mixed-replace:replacement-enabled>replacement enabled</a> if a previous body part from the same resource resulted in a
  <code id=read-multipart-x-mixed-replace:document><a href=#document>Document</a></code> object being created and <a href=#initialise-the-document-object id=read-multipart-x-mixed-replace:initialise-the-document-object>initialized</a>, and otherwise using the same setup as the <a href=#navigate id=read-multipart-x-mixed-replace:navigate>navigate</a>
  attempt that caused this section to be invoked in the first place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class=note>Thus, <code id=read-multipart-x-mixed-replace:event-load><a href=#event-load>load</a></code> events (and for that matter <code id=read-multipart-x-mixed-replace:event-unload><a href=#event-unload>unload</a></code> events) do fire for each body part loaded.</p>


  <h4 id=read-media>7.8.6 <dfn>Page load processing model for media</dfn><a href=#read-media class=self-link></a></h4>

  <p>When an image, video, or audio resource is to be loaded in a <a href=#browsing-context id=read-media:browsing-context>browsing context</a>, the
  user agent should create a <code id=read-media:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-media:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-media:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-media:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-media:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-media:initialise-the-document-object>initialize the
  <code>Document</code> object</a>, append an <code id=read-media:the-html-element><a href=#the-html-element>html</a></code> element to the
  <code id=read-media:document-2><a href=#document>Document</a></code>, append a <code id=read-media:the-head-element><a href=#the-head-element>head</a></code> element and a <code id=read-media:the-body-element><a href=#the-body-element>body</a></code> element to the
  <code id=read-media:the-html-element-2><a href=#the-html-element>html</a></code> element, append an element <var>host element</var> for the media, as described
  below, to the <code id=read-media:the-body-element-2><a href=#the-body-element>body</a></code> element, and set the appropriate attribute of the element
  <var>host element</var>, as described below, to the address of the image, video, or audio
  resource.</p>

  <p>The element <var>host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th> Type of media
         <th> Element for the media
         <th> Appropriate attribute
   <tbody><tr><td> Image
         <td> <code id=read-media:the-img-element><a href=#the-img-element>img</a></code>
         <td> <code id=read-media:attr-img-src><a href=#attr-img-src>src</a></code>
    <tr><td> Video
         <td> <code id=read-media:the-video-element><a href=#the-video-element>video</a></code>
         <td> <code id=read-media:attr-media-src><a href=#attr-media-src>src</a></code>
    <tr><td> Audio
         <td> <code id=read-media:the-audio-element><a href=#the-audio-element>audio</a></code>
         <td> <code id=read-media:attr-media-src-2><a href=#attr-media-src>src</a></code>
  </table>

  

  <p>Then, the user agent must act as if it had <a href=#stop-parsing id=read-media:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-media:document-3><a href=#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-media:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-media:document-4><a href=#document>Document</a></code>.</p>

  <p>After creating the <code id=read-media:document-5><a href=#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-media:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-media:the-head-element-2><a href=#the-head-element>head</a></code> element of the <code id=read-media:document-6><a href=#document>Document</a></code>, or
  attributes to the element <var>host element</var>, e.g., to link to a style sheet, to provide a
  script, to give the document a <code id=read-media:the-title-element><a href=#the-title-element>title</a></code>, or to make the media <a href=#attr-media-autoplay id=read-media:attr-media-autoplay>autoplay</a>.</p>


  <h4 id=read-plugin>7.8.7 <dfn>Page load processing model for content that uses plugins</dfn><a href=#read-plugin class=self-link></a></h4>

  <p>When a resource that requires an external resource to be rendered is to be loaded in a
  <a href=#browsing-context id=read-plugin:browsing-context>browsing context</a>, the user agent should create a <code id=read-plugin:document><a href=#document>Document</a></code> object, mark
  it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-plugin:html-documents data-x-internal=html-documents>HTML document</a> and mark it as being a
  <dfn id=plugin-document>plugin document</dfn>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-plugin:concept-document-content-type data-x-internal=concept-document-content-type>content
  type</a> to the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-plugin:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed MIME type</a> of the
  resource (<var>type</var> in the <a href=#navigate id=read-plugin:navigate>navigate</a> algorithm), <a href=#initialise-the-document-object id=read-plugin:initialise-the-document-object>initialize the
  <code>Document</code> object</a>, append an <code id=read-plugin:the-html-element><a href=#the-html-element>html</a></code> element to the
  <code id=read-plugin:document-2><a href=#document>Document</a></code>, append a <code id=read-plugin:the-head-element><a href=#the-head-element>head</a></code> element and a <code id=read-plugin:the-body-element><a href=#the-body-element>body</a></code> element to the
  <code id=read-plugin:the-html-element-2><a href=#the-html-element>html</a></code> element, append an <code id=read-plugin:the-embed-element><a href=#the-embed-element>embed</a></code> to the <code id=read-plugin:the-body-element-2><a href=#the-body-element>body</a></code> element, and
  set the <code id=read-plugin:attr-embed-src><a href=#attr-embed-src>src</a></code> attribute of the <code id=read-plugin:the-embed-element-2><a href=#the-embed-element>embed</a></code> element to
  the address of the resource.</p>

  <p class=note>The term <a href=#plugin-document id=read-plugin:plugin-document>plugin document</a> is used by
  <cite>Content Security Policy</cite> as part of the mechanism that ensures <code id=read-plugin:the-iframe-element><a href=#the-iframe-element>iframe</a></code>s
  can't be used to evade <code>plugin-types</code> directives. <a href=#refsCSP>[CSP]</a></p>

  

  <p>Then, the user agent must act as if it had <a href=#stop-parsing id=read-plugin:stop-parsing>stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id=read-plugin:document-3><a href=#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-plugin:concept-appcache-init>application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id=read-plugin:document-4><a href=#document>Document</a></code>.</p>

  <p>After creating the <code id=read-plugin:document-5><a href=#document>Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-plugin:update-the-session-history-with-the-new-page>update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id=read-plugin:the-head-element-2><a href=#the-head-element>head</a></code> element of the <code id=read-plugin:document-6><a href=#document>Document</a></code>, or
  attributes to the <code id=read-plugin:the-embed-element-3><a href=#the-embed-element>embed</a></code> element, e.g. to link to a style sheet or to give the
  document a <code id=read-plugin:the-title-element><a href=#the-title-element>title</a></code>.</p>

  <p id=sandboxPluginNavigate class=note>If the <code id=read-plugin:document-7><a href=#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=read-plugin:active-sandboxing-flag-set>active sandboxing
  flag set</a> has its <a href=#sandboxed-plugins-browsing-context-flag id=read-plugin:sandboxed-plugins-browsing-context-flag>sandboxed plugins browsing context flag</a> set, the synthesized
  <code id=read-plugin:the-embed-element-4><a href=#the-embed-element>embed</a></code> element will <a href=#sandboxPluginEmbed>fail to render the content</a> if
  the relevant <a href=#plugin id=read-plugin:plugin>plugin</a> cannot be <a href=#concept-plugin-secure id=read-plugin:concept-plugin-secure>secured</a>.</p>


  <h4 id=read-ua-inline>7.8.8 <dfn>Page load processing model for inline
  content that doesn't have a DOM</dfn><a href=#read-ua-inline class=self-link></a></h4>

  <p>When the user agent is to display a user agent page inline in a <a href=#browsing-context id=read-ua-inline:browsing-context>browsing context</a>,
  the user agent should create a <code id=read-ua-inline:document><a href=#document>Document</a></code> object, mark it as being an <a href=https://dom.spec.whatwg.org/#html-document id=read-ua-inline:html-documents data-x-internal=html-documents>HTML document</a>, set its <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=read-ua-inline:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> to "<code>text/html</code>",
  <a href=#initialise-the-document-object id=read-ua-inline:initialise-the-document-object>initialize the <code>Document</code> object</a>, and then either associate that
  <code id=read-ua-inline:document-2><a href=#document>Document</a></code> with a custom rendering that is not rendered using the normal
  <code id=read-ua-inline:document-3><a href=#document>Document</a></code> rendering rules, or mutate that <code id=read-ua-inline:document-4><a href=#document>Document</a></code> until it represents
  the content the user agent wants to render.</p>

  

  <p>Once the page has been set up, the user agent must act as if it had <a href=#stop-parsing id=read-ua-inline:stop-parsing>stopped parsing</a>.</p>

  <p>Upon creation of the <code id=read-ua-inline:document-5><a href=#document>Document</a></code> object, the user agent must run the <a href=#concept-appcache-init id=read-ua-inline:concept-appcache-init>application cache selection algorithm</a> with no manifest,
  passing in the newly-created <code id=read-ua-inline:document-6><a href=#document>Document</a></code>.</p>

  <p>After creating the <code id=read-ua-inline:document-7><a href=#document>Document</a></code> object, but potentially before the page has been
  completely set up, the user agent must <a href=#update-the-session-history-with-the-new-page id=read-ua-inline:update-the-session-history-with-the-new-page>update the session history with the new
  page</a>.</p>



  <h4 id=scroll-to-fragid>7.8.9 <dfn>Navigating to a fragment</dfn><a href=#scroll-to-fragid class=self-link></a></h4>

  <p>When a user agent is supposed to navigate to a <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a>, then the user agent must
  run the following steps:</p>

  <ol><li>

    <p>Remove all the entries in the <a href=#browsing-context id=scroll-to-fragid:browsing-context>browsing context</a>'s <a href=#session-history id=scroll-to-fragid:session-history>session history</a>
    after the <a href=#current-entry id=scroll-to-fragid:current-entry>current entry</a>. If the <a href=#current-entry id=scroll-to-fragid:current-entry-2>current entry</a> is the last entry in the
    session history, then no entries are removed.</p>

    <p class=note>This <a href=#history-notes>doesn't necessarily have to affect</a> the user
    agent's user interface.</p>

   <li><p>Remove any <a href=#concept-task id=scroll-to-fragid:concept-task>tasks</a> queued by the <a href=#history-traversal-task-source id=scroll-to-fragid:history-traversal-task-source>history traversal
   task source</a> that are associated with any <code id=scroll-to-fragid:document><a href=#document>Document</a></code> objects in the
   <a href=#top-level-browsing-context id=scroll-to-fragid:top-level-browsing-context>top-level browsing context</a>'s <a href=#document-family id=scroll-to-fragid:document-family>document family</a>.<li><p>Append a new entry at the end of the <code id=scroll-to-fragid:history-3><a href=#history-3>History</a></code> object representing the new
   resource and its <code id=scroll-to-fragid:document-2><a href=#document>Document</a></code> object, related state, and <a href=#current-entry id=scroll-to-fragid:current-entry-3>current entry</a>'s
   <a href=#scroll-restoration-mode id=scroll-to-fragid:scroll-restoration-mode>scroll restoration mode</a>. Its <a id=scroll-to-fragid:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> must be set to the address to which
   the user agent was <a href=#navigate id=scroll-to-fragid:navigate>navigating</a>. The title must be left
   unset.<li><p><a href=#traverse-the-history id=scroll-to-fragid:traverse-the-history>Traverse the history</a> to the new entry, with the <i>non-blocking events</i> flag
   set. This will <a href=#scroll-to-the-fragment-identifier id=scroll-to-fragid:scroll-to-the-fragment-identifier>scroll to the fragment</a> given in what is now the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="scroll-to-fragid:the-document's-address" data-x-internal="the-document's-address">URL</a>.</ol>

  <p class=note>If the scrolling fails because the relevant <a href=https://dom.spec.whatwg.org/#concept-id id=scroll-to-fragid:concept-id data-x-internal=concept-id>ID</a> has
  not yet been parsed, then the original <a href=#navigate id=scroll-to-fragid:navigate-2>navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href=#update-the-session-history-with-the-new-page id=scroll-to-fragid:update-the-session-history-with-the-new-page>update the session history
  with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id=scroll-to-the-fragment-identifier>scroll to the fragment</dfn> and <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document>the indicated part
  of the document</a>, if any, is <a href=#being-rendered id=scroll-to-fragid:being-rendered>being rendered</a>, the user agent must either change
  the scrolling position of the document using the following algorithm, or perform some other action
  such that <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-2>the indicated part of the document</a> is brought to the user's attention. If
  there is no indicated part, or if the indicated part is not <a href=#being-rendered id=scroll-to-fragid:being-rendered-2>being rendered</a>, then the
  user agent must do nothing. The aforementioned algorithm is as follows:</p>

  <ol><li><p>If there is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-3>indicated part of the
   document</a>, set the <code id=scroll-to-fragid:document-3><a href=#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element>target element</a> to null.<li>
    <p>If the <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-4>indicated part of the
    document</a> is the top of the document, then:</p>

    <ol><li><p>Set the <code id=scroll-to-fragid:document-4><a href=#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element-2>target element</a> to null.<li><p><a id=scroll-to-fragid:scroll-to-the-beginning-of-the-document href=https://drafts.csswg.org/cssom-view/#scroll-to-the-beginning-of-the-document data-x-internal=scroll-to-the-beginning-of-the-document>Scroll to the beginning of the document</a> for the <code id=scroll-to-fragid:document-5><a href=#document>Document</a></code>. <a href=#refsCSSOMVIEW>[CSSOMVIEW]</a></ol>
   <li>
    <p>Otherwise:</p>

    <ol><li><p>Let <var>target</var> be element that is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-5>the indicated part of the
     document</a>.<li><p>Set the <code id=scroll-to-fragid:document-6><a href=#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element-3>target element</a> to
     <var>target</var>.<li><p>Use the <a id=scroll-to-fragid:scroll-an-element-into-view href=https://drafts.csswg.org/cssom-view/#scroll-an-element-into-view data-x-internal=scroll-an-element-into-view>scroll an element into view</a> algorithm to scroll <var>target</var>
     into view, with the <var>align to top flag</var> set. <a href=#refsCSSOMVIEW>[CSSOMVIEW]</a><li><p>Run the <a href=#focusing-steps id=scroll-to-fragid:focusing-steps>focusing steps</a> for <var>target</var>, with the
     <code id=scroll-to-fragid:document-7><a href=#document>Document</a></code>'s <a id=scroll-to-fragid:viewport href=https://drafts.csswg.org/css2/visuren.html#viewport data-x-internal=viewport>viewport</a> as the <i>fallback target</i>.<li><p>Move the <a href=#sequential-focus-navigation-starting-point id=scroll-to-fragid:sequential-focus-navigation-starting-point>sequential focus navigation starting point</a> to
     <var>target</var>.</p>
    </ol>
   </ol>

  <p><dfn id=the-indicated-part-of-the-document>The indicated part of the document</dfn> is the one that the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, if any, identifies. The semantics of the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> in terms of mapping it to a node is defined by the
  specification that defines the <a id=scroll-to-fragid:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a> used by the <code id=scroll-to-fragid:document-8><a href=#document>Document</a></code> (for
  example, the processing of <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-4 data-x-internal=concept-url-fragment>fragments</a> for <a href=https://mimesniff.spec.whatwg.org/#xml-mime-type id=scroll-to-fragid:xml-mime-type data-x-internal=xml-mime-type>XML MIME types</a> is the responsibility of RFC7303). <a href=#refsRFC7303>[RFC7303]</a></p>

  <p>There is also a <dfn id=target-element>target element</dfn> for each <code id=scroll-to-fragid:document-9><a href=#document>Document</a></code>, which is used in
  defining the <code id=scroll-to-fragid:selector-target><a href=#selector-target>:target</a></code> pseudo-class and is updated by the
  above algorithm. It is initially null.</p>

  <p>For HTML documents (and <a href=https://mimesniff.spec.whatwg.org/#html-mime-type id=scroll-to-fragid:html-mime-type data-x-internal=html-mime-type>HTML MIME types</a>), the following
  processing model must be followed to determine what <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-6>the indicated part of the
  document</a> is.</p>

  <ol><li><p>Apply the <a id=scroll-to-fragid:url-parser href=https://url.spec.whatwg.org/#concept-url-parser data-x-internal=url-parser>URL parser</a> algorithm to the <a id=scroll-to-fragid:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, and let <var>fragid</var> be the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-5 data-x-internal=concept-url-fragment>fragment</a> component of the
   resulting <a id=scroll-to-fragid:url-record href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a>.<li><p>If <var>fragid</var> is the empty string, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-7>the indicated part of the
   document</a> is the top of the document; stop the algorithm here.<li><p>Let <var>fragid bytes</var> be the result of <a href=https://url.spec.whatwg.org/#percent-decode id=scroll-to-fragid:percent-decode data-x-internal=percent-decode>percent-decoding</a> <var>fragid</var>.<li><p>Let <var>decoded fragid</var> be the result of running <a id=scroll-to-fragid:utf-8-decode-without-bom-or-fail href=https://encoding.spec.whatwg.org/#utf-8-decode-without-bom-or-fail data-x-internal=utf-8-decode-without-bom-or-fail>UTF-8 decode without BOM or
   fail</a> on <var>fragid bytes</var>. If <var>decoded fragid</var> is failure, jump to the step
   labeled <i>no decoded fragid</i>.<li><p>If there is an element <a href=https://dom.spec.whatwg.org/#in-a-document-tree id=scroll-to-fragid:in-a-document-tree data-x-internal=in-a-document-tree>in the document tree</a> that
   has an <a href=https://dom.spec.whatwg.org/#concept-id id=scroll-to-fragid:concept-id-2 data-x-internal=concept-id>ID</a> exactly equal to <var>decoded fragid</var>, then the
   first such element in <a id=scroll-to-fragid:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-8>the indicated part of the document</a>;
   stop the algorithm here.<li><p><i>No decoded fragid</i>: If there is an <code id=scroll-to-fragid:the-a-element><a href=#the-a-element>a</a></code> element <a href=https://dom.spec.whatwg.org/#in-a-document-tree id=scroll-to-fragid:in-a-document-tree-2 data-x-internal=in-a-document-tree>in the document tree</a> that has a <code id=scroll-to-fragid:attr-a-name><a href=#attr-a-name>name</a></code>
   attribute whose value is exactly equal to <var>fragid</var> (<em>not</em> <var>decoded
   fragid</var>), then the first such element in <a id=scroll-to-fragid:tree-order-2 href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a> is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-9>the indicated part
   of the document</a>; stop the algorithm here.<li><p>If <var>fragid</var> is an <a id=scroll-to-fragid:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for the
   string <code>top</code>, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-10>the indicated part of the document</a> is the top
   of the document; stop the algorithm here.<li><p>Otherwise, there is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-11>indicated part of
   the document</a>.</ol>

  <p>The <a href=#task-source id=scroll-to-fragid:task-source>task source</a> for the task mentioned in this section must be the <a href=#dom-manipulation-task-source id=scroll-to-fragid:dom-manipulation-task-source>DOM
  manipulation task source</a>.</p>

  



  <h4 id=history-traversal>7.8.10 History traversal<a href=#history-traversal class=self-link></a></h4> 

  

  <p>When a user agent is required to <dfn id=traverse-the-history>traverse the history</dfn> to a <a href=#session-history-entry id=history-traversal:session-history-entry>session history
  entry</a> <var>entry</var>, optionally with <a href=#replacement-enabled id=history-traversal:replacement-enabled>replacement enabled</a>, and optionally
  with the <i>non-blocking events</i> flag set, the user agent must act as follows.</p>

  <p class=note>This algorithm is not just invoked when <a href=#traverse-the-history-by-a-delta id=history-traversal:traverse-the-history-by-a-delta>explicitly going back or forwards in the session history</a> — it is also invoked
  in other situations, for example when <a href=#navigate id=history-traversal:navigate>navigating a browsing context</a>,
  as part of <a href=#update-the-session-history-with-the-new-page id=history-traversal:update-the-session-history-with-the-new-page>updating the session history
  with the new page</a>.</p>

  <ol><li>

    <p>If <var>entry</var> no longer holds a <code id=history-traversal:document><a href=#document>Document</a></code> object, then
    <a href=#navigate id=history-traversal:navigate-2>navigate</a> the <a href=#browsing-context id=history-traversal:browsing-context>browsing
    context</a> to <var>entry</var>'s <a id=history-traversal:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> to perform an <a href=#entry-update id=history-traversal:entry-update>entry update</a> of
    <var>entry</var>, and abort these steps. The "<a href=#navigate id=history-traversal:navigate-3>navigate</a>" algorithm reinvokes this
    "traverse" algorithm to complete the traversal, at which point there <em>is</em> a
    <code id=history-traversal:document-2><a href=#document>Document</a></code> object and so this step gets skipped. The navigation must be done using
    the same <a href=#source-browsing-context id=history-traversal:source-browsing-context>source browsing context</a> as was used the first time <var>entry</var> was
    created. (This can never happen with <a href=#replacement-enabled id=history-traversal:replacement-enabled-2>replacement enabled</a>.)</p>

    <p class=note>If the resource was obtained using a non-idempotent action, for example a POST
    form submission, or if the resource is no longer available, for example because the computer is
    now offline and the page wasn't cached, navigating to it again might not be possible. In this
    case, the navigation will result in a different page than previously; for example, it might be
    an error message explaining the problem or offering to resubmit the form.</p>

   <li><p>If the <a href=#current-entry id=history-traversal:current-entry>current entry</a>'s title was not set by the <code id=history-traversal:dom-history-pushstate><a href=#dom-history-pushstate>pushState()</a></code> or <code id=history-traversal:dom-history-replacestate><a href=#dom-history-replacestate>replaceState()</a></code> methods, then set its title to the value
   returned by the <code id=history-traversal:document.title><a href=#document.title>document.title</a></code> IDL attribute.<li><p>If appropriate, update the <a href=#current-entry id=history-traversal:current-entry-2>current entry</a> in the <a href=#browsing-context id=history-traversal:browsing-context-2>browsing
   context</a>'s <code id=history-traversal:document-3><a href=#document>Document</a></code> object's <code id=history-traversal:history-3><a href=#history-3>History</a></code> object to reflect any state
   that the user agent wishes to persist. The entry is then said to be <a href=#an-entry-with-persisted-user-state id=history-traversal:an-entry-with-persisted-user-state>an entry with persisted
   user state</a>.<li><p>If <var>entry</var> has a different <code id=history-traversal:document-4><a href=#document>Document</a></code> object than the <a href=#current-entry id=history-traversal:current-entry-3>current
   entry</a>, then run the following substeps:</p>

    <ol><li><p>Remove any <a href=#concept-task id=history-traversal:concept-task>tasks</a> queued by the <a href=#history-traversal-task-source id=history-traversal:history-traversal-task-source>history traversal
     task source</a> that are associated with any <code id=history-traversal:document-5><a href=#document>Document</a></code> objects in the
     <a href=#top-level-browsing-context id=history-traversal:top-level-browsing-context>top-level browsing context</a>'s <a href=#document-family id=history-traversal:document-family>document family</a>.<li>

      <p>If the <a href=#concept-origin id=history-traversal:concept-origin>origin</a> of <var>entry</var>'s <code id=history-traversal:document-6><a href=#document>Document</a></code> object is not the
      <a href=#same-origin id=history-traversal:same-origin>same</a> as the <a href=#concept-origin id=history-traversal:concept-origin-2>origin</a> of the <a href=#current-entry id=history-traversal:current-entry-4>current
      entry</a>'s <code id=history-traversal:document-7><a href=#document>Document</a></code> object, then run the following subsubsteps:</p>

      <ol><li><p>The current <a href=#browsing-context-name id=history-traversal:browsing-context-name>browsing context name</a> must be stored with all the entries in
       the history that are associated with <code id=history-traversal:document-8><a href=#document>Document</a></code> objects with the <a href=#same-origin id=history-traversal:same-origin-2>same
       origin</a> as the <a href=#active-document id=history-traversal:active-document>active document</a> <em>and</em> that are contiguous with the
       <a href=#current-entry id=history-traversal:current-entry-5>current entry</a>.<li id=resetBCName><p>If the browsing context is a <a href=#top-level-browsing-context id=history-traversal:top-level-browsing-context-2>top-level browsing context</a>,
       but not an <a href=#auxiliary-browsing-context id=history-traversal:auxiliary-browsing-context>auxiliary browsing context</a>, then set the browsing context's <a href=#browsing-context-name id=history-traversal:browsing-context-name-2>name</a> to the empty string.</ol>

     <li id=appcache-history-2><p>Make <var>entry</var>'s <code id=history-traversal:document-9><a href=#document>Document</a></code> object the
     <a href=#active-document id=history-traversal:active-document-2>active document</a> of the <a href=#browsing-context id=history-traversal:browsing-context-3>browsing context</a>.<li>

      <p>If <var>entry</var> has a <a href=#browsing-context-name id=history-traversal:browsing-context-name-3>browsing context name</a>, then run the following
      subsubsteps:</p>

      <ol><li><p>Set the browsing context's <a href=#browsing-context-name id=history-traversal:browsing-context-name-4>browsing context name</a> to <var>entry</var>'s
       <a href=#browsing-context-name id=history-traversal:browsing-context-name-5>browsing context name</a>.<li><p>Clear any <a href=#browsing-context-name id=history-traversal:browsing-context-name-6>browsing context names</a> of all
       entries in the history that are associated with <code id=history-traversal:document-10><a href=#document>Document</a></code> objects with the
       <a href=#same-origin id=history-traversal:same-origin-3>same origin</a> as the new <a href=#active-document id=history-traversal:active-document-3>active document</a> and that are contiguous with
       <var>entry</var>.</ol>

     <li id=history-autocomplete><p>If <var>entry</var>'s <code id=history-traversal:document-11><a href=#document>Document</a></code> object has any
     form controls whose <a href=#autofill-field-name id=history-traversal:autofill-field-name>autofill field name</a> is "<code id=history-traversal:attr-fe-autocomplete-off><a href=#attr-fe-autocomplete-off>off</a></code>", invoke the <a href=#concept-form-reset-control id=history-traversal:concept-form-reset-control>reset algorithm</a> of each of those elements.<li>

      <p>If the <a href=#current-document-readiness id=history-traversal:current-document-readiness>current document readiness</a> of <var>entry</var>'s <code id=history-traversal:document-12><a href=#document>Document</a></code>
      object is "<code>complete</code>", then <a href=#queue-a-task id=history-traversal:queue-a-task>queue a task</a> to run the
      following subsubsteps:</p>

      <ol><li><p>If the <code id=history-traversal:document-13><a href=#document>Document</a></code>'s <a href=#page-showing id=history-traversal:page-showing>page showing</a> flag is true, then abort this
       task (i.e. don't fire the event below).<li><p>Set the <code id=history-traversal:document-14><a href=#document>Document</a></code>'s <a href=#page-showing id=history-traversal:page-showing-2>page showing</a> flag to true.<li>

        <p>Run any <dfn id=session-history-document-visibility-change-steps>session history document visibility change steps</dfn> for <code id=history-traversal:document-15><a href=#document>Document</a></code> that
        are defined by <a href=#other-applicable-specifications id=history-traversal:other-applicable-specifications>other applicable specifications</a>.</p>

        <p class=note>This is specifically intended for use by the Page Visibility specification. <a href=#refsPAGEVIS>[PAGEVIS]</a></p>

       <li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire data-x-internal=concept-event-fire>Fire an event</a> named <code id=history-traversal:event-pageshow><a href=#event-pageshow>pageshow</a></code> at the <code id=history-traversal:document-16><a href=#document>Document</a></code> object's
       <code id=history-traversal:window><a href=#window>Window</a></code> object, using <code id=history-traversal:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code>, with the <code id=history-traversal:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialized to true,
       and <var>legacy target override flag</var> set.</ol>

      

     </ol>

   <li><p>Set the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id="history-traversal:the-document's-address" data-x-internal="the-document's-address">URL</a> to <var>entry</var>'s
   <a id=history-traversal:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>.<li><p>If <var>entry</var> has a <a id=history-traversal:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> differs from that of the
   <a href=#current-entry id=history-traversal:current-entry-6>current entry</a>'s when compared in a <a href=#case-sensitive id=history-traversal:case-sensitive>case-sensitive</a> manner, and the two
   share the same <code id=history-traversal:document-17><a href=#document>Document</a></code> object, then let <var>hash changed</var> be true, and let
   <var>old URL</var> be the <a href=#current-entry id=history-traversal:current-entry-7>current entry</a>'s <a id=history-traversal:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> and <var>new URL</var> be
   <var>entry</var>'s <a id=history-traversal:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>. Otherwise, let <var>hash changed</var> be false.<li><p>If the traversal was initiated with <dfn id=replacement-enabled data-export="">replacement enabled</dfn>, remove
   the entry immediately before the <var>specified entry</var> in the session history.<li><p>If <var>entry</var> is not <a href=#an-entry-with-persisted-user-state id=history-traversal:an-entry-with-persisted-user-state-2>an entry with persisted user state</a>, but its
   <a id=history-traversal:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a> is non-null, then
   <a href=#scroll-to-the-fragment-identifier id=history-traversal:scroll-to-the-fragment-identifier>scroll to the fragment</a>.<li><p>Set the <a href=#current-entry id=history-traversal:current-entry-8>current entry</a> to <var>entry</var>.<li><p>Let <var>targetRealm</var> be the <a id=history-traversal:current-realm-record href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>.<li><p>If <var>entry</var> has a <a href=#state-object id=history-traversal:state-object>state object</a>, then let <var>state</var> be
   <a href=#structuredclone id=history-traversal:structuredclone>StructuredClone</a>(<var>entry</var>'s <a href=#state-object id=history-traversal:state-object-2>state object</a>,
   <var>targetRealm</var>). Otherwise, let <var>state</var> be null.<li><p>Set <code id=history-traversal:dom-history-state><a href=#dom-history-state>history.state</a></code> to <var>state</var>.<li><p>Let <var>state changed</var> be true if <var>entry</var>'s <code id=history-traversal:document-18><a href=#document>Document</a></code> object
   has a <a href=#latest-entry id=history-traversal:latest-entry>latest entry</a>, and that entry is not <var>entry</var>; otherwise let it be
   false.</p>

   <li><p>Set <var>entry</var>'s <code id=history-traversal:document-19><a href=#document>Document</a></code> object's <a href=#latest-entry id=history-traversal:latest-entry-2>latest entry</a> to
   <var>entry</var>.<li>

    <p>If the <i>non-blocking events</i> flag is not set, then run the following substeps
    <a href=#immediately id=history-traversal:immediately>immediately</a>. Otherwise, the <i>non-blocking events</i> flag is set; <a href=#queue-a-task id=history-traversal:queue-a-task-2>queue a
    task</a> to run the following substeps instead.</p>

    <ol><li><p>If <var>state changed</var> is true, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire-2 data-x-internal=concept-event-fire>fire an
     event</a> named <code id=history-traversal:event-popstate><a href=#event-popstate>popstate</a></code> at the <code id=history-traversal:document-20><a href=#document>Document</a></code>
     object's <code id=history-traversal:window-2><a href=#window>Window</a></code> object, using <code id=history-traversal:popstateevent><a href=#popstateevent>PopStateEvent</a></code>, with the <code id=history-traversal:dom-event-bubbles><a data-x-internal=dom-event-bubbles href=https://dom.spec.whatwg.org/#dom-event-bubbles>bubbles</a></code> attribute initialized to true and the <code id=history-traversal:dom-popstateevent-state><a href=#dom-popstateevent-state>state</a></code> attribute initialized <var>state</var>.<li><p>If <var>entry</var> is <a href=#an-entry-with-persisted-user-state id=history-traversal:an-entry-with-persisted-user-state-3>an entry with persisted user state</a>, then the user
     agent may <a href=#restore-persisted-user-state id=history-traversal:restore-persisted-user-state>restore persisted user state</a> and update aspects of the document and its
     rendering.<li><p>If <var>hash changed</var> is true, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire-3 data-x-internal=concept-event-fire>fire an
     event</a> named <code id=history-traversal:event-hashchange><a href=#event-hashchange>hashchange</a></code> at the <a href=#browsing-context id=history-traversal:browsing-context-4>browsing
     context</a>'s <code id=history-traversal:window-3><a href=#window>Window</a></code> object, using <code id=history-traversal:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code>, with the <code id=history-traversal:dom-event-bubbles-2><a data-x-internal=dom-event-bubbles href=https://dom.spec.whatwg.org/#dom-event-bubbles>bubbles</a></code> attribute initialized to true, the <code id=history-traversal:dom-hashchangeevent-oldurl><a href=#dom-hashchangeevent-oldurl>oldURL</a></code> attribute initialized to <var>old URL</var>,
     and the <code id=history-traversal:dom-hashchangeevent-newurl><a href=#dom-hashchangeevent-newurl>newURL</a></code> attribute initialized to
     <var>new URL</var>.</ol>

   </ol>

  <p>The <a href=#task-source id=history-traversal:task-source>task source</a> for the tasks mentioned above is the <a href=#dom-manipulation-task-source id=history-traversal:dom-manipulation-task-source>DOM manipulation task
  source</a>.</p>

  

  <h5 id=persisted-user-state-restoration>7.8.10.1 Persisted user state restoration<a href=#persisted-user-state-restoration class=self-link></a></h5>
  

  <p>When the user agent is to <dfn id=restore-persisted-user-state>restore persisted user state</dfn> from a history entry, it must
  run the following steps immediately:</p>

  <ol><li><p>If the entry has a <a href=#scroll-restoration-mode id=persisted-user-state-restoration:scroll-restoration-mode>scroll restoration mode</a>, let <var>scrollRestoration</var>
   be that. Otherwise let <var>scrollRestoration</var> be "<code id=persisted-user-state-restoration:dom-scrollrestoration-auto><a href=#dom-scrollrestoration-auto>auto</a></code>"<li><p>If <var>scrollRestoration</var> is "<code id=persisted-user-state-restoration:dom-scrollrestoration-manual><a href=#dom-scrollrestoration-manual>manual</a></code>" the user agent should not restore the scroll
   position for the <code id=persisted-user-state-restoration:document><a href=#document>Document</a></code> or any of its scrollable regions, with the exception of
   any nested browsing contexts whose scroll restoration is controlled by their own history entry's
   <a href=#scroll-restoration-mode id=persisted-user-state-restoration:scroll-restoration-mode-2>scroll restoration mode</a>, otherwise, it may do so.<li><p>Optionally, update other aspects of the document and its rendering, for instance values of
   form fields, that the user agent had previously recorded.</ol>
  

  
  <p class=note>This can even include updating the <code id=persisted-user-state-restoration:the-dir-attribute><a href=#the-dir-attribute>dir</a></code> attribute
  of <code id=persisted-user-state-restoration:the-textarea-element><a href=#the-textarea-element>textarea</a></code> elements or <code id=persisted-user-state-restoration:the-input-element><a href=#the-input-element>input</a></code> elements whose <code id=persisted-user-state-restoration:attr-input-type><a href=#attr-input-type>type</a></code> attribute is in either the <a href="#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the
  directionality of user input in such controls.</p>

  <p class=note>Not restoring the scroll position by user agent does not imply that the scroll
  position will be left at any particular value (e.g., (0,0)). The actual scroll position depends on
  the navigation type and the user agent's particular caching strategy. So web applications should
  not assume any particular scroll position but rather should set it to what they want it to be.</p>

  <h5 id=the-popstateevent-interface>7.8.10.2 The <code id=the-popstateevent-interface:popstateevent><a href=#popstateevent>PopStateEvent</a></code> interface<a href=#the-popstateevent-interface class=self-link></a></h5>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#popstateeventinit id=the-popstateevent-interface:popstateeventinit>PopStateEventInit</a> eventInitDict)]
interface <dfn id=popstateevent>PopStateEvent</dfn> : <a id=the-popstateevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  readonly attribute any <a href=#dom-popstateevent-state id=the-popstateevent-interface:dom-popstateevent-state>state</a>;
};

dictionary <dfn id=popstateeventinit>PopStateEventInit</dfn> : <a id=the-popstateevent-interface:eventinit href=https://dom.spec.whatwg.org/#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  any state = null;
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-popstateevent-interface:dom-popstateevent-state-2><a href=#dom-popstateevent-state>state</a></code><dd>

    <p>Returns a copy of the information that was provided to <code id=the-popstateevent-interface:dom-history-pushstate><a href=#dom-history-pushstate>pushState()</a></code> or <code id=the-popstateevent-interface:dom-history-replacestate><a href=#dom-history-replacestate>replaceState()</a></code>.</p>

   </dl>

  

  <p>The <dfn id=dom-popstateevent-state><code>state</code></dfn> attribute must return the
  value it was initialized to. It represents the context information for the event, or null, if the
  state represented is the initial state of the <code id=the-popstateevent-interface:document><a href=#document>Document</a></code>.</p>

  


  <h5 id=the-hashchangeevent-interface>7.8.10.3 The <code id=the-hashchangeevent-interface:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code> interface<a href=#the-hashchangeevent-interface class=self-link></a></h5><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> hashchange<span class="and_chr yes"><span>Chrome for Android</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>5+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>4.0+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.6+</span></span><span class="ie yes"><span>IE</span> <span>8+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.2+</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=hashchange">caniuse.com</a></div>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#hashchangeeventinit id=the-hashchangeevent-interface:hashchangeeventinit>HashChangeEventInit</a> eventInitDict)]
interface <dfn id=hashchangeevent>HashChangeEvent</dfn> : <a id=the-hashchangeevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  readonly attribute USVString <a href=#dom-hashchangeevent-oldurl id=the-hashchangeevent-interface:dom-hashchangeevent-oldurl>oldURL</a>;
  readonly attribute USVString <a href=#dom-hashchangeevent-newurl id=the-hashchangeevent-interface:dom-hashchangeevent-newurl>newURL</a>;
};

dictionary <dfn id=hashchangeeventinit>HashChangeEventInit</dfn> : <a id=the-hashchangeevent-interface:eventinit href=https://dom.spec.whatwg.org/#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  USVString oldURL = "";
  USVString newURL = "";
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-hashchangeevent-interface:dom-hashchangeevent-oldurl-2><a href=#dom-hashchangeevent-oldurl>oldURL</a></code><dd>

    <p>Returns the <a id=the-hashchangeevent-interface:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry>session history entry</a> that was previously
    current.</p>

   <dt><var>event</var> . <code id=the-hashchangeevent-interface:dom-hashchangeevent-newurl-2><a href=#dom-hashchangeevent-newurl>newURL</a></code><dd>

    <p>Returns the <a id=the-hashchangeevent-interface:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry-2>session history entry</a> that is now
    current.</p>

   </dl>

  

  <p>The <dfn id=dom-hashchangeevent-oldurl><code>oldURL</code></dfn> attribute must return
  the value it was initialized to. It represents context information for the event, specifically the
  URL of the <a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry-3>session history entry</a> that was traversed from.</p>

  <p>The <dfn id=dom-hashchangeevent-newurl><code>newURL</code></dfn> attribute must return
  the value it was initialized to. It represents context information for the event, specifically the
  URL of the <a href=#session-history-entry id=the-hashchangeevent-interface:session-history-entry-4>session history entry</a> that was traversed to.</p>

  


  <h5 id=the-pagetransitionevent-interface>7.8.10.4 The <code id=the-pagetransitionevent-interface:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code> interface<a href=#the-pagetransitionevent-interface class=self-link></a></h5>

  <pre class=idl>[Constructor(DOMString type, optional <a href=#pagetransitioneventinit id=the-pagetransitionevent-interface:pagetransitioneventinit>PageTransitionEventInit</a> eventInitDict)]
interface <dfn id=pagetransitionevent>PageTransitionEvent</dfn> : <a id=the-pagetransitionevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  readonly attribute boolean <a href=#dom-pagetransitionevent-persisted id=the-pagetransitionevent-interface:dom-pagetransitionevent-persisted>persisted</a>;
};

dictionary <dfn id=pagetransitioneventinit>PageTransitionEventInit</dfn> : <a id=the-pagetransitionevent-interface:eventinit href=https://dom.spec.whatwg.org/#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  boolean persisted = false;
};</pre>

  <dl class=domintro><dt><var>event</var> . <code id=the-pagetransitionevent-interface:dom-pagetransitionevent-persisted-2><a href=#dom-pagetransitionevent-persisted>persisted</a></code><dd>

    <p>For the <code id=the-pagetransitionevent-interface:event-pageshow><a href=#event-pageshow>pageshow</a></code> event, returns false if the page is
    newly being loaded (and the <code id=the-pagetransitionevent-interface:event-load><a href=#event-load>load</a></code> event will fire). Otherwise,
    returns true.</p>

    <p>For the <code id=the-pagetransitionevent-interface:event-pagehide><a href=#event-pagehide>pagehide</a></code> event, returns false if the page is
    going away for the last time. Otherwise, returns true, meaning that (if nothing conspires to
    make the page unsalvageable) the page might be reused if the user navigates back to this
    page.</p>

    <p>Things that can cause the page to be unsalvageable include:</p>

    <ul class=brief><li><code id=the-pagetransitionevent-interface:dom-document-open><a href=#dom-document-open>document.open()</a></code>
     <li>Listening for <code id=the-pagetransitionevent-interface:event-beforeunload><a href=#event-beforeunload>beforeunload</a></code> events
     <li>Listening for <code id=the-pagetransitionevent-interface:event-unload><a href=#event-unload>unload</a></code> events
     <li>Having <code id=the-pagetransitionevent-interface:the-iframe-element><a href=#the-iframe-element>iframe</a></code>s that are not salvageable
     <li>Active <code id=the-pagetransitionevent-interface:websocket><a href=#websocket>WebSocket</a></code> objects
     <li><a href=#abort-a-document id=the-pagetransitionevent-interface:abort-a-document>Aborting a <code>Document</code></a>
    </ul>

   </dl>

  

  <p>The <dfn id=dom-pagetransitionevent-persisted><code>persisted</code></dfn> attribute must
  return the value it was initialized to. It represents the context information for the event.</p>

  



  <h4 id=unloading-documents>7.8.11 Unloading documents<a href=#unloading-documents class=self-link></a></h4>

  

  <p>A <code id=unloading-documents:document><a href=#document>Document</a></code> has a <dfn id=concept-document-salvageable><i>salvageable</i></dfn> state, which must initially be
  true, a <dfn id=fired-unload>fired unload</dfn> flag, which must initially be false, and a <dfn id=page-showing>page showing</dfn>
  flag, which must initially be false. The <a href=#page-showing id=unloading-documents:page-showing>page showing</a> flag is used to ensure that
  scripts receive <code id=unloading-documents:event-pageshow><a href=#event-pageshow>pageshow</a></code> and <code id=unloading-documents:event-pagehide><a href=#event-pagehide>pagehide</a></code> events in a consistent manner (e.g. that they never
  receive two <code id=unloading-documents:event-pagehide-2><a href=#event-pagehide>pagehide</a></code> events in a row without an intervening
  <code id=unloading-documents:event-pageshow-2><a href=#event-pageshow>pageshow</a></code>, or vice versa).</p>

  <p><a href=#event-loop id=unloading-documents:event-loop>Event loops</a> have a <dfn id=termination-nesting-level>termination nesting level</dfn>
  counter, which must initially be zero.</p>

  <p>When a user agent is to <dfn id=prompt-to-unload-a-document>prompt to unload a document</dfn>, it must run the following
  steps.</p>

  <ol><li><p>Increase the <a href=#event-loop id=unloading-documents:event-loop-2>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level>termination nesting level</a> by
   one.<li><p>Increase the <code id=unloading-documents:document-2><a href=#document>Document</a></code>'s <a href=#ignore-opens-during-unload-counter id=unloading-documents:ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.<li><p>Let <var>event</var> be the result of <a id=unloading-documents:creating-an-event href=https://dom.spec.whatwg.org/#concept-event-create data-x-internal=creating-an-event>creating an event</a> using
   <code id=unloading-documents:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>.<li><p>Initialize <var>event</var>'s <code id=unloading-documents:dom-event-type><a data-x-internal=dom-event-type href=https://dom.spec.whatwg.org/#dom-event-type>type</a></code> attribute to <code id=unloading-documents:event-beforeunload><a href=#event-beforeunload>beforeunload</a></code> and its <code id=unloading-documents:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute true.<li><p><i>Dispatch</i>: <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=unloading-documents:concept-event-dispatch data-x-internal=concept-event-dispatch>Dispatch</a> <var>event</var> at
   the <code id=unloading-documents:document-3><a href=#document>Document</a></code>'s <code id=unloading-documents:window><a href=#window>Window</a></code> object.<li><p>Decrease the <a href=#event-loop id=unloading-documents:event-loop-3>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-2>termination nesting level</a> by
   one.<li><p>If any event listeners were triggered by the earlier <i>dispatch</i> step, then set the
   <code id=unloading-documents:document-4><a href=#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state to
   false.<li>

    <p>If the <code id=unloading-documents:document-5><a href=#document>Document</a></code>'s <a href=#active-sandboxing-flag-set id=unloading-documents:active-sandboxing-flag-set>active sandboxing flag set</a> does not have its
    <a href=#sandboxed-modals-flag id=unloading-documents:sandboxed-modals-flag>sandboxed modals flag</a> set, and the <code id=unloading-documents:dom-beforeunloadevent-returnvalue><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute of the <var>event</var>
    object is not the empty string, or if the event was canceled, then the user agent may ask the
    user to confirm that they wish to unload the document.</p>

    <p class=note>The message shown to the user is not customizable, but instead determined by
    the user agent. In particular, the actual value of the <code id=unloading-documents:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute is ignored.</p>

    <p>The user agent is encouraged to avoid asking the user for confirmation if it judges that
    doing so would be annoying, deceptive, or pointless. A simple heuristic might be that if the
    user has not interacted with the document, the user agent would not ask for confirmation before
    unloading it.</p>

    <p>If the user agent asks the user for confirmation, it must <a href=#pause id=unloading-documents:pause>pause</a> while waiting
    for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id=refused-to-allow-the-document-to-be-unloaded>refused to allow
    the document to be unloaded</dfn>.</p>

   <li><p>If this algorithm was invoked by another instance of the "prompt to unload a document"
   algorithm (i.e. through the steps below that invoke this algorithm for all descendant browsing
   contexts), then jump to the step labeled <i>end</i>.<li><p>Let <var>descendants</var> be the <a href=#list-of-the-descendant-browsing-contexts id=unloading-documents:list-of-the-descendant-browsing-contexts>list of the descendant browsing
   contexts</a> of the <code id=unloading-documents:document-6><a href=#document>Document</a></code>.<li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href=#browsing-context id=unloading-documents:browsing-context>browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href=#prompt-to-unload-a-document id=unloading-documents:prompt-to-unload-a-document>Prompt to unload</a> the <a href=#active-document id=unloading-documents:active-document>active
     document</a> of the <a href=#browsing-context id=unloading-documents:browsing-context-2>browsing context</a> <var>b</var>. If the user
     <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document to be unloaded</a>, then the user implicitly also <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded-2>refused to allow <em>this</em> document to
     be unloaded</a>; jump to the step labeled <i>end</i>.</p>

     <li><p>If the <i id=unloading-documents:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state of the <a href=#active-document id=unloading-documents:active-document-2>active
     document</a> of the <a href=#browsing-context id=unloading-documents:browsing-context-3>browsing context</a> <var>b</var> is false, then set
     the <i id=unloading-documents:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state of <em>this</em> document to
     false also.</ol>

   <li><p><i>End</i>: Decrease the <code id=unloading-documents:document-7><a href=#document>Document</a></code>'s <a href=#ignore-opens-during-unload-counter id=unloading-documents:ignore-opens-during-unload-counter-2>ignore-opens-during-unload
   counter</a> by one.</ol>

  <p>When a user agent is to <dfn id=unload-a-document data-export="">unload a document</dfn>, it must run the following
  steps. These steps are passed an argument, <var>recycle</var>, which is either true or false,
  indicating whether the <code id=unloading-documents:document-8><a href=#document>Document</a></code> object is going to be re-used. (This is set by the
  <code id=unloading-documents:dom-document-open><a href=#dom-document-open>document.open()</a></code> method.)</p>

  <ol><li><p>Increase the <a href=#event-loop id=unloading-documents:event-loop-4>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-3>termination nesting level</a> by
   one.<li><p>Increase the <code id=unloading-documents:document-9><a href=#document>Document</a></code>'s <a href=#ignore-opens-during-unload-counter id=unloading-documents:ignore-opens-during-unload-counter-3>ignore-opens-during-unload counter</a> by
   one.<li><p>If the <code id=unloading-documents:document-10><a href=#document>Document</a></code>'s <a href=#page-showing id=unloading-documents:page-showing-2>page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code id=unloading-documents:event-pagehide-3><a href=#event-pagehide>pagehide</a></code> event and don't rerun the <a href=#unloading-document-visibility-change-steps id=unloading-documents:unloading-document-visibility-change-steps>unloading document
   visibility change steps</a>).<li><p>Set the <code id=unloading-documents:document-11><a href=#document>Document</a></code>'s <a href=#page-showing id=unloading-documents:page-showing-3>page showing</a> flag to false.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=unloading-documents:concept-event-fire data-x-internal=concept-event-fire>Fire an event</a> named <code id=unloading-documents:event-pagehide-4><a href=#event-pagehide>pagehide</a></code> at the <code id=unloading-documents:document-12><a href=#document>Document</a></code> object's <code id=unloading-documents:window-2><a href=#window>Window</a></code>
   object, using <code id=unloading-documents:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code>, with the <code id=unloading-documents:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialized to true if the
   <code id=unloading-documents:document-13><a href=#document>Document</a></code> object's <i id=unloading-documents:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state is
   true, and false otherwise, and <var>legacy target override flag</var> set.<li>

    <p>Run any <dfn id=unloading-document-visibility-change-steps>unloading document visibility change steps</dfn> for <code id=unloading-documents:document-14><a href=#document>Document</a></code> that
    are defined by <a href=#other-applicable-specifications id=unloading-documents:other-applicable-specifications>other applicable specifications</a>.</p>

    <p class=note>This is specifically intended for use by the Page Visibility specification. <a href=#refsPAGEVIS>[PAGEVIS]</a></p>

   <li><p><i>Unload event</i>: If the <code id=unloading-documents:document-15><a href=#document>Document</a></code>'s <a href=#fired-unload id=unloading-documents:fired-unload>fired unload</a> flag is
   false, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=unloading-documents:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=unloading-documents:event-unload><a href=#event-unload>unload</a></code> at the <code id=unloading-documents:document-16><a href=#document>Document</a></code>'s object <code id=unloading-documents:window-3><a href=#window>Window</a></code>
   object, with <var>legacy target override flag</var> set.<li><p>Decrease the <a href=#event-loop id=unloading-documents:event-loop-5>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-4>termination nesting level</a> by
   one.<li><p>If any event listeners were triggered by the earlier <i>unload event</i> step, then set
   the <code id=unloading-documents:document-17><a href=#document>Document</a></code> object's <i id=unloading-documents:concept-document-salvageable-5><a href=#concept-document-salvageable>salvageable</a></i> state
   to false and set the <code id=unloading-documents:document-18><a href=#document>Document</a></code>'s <a href=#fired-unload id=unloading-documents:fired-unload-2>fired unload</a> flag to true.<li><p>Run any <a href=#unloading-document-cleanup-steps id=unloading-documents:unloading-document-cleanup-steps>unloading document cleanup steps</a> for <code id=unloading-documents:document-19><a href=#document>Document</a></code> that are
   defined by this specification and <a href=#other-applicable-specifications id=unloading-documents:other-applicable-specifications-2>other applicable specifications</a>.<li><p>If this algorithm was invoked by another instance of the "unload a document" algorithm
   (i.e. by the steps below that invoke this algorithm for all descendant browsing contexts), then
   jump to the step labeled <i>end</i>.<li><p>Let <var>descendants</var> be the <a href=#list-of-the-descendant-browsing-contexts id=unloading-documents:list-of-the-descendant-browsing-contexts-2>list of the descendant browsing
   contexts</a> of the <code id=unloading-documents:document-20><a href=#document>Document</a></code>.<li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href=#browsing-context id=unloading-documents:browsing-context-4>browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href=#unload-a-document id=unloading-documents:unload-a-document>Unload</a> the <a href=#active-document id=unloading-documents:active-document-3>active document</a> of the
     <a href=#browsing-context id=unloading-documents:browsing-context-5>browsing context</a> <var>b</var> with the <var>recycle</var>
     parameter set to false.<li><p>If the <i id=unloading-documents:concept-document-salvageable-6><a href=#concept-document-salvageable>salvageable</a></i> state of the <a href=#active-document id=unloading-documents:active-document-4>active
     document</a> of the <a href=#browsing-context id=unloading-documents:browsing-context-6>browsing context</a> <var>b</var> is false, then set
     the <i id=unloading-documents:concept-document-salvageable-7><a href=#concept-document-salvageable>salvageable</a></i> state of <em>this</em> document to
     false also.</ol>

   <li><p>If both the <code id=unloading-documents:document-21><a href=#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-8><a href=#concept-document-salvageable>salvageable</a></i> state and <var>recycle</var> are
   false, then the <code id=unloading-documents:document-22><a href=#document>Document</a></code>'s <a href=#concept-document-bc id=unloading-documents:concept-document-bc>browsing
   context</a> must <a href=#discard-a-document id=unloading-documents:discard-a-document>discard the
   <code>Document</code></a>.<li><p><i>End</i>: Decrease the <code id=unloading-documents:document-23><a href=#document>Document</a></code>'s <a href=#ignore-opens-during-unload-counter id=unloading-documents:ignore-opens-during-unload-counter-4>ignore-opens-during-unload
   counter</a> by one.</ol>

  <p>This specification defines the following <dfn id=unloading-document-cleanup-steps data-export="">unloading document cleanup
  steps</dfn>. Other specifications can define more.</p>

  <ol><li><p>Let <var>window</var> be the <code id=unloading-documents:document-24><a href=#document>Document</a></code>'s <code id=unloading-documents:window-4><a href=#window>Window</a></code> object.<li>

    <p>For each <code id=unloading-documents:websocket><a href=#websocket>WebSocket</a></code> object <var>webSocket</var> whose <a href=#concept-relevant-global id=unloading-documents:concept-relevant-global>relevant global object</a> is equal to <var>window</var>,
    <a href=#make-disappear id=unloading-documents:make-disappear>make disappear</a> <var>webSocket</var>.</p>

    <p>If this affected any <code id=unloading-documents:websocket-2><a href=#websocket>WebSocket</a></code> objects, then set the <code id=unloading-documents:document-25><a href=#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-9><a href=#concept-document-salvageable>salvageable</a></i> state to false.</p>

   <li>

    <p>If the <code id=unloading-documents:document-26><a href=#document>Document</a></code>'s <i id=unloading-documents:concept-document-salvageable-10><a href=#concept-document-salvageable>salvageable</a></i>
    state is false, run the following substeps:</p>

    <ol><li><p>For each <code id=unloading-documents:eventsource><a href=#eventsource>EventSource</a></code> object <var>eventSource</var> whose <a href=#concept-relevant-global id=unloading-documents:concept-relevant-global-2>relevant global object</a> is equal to <var>window</var>,
     <a href=#concept-eventsource-forcibly-close id=unloading-documents:concept-eventsource-forcibly-close>forcibly close</a>
     <var>eventSource</var>.<li><p>Empty <var>window</var>'s <a href=#list-of-active-timers id=unloading-documents:list-of-active-timers>list of active timers</a>.</ol>

   </ol>

  



  <h5 id=the-beforeunloadevent-interface>7.8.11.1 The <code id=the-beforeunloadevent-interface:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface<a href=#the-beforeunloadevent-interface class=self-link></a></h5>

  <pre class=idl>interface <dfn id=beforeunloadevent>BeforeUnloadEvent</dfn> : <a id=the-beforeunloadevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  attribute DOMString <a href=#dom-beforeunloadevent-returnvalue id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue>returnValue</a>;
};</pre>

  <p class=note>There are no <code id=the-beforeunloadevent-interface:beforeunloadevent-2><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>-specific initialization methods.</p>

  <p>The <code id=the-beforeunloadevent-interface:beforeunloadevent-3><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface is a legacy interface which allows <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document>prompting to unload the document</a> to be controlled
  not only by canceling the event, but by setting the <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute to a value besides the
  empty string. Authors should use the <code id=the-beforeunloadevent-interface:dom-event-preventdefault><a data-x-internal=dom-event-preventdefault href=https://dom.spec.whatwg.org/#dom-event-preventdefault>preventDefault()</a></code> method, or other means of canceling
  events, instead of using <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-3><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code>.</p>

  

  <p>The <dfn id=dom-beforeunloadevent-returnvalue><code>returnValue</code></dfn> attribute
  controls the process of <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document-2>prompting to unload the
  document</a>. When the event is created, the attribute must be set to
  the empty string. On getting, it must return the last value it was set to. On setting, the
  attribute must be set to the new value.</p>

  <p class=note>This attribute is a <code>DOMString</code> only for historical reasons.
  Any value besides the empty string will be treated as a request to ask the user for
  confirmation.</p>

  


  

  <h4 id=aborting-a-document-load>7.8.12 Aborting a document load<a href=#aborting-a-document-load class=self-link></a></h4>

  <p>If a <code id=aborting-a-document-load:document><a href=#document>Document</a></code> is <dfn id=abort-a-document>aborted</dfn>, the user agent must
  run the following steps:</p>

  <ol><li><p><a href=#abort-a-document id=aborting-a-document-load:abort-a-document>Abort</a> the <a href=#active-document id=aborting-a-document-load:active-document>active
   documents</a> of every <a href=#child-browsing-context id=aborting-a-document-load:child-browsing-context>child browsing context</a>. If this results in any of those
   <code id=aborting-a-document-load:document-2><a href=#document>Document</a></code> objects having their <i id=aborting-a-document-load:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state set to false, then set this
   <code id=aborting-a-document-load:document-3><a href=#document>Document</a></code>'s <i id=aborting-a-document-load:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state to false
   also.<li><p>Cancel any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=aborting-a-document-load:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm in the
   context of this <code id=aborting-a-document-load:document-4><a href=#document>Document</a></code>, discarding any <a href=#concept-task id=aborting-a-document-load:concept-task>tasks</a>
   <a href=#queue-a-task id=aborting-a-document-load:queue-a-task>queued</a> for them, and discarding any further data received from
   the network for them. If this resulted in any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=aborting-a-document-load:concept-fetch-2 data-x-internal=concept-fetch>fetch</a> algorithm being canceled or any <a href=#queue-a-task id=aborting-a-document-load:queue-a-task-2>queued</a> <a href=#concept-task id=aborting-a-document-load:concept-task-2>tasks</a> or any network data getting
   discarded, then set the <code id=aborting-a-document-load:document-5><a href=#document>Document</a></code>'s <i id=aborting-a-document-load:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state to false.<li><p>If the <code id=aborting-a-document-load:document-6><a href=#document>Document</a></code> has an <a href=#active-parser id=aborting-a-document-load:active-parser>active parser</a>, then <a href=#abort-a-parser id=aborting-a-document-load:abort-a-parser>abort that parser</a> and set the <code id=aborting-a-document-load:document-7><a href=#document>Document</a></code>'s <i id=aborting-a-document-load:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state to false.</ol>

  <p>User agents may allow users to explicitly invoke the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-2>abort a
  document</a> algorithm for a <code id=aborting-a-document-load:document-8><a href=#document>Document</a></code>. If the user does so, then, if that
  <code id=aborting-a-document-load:document-9><a href=#document>Document</a></code> is an <a href=#active-document id=aborting-a-document-load:active-document-2>active document</a>, the user agent should <a href=#queue-a-task id=aborting-a-document-load:queue-a-task-3>queue a
  task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=aborting-a-document-load:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=aborting-a-document-load:event-abort><a href=#event-abort>abort</a></code> at that <code id=aborting-a-document-load:document-10><a href=#document>Document</a></code>'s <code id=aborting-a-document-load:window><a href=#window>Window</a></code> object
  before invoking the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-3>abort</a> algorithm.</p>

  

  



  <h3 id=offline>7.9 Offline Web applications<a href=#offline class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> offline-apps<span class="and_chr yes"><span>Chrome for Android</span> <span>55+</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>2.1+</span></span><span class="safari yes"><span>Safari</span> <span>4+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><p class=caniuse>Source: <a href="http://caniuse.com/#feat=offline-apps">caniuse.com</a></div> 

  <p class=critical>This feature is in the process of being removed from the Web platform. (This
  is a long process that takes many years.) Using any of the offline Web application features at
  this time is highly discouraged. Use service workers instead. <a href=#refsSW>[SW]</a></p>

  

  <h4 id=introduction-10>7.9.1 Introduction<a href=#introduction-10 class=self-link></a></h4>

  <p><i>This section is non-normative.</i></p>

  <p>In order to enable users to continue interacting with Web applications and documents even when
  their network connection is unavailable — for instance, because they are traveling outside
  of their ISP's coverage area — authors can provide a manifest which lists the files that are
  needed for the Web application to work offline and which causes the user's browser to keep a copy
  of the files for use offline.</p>

  <p>To illustrate this, consider a simple clock applet consisting of an HTML page "<code>clock1.html</code>", a CSS style sheet "<code>clock.css</code>", and a
  JavaScript script "<code>clock.js</code>".</p>

  <p>Before adding the manifest, these three files might look like this:</p>

  <pre>&lt;!-- clock1.html -->
&lt;!DOCTYPE HTML>
&lt;html>
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Clock&lt;/title>
  &lt;script src="clock.js">&lt;/script>
  &lt;link rel="stylesheet" href="clock.css">
 &lt;/head>
 &lt;body>
  &lt;p>The time is: &lt;output id="clock">&lt;/output>&lt;/p>
 &lt;/body>
&lt;/html>
</pre>
  <pre>/* clock.css */
output { font: 2em sans-serif; }
</pre>
  <pre>/* clock.js */
setInterval(function () {
    document.getElementById('clock').value = new Date();
}, 1000);
</pre>

  <p>If the user tries to open the "<code>clock1.html</code>" page while offline, though,
  the user agent (unless it happens to have it still in the local cache) will fail with an
  error.</p>

  <p>The author can instead provide a manifest of the three files, say "<code>clock.appcache</code>":</p>

  <pre>CACHE MANIFEST
clock2.html
clock.css
clock.js
</pre>

  <p>With a small change to the HTML file, the manifest (served as <code id=introduction-10:text/cache-manifest><a href=#text/cache-manifest>text/cache-manifest</a></code>)
  is linked to the application:</p>

  <pre>&lt;!-- clock2.html -->
&lt;!DOCTYPE HTML>
&lt;html manifest="clock.appcache">
 &lt;head>
  &lt;meta charset="utf-8">
  &lt;title>Clock&lt;/title>
  &lt;script src="clock.js">&lt;/script>
  &lt;link rel="stylesheet" href="clock.css">
 &lt;/head>
 &lt;body>
  &lt;p>The time is: &lt;output id="clock">&lt;/output>&lt;/p>
 &lt;/body>
&lt;/html>
</pre>

  <p>Now, if the user goes to the page, the browser will cache the files and make them available
  even when the user is offline.</p>

  <p class=note>Authors are encouraged to include the main page in the manifest also, but in
  practice the page that referenced the manifest is automatically cached even if it isn't explicitly
  mentioned.</p>

  <p class=note>With the exception of "no-store" directive, HTTP cache headers and restrictions on
  caching pages served over TLS (encrypted, using <code id=introduction-10:https-protocol><a data-x-internal=https-protocol href=https://tools.ietf.org/html/rfc7230#section-2.7.2>https:</a></code>) are
  overridden by manifests. Thus, pages will not expire from an application cache before the user
  agent has updated it, and even applications served over TLS can be made to work offline.</p>

  <p><a href=/demos/offline/clock/clock2.html>View this example online</a>.</p>



  <h5 id=supporting-offline-caching-for-legacy-applications>7.9.1.1 Supporting offline caching for legacy applications<a href=#supporting-offline-caching-for-legacy-applications class=self-link></a></h5>

  <p><i>This section is non-normative.</i></p>

  <p>The application cache feature works best if the application logic is separate from the
  application and user data, with the logic (markup, scripts, style sheets, images, etc) listed in
  the manifest and stored in the application cache, with a finite number of static HTML pages for
  the application, and with the application and user data stored in Web Storage or a client-side
  Indexed Database, updated dynamically using Web Sockets, <code id=supporting-offline-caching-for-legacy-applications:xmlhttprequest><a data-x-internal=xmlhttprequest href=https://xhr.spec.whatwg.org/#xmlhttprequest>XMLHttpRequest</a></code>, server-sent
  events, or some other similar mechanism.</p>

  <p>This model results in a fast experience for the user: the application immediately loads, and
  fresh data is obtained as fast as the network will allow it (possibly while stale data shows).</p>

  <p>Legacy applications, however, tend to be designed so that the user data and the logic are mixed
  together in the HTML, with each operation resulting in a new HTML page from the server.</p>

  <div class=example>

   <p>For example, consider a news application. The typical architecture of such an application,
   when not using the application cache feature, is that the user fetches the main page, and the
   server returns a dynamically-generated page with the current headlines and the user interface
   logic mixed together.</p>

   <p>A news application designed for the application cache feature, however, would instead have the
   main page just consist of the logic, and would then have the main page fetch the data separately
   from the server, e.g. using <code id=supporting-offline-caching-for-legacy-applications:xmlhttprequest-2><a data-x-internal=xmlhttprequest href=https://xhr.spec.whatwg.org/#xmlhttprequest>XMLHttpRequest</a></code>.</p>

  </div>

  <p>The mixed-content model does not work well with the application cache feature: since the
  content is cached, it would result in the user always seeing the stale data from the previous time
  the cache was updated.</p>

  <p>While there is no way to make the legacy model work as fast as the separated model, it
  <em>can</em> at least be retrofitted for offline use using the <a href=#concept-appcache-mode-prefer-online id=supporting-offline-caching-for-legacy-applications:concept-appcache-mode-prefer-online>prefer-online</a> <a href=#concept-appcache-mode id=supporting-offline-caching-for-legacy-applications:concept-appcache-mode>application cache mode</a>. To do so, list all the static
  resources used by the HTML page you want to have work offline in an <a href=#concept-appcache-manifest id=supporting-offline-caching-for-legacy-applications:concept-appcache-manifest>application cache manifest</a>, use the <code id=supporting-offline-caching-for-legacy-applications:attr-html-manifest><a href=#attr-html-manifest>manifest</a></code> attribute to select that manifest from the HTML file,
  and then add the following line at the bottom of the manifest:</p>

  <pre>SETTINGS:
prefer-online
NETWORK:
*</pre>

  <p>This causes the <a href=#application-cache id=supporting-offline-caching-for-legacy-applications:application-cache>application cache</a> to only be used for <a href=#concept-appcache-master id=supporting-offline-caching-for-legacy-applications:concept-appcache-master>master entries</a> when the user is offline, and causes the
  application cache to be used as an atomic HTTP cache (essentially pinning resources listed in the
  manifest), while allowing all resources not listed in the manifest to be accessed normally when
  the user is online.</p>



  <h5 id=appcacheevents>7.9.1.2 Event summary<a href=#appcacheevents class=self-link></a></h5>

  <p><i>This section is non-normative.</i></p>

  <p>When the user visits a page that declares a manifest, the browser will try to update the cache.
  It does this by fetching a copy of the manifest and, if the manifest has changed since the user
  agent last saw it, redownloading all the resources it mentions and caching them anew.</p>

  <p>As this is going on, a number of events get fired on the <code id=appcacheevents:applicationcache><a href=#applicationcache>ApplicationCache</a></code> object
  to keep the script updated as to the state of the cache update, so that the user can be notified
  appropriately. The events are as follows:</p>

  <table><thead><tr><th> Event name
     <th> Interface
     <th> Fired when...
     <th> Next events
   <tbody><tr><td> <dfn id=event-appcache-checking><code>checking</code></dfn>
     <td> <code id=appcacheevents:event><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The user agent is checking for an update, or attempting to download the manifest for the
          first time. <strong>This is always the first event in the sequence.</strong>
     <td> <code id=appcacheevents:event-appcache-noupdate><a href=#event-appcache-noupdate>noupdate</a></code>, <code id=appcacheevents:event-appcache-downloading><a href=#event-appcache-downloading>downloading</a></code>, <code id=appcacheevents:event-appcache-obsolete><a href=#event-appcache-obsolete>obsolete</a></code>, <code id=appcacheevents:event-appcache-error><a href=#event-appcache-error>error</a></code>

    <tr><td> <dfn id=event-appcache-noupdate><code>noupdate</code></dfn>
     <td> <code id=appcacheevents:event-2><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The manifest hadn't changed.
     <td> Last event in sequence.

    <tr><td> <dfn id=event-appcache-downloading><code>downloading</code></dfn>
     <td> <code id=appcacheevents:event-3><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The user agent has found an update and is fetching it, or is downloading the resources
          listed by the manifest for the first time.
     <td> <code id=appcacheevents:event-appcache-progress><a href=#event-appcache-progress>progress</a></code>, <code id=appcacheevents:event-appcache-error-2><a href=#event-appcache-error>error</a></code>, <code id=appcacheevents:event-appcache-cached><a href=#event-appcache-cached>cached</a></code>, <code id=appcacheevents:event-appcache-updateready><a href=#event-appcache-updateready>updateready</a></code>

    <tr><td> <dfn id=event-appcache-progress><code>progress</code></dfn>
     <td> <code id=appcacheevents:progressevent><a data-x-internal=progressevent href=https://xhr.spec.whatwg.org/#interface-progressevent>ProgressEvent</a></code>
     <td> The user agent is downloading resources listed by the manifest.
          The event object's <code id=appcacheevents:dom-progressevent-total><a data-x-internal=dom-progressevent-total href=https://xhr.spec.whatwg.org/#dom-progressevent-total>total</a></code> attribute returns the total number of files to be downloaded.
          The event object's <code id=appcacheevents:dom-progressevent-loaded><a data-x-internal=dom-progressevent-loaded href=https://xhr.spec.whatwg.org/#dom-progressevent-loaded>loaded</a></code> attribute returns the number of files processed so far.
     <td> <code id=appcacheevents:event-appcache-progress-2><a href=#event-appcache-progress>progress</a></code>, <code id=appcacheevents:event-appcache-error-3><a href=#event-appcache-error>error</a></code>, <code id=appcacheevents:event-appcache-cached-2><a href=#event-appcache-cached>cached</a></code>, <code id=appcacheevents:event-appcache-updateready-2><a href=#event-appcache-updateready>updateready</a></code>

    <tr><td> <dfn id=event-appcache-cached><code>cached</code></dfn>
     <td> <code id=appcacheevents:event-4><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The resources listed in the manifest have been downloaded, and the application is now cached.
     <td> Last event in sequence.

    <tr><td> <dfn id=event-appcache-updateready><code>updateready</code></dfn>
     <td> <code id=appcacheevents:event-5><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The resources listed in the manifest have been newly redownloaded, and the script can use
          <code id=appcacheevents:dom-appcache-swapcache><a href=#dom-appcache-swapcache>swapCache()</a></code> to switch to the new cache.
     <td> Last event in sequence.

    <tr><td> <dfn id=event-appcache-obsolete><code>obsolete</code></dfn>
     <td> <code id=appcacheevents:event-6><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The manifest was found to have become a 404 or 410 page, so the application cache is being deleted.
     <td> Last event in sequence.

    <tr><td rowspan=4> <dfn id=event-appcache-error><code>error</code></dfn>
     <td rowspan=4> <code id=appcacheevents:event-7><a data-x-internal=event href=https://dom.spec.whatwg.org/#interface-event>Event</a></code>
     <td> The manifest was a 404 or 410 page, so the attempt to cache the application has been aborted.
     <td rowspan=3> Last event in sequence.

    <tr><td> The manifest hadn't changed, but the page referencing the manifest failed to download properly.

    <tr><td> A fatal error occurred while fetching the resources listed in the manifest.

    <tr><td> The manifest changed while the update was being run.
     <td> The user agent will try fetching the files again momentarily.

  </table>

  <p>These events are cancelable; their default action is for the user agent to show download
  progress information. If the page shows its own update UI, canceling the events will prevent the
  user agent from showing redundant progress information.</p>



  

  <h4 id=appcache>7.9.2 Application caches<a href=#appcache class=self-link></a></h4> 

  <p>An <dfn id=application-cache data-export="">application cache</dfn> is a set of cached resources consisting of:</p>

  <ul><li>

    <p>One or more resources (including their out-of-band metadata, such as HTTP headers, if any),
    identified by URLs, each falling into one (or more) of the following categories:</p>

    <dl><dt><dfn id=concept-appcache-master>Master entries</dfn>

     <dd><p class=note>These are documents that were added to the cache because a <a href=#browsing-context id=appcache:browsing-context>browsing
     context</a> was <a href=#navigate id=appcache:navigate>navigated</a> to that document and the document
     indicated that this was its cache, using the <code id=appcache:attr-html-manifest><a href=#attr-html-manifest>manifest</a></code>
     attribute.</p>


     <dt><dfn id=concept-appcache-manifest>The manifest</dfn>

     <dd><p class=note>This is the resource corresponding to the URL that was given in a master
     entry's <code id=appcache:the-html-element><a href=#the-html-element>html</a></code> element's <code id=appcache:attr-html-manifest-2><a href=#attr-html-manifest>manifest</a></code> attribute.
     The manifest is fetched and processed during the <a href=#application-cache-download-process id=appcache:application-cache-download-process>application cache download
